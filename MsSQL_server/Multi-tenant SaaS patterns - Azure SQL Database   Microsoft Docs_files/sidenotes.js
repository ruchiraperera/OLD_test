!function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else if("object"==typeof Livefyre&&"function"==typeof Livefyre.define&&Livefyre.define.amd)Livefyre.define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(g.Livefyre||(g.Livefyre={})).Sidenotes=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){function Swipe(n,t){"use strict";function e(){E=x.children,w=E.length,E.length<2&&(t.continuous=!1),f.transitions&&t.continuous&&E.length<3&&(x.appendChild(E[0].cloneNode(!0)),x.appendChild(x.children[1].cloneNode(!0)),E=x.children),m=new Array(E.length),p=n.getBoundingClientRect().width||n.offsetWidth,x.style.width=E.length*p+"px";for(var e=E.length;e--;){var i=E[e];i.style.width=p+"px",i.setAttribute("data-index",e),f.transitions&&(i.style.left=e*-p+"px",a(e,b>e?-p:b<e?p:0,0))}t.continuous&&f.transitions&&(a(s(b-1),-p,0),a(s(b+1),p,0)),f.transitions||(x.style.left=b*-p+"px"),n.style.visibility="visible"}function i(){t.continuous?r(b-1):b&&r(b-1)}function o(){t.continuous?r(b+1):b<E.length-1&&r(b+1)}function s(n){return(E.length+n%E.length)%E.length}function r(n,e){if(b!=n){if(f.transitions){var i=Math.abs(b-n)/(b-n);if(t.continuous){var o=i;(i=-m[s(n)]/p)!==o&&(n=-i*E.length+n)}for(var r=Math.abs(b-n)-1;r--;)a(s((n>b?n:b)-r-1),p*i,0);n=s(n),a(b,p*i,e||g),a(n,0,e||g),t.continuous&&a(s(n-i),-p*i,0)}else n=s(n),c(b*-p,n*-p,e||g);b=n,h(t.callback&&t.callback(b,E[b]))}}function a(n,t,e){u(n,t,e),m[n]=t}function u(n,t,e){var i=E[n],o=i&&i.style;o&&(o.webkitTransitionDuration=o.MozTransitionDuration=o.msTransitionDuration=o.OTransitionDuration=o.transitionDuration=e+"ms",o.webkitTransform="translate("+t+"px,0)translateZ(0)",o.msTransform=o.MozTransform=o.OTransform="translateX("+t+"px)")}function c(n,e,i){if(!i)return void(x.style.left=e+"px");var o=+new Date,s=setInterval(function(){var r=+new Date-o;if(r>i)return x.style.left=e+"px",L&&d(),t.transitionEnd&&t.transitionEnd.call(event,b,E[b]),void clearInterval(s);x.style.left=(e-n)*(Math.floor(r/i*100)/100)+n+"px"},4)}function d(){T=setTimeout(o,L)}function l(){L=0,clearTimeout(T)}var v=function(){},h=function(n){setTimeout(n||v,0)},f={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(n){var t=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var e in t)if(void 0!==n.style[t[e]])return!0;return!1}(document.createElement("swipe"))};if(n){var E,m,p,w,x=n.children[0];t=t||{};var b=parseInt(t.startSlide,10)||0,g=t.speed||300;t.continuous=void 0===t.continuous||t.continuous;var T,y,L=t.auto||0,k={},D={},M={handleEvent:function(n){switch(n.type){case"touchstart":this.start(n);break;case"touchmove":this.move(n);break;case"touchend":h(this.end(n));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":h(this.transitionEnd(n));break;case"resize":h(e)}t.stopPropagation&&n.stopPropagation()},start:function(n){var t=n.touches[0];k={x:t.pageX,y:t.pageY,time:+new Date},y=void 0,D={},x.addEventListener("touchmove",this,!1),x.addEventListener("touchend",this,!1)},move:function(n){if(!(n.touches.length>1||n.scale&&1!==n.scale)){t.disableScroll&&n.preventDefault();var e=n.touches[0];D={x:e.pageX-k.x,y:e.pageY-k.y},void 0===y&&((y=!!(y||Math.abs(D.x)<Math.abs(D.y)))||t.slideMove&&t.slideMove.call(n,E[b])),y||(n.preventDefault(),l(),t.continuous?(u(s(b-1),D.x+m[s(b-1)],0),u(b,D.x+m[b],0),u(s(b+1),D.x+m[s(b+1)],0)):(D.x=D.x/(!b&&D.x>0||b==E.length-1&&D.x<0?Math.abs(D.x)/p+1:1),u(b-1,D.x+m[b-1],0),u(b,D.x+m[b],0),u(b+1,D.x+m[b+1],0)))}},end:function(n){var e=+new Date-k.time,i=Number(e)<250&&Math.abs(D.x)>20||Math.abs(D.x)>p/2,o=!b&&D.x>0||b==E.length-1&&D.x<0;t.continuous&&(o=!1);var r=D.x<0;y||(i&&!o?(r?(t.continuous?(a(s(b-1),-p,0),a(s(b+2),p,0)):a(b-1,-p,0),a(b,m[b]-p,g),a(s(b+1),m[s(b+1)]-p,g),b=s(b+1)):(t.continuous?(a(s(b+1),p,0),a(s(b-2),-p,0)):a(b+1,p,0),a(b,m[b]+p,g),a(s(b-1),m[s(b-1)]+p,g),b=s(b-1)),t.callback&&t.callback(b,E[b])):t.continuous?(a(s(b-1),-p,g),a(b,0,g),a(s(b+1),p,g)):(a(b-1,-p,g),a(b,0,g),a(b+1,p,g))),x.removeEventListener("touchmove",M,!1),x.removeEventListener("touchend",M,!1)},transitionEnd:function(n){parseInt(n.target.getAttribute("data-index"),10)==b&&(L&&d(),t.transitionEnd&&t.transitionEnd.call(n,b,E[b]))}};return e(),L&&d(),f.addEventListener?(f.touch&&x.addEventListener("touchstart",M,!1),f.transitions&&(x.addEventListener("webkitTransitionEnd",M,!1),x.addEventListener("msTransitionEnd",M,!1),x.addEventListener("oTransitionEnd",M,!1),x.addEventListener("otransitionend",M,!1),x.addEventListener("transitionend",M,!1)),window.addEventListener("resize",M,!1)):window.onresize=function(){e()},{setup:function(){e()},slide:function(n,t){l(),r(n,t)},prev:function(){l(),i()},next:function(){l(),o()},stop:function(){l()},getPos:function(){return b},getNumSlides:function(){return w},kill:function(){l(),x.style.width="",x.style.left="";for(var n=E.length;n--;){var t=E[n];t.style.width="",t.style.left="",f.transitions&&u(n,0,0)}f.addEventListener?(x.removeEventListener("touchstart",M,!1),x.removeEventListener("webkitTransitionEnd",M,!1),x.removeEventListener("msTransitionEnd",M,!1),x.removeEventListener("oTransitionEnd",M,!1),x.removeEventListener("otransitionend",M,!1),x.removeEventListener("transitionend",M,!1),window.removeEventListener("resize",M,!1)):window.onresize=null}}}}module.exports=Swipe},{}],2:[function(_dereq_,module,exports){"use strict";function callableOnce(t,i){var e=0;return i=i||{},function(){if(++e>1)return void log(["This function is only meant to be called once, but it was called ",e," times"].join(""));t.apply(i,arguments)}}var inherits=_dereq_("./../../inherits/inherits.js"),EventEmitter=_dereq_("./../../event-emitter/src/event-emitter"),log=_dereq_("./../../debug/debug.js")("auth"),bind=_dereq_("./util/bind"),Auth=module.exports=function(){var t,i=!1,e=!1;EventEmitter.apply(this),this._delegate=!1;var n=function(i){return i?t&&t[i]:t};this.on("login",function(n){t=n,i=!0,e=!0}),this.on("authenticate",function(){e=!0}),this.on("logout",function(){t=null,i=!1,e=!1}),this.on("error",function(t){log(t)}),this.get=n,this.isAuthenticated=function(){return e}};inherits(Auth,EventEmitter),Auth.prototype.delegate=function(t){return log("Auth#delegate",t),this._delegate={},t.login&&(this._delegate.login=bind(t.login,t)),t.logout&&(this._delegate.logout=bind(t.logout,t)),t.viewProfile&&(this._delegate.viewProfile=bind(t.viewProfile,t)),t.editProfile&&(this._delegate.editProfile=bind(t.editProfile,t)),t.forEachAuthentication&&t.forEachAuthentication(bind(function(t){this._authenticate(t)},this)),this.emit("delegate",t),this},Auth.prototype.hasDelegate=function(t){return"string"==typeof t?this._delegate&&this._delegate.hasOwnProperty(t):!!this._delegate},Auth.prototype.login=function(t){if(t&&"function"!=typeof t)return this._loginUser(t);var i=t;log("Auth#login"),(0,this._delegate.login)(bind(callableOnce(function(){this._finishLogin.apply(this,arguments),"function"==typeof i&&i.apply(this,arguments)},this)))},Auth.prototype._loginUser=function(t){this.emit("login",t);for(var i in t)t.hasOwnProperty(i)&&this.emit("login."+i,t[i])},Auth.prototype._finishLogin=function(t,i){if(log("Auth#_finishLogin",t,i),t)return void this.emit("error",t);i||log(["_finishLogin called without a truthy second parameter. The user","cannot be authenticated."].join(" ")),this._authenticate(i)},Auth.prototype.logout=function(t){log("Auth#logout");var i=this._delegate.logout,e=new Error("No logout auth delegate");if(!i){if("function"!=typeof t)throw e;return void t(e)}i(bind(callableOnce(function(){this._finishLogout.apply(this,arguments),"function"==typeof t&&t.apply(this,arguments)},this)))},Auth.prototype._finishLogout=function(t,i){if(log("Auth#_finishLogout",i),t)return void this.emit("error",t);this.emit("logout")},Auth.prototype.authenticate=function(t){this._authenticate(t)},Auth.prototype._authenticate=function(t){if(t){for(var i in t)t.hasOwnProperty(i)&&this.emit("authenticate."+i,t[i]);this.emit("authenticate",t)}},Auth.prototype.viewProfile=function(t){this._delegate.viewProfile(t)},Auth.prototype.editProfile=function(t){this._delegate.editProfile(t)},Auth.prototype.plugin=function(t){return t(this),this}},{"./../../debug/debug.js":6,"./../../event-emitter/src/event-emitter":10,"./../../inherits/inherits.js":11,"./util/bind":4}],3:[function(_dereq_,module,exports){var Auth=_dereq_("./auth"),createAuth=function(e){return new Auth(e)};exports=module.exports=createAuth(),exports.create=createAuth},{"./auth":2}],4:[function(_dereq_,module,exports){module.exports=function(r,t,e){if(!r)throw new Error;if(arguments.length>2){var n=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,n),r.apply(t,e)}}return function(){return r.apply(t,arguments)}}},{}],5:[function(_dereq_,module,exports){function InvalidCharacterError(r){this.message=r}var base64={},chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";InvalidCharacterError.prototype=new Error,InvalidCharacterError.prototype.name="InvalidCharacterError",base64.btoa=window.btoa?function(r){return window.btoa(r)}:function(r){for(var a,e,t=0,o=chars,n="";r.charAt(0|t)||(o="=",t%1);n+=o.charAt(63&a>>8-t%1*8)){if((e=r.charCodeAt(t+=.75))>255)throw new InvalidCharacterError("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");a=a<<8|e}return n},base64.atob=window.atob?function(r){return window.atob(r)}:function(r){if(r=r.replace(/=+$/,""),r.length%4==1)throw new InvalidCharacterError("'atob' failed: The string to be decoded is not correctly encoded.");for(var a,e,t=0,o=0,n="";e=r.charAt(o++);~e&&(a=t%4?64*a+e:e,t++%4)?n+=String.fromCharCode(255&a>>(-2*t&6)):0)e=chars.indexOf(e);return n},base64.url={btoa:function(r){var a=base64.btoa(r);return a=a.replace(/\+/g,"-"),a=a.replace(/\//g,"_")},atob:function(r){var a=r;return a=a.replace(/-/g,"+"),a=a.replace(/_/g,"/"),base64.atob(a)}},module.exports=base64},{}],6:[function(_dereq_,module,exports){function debug(e){return debug.enabled(e)?function(n){n=coerce(n);var u=new Date,o=u-(debug[e]||u);debug[e]=u,n=e+" "+n+" +"+debug.humanize(o),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function coerce(e){return e instanceof Error?e.stack||e.message:e}module.exports=debug,debug.names=[],debug.skips=[],debug.enable=function(e){try{localStorage.debug=e}catch(e){}for(var n=(e||"").split(/[\s,]+/),u=n.length,o=0;o<u;o++)e=n[o].replace("*",".*?"),"-"===e[0]?debug.skips.push(new RegExp("^"+e.substr(1)+"$")):debug.names.push(new RegExp("^"+e+"$"))},debug.disable=function(){debug.enable("")},debug.humanize=function(e){return e>=36e5?(e/36e5).toFixed(1)+"h":e>=6e4?(e/6e4).toFixed(1)+"m":e>=1e3?(e/1e3|0)+"s":e+"ms"},debug.enabled=function(e){for(var n=0,u=debug.skips.length;n<u;n++)if(debug.skips[n].test(e))return!1;for(var n=0,u=debug.names.length;n<u;n++)if(debug.names[n].test(e))return!0;return!1};try{window.localStorage&&debug.enable(localStorage.debug)}catch(e){}},{}],7:[function(_dereq_,module,exports){function Arc4(){this._state=[],this._index1=0,this._index2=0}Arc4.prototype.setKey=function(t,i){i||(i=t.length);for(var e=this._state,s=0;s<256;++s)e[s]=s;for(var n=0,s=0;s<256;++s){n=n+e[s]+t[s%i]&255;var r=e[s];e[s]=e[n],e[n]=r}this._index1=0,this._index2=0},Arc4.prototype.discard=function(t){for(var i=this._index1,e=this._index2,s=this._state,n=0;n<t;++n){i=i+1&255,e=e+s[i]&255;var r=s[i];s[i]=s[e],s[e]=r}this._index1=i,this._index2=e},Arc4.prototype.crypt=function(t,i){i||(i=t.length);for(var e=this._index1,s=this._index2,n=this._state,r=0;r<i;++r){e=e+1&255,s=s+n[e]&255;var h=n[e];n[e]=n[s],n[s]=h,t[r]^=n[n[e]+n[s]&255]}this._index1=e,this._index2=s},module.exports=Arc4},{}],8:[function(_dereq_,module,exports){function ErefProcessor(e){this._keys=[],Transform.call(this,e)}function map(e,r){for(var t=[],o=0;o<e.length;o++)t.push(r(e[o]));return t}var eref=_dereq_("./main"),inherits=_dereq_("./../../inherits/inherits.js"),Transform=_dereq_("./../../stream/src/transform");inherits(ErefProcessor,Transform),ErefProcessor.BATCH_SIZE=20,ErefProcessor.TIMEOUT=300;var encryptedSet={},encrypted=[],buffered=[],drainAfterWait=null;ErefProcessor.prototype.setKeys=function(e){for(var r=[],t=0;t<e.length;t++)void 0!==e[t]&&r.push(e[t]);this._keys=r},ErefProcessor.prototype.getKeys=function(){return this._keys},ErefProcessor.prototype._transform=function(e,r){this.handleEncrypted(e),r()},ErefProcessor.prototype.drainBuffer=function(){for(;buffered.length;)this.push(buffered.slice(0,ErefProcessor.BATCH_SIZE)),buffered=buffered.slice(ErefProcessor.BATCH_SIZE)},ErefProcessor.prototype.handleDecrypted=function(e){for(var r,t,o=map(encrypted,function(e){return e.join()}),n=map(e,function(e){return e.join()}),f=0;f<n.length;f++)t=n[f],encryptedSet[t]&&(r=o.indexOf(t),encrypted.pop(r),encryptedSet[t]=null)},ErefProcessor.prototype.handleEncrypted=function(e){var r=this.maybeDecrypt(e);if(r){buffered.push.apply(buffered,r),buffered.length>=ErefProcessor.BATCH_SIZE&&this.drainBuffer();var t=this;drainAfterWait&&clearTimeout(drainAfterWait),drainAfterWait=setTimeout(function(){t.drainBuffer()},ErefProcessor.TIMEOUT)}},ErefProcessor.prototype.maybeDecrypt=function(e){var r,t=this.getKeys(),o=[];if(r=eref.decryptErefs(e,t))return o.push(r),o;encryptedSet[e.join()]||(encrypted.push(e),encryptedSet[e.join()]=!0)},ErefProcessor.prototype.processStorage=function(){for(var e=0;e<encrypted.length;e++)this.write(encrypted[e])},ErefProcessor.prototype._getBuffer=function(){return buffered},ErefProcessor.prototype._setBuffer=function(e){buffered=e},ErefProcessor.prototype._getCache=function(){return encrypted},ErefProcessor.prototype._setCache=function(e){encrypted=e},module.exports=ErefProcessor},{"./../../inherits/inherits.js":11,"./../../stream/src/transform":48,"./main":9}],9:[function(_dereq_,module,exports){function stringToByteArray(r){for(var e,t=[],n=0,f=0;f<r.length;f++){for(e=r.charCodeAt(f);e>255;)t[n++]=255&e,e>>=8;t[n++]=e}return t}function byteArrayToString(r){return String.fromCharCode.apply(null,r)}function arc4Decrypt(r,e){var t=new Arc4;return r=stringToByteArray(r),e=base64.atob(e),e=stringToByteArray(e),t.setKey(r),t.crypt(e),byteArrayToString(e)}function decryptEref(r,e){var t=arc4Decrypt(e,r),n=t.match(EREF_REGEX);return n?n[1]:null}var Arc4=_dereq_("./arc4"),base64=_dereq_("./../../base64/base64"),EREF_REGEX=/^eref:\/\/([^:\/]+:[^:\/]+\/[^:\/]+)$/,eref={};eref.decryptEref=function(r,e){for(var t,n=0,f=e.length;n<f;n++)if(t=decryptEref(r,e[n]))return t;return null},eref.decryptErefs=function(r,e){for(var t,n,f=0,a=r.length;f<a;f++)if(t=r[f],n=eref.decryptEref(t,e))return n},module.exports=eref},{"./../../base64/base64":5,"./arc4":7}],10:[function(_dereq_,module,exports){function indexOf(t,e){if(Array.prototype.indexOf)return t.indexOf(e);for(var r=0,n=t.length;r<n;r++)if(t[r]===e)return r;return-1}function forEach(t,e,r){if(null!=t)for(var n=-1,i=t.length;++n<i&&!1!==e.call(r,t[n],n,t););}var slice=Array.prototype.slice,EventEmitter=module.exports=function(){this._listeners={}};EventEmitter.listenerCount=function(t,e){var r=t._listeners[e];return r?r.length:0},EventEmitter.prototype.on=function(t,e){return this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.once=function(t,e){function r(){this.removeListener(t,r),e.apply(this,arguments)}return r.listener=e,this.on(t,r)},EventEmitter.prototype.removeListener=function(t,e){if(e&&this._listeners[t]){var r=indexOf(this._listeners[t],e);if(-1===r)return;this._listeners[t].splice(r,1)}},EventEmitter.prototype.removeAllListeners=function(t){var e={};t?e[t]=this.listeners(t):e=this._listeners;var r;for(var n in e){if(!e.hasOwnProperty(n))return;r=e[n].slice(),forEach(r,function(t){this.removeListener(n,t)},this)}return this},EventEmitter.prototype.listeners=function(t){return this._listeners[t].slice()||[]},EventEmitter.prototype.emit=function(t){var e,r=this._listeners[t]||[],n=slice.call(arguments,1);if(r.length&&(r=r.slice()),"error"===t&&!r.length)throw e=n[0],e instanceof Error?e:TypeError('Uncaught, unspecified "error" event');for(var i=0,s=r.length;i<s;i++)try{r[i].apply(this,n)}catch(e){switch(t){case"error":try{this.emit("errorOnError",e)}catch(t){throw new Error("event-emitter: There was an exceptionin the errorInOnError listener",e,this)}break;default:this.emit("error",e)}}}},{}],11:[function(_dereq_,module,exports){module.exports=function(){function t(t,o){var r=function(){};r.prototype=o.prototype,t.prototype=new r,t.prototype.constructor=t}return t.parasitically=function(o,r){for(var e,n=t.keys(r.prototype),p=n.length,y=0;y<p;y++)e=n[y],o.prototype[e]||(o.prototype[e]=r.prototype[e])},t.keys=Object.keys||function(){var t=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=r.length;return function(n){if("object"!=typeof n&&"function"!=typeof n||null===n)throw new TypeError("Object.keys called on a non-object");var p=[];for(var y in n)t.call(n,y)&&p.push(y);if(o)for(var c=0;c<e;c++)t.call(n,r[c])&&p.push(r[c]);return p}}(),t}()},{}],12:[function(_dereq_,module,exports){function isFyreOld(e){var n="function"==typeof e.loginByCookie,o=window.fyre&&"object"==typeof window.fyre.conv;return!!n&&!!o}function isBetaDelegate(e){var n="function"==typeof e.restoreSession,o=window.Livefyre&&"object"==typeof window.Livefyre.user;return n&&o}function isOld(e){return isFyreOld(e)||isBetaDelegate(e)}function adaptBetaDelegate(e){function n(e,n){"function"==typeof e&&e.apply(this,null,n)}function o(n){var o=new LivefyreUser;n.serverUrl=e.serverUrl,o=authApi.updateUser(o,n),auth.login({livefyre:o})}function t(){auth.emit("logout")}var i={},r=window.Livefyre;return r.user.on("login",o),r.user.on("logout",t),i.login=function(){var o=e.login;return function(t){o.call(e),r.user.once("login",function(e){n(t,[e])})}}(),i.logout=function(){var o=e.logout;return function(t){o.call(e),r.user.once("logout",function(){n(t)})}}(),i.viewProfile=bind(e.viewProfile,e),i.editProfile=bind(e.editProfile,e),i.destroy=function(){r.user.removeListener("login",o),r.user.removeListener("logout",t),e.destroy()},i}function adaptOldDelegate(e){function n(e,n){if(!n)return auth.emit("logout");auth.login({livefyre:session.get()})}function o(e){return{success:function(){"function"==typeof e&&e.apply(this,null,arguments)},failure:function(){"function"==typeof e&&e.apply(this,arguments)}}}var t=window.fyre;t.conv.user.on("change:token",n),t.conv.user.id&&(auth.get("livefyre")||n(t.conv.user.get("token")));var i={success:function(){},failure:function(){}},r=Array.prototype.slice,u={};return u.login=function(){var n=e.login;return function(t){n.call(e,o(t))}}(),u.logout=function(){var n=e.logout;return function(o){n.call(e,i),o()}}(),u.viewProfile=function(){var n=e.viewProfile;return function(){var o=r.call(arguments);o.unshift(i),n.apply(e,o)}}(),u.editProfile=function(){var n=e.editProfile;return function(){var o=r.call(arguments);o.unshift(i),n.apply(e,o)}}(),u.destroy=function(){t.conv.user.off("change:token",n)},e.loginByCookie(i),u}function oldToNew(e){return isBetaDelegate(e)?adaptBetaDelegate(e):isFyreOld(e)?adaptOldDelegate(e):e}var auth=_dereq_("./../../auth/src/main"),authApi=_dereq_("./auth-api"),bind=_dereq_("./../../mout/src/function/bind"),LivefyreUser=_dereq_("./user"),session=_dereq_("./session");module.exports={oldToNew:oldToNew,isOld:isOld}},{"./../../auth/src/main":3,"./../../mout/src/function/bind":26,"./auth-api":13,"./session":16,"./user":17}],13:[function(_dereq_,module,exports){function jsonpError(e){var r=e&&e.code;if(200!==r){var t=new Error("Error requesting with JSONP");return t.response=e,t.code=r,t}}function extend(e){for(var r,t=[].slice.call(arguments,1),o=0,n=t.length;o<n;o++){r=t[o];for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}function qsParam(e,r){return"{key}={value}".replace("{key}",e).replace("{value}",encodeURIComponent(r))}function networkFromToken(e){var r=e.split(".");if(3!==r.length)throw new Error("The provided lftoken is not a JWT: "+e);var t=base64.atob(r[1]);return JSON.parse(t).domain}function getDomain(e){return e.split(".")[0]}function serverUrlFromNetwork(e){var r=getDomain(e),t="http:"!==document.location.protocol?"https:":document.location.protocol;return"livefyre"===r?t+"//admin."+e:t+"//"+r+".admin.fyre.co"}function serverUrlFromToken(e){return serverUrlFromNetwork(networkFromToken(e))}var base64=_dereq_("./../../base64/base64"),CollectionAuthorization=_dereq_("./collection-authorization"),filter=_dereq_("./../../mout/src/array/filter"),jsonp=_dereq_("./util/jsonp"),map=_dereq_("./../../mout/src/array/map"),authApi=module.exports={};authApi.authenticate=function(e,r){var t,o,n=[],i=e&&e.token,a=e&&e.serverUrl;i&&n.push(qsParam("lftoken",e.token)),e.network&&(a=serverUrlFromNetwork(e.network)),a||(a=i?serverUrlFromToken(i):"http://livefyre.com"),e.bpChannel&&n.push(qsParam("bp_channel",e.bpChannel)),e.articleId&&e.siteId&&n.push(qsParam("articleId",base64.btoa(e.articleId)),qsParam("siteId",e.siteId)),t=n.join("&"),o=[a,"/api/v3.0/auth/?",t].join(""),this._request(o,function(e,t){e||(e=jsonpError(t));var o=t&&t.data;r(e,o)})},authApi._request=function(e,r){jsonp.req(e,r)},authApi.updateUser=function(e,r,t){var o,n=r.profile,i=r.token,a=i&&i.value,s=i&&new Date(+new Date+1e3*i.ttl),u=r.collection_id,l=extend({},n,{serverUrl:r.serverUrl,token:a,tokenExpiresAt:s});e.set(l);var c=[];u&&(o=this.createCollectionAuthorization(t||{},r))&&c.push(o);var p=this.createNetworkAuthorizations(r);p.length>0&&c.push.apply(c,p);var h=this.createSiteAuthorizations(r);h.length>0&&c.push.apply(c,h);var d=filter(c,function(r){return r.network?!e.isMod({network:r.network}):r.siteId?!e.isMod({siteId:r.siteId}):!(!r.collection||!r.collection.id||e.isMod({collectionId:r.collection.id}))});return d.length>0&&e.authorizations.push.apply(e.authorizations,d),e},authApi.createCollectionAuthorization=function(e,r){var t={network:e.network,id:r.collection_id,siteId:e.siteId,articleId:e.articleId},o=new CollectionAuthorization(t),n=r.permissions,i=n&&n.authors;i&&i.length>0&&o.authors.push.apply(o.authors,i);var a=n&&n.moderator_key;return a&&(o.moderatorKey=a),o},authApi.createNetworkAuthorizations=function(e){var r=e.modScopes,t=r&&r.networks;return t&&t.length>0?map(t,function(e){return{network:e,moderator:!0}}):[]},authApi.createSiteAuthorizations=function(e){var r=e.modScopes,t=r&&r.sites;return t&&t.length>0?map(t,function(e){return{siteId:e,moderator:!0}}):[]}},{"./../../base64/base64":5,"./../../mout/src/array/filter":21,"./../../mout/src/array/map":22,"./collection-authorization":14,"./util/jsonp":18}],14:[function(_dereq_,module,exports){module.exports=function(o){this.collection=o,this.authors=[],this.moderatorKey=null}},{}],15:[function(_dereq_,module,exports){"use strict";function validateCollection(r){for(var e=["siteId","articleId","network"],t=0,o=e.length;t<o;t++){var i=e[t];if(!r[i])throw collectionOptError(i,r)}}function collectionOptError(r,e){var t=new Error("Missing Collection option "+r);return t.collection=e,t.missingOption=r,t}var authApi=_dereq_("./auth-api"),map=_dereq_("./../../mout/src/array/map"),session=_dereq_("./session"),permissions=module.exports={};permissions.forCollection=function(r,e,t){validateCollection(e);var o={};o.token=r.get("token"),o.serverUrl=r.get("serverUrl"),o.siteId=e.siteId,o.articleId=e.articleId,authApi.authenticate(o,function(r,e){return r?t(r):e.profile?(e.serverUrl=o.serverUrl,void t(null,e)):(r=new Error("fetch-user got empty auth response"),t(r))})},permissions.getKeys=function(r,e,t){function o(r){var e=map(r.authors,function(r){return r.key});return r.moderatorKey?e.concat([r.moderatorKey]):e}var i=r.getAuthorizationByCollectionId(e.id);if(i)return t(null,o(i));permissions.forCollection(r,e,function(n,s){if(n)return t(n);authApi.updateUser(r,s),session.save(s,r),i=r.getAuthorizationByCollectionId(e.id),t(null,o(i))})}},{"./../../mout/src/array/map":22,"./auth-api":13,"./session":16}],16:[function(_dereq_,module,exports){var authApi=_dereq_("./auth-api"),deepClone=_dereq_("./../../mout/src/lang/deepClone"),LivefyreUser=_dereq_("./user"),storage=_dereq_("./util/storage");module.exports={get:function(){var e=storage.get("fyre-auth")||{};if(!e.token)return null;var r=new LivefyreUser;return authApi.updateUser(r,e),r},save:function(e,r){var t=deepClone(e),a=e.token,o=+new Date+1e3*a.ttl;r&&(t.mod_map=r.get("modMap")),storage.set("fyre-auth",t,o);var n=e.token;n&&storage.set("fyre-authentication-creds",n.value,+new Date+1e3*n.ttl)},clear:function(){storage.remove("fyre-auth"),storage.remove("fyre-authentication-creds")}}},{"./../../mout/src/lang/deepClone":31,"./auth-api":13,"./user":17,"./util/storage":19}],17:[function(_dereq_,module,exports){function LivefyreUser(t){this._attributes={},this.authorizations=[],EventEmitter.call(this)}function isModByCollectionInfo(t){return some(this.authorizations,function(e){var i=e.collection;return Boolean(i&&e.moderatorKey&&i.network===t.network&&i.siteId===t.siteId&&i.articleId===t.articleId)})}function isModByCollectionId(t){var e=this.getAuthorizationByCollectionId(t);return Boolean(e&&e.moderatorKey)}function isModByNetwork(t){return some(this.authorizations,function(e){var i=e.network;return i&&i===t&&e.moderator})}function isModBySiteId(t){return some(this.authorizations,function(e){var i=e.siteId;return i&&i===t&&e.moderator})}var EventEmitter=_dereq_("./../../event-emitter/src/event-emitter"),inherits=_dereq_("./../../inherits/inherits.js"),some=_dereq_("./../../mout/src/array/some");inherits(LivefyreUser,EventEmitter),LivefyreUser.EVENTS={CHANGE:"change"},LivefyreUser.prototype.set=function(t,e){var i,r,o;"string"==typeof t&&(i=t,t={},t[i]=e);for(r in t)t.hasOwnProperty(r)&&(o=t[r],this._attributes[r]=o,this.emit(LivefyreUser.EVENTS.CHANGE+":"+r,o));this.emit(LivefyreUser.EVENTS.CHANGE,t)},LivefyreUser.prototype.get=function(t){return t?this._attributes[t]:this._attributes},LivefyreUser.prototype.unset=function(t){if(t in this._attributes){delete this._attributes[t];var e={};e[t]=void 0,this.emit(LivefyreUser.EVENTS.CHANGE+":"+t,e[t])}},LivefyreUser.prototype.isAuthenticated=function(){return!!this.get("id")},LivefyreUser.prototype.getAuthorizationByCollectionId=function(t){for(var e,i,r=0;r<this.authorizations.length;r++)if(e=this.authorizations[r],(i=e.collection)&&i.id===t)return e;return null},LivefyreUser.prototype.isMod=function(t){return t.collectionId?isModByCollectionId.call(this,t.collectionId):t.articleId?isModByCollectionInfo.call(this,t):t.network?isModByNetwork.call(this,t.network):t.siteId?isModBySiteId.call(this,t.siteId):void 0},module.exports=LivefyreUser},{"./../../event-emitter/src/event-emitter":10,"./../../inherits/inherits.js":11,"./../../mout/src/array/some":25}],18:[function(_dereq_,module,exports){function req(e,n){function t(){o.parentNode&&o.parentNode.removeChild(o),window[r]=void 0}var r="_lfcallback_"+ +new Date,o=document.createElement("script"),a=e.indexOf("?")>0?"&":"?";window[r]=function(e){t(),n(null,e)},o.type="text/javascript",o.async=!0,o.onerror=function(){t(),n("error")},o.src=e+a+"callback="+r,document.getElementsByTagName("head")[0].appendChild(o)}module.exports={req:req}},{}],19:[function(_dereq_,module,exports){var canUseLocalStorage=function(){try{var e=localStorage||null;return e.setItem("__lfstorage__","1"),e.removeItem("__lfstorage__"),!0}catch(e){return!1}}(),html5Storage={set:function(e,t,r){try{localStorage.setItem(e,JSON.stringify({value:t,expiration:r||null}))}catch(e){}},get:function(e){try{var t=localStorage.getItem(e),r=t?JSON.parse(t):{};return r.expiration&&r.expiration<+new Date?void html5Storage.remove(e):r.value}catch(e){return}},remove:function(e){try{localStorage.removeItem(e)}catch(e){}}},cookieStorage={set:function(e,t,r){var o;o=r>0?function(e){return new Date(e).toUTCString()}(r):0===r?";expires="+new Date(1970,1,1).toUTCString():+new Date+6048e5,document.cookie=e+"="+JSON.stringify({value:t,expiration:o})},get:function(e){for(var t,r=e+"=",o=function(){return document.cookie.split(/\s*;\s*/)}(),n=0;t=o[n];++n){if(0===t.lastIndexOf(r,0))return t.substr(r.length);if(t===e)return""}},remove:function(e){cookieStorage.set(e,"",0)}};module.exports=canUseLocalStorage?html5Storage:cookieStorage},{}],20:[function(_dereq_,module,exports){"use strict";var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),loader={},CLASSES={NOT_SUPPORTED:"lf-not-supported"},SIZES={MINI:"mini",SMALL:"small",LARGE:"large"},DEFAULT_SIZE=SIZES.SMALL,LOADER_DOM=['<div class="lf-loader">',"<div /><div /><div /><div /><div /><div /><div /><div /><div />","</div>"].join(""),VALID_SIZES=[SIZES.MINI,SIZES.SMALL,SIZES.LARGE];loader.isSupported=function(){return!(navigator.userAgent.match(/MSIE ([0-9]+)\./)&&RegExp.$1<=9)},loader.decorate=function(d,S){var i=$(LOADER_DOM);if($(d).html("").append(i),!loader.isSupported())return void i.html("").addClass(CLASSES.NOT_SUPPORTED);if(!S)return void i.addClass("lf-"+DEFAULT_SIZE);if("string"==typeof S)return-1===VALID_SIZES.indexOf(S)&&(S=DEFAULT_SIZE),void i.addClass("lf-"+S);if("number"==typeof S)return S%3!=0?void i.addClass("lf-"+DEFAULT_SIZE):void i.height(S).width(S);throw S+" is not a valid argument."},module.exports=loader},{"./../../../node_modules/jquery/dist/jquery":96}],21:[function(_dereq_,module,exports){module.exports=function(r){function n(n,e,t){e=r(e,t);var u=[];if(null==n)return u;for(var o,f=-1,i=n.length;++f<i;)o=n[f],e(o,f,n)&&u.push(o);return u}return n}(_dereq_("../function/makeIterator_"))},{"../function/makeIterator_":28}],22:[function(_dereq_,module,exports){module.exports=function(r){function n(n,e,t){e=r(e,t);var u=[];if(null==n)return u;for(var o=-1,f=n.length;++o<f;)u[o]=e(n[o],o,n);return u}return n}(_dereq_("../function/makeIterator_"))},{"../function/makeIterator_":28}],23:[function(_dereq_,module,exports){module.exports=function(){function r(r,n,e){var t=arguments.length>2,o=e;if(null==r||!r.length){if(t)return e;throw new Error("reduce of empty array with no initial value")}for(var u=-1,i=r.length;++u<i;)t?o=n(o,r[u],u,r):(o=r[u],t=!0);return o}return r}()},{}],24:[function(_dereq_,module,exports){module.exports=function(){function n(n,t,a){var r=n.length;t=null==t?0:t<0?Math.max(r+t,0):Math.min(t,r),a=null==a?r:a<0?Math.max(r+a,0):Math.min(a,r);for(var u=[];t<a;)u.push(n[t++]);return u}return n}()},{}],25:[function(_dereq_,module,exports){module.exports=function(r){function e(e,n,t){n=r(n,t);var u=!1;if(null==e)return u;for(var o=-1,f=e.length;++o<f;)if(n(e[o],o,e)){u=!0;break}return u}return e}(_dereq_("../function/makeIterator_"))},{"../function/makeIterator_":28}],26:[function(_dereq_,module,exports){module.exports=function(r){function n(n,e,t){var u=r(arguments,2);return function(){return n.apply(e,u.concat(r(arguments)))}}return n}(_dereq_("../array/slice"))},{"../array/slice":24}],27:[function(_dereq_,module,exports){
module.exports=function(){function n(n){return n}return n}()},{}],28:[function(_dereq_,module,exports){module.exports=function(e,r,n){function t(t,u){if(null==t)return e;switch(typeof t){case"function":return void 0!==u?function(e,r,n){return t.call(u,e,r,n)}:t;case"object":return function(e){return n(e,t)};case"string":case"number":return r(t)}}return t}(_dereq_("./identity"),_dereq_("./prop"),_dereq_("../object/deepMatches"))},{"../object/deepMatches":37,"./identity":27,"./prop":29}],29:[function(_dereq_,module,exports){module.exports=function(){function n(n){return function(r){return r[n]}}return n}()},{}],30:[function(_dereq_,module,exports){module.exports=function(e,r,n){function t(r){switch(e(r)){case"Object":return u(r);case"Array":return a(r);case"RegExp":return i(r);case"Date":return c(r);default:return r}}function u(e){return r(e)?n({},e):e}function i(e){var r="";return r+=e.multiline?"m":"",r+=e.global?"g":"",r+=e.ignorecase?"i":"",new RegExp(e.source,r)}function c(e){return new Date(+e)}function a(e){return e.slice()}return t}(_dereq_("./kindOf"),_dereq_("./isPlainObject"),_dereq_("../object/mixIn"))},{"../object/mixIn":41,"./isPlainObject":35,"./kindOf":36}],31:[function(_dereq_,module,exports){module.exports=function(r,e,n,t){function u(e,t){switch(n(e)){case"Object":return i(e,t);case"Array":return c(e,t);default:return r(e)}}function i(r,n){if(t(r)){var i={};return e(r,function(r,e){this[e]=u(r,n)},i),i}return n?n(r):r}function c(r,e){for(var n=[],t=-1,i=r.length;++t<i;)n[t]=u(r[t],e);return n}return u}(_dereq_("./clone"),_dereq_("../object/forOwn"),_dereq_("./kindOf"),_dereq_("./isPlainObject"))},{"../object/forOwn":39,"./clone":30,"./isPlainObject":35,"./kindOf":36}],32:[function(_dereq_,module,exports){module.exports=function(r){return Array.isArray||function(n){return r(n,"Array")}}(_dereq_("./isKind"))},{"./isKind":33}],33:[function(_dereq_,module,exports){module.exports=function(n){function r(r,e){return n(r)===e}return r}(_dereq_("./kindOf"))},{"./kindOf":36}],34:[function(_dereq_,module,exports){module.exports=function(r){function e(e){return r(e,"Number")}return e}(_dereq_("./isKind"))},{"./isKind":33}],35:[function(_dereq_,module,exports){module.exports=function(){function t(t){return!!t&&"object"==typeof t&&t.constructor===Object}return t}()},{}],36:[function(_dereq_,module,exports){module.exports=function(){function e(e){return null===e?"Null":e===t?"Undefined":n.exec(o.call(e))[1]}var t,n=/^\[object (.*)\]$/,o=Object.prototype.toString;return e}()},{}],37:[function(_dereq_,module,exports){module.exports=function(r,n){function t(r,n){for(var t=-1,e=r.length;++t<e;)if(f(r[t],n))return!0;return!1}function e(r,n){for(var e=-1,u=n.length;++e<u;)if(!t(r,n[e]))return!1;return!0}function u(n,t){var e=!0;return r(t,function(r,t){if(!f(n[t],r))return e=!1}),e}function f(r,t){return r&&"object"==typeof r?n(r)&&n(t)?e(r,t):u(r,t):r===t}return f}(_dereq_("./forOwn"),_dereq_("../lang/isArray"))},{"../lang/isArray":32,"./forOwn":39}],38:[function(_dereq_,module,exports){module.exports=function(r){function t(){u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=!0;for(var r in{toString:null})e=!1}function o(o,c,i){var a,f=0;null==e&&t();for(a in o)if(!1===n(c,o,a,i))break;if(e)for(var l=o.constructor,p=!!l&&o===l.prototype;(a=u[f++])&&("constructor"===a&&(p||!r(o,a))||o[a]===Object.prototype[a]||!1!==n(c,o,a,i)););}function n(r,t,o,n){return r.call(n,t[o],o,t)}var e,u;return o}(_dereq_("./hasOwn"))},{"./hasOwn":40}],39:[function(_dereq_,module,exports){module.exports=function(n,r){function e(e,u,i){r(e,function(r,o){if(n(e,o))return u.call(i,e[o],o,e)})}return e}(_dereq_("./hasOwn"),_dereq_("./forIn"))},{"./forIn":38,"./hasOwn":40}],40:[function(_dereq_,module,exports){module.exports=function(){function t(t,r){return Object.prototype.hasOwnProperty.call(t,r)}return t}()},{}],41:[function(_dereq_,module,exports){module.exports=function(n){function r(r,u){for(var e,o=0,f=arguments.length;++o<f;)null!=(e=arguments[o])&&n(e,t,r);return r}function t(n,r){this[r]=n}return r}(_dereq_("./forOwn"))},{"./forOwn":39}],42:[function(_dereq_,module,exports){module.exports=function(){function i(i){return i=i||{},i._listeningTo={},i.listenTo=n,i.stopListening=t,i}function n(i,n,t){var s=i._listenId||(i._listenId=e+++"");this._listeningTo[s]=this._listeningTo[s]||{},this._listeningTo[s].obj=i,this._listeningTo[s].listeners=this._listeningTo[s].listeners||{},this._listeningTo[s].listeners[n]=this._listeningTo[s].listeners[n]||[],this._listeningTo[s].listeners[n].push(t),i.on(n,t)}function t(i){if(i)return void s.call(this,i._listenId);for(var n in this._listeningTo)this._listeningTo.hasOwnProperty(n)&&s.call(this,n)}function s(i){if(this._listeningTo[i]){var n,t=this._listeningTo[i].obj,s=this._listeningTo[i].listeners;for(var e in s)if(s.hasOwnProperty(e)){n=s[e];for(var o=0;o<n.length;o++)t.removeListener(e,n[o])}delete this._listeningTo[i]}}var e=0;return i}()},{}],43:[function(_dereq_,module,exports){var ObjUtil={};ObjUtil.isObject=function(t){return"object"==typeof t&&null!==t},ObjUtil.extend=function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},module.exports=ObjUtil},{}],44:[function(_dereq_,module,exports){var ObjUtil=_dereq_("./object"),callbacks={},loaded={},Loader={};Loader.loadCSS=function(e,t,a,l){var n=t||document,c=l||n.getElementsByTagName("head")[0],o=n.createElement("link");existsOnPage("link","href",e,n)||(o.rel="stylesheet",o.type="text/css",o.href=e,o.media="all",ObjUtil.isObject(a)&&ObjUtil.extend(o,a),c.appendChild(o))},Loader.loadScript=function(e,t,a,l,n){var c="function"==typeof l?l:function(){},o=t||document,r=n||o.getElementsByTagName("head")[0],d=o.createElement("script");return loaded[e]?void c():callbacks[e]?void callbacks[e].push(c):(d.type="text/javascript",d.src=e,d.async=!0,d.defer=!0,ObjUtil.isObject(a)&&ObjUtil.extend(link,a),attachCallback(d,c),void r.appendChild(d))};var attachCallback=function(e,t){callbacks[e.src]=[t],e.onload=e.onreadystatechange=function(){e.readyState&&!/loaded|complete/.test(e.readyState)||(executeCallbacks(e.src),loaded[e.src]=!0,e.onload=e.onreadystatechange=null,e=void 0)}},executeCallbacks=function(e){var t=t[e];if(t.length)for(var a=0,l=t.length;a<l;a++)t[a]();delete t[e]},existsOnPage=function(e,t,a,l){var n,c=l||document,o=0,r=c.getElementsByTagName(e),d=r.length;for(a=a.toLowerCase();o<d;o++)if(n=r[o],"string"==typeof n[t]&&n[t].toLowerCase().indexOf(a)>-1)return!0;return!1};module.exports=Loader},{"./object":43}],45:[function(_dereq_,module,exports){module.exports=function(e,i,l,t){function a(l){e.call(this,l),i.call(this,l),l&&!1===l.readable&&(this.readable=!1),l&&!1===l.writable&&(this.writable=!1),this.allowHalfOpen=!0,l&&!1===l.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",r)}function r(){var e=this;this.allowHalfOpen||this._writableState.ended||l.nextTick(function(){e.end()})}return t(a,e),t.parasitically(a,i),a}(_dereq_("./readable"),_dereq_("./writable"),_dereq_("./util"),_dereq_("inherits"))},{"./readable":46,"./util":49,"./writable":50,inherits:95}],46:[function(_dereq_,module,exports){module.exports=function(e,t,i,r){"use strict";function n(t){t=t||{},t.objectMode=!0,this._readableState=new a(t,this),this.readable=!0,e.call(this)}function a(e,t){e=e||{};var i=e.highWaterMark;this.highWaterMark=i||0===i?i:0,this.highWaterMark=~~this.highWaterMark,this.buffer=[],this.pipes=[],this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.calledRead=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.objectMode=!!e.objectMode,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null}return r(n,e),n.prototype.pipe=function(e,r){function n(e){e===b&&d()}function a(){e.end()}function d(){e.removeListener("close",s),e.removeListener("finish",h),e.removeListener("drain",g),e.removeListener("error",l),e.removeListener("unpipe",n),b.removeListener("end",a),b.removeListener("end",d),b.removeListener("data",o),!c.awaitDrain||e._writableState&&!e._writableState.needDrain||g()}function o(t){!1===e.write(t)&&(b._readableState.awaitDrain++,b.pause())}function l(t){u(),0===i.listenerCount(e,"error")&&e.emit("error",t)}function s(){e.removeListener("finish",h),u()}function h(){e.removeListener("close",s),u()}function u(){b.unpipe(e)}var f,p,b=this,c=this._readableState;c.pipes.push(e),f=!r||!1!==r.end,p=f?a:d,c.endEmitted?t.nextTick(p):b.once("end",p),e.on("unpipe",n);var g=this._pipeOnDrain();return e.on("drain",g),b.on("data",o),e.once("error",l),e.once("close",s),e.once("finish",h),e.emit("pipe",b),c.flowing||b.resume(),e},n.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipes.length)return this;if(1===t.pipes.length)return e&&e!==t.pipes[0]?this:(e||(e=t.pipes[0]),t.pipes=[],t.flowing=!1,e&&e.emit("unpipe",this),this);if(!e){var i=t.pipes,r=i.length;t.pipes=[],t.flowing=!1;for(var n=0;n<r;n++)i[n].emit("unpipe",this);return this}var a=t.pipes.indexOf(e);return-1===a?this:(t.pipes.splice(a,1),e.emit("unpipe",this),this)},n.prototype._pipeOnDrain=function(){var e=this;return function(){var t=e._readableState;t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&i.listenerCount(e,"data")&&(t.flowing=!0,e._flow())}},n.prototype._flow=function(){var e,t=this._readableState;if(t.flowing)do{e=this.read()}while(null!==e&&t.flowing)},n.prototype.push=function(e){var t=Array.prototype.slice.call(arguments);return this._addToBuffer.apply(this,[!1].concat(t))},n.prototype.unshift=function(e){var t=Array.prototype.slice.call(arguments);return this._addToBuffer.apply(this,[!0].concat(t))},n.prototype._addToBuffer=function(e,t){var i=Array.prototype.slice.call(arguments,1),r=this._readableState;return null===t?(r.reading=!1,r.ended||this._endReadable()):r.ended&&!e?this.emit("error",new Error("readable.push() called after EOF")):r.endEmitted&&e?this.emit("error",new Error("readable.unshift() called after end event")):(e?r.buffer.unshift.apply(r.buffer,i):(r.reading=!1,r.buffer.push.apply(r.buffer,i)),t&&r.needReadable&&this._emitReadable(),this._maybeReadMore()),!r.ended&&(r.needReadable||r.buffer.length<r.highWaterMark||0===r.buffer.length)},n.prototype._maybeReadMore=function(){function e(){for(var e=r.buffer.length;!r.reading&&!r.ended&&r.buffer.length<r.highWaterMark&&(i.read(0),e!==r.buffer.length);)e=r.buffer.length;r.readingMore=!1}var i=this,r=i._readableState;r.readingMore||(r.readingMore=!0,t.nextTick(e))},n.prototype.resume=function(){var e=this._readableState;e.flowing||(e.flowing=!0,e.reading||this.read(0),this._scheduleResume())},n.prototype._scheduleResume=function(){var e=this,i=this._readableState;i.resumeScheduled||(i.resumeScheduled=!0,t.nextTick(function(){e._doResume()}))},n.prototype._doResume=function(){var e=this._readableState;e.resumeScheduled=!1,this.emit("resume"),this._flow(),e.flowing&&!e.reading&&this.read(0)},n.prototype.pause=function(){!1!==this._readableState.flowing&&(this._readableState.flowing=!1,this.emit("pause"))},n.prototype.on=function(t,i){var r=(e.prototype.on.call(this,t,i),this._readableState);"data"===t&&!1!==r.flowing&&this.resume(),"readable"===t&&this.readable&&(r.readableListening||(r.readableListening=!0,r.emittedReadable=!1,r.needReadable=!0,r.reading?r.buffer.length&&this._emitReadable():this.read(0)))},n.prototype.read=function(e){var t,i,r=this._readableState,n=e;return r.calledRead=!0,("number"!=typeof e||e>0)&&(r.emittedReadable=!1),0===e&&r.needReadable&&(r.buffer.length>=r.highWaterMark||r.ended)?(0===r.buffer.length&&r.ended?this._endReadable():this._emitReadable(),null):0===(e=this._getSizeToRead(e))&&r.ended?(0===r.buffer.length&&this._endReadable(),null):(t=r.needReadable,(0===r.buffer.length||r.buffer.length-e<r.highWaterMark)&&(t=!0),(r.reading||r.ended)&&(t=!1),t&&(r.reading=!0,r.sync=!0,0===r.buffer.length&&(r.needReadable=!0),this._read(r.highWaterMark),r.sync=!1,r.reading||(e=this._getSizeToRead(n))),i=e>0?this._readFromBuffer(e):null,null===i&&(r.needReadable=!0,e=0),0!==r.buffer.length||r.ended||(r.needReadable=!0),r.ended&&!r.endEmitted&&0===r.buffer.length&&this._endReadable(),null!==i&&this.emit("data",i),i)},n.prototype._read=function(){this.emit("error",new Error("._read() not implemented"))},n.prototype._readFromBuffer=function(){var e=this._readableState,t=e.buffer;return 0===t.length?null:t.shift()},n.prototype._getSizeToRead=function(e){var t=this._readableState;return 0===t.buffer.length&&t.ended?0:0===e?0:1},n.prototype._emitReadable=function(){function e(){i.emit("readable"),i._flow()}var i=this,r=this._readableState;r.needReadable=!1,r.emittedReadable||(r.emittedReadable=!0,r.sync?t.nextTick(e):e())},n.prototype._endReadable=function(){var e=this._readableState;e.ended=!0,e.buffer.length?this._emitReadable():this._emitEnd()},n.prototype._emitEnd=function(){var e=this,i=this._readableState;if(i.buffer.length>0)throw new Error("Tried to emit end event on a non-empty Readable");!i.endEmitted&&i.calledRead&&(i.ended=!0,t.nextTick(function(){i.endEmitted||0!==i.buffer.length||(i.endEmitted=!0,e.readable=!1,e.emit("end"))}))},n}(_dereq_("./stream"),_dereq_("./util"),_dereq_("./../../event-emitter/src/event-emitter"),_dereq_("inherits"))},{"./../../event-emitter/src/event-emitter":10,"./stream":47,"./util":49,inherits:95}],47:[function(_dereq_,module,exports){module.exports=function(e,t){"use strict";function r(e){t.call(this)}return e(r,t),r}(_dereq_("inherits"),_dereq_("./../../event-emitter/src/event-emitter"))},{"./../../event-emitter/src/event-emitter":10,inherits:95}],48:[function(_dereq_,module,exports){module.exports=function(r,t){function n(t){var n=this;r.call(this,t),this._transformState=new e(t,this),this._readableState.needReadable=!0,this._readableState.sync=!1,this.once("finish",function(){"function"==typeof n._flush?n._flush(function(r){n._doneTransforming(err)}):n._doneTransforming()})}function e(r,t){this.afterTransform=function(r,n){return t._afterTransform(r,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null}return t(n,r),n.prototype._transform=function(r,t){this.emit("error",new Error("_transform not implemented!"))},n.prototype.push=function(t){return this._transformState.needTransform=!1,r.prototype.push.apply(this,arguments)},n.prototype._read=function(){var r=this._transformState;null!==r.writechunk&&r.writecb&&!r.transforming?(r.transforming=!0,this._transform(r.writechunk,r.afterTransform)):r.needTransform=!0},n.prototype._write=function(r,t){var n=this._transformState,e=this._readableState;n.writecb=t,n.writechunk=r,n.transforming||(n.needTransform||e.needReadable||e.buffer.length<e.highWaterMark)&&this._read(e.highWaterMark)},n.prototype._afterTransform=function(r,t){var n=this._transformState,e=this._readableState,i=n.writecb;if(n.transforming=!1,!i)return this.emit("error",new Error("no writecb in Transform class"));n.writechunk=null,n.writecb=null,null!==t&&void 0!==t&&this.push(t),i&&i(r),e.reading=!1,(e.needReadable||e.buffer.length<e.highWaterMark)&&this._read(e.highWaterMark)},n.prototype._doneTransforming=function(r){r&&this.emit("error",r);var t=this._writableState,n=this._transformState;if(t.buffer.length)throw new Error("Calling Transform#_doneTransforming when writable buffer not empty");if(n.transforming)throw new Error("Calling Transform#_doneTransforming when still transforming");return this.push(null)},n}(_dereq_("./duplex"),_dereq_("inherits"))},{"./duplex":45,inherits:95}],49:[function(_dereq_,module,exports){module.exports=function(){"use strict";var t={};return t.nextTick=function(){if("function"==typeof setImmediate)return function(t){setImmediate(t)};if("undefined"==typeof window||window.ActiveXObject||!window.postMessage)return function(t){setTimeout(t)};var t=[];return window.addEventListener("message",function(){for(var e=0;e<t.length;)try{t[e++]()}catch(n){throw t=t.slice(e),window.postMessage("tic!","*"),n}t.length=0},!0),function(e){t.length||window.postMessage("tic!","*"),t.push(e)}}(),t}()},{}],50:[function(_dereq_,module,exports){module.exports=function(t,e,i){function r(e){this.writable=!0,this._writableState=new h(e,this),t.call(this,e)}function n(t,e){this.chunk=t,this.callback=e}function h(t,e){t=t||{};var i=t.highWaterMark;this.highWaterMark=i||0===i?i:0,this.objectMode=!!t.objectMode,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var r=!1===t.decodeStrings;this.decodeStrings=!r,this.defaultEncoding=t.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(t){e._onwrite(t)},this.writecb=null,this.writelen=0,this.buffer=[]}return i(r,t),r.prototype.write=function(t,i){var r,n=this._writableState,h=!1;return"function"!=typeof i&&(i=function(){}),n.ended?(r=new Error(".write() called after stream end"),this.emit("error",r),e.nextTick(function(){i(r)})):h=this._writeOrBuffer(t,i),h},r.prototype._writeOrBuffer=function(t,e){var i=this._writableState,r=i.buffer.length<i.highWaterMark;return i.needDrain=!r,i.writing?i.buffer.push(new n(t,e)):this._doWrite(t,e),r},r.prototype._write=function(t,e){e(new Error("._write not implemented"))},r.prototype._onwrite=function(t){var i,r=this,n=this._writableState,h=n.sync,s=n.writecb;n.writing=!1,n.writecb=null,n.writelen=0,t?(h?e.nextTick(function(){s(t)}):s(t),this.emit("error",t)):(i=this._needFinish(),i||n.bufferProcessing||!n.buffer.length||this._clearBuffer(),h?e.nextTick(function(){r._afterWrite(i,s)}):this._afterWrite(i,s))},r.prototype._doWrite=function(t,e){var i=this._writableState;i.writelen=1,i.writecb=e,i.writing=!0,i.sync=!0,this._write(t,i.onwrite),i.sync=!1},r.prototype._afterWrite=function(t,e){this._writableState,t||this._onwriteDrain(),e(),t&&this._finishMaybe()},r.prototype._onwriteDrain=function(){var t=this._writableState;0===t.buffer.length&&t.needDrain&&(t.needDrain=!1,this.emit("drain"))},r.prototype._clearBuffer=function(){var t=this._writableState;t.bufferProcessing=!0;for(var e=0;e<t.buffer.length;e++){var i=t.buffer[e],r=i.chunk,n=i.callback;if(this._doWrite(r,n),t.writing){e++;break}}t.bufferProcessing=!1,e<t.buffer.length?t.buffer=t.buffer.slice(e):t.buffer.length=0},r.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe. Not readable"))},r.prototype.end=function(t,i){var r=this._writableState;"function"==typeof t&&(i=t,t=null),void 0!==t&&null!==t&&this.write(t),r.ending||r.finished||(r.ending=!0,this._finishMaybe(),i&&(r.finished?e.nextTick(i):this.once("finish",i)),r.ended=!0)},r.prototype._finishMaybe=function(){var t=this._writableState,e=this._needFinish();return e&&(t.finished=!0,this.emit("finish")),e},r.prototype._needFinish=function(){var t=this._writableState;return t.ending&&0===t.buffer.length&&!t.finished&&!t.writing},r.WritableState=h,r}(_dereq_("./stream"),_dereq_("./util"),_dereq_("inherits"))},{"./stream":47,"./util":49,inherits:95}],51:[function(_dereq_,module,exports){var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),EventMap=_dereq_("./../../../view/src/event-map"),inherits=_dereq_("./../../../inherits/inherits.js"),util=_dereq_("./util"),View=_dereq_("./../../../view/src/view.js"),Editor=function(t){View.call(this,t)};inherits(Editor,View),Editor.prototype.classes={FIELD:"editor-field",POST_BTN:"editor-post-btn"},Editor.prototype.errors={BODY:"Please enter a body"},Editor.prototype.buildPostEventObj=function(){var t={};return t.body=this.$textareaEl.val(),t.failure=$.proxy(this.handlePostFailure,this),t.success=$.proxy(this.handlePostSuccess,this),t},Editor.prototype.events=new EventMap(function(){var t=Editor.prototype.classes,e={};return e["click ."+t.POST_BTN]="handlePostBtnClick",e}()),Editor.prototype.handlePostBtnClick=function(){var t=this.buildPostEventObj();this.validate(t)&&this.sendPostEvent(t)},Editor.prototype.handlePostFailure=util.abstractMethod,Editor.prototype.handlePostSuccess=util.abstractMethod,Editor.prototype.render=function(){View.prototype.render.call(this),this.$textareaEl=this.$("."+this.classes.FIELD)},Editor.prototype.sendPostEvent=util.abstractMethod,Editor.prototype.showError=util.abstractMethod,Editor.prototype.validate=function(t){return!!t.body||(this.showError(this.errors.BODY),!1)},module.exports=Editor},{"./../../../../node_modules/jquery/dist/jquery":96,"./../../../inherits/inherits.js":11,"./../../../view/src/event-map":82,"./../../../view/src/view.js":83,"./util":52}],52:[function(_dereq_,module,exports){var util={};util.abstractMethod=function(){throw"Function must be implemented."},module.exports=util},{}],53:[function(_dereq_,module,exports){module.exports=function(e,r,t,n){"use strict";var i=n("streamhub-sdk/auth"),o=new t;o.setToken=function(e){i(".setToken",e),this._token=e,this.emit("token",e)},o.getToken=function(){var r=e.get("livefyre");return r?r.get("token"):this._token};var u=function(e){Error.apply(this,arguments),this.message=e};return r(u,Error),u.prototype.name="UnauthorizedError",o.UnauthorizedError=u,o}(_dereq_("./../../../auth/src/main"),_dereq_("inherits"),_dereq_("./../../../event-emitter/src/event-emitter"),_dereq_("./../debug"))},{"./../../../auth/src/main":3,"./../../../event-emitter/src/event-emitter":10,"./../debug":77,inherits:95}],54:[function(_dereq_,module,exports){module.exports=function(e,t,r){"use strict";var i=function(t){t=t||{},t.serviceName="bootstrap",this._version=t.version,e.call(this,t)};return t(i,e),i.prototype._serviceName="bootstrap",i.prototype.getContent=function(e,t){e=e||{},t=t||function(){};var i=e.environment=e.environment||"livefyre.com",n="livefyre.com"!==i&&"fyre"!==i&&"fy.re"!==i,o=[this._getUrlBase(e),"/bs3/",this._version?this._version+"/":"",n?e.environment+"/":"",e.network,"/",e.siteId,"/",r.url.btoa(e.articleId.toString()),"/",void 0!==e.page?e.page+".json":"init"].join("");this._request({url:o},t)},i}(_dereq_("./http-client"),_dereq_("inherits"),_dereq_("./../../../../base64/base64"))},{"./../../../../base64/base64":5,"./http-client":56,inherits:95}],55:[function(_dereq_,module,exports){module.exports=function(e,t){"use strict";var i=function(t){t=t||{},t.serviceName="quill",e.call(this,t)};return t(i,e),i.prototype.createCollection=function(e,t){t=t||function(){};var i=[this._getUrlBase(e),"/api/v3.0/site/",e.siteId,"/collection/create"].join(""),c=e.collectionMeta;if(!c)throw"User error: Missing collectionMeta.";var o={collectionMeta:c};"boolean"==typeof e.signed&&(o.signed=e.signed),o.signed||(o.collectionMeta.articleId=e.articleId,e.collectionMeta.tags&&(o.collectionMeta.tags=e.collectionMeta.tags.join(","))),e.checksum&&(o.checksum=e.checksum),o=JSON.stringify(o),this._request({method:"POST",url:i,dataType:"json",data:o},t)},i}(_dereq_("./http-client"),_dereq_("inherits"))},{"./http-client":56,inherits:95}],56:[function(_dereq_,module,exports){module.exports=function(t){"use strict";function o(t,o,e){var r=new Error(t);return r.statusCode=o,r.body=e,r}var e=function(t){t=t||{},this._serviceName=t.serviceName,this._protocol=t.protocol||document.location.protocol,":"!==this._protocol.slice(-1)&&(this._protocol+=":")};e.prototype._request=function(e,n){n=n||function(){};var i=t.ajax({type:e.method||"GET",url:e.url,data:e.data,dataType:e.dataType||this._getDataType()});return i.done(function(t,o,e){n(null,t)}),i.fail(function(t,e,i){if(!r){var s=i||"LivefyreHttpClient Error",a=o(s,t.status,t.responseJSON);n(a)}}),i},e.prototype._getDataType=function(){return t.support.cors?"json":"jsonp"},e.prototype._getUrlBase=function(t){return[this._protocol,"//",this._getHost(t)].join("")},e.prototype._getHost=function(t){var o,e="livefyre.com"===t.network,r=t.environment||"livefyre.com",n=this._serviceName+"."+(e?r:t.network);return e||"https:"!==this._protocol||(o=t.network.split("."),o.splice(1,0,this._serviceName),n=o.join(".")),n};var r=!1;return t(window).on("beforeunload",function(){r=!0}),e}(_dereq_("./../../jquery"))},{"./../../jquery":78}],57:[function(_dereq_,module,exports){module.exports=function(t,e){"use strict";var r=function(e){e=e||{},e.serviceName="stream1",t.call(this,e)};return e(r,t),r.prototype._serviceName="stream1",r.prototype.getContent=function(t,e){t=t||{},e=e||function(){};var r=[this._getUrlBase(t),"/v3.0/collection/",t.collectionId,"/",t.commentId||"0","/"].join("");return this._request({url:r},function(t,r){return t?e.apply(this,arguments):r.timeout?e(null,{timeout:r.timeout}):"error"===r.status?e(r.msg):void e(null,r.data)})},r}(_dereq_("./http-client"),_dereq_("inherits"))},{"./http-client":56,inherits:95}],58:[function(_dereq_,module,exports){module.exports=function(t,e){"use strict";var o=function(e){e=e||{},e.serviceName="quill",t.call(this,e)};return e(o,t),o.prototype.postContent=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId,"/post/"].join(""),n={body:t.body,lftoken:t.lftoken};t.parent_id&&(n.parent_id=t.parent_id),t.media&&(n.attachments=JSON.stringify(t.media)),this._request({method:"POST",url:o,data:n},e)},o.prototype.postTweet=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId,"/post/tweet/"].join(""),n={tweet_id:t.tweetId,lftoken:t.lftoken};this._request({method:"POST",url:o,data:n},e)},o.prototype.follow=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId,"/follow/"].join(""),n={lftoken:t.lftoken};this._request({method:"POST",url:o,data:n},e)},o.prototype.unfollow=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId,"/unfollow/"].join(""),n={lftoken:t.lftoken};this._request({method:"POST",url:o,data:n},e)},o.prototype.like=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/message/",t.contentId,"/like/"].join(""),n={lftoken:t.lftoken,collection_id:t.collectionId};this._request({method:"POST",url:o,data:n},e)},o.prototype.unlike=function(t,e){t=t||{},e=e||function(){};var o=[this._getUrlBase(t),"/api/v3.0/message/",t.contentId,"/unlike/"].join(""),n={lftoken:t.lftoken,collection_id:t.collectionId};this._request({method:"POST",url:o,dataType:"json",data:n},e)},o}(_dereq_("./http-client"),_dereq_("inherits"))},{"./http-client":56,inherits:95}],59:[function(_dereq_,module,exports){module.exports=function(e){"use strict";var t=function(e){e=e||{},this._collection=e.collection};return t.prototype.createArchive=function(t){return t=t||{},t.collection=this._collection,new e(t)},t}(_dereq_("./streams/featured-archive"))},{"./streams/featured-archive":62}],60:[function(_dereq_,module,exports){module.exports=function(t,e,i,r,o,n,s,a,p,c,l){"use strict";var h=l("streamhub-sdk/collection"),u=function(t){t=t||{},this.id=t.id,this.network=t.network,this.siteId=t.siteId,this.articleId=t.articleId,this.environment=t.environment,this._collectionMeta=t.collectionMeta,this._signed=t.signed,this._autoCreate="autoCreate"in t?t.autoCreate:Boolean(this._collectionMeta),this._maxInitAttempts=t.maxInitAttempts||4,this._replies=t.replies||!1,this._bootstrapClient=t.bootstrapClient||new n,this._createClient=t.createClient||new s,this._writer=t.writer||null,this._updater=null,this._pipedArchives=[],o.call(this,t)};return c(u,o),u.prototype.createArchive=function(e){return e=e||{},e.collection=this,e.bootstrapClient=e.bootstrapClient||this._bootstrapClient,e.replies=e.replies||this._replies,new t(e)},u.prototype.createUpdater=function(t){return t=t||{},new e({collection:this,streamClient:t.streamClient,replies:this._replies,createStateToContent:t.createStateToContent,createAnnotator:t.createAnnotator})},u.prototype.createWriter=function(t){return t=t||{},t.collection=this,new i(t)},u.prototype.createFeaturedContents=function(t){return t=t||{},t.collection=this,new r(t)},u.prototype.pipe=function(t,e){var i;e=e||{};var r=e.archivePipeOpts||e;return void 0===e.pipeArchiveToMore&&(e.pipeArchiveToMore=!0),e.pipeArchiveToMore&&t.more&&t.more.writable&&(i=this.createArchive(),i.pipe(t.more,r),this._pipedArchives.push(i)),o.prototype.pipe.apply(this,arguments)},u.prototype.pause=function(){o.prototype.pause.apply(this,arguments),this._updater&&this._updater.pause()},u.prototype.resume=function(){o.prototype.resume.apply(this,arguments),this._updater&&this._updater.resume()},u.prototype._read=function(){var t,e=this;return this._updater||(this._updater=this.createUpdater()),t=this._updater.read(),t?this.push(t):e._updater.on("readable",function t(){var i=e._updater.read();i&&(e._updater.removeListener("readable",t),e.push(i))})},u.prototype._write=function(t,e){this._writer||(this._writer=this.createWriter()),this._writer.write(t,e)},u.prototype.initFromBootstrap=function(t){var e=this;t&&this.once("_initFromBootstrap",t),this._isInitingFromBootstrap||(this._isInitingFromBootstrap=!0,this._getBootstrapInit(function(t,i){if(e._isInitingFromBootstrap=!1,t&&404===t.statusCode&&this._autoCreate)return void this._createCollection(function(t){t&&409!==t.statusCode||e._pollForBootstrapLoaded()});this._handleInitComplete(t,i)}))},u.prototype._handleInitComplete=function(t,e){if(!e)throw"Fatal collection connection error";var i=e.collectionSettings;this.id=i&&i.collectionId,this.emit("_initFromBootstrap",t,e)},u.prototype._pollForBootstrapLoaded=function(t){var e=t||1,i=this;this._getBootstrapInit(function(t,r){if(t&&404===t.statusCode)return void(++e<this._maxInitAttempts&&setTimeout(function(){i._pollForBootstrapLoaded(e)},1e3*e));this._handleInitComplete(t,r)})},u.prototype._getBootstrapInit=function(t){var e,i=this;e={network:this.network,siteId:this.siteId,articleId:this.articleId,environment:this.environment},this._bootstrapClient.getContent(e,function(e,r){e&&h("Error requesting Bootstrap init",e,r),t.call(i,e,r)})},u.prototype._createCollection=function(t){if(this._isCreatingCollection)throw"Attempting to create a collection more than once.";this._isCreatingCollection=!0;var e=this;this._autoCreate=!1,this.once("_createCollection",t);var i=function(t){e._isCreatingCollection=!1,t&&h("Error requesting collection creation",t),e.emit("_createCollection",t)},r={network:this.network,siteId:this.siteId,articleId:this.articleId,environment:this.environment,collectionMeta:this._collectionMeta,signed:this._signed};this._createClient.createCollection(r,i)},u}(_dereq_("./streams/archive"),_dereq_("./streams/updater"),_dereq_("./streams/writer"),_dereq_("./featured-contents"),_dereq_("./../../../stream/src/duplex"),_dereq_("./clients/bootstrap-client"),_dereq_("./clients/create-client"),_dereq_("./clients/write-client"),_dereq_("./../auth/main"),_dereq_("inherits"),_dereq_("./../debug"))},{"./../../../stream/src/duplex":45,"./../auth/main":53,"./../debug":77,"./clients/bootstrap-client":54,"./clients/create-client":55,"./clients/write-client":58,"./featured-contents":59,"./streams/archive":61,"./streams/updater":63,"./streams/writer":64,inherits:95}],61:[function(_dereq_,module,exports){module.exports=function(t,e,r,o,n,i,a){"use strict";var s=n("streamhub-sdk/collection/streams/archive"),c=function(t){t=t||{},this._collection=t.collection,this._bootstrapClient=t.bootstrapClient||new r,this._contentIdsInHeadDocument=[],this._replies=t.replies||!1,this._comparator=t.comparator||c.comparators.CREATED_AT_DESCENDING,e.call(this,t)};return a(c,e),c.comparators={CREATED_AT_ASCENDING:"CREATED_AT_ASCENDING",CREATED_AT_DESCENDING:"CREATED_AT_DESCENDING"},c.prototype._read=function(){return s("_read","Buffer length is "+this._readableState.buffer.length),void 0===this._nextPage?this._readFirstPage():null===this._nextPage?this.push(null):void("number"==typeof this._nextPage&&this._readNextPage())},c.prototype._readFirstPage=function(){var t=this;return this._comparator===c.comparators.CREATED_AT_ASCENDING?(this._nextPage=0,
void this._readNextPage()):this._collection.initFromBootstrap(function(e,r){var o=r.headDocument,n=r.collectionSettings,a=n&&n.archiveInfo,s=a&&a.nPages;if(0===s)return void t.push(null);var c=t._contentsFromBootstrapDoc(o,{isHead:!0});if(t._nextPage=s-1,!c.length)return t.push(),void i.nextTick(function(){t.read(0)});t.push.apply(t,c)})},c.prototype._readNextPage=function(){var t=this,e=this._getBootstrapClientOptions();this._nextPage=this._getNextPageName(),this._bootstrapClient.getContent(e,function(r,o){var n=e.page;if(r&&404===r.statusCode)return s("404 when requesting page "+n+". Must be end of archive"),t._nextPage=null,void t._read();if(r||!o)return void t.emit("error",new Error("Error requesting Bootstrap page "+e.page));var i=t._contentsFromBootstrapDoc(o);if(!i.length)return t._read();t.push.apply(t,i)})},c.prototype._getNextPageName=function(){var t,e=this._nextPage;switch(this._comparator){case c.comparators.CREATED_AT_ASCENDING:t=e+1;break;case c.comparators.CREATED_AT_DESCENDING:(t=e-1)<0&&(t=null)}return t},c.prototype._getBootstrapClientOptions=function(){return{environment:this._collection.environment,network:this._collection.network,siteId:this._collection.siteId,articleId:this._collection.articleId,page:this._nextPage}},c.prototype._contentsFromBootstrapDoc=function(t,e){e=e||{},t=t||{};var r,o,n=this,i=t.content||[],a=[];this._collection&&(t.collection=this._collection);var c=this._createStateToContent(t);c.on("data",function(t){t&&-1===n._contentIdsInHeadDocument.indexOf(t.id)&&(e.isHead&&t.id&&n._contentIdsInHeadDocument.push(t.id),a.push(t))});for(var u=0,_=i.length;u<_;u++)r=i[u],(o=r.content&&r.content.id)&&-1!==this._contentIdsInHeadDocument.indexOf(o)||c.write(r);return a=this._sortContents(a),s("created contents from bootstrapDoc",a),a},c.prototype._sortContents=function(t){var e;return e=this._comparator===c.comparators.CREATED_AT_ASCENDING?function(t,e){return t.createdAt-e.createdAt}:function(t,e){return e.createdAt-t.createdAt},t.sort(e)},c.prototype._createStateToContent=function(t){return t=t||{},t.replies=this._replies,new o(t)},c}(_dereq_("./../../jquery"),_dereq_("./../../../../stream/src/readable"),_dereq_("./../clients/bootstrap-client"),_dereq_("./../../content/state-to-content"),_dereq_("./../../debug"),_dereq_("./../../../../stream/src/util"),_dereq_("inherits"))},{"./../../../../stream/src/readable":46,"./../../../../stream/src/util":49,"./../../content/state-to-content":68,"./../../debug":77,"./../../jquery":78,"./../clients/bootstrap-client":54,inherits:95}],62:[function(_dereq_,module,exports){module.exports=function(t,e,n,o,r,i){"use strict";var s=r("streamhub-sdk/collection/streams/featured-archive"),a=function(t){t=t||{},this._collection=t.collection,this._fetchedHead=!1,this._bootstrapClient=t.bootstrapClient||new n,this._contentIdsInHeadDocument=[],e.call(this,t)};return i(a,e),a.prototype._read=function(){var t=this;return s("_read","Buffer length is "+this._readableState.buffer.length),this._fetchedHead?null===this._nextPage?this.push(null):void(this._nextPage&&this._readNextPage()):this._collection.initFromBootstrap(function(e,n){var o=n.featured;if(!o)return t.push(null);t._nextPage=o.isComplete?null:"featured-all";var r=t._contentsFromBootstrapDoc(o,{isHead:!0});t._fetchedHead=!0,t.push.apply(t,r)})},a.prototype._readNextPage=function(){var t=this,e=this._getBootstrapClientOptions();this._nextPage=null,this._bootstrapClient.getContent(e,function(n,o){if(n||!o)return void t.emit("error",new Error("Error requesting Bootstrap page "+e.page));var r=t._contentsFromBootstrapDoc(o);if(!r.length)return t._read();t.push.apply(t,r)})},a.prototype._getBootstrapClientOptions=function(){return{environment:this._collection.environment,network:this._collection.network,siteId:this._collection.siteId,articleId:this._collection.articleId,page:this._nextPage}},a.prototype._contentsFromBootstrapDoc=function(t,e){e=e||{},t=t||{};var n,r=this,i=t.content||[],a=new o(t),c=[];a.on("data",function(t){t&&-1===r._contentIdsInHeadDocument.indexOf(t.id)&&(e.isHead&&t.id&&r._contentIdsInHeadDocument.push(t.id),c.push(t))});for(var l=0,u=i.length;l<u;l++)n=i[l],a.write(n);return s("created contents from bootstrapDoc",c),c},a}(_dereq_("./../../jquery"),_dereq_("./../../../../stream/src/readable"),_dereq_("./../clients/bootstrap-client"),_dereq_("./../../content/state-to-content"),_dereq_("./../../debug"),_dereq_("inherits"))},{"./../../../../stream/src/readable":46,"./../../content/state-to-content":68,"./../../debug":77,"./../../jquery":78,"./../clients/bootstrap-client":54,inherits:95}],63:[function(_dereq_,module,exports){module.exports=function(t,e,n,r,o,i,a,s){"use strict";var c=s("streamhub-sdk/collection/streams/updater"),l=function(t){t=t||{},this._collection=t.collection,this._streamClient=t.streamClient||new o,this._request=null,this._replies=t.replies||!1,t.createStateToContent&&(this._createStateToContent=t.createStateToContent),t.createAnnotator&&(this._createAnnotator=t.createAnnotator),e.call(this,t)};return t(l,e),l.prototype._read=function(){var t=this;if(c("_read","Buffer length is "+this._readableState.buffer.length),!this._latestEvent||!this._collection.id)return this._collection.initFromBootstrap(function(e,n){var r=n.collectionSettings,o=n.headDocument,i=o&&o.event;if(i=i||r&&r.event,!t._collection.id)throw new Error("Couldn't get Collection ID after initFromBootstrap");if(void 0===i)throw new Error("Couldn't get latestEvent after initFromBootstrap");t._latestEvent=i,t._stream()});t._stream()},l.prototype._stream=function(){var t=this,e=this._streamClient,r=this._getStreamClientOptions(),o=e.getContent(r,function(e,r){function o(){t.push(),n.nextTick(function(){t.read(0)})}if(e&&"abort"===e.message)return c("stream request aborted"),void t.push();if(e)return t.emit("error",e);if(r.timeout)return c("long poll timeout, requesting again on next tick"),o();var i=t._contentsFromStreamData(r);if(t._latestEvent=r.maxEventId,!i.length)return o();t.push.apply(t,i)});this._request=o},l.prototype.pause=function(){return this._request&&(this._request.abort(),this._request=null),e.prototype.pause.apply(this,arguments)},l.prototype._contentsFromStreamData=function(t){var e,n,r,o=this._createAnnotator(),i=t.annotations,a=[],s=t.states,c=this._createStateToContent(t);c.on("data",function(t){a.push(t)});for(n in s)s.hasOwnProperty(n)&&(r=s[n],c.write(r));for(n in i)i.hasOwnProperty(n)&&(e=i[n],o.write({contentId:n,annotationDiff:e}));return a},l.prototype._getStreamClientOptions=function(){return{collectionId:this._collection.id,network:this._collection.network,environment:this._collection.environment,commentId:this._latestEvent}},l.prototype._createStateToContent=function(t){return t=t||{},t.replies=this._replies,t.collection=this._collection,new i(t)},l.prototype._createAnnotator=function(){return new a},l}(_dereq_("inherits"),_dereq_("./../../../../stream/src/readable"),_dereq_("./../../../../stream/src/util"),_dereq_("./../clients/bootstrap-client"),_dereq_("./../clients/stream-client"),_dereq_("./../../content/state-to-content"),_dereq_("./../../content/annotator"),_dereq_("./../../debug"))},{"./../../../../stream/src/readable":46,"./../../../../stream/src/util":49,"./../../content/annotator":66,"./../../content/state-to-content":68,"./../../debug":77,"./../clients/bootstrap-client":54,"./../clients/stream-client":57,inherits:95}],64:[function(_dereq_,module,exports){module.exports=function(t,e,i,n){"use strict";var r=function(i){this._collection=i.collection,this._writeClient=i.writeClient||new e,t.call(this,i)};return n(r,t),r.prototype._write=function t(e,n){var r=this,o=this._collection,l=i.getToken(),a=this._writeClient.postContent,c=e.attachments&&e.attachments.length;if(!l)throw new i.UnauthorizedError("Collection cannot write until streamhub-sdk/auth.setToken has been called");if(!o.id)return o.initFromBootstrap(function(){t.call(r,e,n)});var s={body:e.body,collectionId:o.id,environment:o.environment,lftoken:i.getToken(),network:o.network};if(c){var h;s.media=[];for(var d=0;d<c;d++)h=e.attachments[d],"function"==typeof h.toJSON&&(h=h.toJSON()),s.media.push(h)}e.parentId&&(s.parent_id=e.parentId),e.tweetId&&(a=this._writeClient.postTweet,s.tweetId=e.tweetId),a.call(this._writeClient,s,function(t,i){if(t)return n(t);e.set({collection:this._collection,id:i.data.messages[0].content.id}),n()}.bind(this))},r}(_dereq_("./../../../../stream/src/writable"),_dereq_("./../clients/write-client"),_dereq_("./../../auth/main"),_dereq_("inherits"))},{"./../../../../stream/src/writable":50,"./../../auth/main":53,"./../clients/write-client":58,inherits:95}],65:[function(_dereq_,module,exports){module.exports=function(){"use strict";function t(t){return t.value===i.vote.DOWNVOTE?1:0}function e(t){return t.value===i.vote.UPVOTE?1:0}function o(o,s,v){v&&(o.upvotes-=e(v),o.downvotes-=t(v)),s&&(o.upvotes+=e(s),o.downvotes+=t(s)),o.helpfulness=o.upvotes-o.downvotes}function s(t,e){for(var o=0,s=t.length;o<s;o++)if(t[o].author===e.author)return o;return-1}function v(t,e,v){var n,u=v.votes=v.votes||{},r=v.votes.list=v.votes.list||[];u.upvotes=u.upvotes||0,u.downvotes=u.downvotes||0,u.helpfulness=u.helpfulness||0;for(var i=0,f=e.length;i<f;i++)n=e[i],s(r,n)>-1||(r.push(n),o(u,n));t.votes=u}function n(t,e,v){for(var n,u,r,i=v.votes,f=v.votes.list,l=0,a=f.length;l<a;l++)u=f[l],-1!==(n=s(e,u))&&(r=e[n],o(i,r,u),f[l]=r);t.votes=i}function u(t,e,v){var n=v.votes,u=v.votes.list;u=u.filter(function(t){return-1===s(e,t)||(o(n,!1,t),!1)}),v.votes.list=u,t.votes=v.votes}function r(t){t.added.vote=v,t.updated.vote=n,t.removed.vote=u}var i={};return i.vote={UNSET:0,UPVOTE:1,DOWNVOTE:2},i.voteToCount={0:0,1:1,2:-1},{withVotes:r,voteEnums:i}}()},{}],66:[function(_dereq_,module,exports){module.exports=function(e,t,o,r){"use strict";var d=function(e){e=e||{},o.call(this,e)};return r(d,o),d.prototype.annotate=function(e,o,r){var d,n,a,p,i,u={};for(i in o)if(o.hasOwnProperty(i)&&(n=o[i],t.objectKeys(n).length))for(a in n)n.hasOwnProperty(a)&&(d=n[a],(p=this[i][a])&&p(u,d,e));e.set(u,r)},d.prototype._write=function(t){var o=t.content||e.get(t.contentId);o&&this.annotate(o,t.annotationDiff,t.silence)},d.prototype.added={},d.prototype.updated={},d.prototype.removed={},d.prototype.added.featuredmessage=function(e,t){e.featured=t},d.prototype.updated.featuredmessage=d.prototype.added.featuredmessage,d.prototype.removed.featuredmessage=function(e,t,o){e.featured=!1},d.prototype.added.sortOrder=function(e,t){e.sortOrder=t},d.prototype.updated.sortOrder=function(e,t,o){e.sortOrder=t},d.prototype.removed.sortOrder=function(e,t,o){e.sortOrder=null},d.prototype.added.moderator=function(e){e.moderator=!0},d.prototype.removed.moderator=function(e){e.moderator=!1},d.prototype.added.geocode=function(e,t){e.geocode=t},d}(_dereq_("./../storage"),_dereq_("./../util"),_dereq_("./../../../stream/src/writable"),_dereq_("inherits"))},{"./../../../stream/src/writable":50,"./../storage":79,"./../util":80,inherits:95}],67:[function(_dereq_,module,exports){module.exports=function(t,e,i,s){"use strict";var n=function(t){var i=t,s={};e.call(this),"object"==typeof t&&(i=i.body,s=t),this.body=i;var r="number"==typeof s.visibility?s.visibility:"number"==typeof s.vis?s.vis:1;this.visibility=n.enums.visibility[r],this.attachments=s.attachments||[],this.replies=s.replies||[],this.opines=s.opines||[]};return i(n,e),n.prototype.typeUrn="urn:livefyre:js:streamhub-sdk:content",n.prototype.addAttachment=function(t){this.attachments.push(t),this.emit("attachment",t)},n.prototype.removeAttachment=function(t){this.attachments.splice(this.attachments.indexOf(t),1),this.emit("removeAttachment",t)},n.prototype.addReply=function(t){this.replies.push(t),this.emit("reply",t)},n.prototype.set=function(t,e){t=t||{};var i,s,n,r={};for(var h in t)t.hasOwnProperty(h)&&"_"!==h.charAt(0)&&(i=r[h]=this[h],(s=this[h]=t[h])===i&&"object"!=typeof s||(e||this.emit("change:"+h,s,i),n=!0));n&&(e||this.emit("change",t,r))},n.enums={},n.enums.visibility=["NONE","EVERYONE","OWNER","GROUP"],n}(_dereq_("./../jquery"),_dereq_("./../../../event-emitter/src/event-emitter"),_dereq_("inherits"))},{"./../../../event-emitter/src/event-emitter":10,"./../jquery":78,inherits:95}],68:[function(_dereq_,module,exports){module.exports=function(t,e,r,o,n,i,a,s,c,d,h){"use strict";function p(t){var e=/\/\/instagram\.com/i;try{return t.content.feedEntry.channelId.match(e)}catch(t){return!1}}var l=c("streamhub-sdk/content/state-to-content"),u=function(t){t=t||{},this._authors=t.authors||{},this._replies=t.replies,this._collection=t.collection,this._storage=t.storage||s,d.call(this,t)};return h(u,d),u.prototype._transform=function(t,e){var r;try{r=this.transform(t,this._authors,{replies:this._replies,collection:this._collection})}catch(t){this.emit("error transforming state-to-content",t),l("StateToContent.transform threw",t)}r&&r.length&&this.push.apply(this,r),e()},u.prototype.transform=function(t,e,r){r=r||{};var o,n=void 0===t.vis||1===t.vis,i=t.content.parentId,a=u.enums.type[t.type],s="OEMBED"===a,c="CONTENT"===a,d="OPINE"===a,h=t.childContent||[],p=[],l=[];if(s||c||d){if(o=this._createContent(t,e),o&&r.collection&&(o.collection=r.collection),o&&o.id){var y=this._storage.get(o.id);y?(c&&y.set(this._getUpdatedProperties(o)),o=y):this._storage.set(o.id,o),p=this._storage.get("children_"+o.id)||[]}h=t.childContent||[];for(var _=0,f=h.length;_<f;_++){var g=this.transform(h[_],e,r);l.push.apply(l,g||[])}if(p.length&&this._addChildren(o,p),s&&this._attachOrStore(o,t.content.targetId),i&&this._addReplyOrStore(o,t.content.parentId),d&&this._addOpineOrStore(o,t.content.targetId),!c)return this._handleNonContent(o);if(!n)return this._handleNonPublic(o);if(!i||r.replies)return r.collection&&(o.collection=r.collection),r.replies?[o].concat(l):[o]}},u.transform=function(t,e,r){return(new u).transform(t,e,r)},u.prototype._addChildren=function(e,r){for(var n,a=0,s=r.length;a<s;a++)n=r[a],n instanceof o?e.addAttachment(n):n instanceof t?e.addReply(n):n instanceof i&&e.addOpine(n)},u._addChildren=u.prototype._addChildren,u.prototype._createContent=function(o,s){var c,d=u.enums.source[o.source];return o.author=s&&s[o.content.authorId],"OEMBED"===u.enums.type[o.type]?new n(o):"OPINE"===u.enums.type[o.type]?new i(o):"twitter"===d?new e(o):"facebook"===d?new r(o):"instagram"===d?new a(o):"feed"===d?(c=t,p(o)&&(c=a),new c(o)):"livefyre"===d?new t(o):void l("StateToContent could not create content for state",o)},u._createContent=u.prototype._createContent,u.prototype._getUpdatedProperties=function(t){var e={visibility:t.visibility};return t.attachments&&t.attachments.length&&(e.attachments=t.attachments),t.body&&(e.body=t.body),t.author&&(e.author=t.author),t.createdAt&&(e.createdAt=t.createdAt),t.updatedAt&&(e.updatedAt=t.updatedAt),e},u._getUpdatedProperties=u.prototype._getUpdatedProperties,u.prototype._attachOrStore=function(t,e){var r=this._storage.get(e);r?(l("attaching attachment",arguments),r.addAttachment(t)):(l("storing attachment",arguments),this._storeChild(t,e))},u._attachOrStore=u.prototype._attachOrStore,u.prototype._addReplyOrStore=function(t,e){var r=this._storage.get(e);r?(l("adding reply",arguments),r.addReply(t)):(l("storing reply",arguments),this._storeChild(t,e))},u._addReplyOrStore=u.prototype._addReplyOrStore,u.prototype._addOpineOrStore=function(t,e){var r=s.get(e);r?(l("attaching attachment",arguments),r.addOpine(t)):(l("storing attachment",arguments),this._storeChild(t,e))},u.prototype._storeChild=function(t,e){var r="children_"+e,o=this._storage.get(r)||[];o.push(t),this._storage.set(r,o)},u._storeChild=u.prototype._storeChild,u.prototype._handleNonPublic=function(t){},u.prototype._handleNonContent=function(t){},u.enums={},u.enums.source=t.SOURCES,u.enums.type=["CONTENT","OPINE","SHARE","OEMBED"],u.Storage=s,u}(_dereq_("./types/livefyre-content"),_dereq_("./types/livefyre-twitter-content"),_dereq_("./types/livefyre-facebook-content"),_dereq_("./types/oembed"),_dereq_("./types/livefyre-oembed"),_dereq_("./types/livefyre-opine"),_dereq_("./types/livefyre-instagram-content"),_dereq_("./../storage"),_dereq_("./../debug"),_dereq_("./../../../stream/src/transform"),_dereq_("inherits"))},{"./../../../stream/src/transform":48,"./../debug":77,"./../storage":79,"./types/livefyre-content":69,"./types/livefyre-facebook-content":70,"./types/livefyre-instagram-content":71,"./types/livefyre-oembed":72,"./types/livefyre-opine":73,"./types/livefyre-twitter-content":74,"./types/oembed":75,inherits:95}],69:[function(_dereq_,module,exports){module.exports=function(t,e,i,n,o){"use strict";var r=function(t,i){i=i||{},e.call(this),this._likes=0,this._annotator=i.annotator||this._createAnnotator(),t&&(t.content=t.content||{},t.content.annotations=t.content.annotations||{},this.id=t.content.id||t.id,this.author=t.author,this.createdAt=new Date(1e3*t.content.createdAt),this.updatedAt=new Date(1e3*t.content.updatedAt),this.lastVisibility=e.enums.visibility[t.lastVis],this.visibility=e.enums.visibility[t.vis],this.parentId=t.content.parentId,this.meta=t,this._annotator.annotate(this,{added:t.content.annotations},!0)),this.body=t?t.content.bodyHtml:"",this.source=t?r.SOURCES[t.source]:"livefyre"};return o(r,e),r.prototype.typeUrn="urn:livefyre:js:streamhub-sdk:content:types:livefyre",r.prototype._createAnnotator=function(){return new i},r.prototype.addAttachment=function(t){var e=!1;if(t.id)for(var i in this.attachments)this.attachments[i].id===t.id&&(e=!0);e||(this.attachments.push(t),this.emit("attachment",t))},r.prototype.addReply=function(t){var e=!1;if(t.id)for(var i in this.replies)this.replies[i].id===t.id&&(e=!0);e||(this.replies.push(t),this.emit("reply",t))},r.prototype.addOpine=function(t){if(0===t.vis)return void this.removeOpine(t);var e=!1;if(t.id)for(var i=0;i<this.opines.length;i++)this.opines[i].id===t.id&&(e=!0);else for(var i=0;i<this.opines.length;i++)this.opines[i].content.id===t.content.id&&(e=!0);e||(this.opines.push(t),t.relType===n.enums.type.indexOf("LIKE")&&this._likes++,this.emit("opine",t))},r.prototype.removeOpine=function(t){var e=null;if(t.id){for(var i=0;i<this.opines.length;i++)if(this.opines[i].id===t.id){e=i;break}}else for(var i=0;i<this.opines.length;i++)if(this.opines[i].content.id===t.content.id){e=i;break}null!==e&&(this.opines.splice(e,1),this._likes--,this.emit("removeOpine",t))},r.prototype.getLikeCount=function(){return this._likes},r.prototype.isLiked=function(t){for(var e=0;e<this.opines.length;e++)if(t===this.opines[e].author.id)return!0;return!1},r.prototype.isFeatured=function(){return Boolean(this.featured)},r.prototype.getFeaturedValue=function(){if(this.isFeatured())return this.featured.value},r.SOURCES=["livefyre","twitter","twitter","facebook","livefyre","livefyre","facebook","twitter","livefyre","unknown","unknown","unknown","unknown","feed","facebook","unknown","unknown","unknown","unknown","instagram","twitter","facebook"],r}(_dereq_("./../../jquery"),_dereq_("./../main"),_dereq_("./../annotator"),_dereq_("./livefyre-opine"),_dereq_("inherits"))},{"./../../jquery":78,"./../annotator":66,"./../main":67,"./livefyre-opine":73,inherits:95}],70:[function(_dereq_,module,exports){module.exports=function(e,r,t){"use strict";function i(r){var t=e("<div></div>");return t.append(r),t.html()}var n=function(t){var n;r.call(this,t);try{var n=e(this.body)}catch(e){}n&&n.length&&(n.find(".fyre-image, .fyre-link").remove(),this.body=i(n))};return t(n,r),n.prototype.typeUrn="urn:livefyre:js:streamhub-sdk:content:types:livefyre-facebook",n}(_dereq_("./../../jquery"),_dereq_("./livefyre-content"),_dereq_("inherits"))},{"./../../jquery":78,"./livefyre-content":69,inherits:95}],71:[function(_dereq_,module,exports){module.exports=function(e,r){"use strict";var t=function(r){e.call(this,r)};return r(t,e),t.prototype.typeUrn="urn:livefyre:js:streamhub-sdk:content:types:livefyre-instagram",t}(_dereq_("./livefyre-content"),_dereq_("inherits"))},{"./livefyre-content":69,inherits:95}],72:[function(_dereq_,module,exports){module.exports=function(t,e,r,i){"use strict";var l=function(t){r.call(this,t),e.call(this,t.content.oembed),"Facebook"===this.provider_name&&this.url&&this.thumbnail_url&&(""===this.html||null===this.html)&&(this.html="<a href='"+this.url+"' target='_blank'/><img src='"+this.thumbnail_url+"'/></a>")};return i(l,e),t.extend(l.prototype,r.prototype),l}(_dereq_("./../../jquery"),_dereq_("./oembed"),_dereq_("./livefyre-content"),_dereq_("inherits"))},{"./../../jquery":78,"./livefyre-content":69,"./oembed":75,inherits:95}],73:[function(_dereq_,module,exports){module.exports=function(e,i,t){"use strict";var r=function(t,n){if(n=n||{},i.call(this,this),t&&1!==t.type)throw new Error("Opines must be constructed with .type == 1 ");t=t||{},e.extend(this,t),void 0===n.opineType&&(this.relType=r.enums.type.indexOf("LIKE"))};return t(r,i),r.enums={},r.enums.type=["LIKE","FLAG_OFFENSIVE","FLAG_SPAM","FLAG_DISAGREE","FLAG_OFF_TOPIC","FLAG_PROFANE",void 0,void 0,void 0,void 0,"ANNOTATION","MODERATION_REASON","IS_SPAM_CONTENT","IS_NOT_SPAM_CONTENT"],r}(_dereq_("./../../jquery"),_dereq_("./../main"),_dereq_("inherits"))},{"./../../jquery":78,"./../main":67,inherits:95}],74:[function(_dereq_,module,exports){module.exports=function(t,e,r,i){"use strict";var o=function(t){r.call(this,t),this.tweetId=o.tweetIdFromLivefyreId(this.id),this.author&&(this.author.twitterUserId=o.twitterUserIdFromLivefyreAuthorId(this.author.id)),this.twitterVerified=o.isVerified(this.meta)};return i(o,r),o.prototype.typeUrn="urn:livefyre:js:streamhub-sdk:content:types:livefyre-twitter",o.isVerified=function(t){return(t.content.annotations.tweetMeta||{}).verified_user||!1},o.tweetIdFromLivefyreId=function(t){var e=/tweet-(\d+)@twitter.com/,r=t.match(e);if(!r)throw new Error("Can't parse tweet ID from Livefyre ID");return r[1]},o.twitterUserIdFromLivefyreAuthorId=function(t){var e=/([^@]+)@twitter.com/,r=t.match(e);if(!r)throw new Error("Can't parse twitterUserId from Livefyre authorId");return r[1]},o}(_dereq_("./../../jquery"),_dereq_("./twitter-content"),_dereq_("./livefyre-content"),_dereq_("inherits"))},{"./../../jquery":78,"./livefyre-content":69,"./twitter-content":76,inherits:95}],75:[function(_dereq_,module,exports){module.exports=function(t,e,i){"use strict";var r=function(i){if(e.call(this,this),i&&-1===r.types.indexOf(i.type))throw new Error("Oembeds must be constructed with .type in "+r.types);i=i||{},t.extend(this,i),void 0!==this.html&&""===t.trim(this.html)&&(this.html=null)};return i(r,e),r.types=["photo","video","link","rich"],r.properties=["type","version","title","author_name","author_url","provider_name","provider_url","cache_age","thumbnail_url","thumbnail_width","thumbnail_height","url","width","height","html"],r.prototype.toJSON=function(){var e=this,i={};return t.each(r.properties,function(t,r){void 0!==e[r]&&(i[r]=e[r])}),i},r}(_dereq_("./../../jquery"),_dereq_("./../main"),_dereq_("inherits"))},{"./../../jquery":78,"./../main":67,inherits:95}],76:[function(_dereq_,module,exports){module.exports=function(t,e){"use strict";var i=function(e){t.call(this,this),e=e||{},this.tweetId=e.tweetId};return e(i,t),i}(_dereq_("./../main"),_dereq_("inherits"))},{"./../main":67,inherits:95}],77:[function(_dereq_,module,exports){module.exports=_dereq_("./../../debug/debug.js")},{"./../../debug/debug.js":6}],78:[function(_dereq_,module,exports){module.exports=function(e){"use strict";if(!e.support.cors&&window.XDomainRequest){var t=/^https?:\/\//i,o=/^get|post$/i,n=new RegExp("^"+location.protocol,"i"),r=/\/xml/i,s=window.XDomainRequest,a=window.ActiveXObject;e.ajaxTransport("text html xml json",function(i,c,u){if(i.crossDomain&&i.async&&o.test(i.type)&&t.test(c.url)&&n.test(c.url)){var p=null,l=(c.dataType||"").toLowerCase();return{send:function(t,o){if(p=new s,/^\d+$/.test(c.timeout)&&(p.timeout=c.timeout),p.ontimeout=function(){o(500,"timeout")},p.onload=function(){var e="Content-Length: "+p.responseText.length+"\r\nContent-Type: "+p.contentType,t={code:200,message:"success"},n={text:p.responseText};try{if("json"===l)try{n.json=JSON.parse(p.responseText)}catch(e){t.code=500,t.message="parseerror"}else if("xml"===l||"text"!==l&&r.test(p.contentType)){var s=new a("Microsoft.XMLDOM");s.async=!1;try{s.loadXML(p.responseText)}catch(e){s=void 0}if(!s||!s.documentElement||s.getElementsByTagName("parsererror").length)throw t.code=500,t.message="parseerror","Invalid XML: "+p.responseText;n.xml=s}}catch(e){throw e}finally{o(t.code,t.message,n,e)}},p.onerror=function(){o(500,"error",{text:p.responseText})},p.open(i.type,i.url),p.onprogress=function(){},c.data&&"POST"===i.type){var n=c.data;"object"==typeof n&&(n=e.param(n)),p.send(n)}else p.send()},abort:function(){p&&p.abort()}}}})}return e}(_dereq_("./../../../node_modules/jquery/dist/jquery"))},{"./../../../node_modules/jquery/dist/jquery":96}],79:[function(_dereq_,module,exports){module.exports=function(e,t){"use strict";var r={cache:{}};return t.call(r),e.extend(r,t.prototype),r.get=function(e,t){var r=this.cache[e];if(!t)return r;t(r)},r.set=function(e,t,r){var i=this.cache[e];if(this.cache[e]=t,i?this.emit("change",i,t):this.emit("add",t),!r)return t;r(t)},r}(_dereq_("./jquery"),_dereq_("./../../event-emitter/src/event-emitter"))},{"./../../event-emitter/src/event-emitter":10,"./jquery":78}],80:[function(_dereq_,module,exports){module.exports=function(e,t){"use strict";var r=e("util"),n={};n.outerWidth=function(e){return r("Deprecated: util.outerWidth"),t(e).outerWidth(!0)},n.outerHeight=function(e){return r("Deprecated: util.outerHeight"),t(e).outerHeight(!0)},n.innerWidth=function(e){return r("Deprecated: util.innerWidth"),t(e).innerWidth()},n.innerHeight=function(e){return r("Deprecated: util.innerHeight"),t(e).innerHeight()};var o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return n.formatDate=function(e,t){t=t||new Date;var r,n=e.getTime()-t.getTime();return n>0?"":n>-6e4?Math.round(-1*n/1e3)+"s":n>-36e5?Math.round(-1*n/6e4)+"m":n>-864e5?Math.round(-1*n/36e5)+"h":(r=e.getDate()+" "+o[e.getMonth()],e.getFullYear()!==t.getFullYear()&&(r+=" "+e.getFullYear()),r)},n.objectKeys=Object.keys||function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(o){if("object"!=typeof o&&"function"!=typeof o||null===o)throw new TypeError("objectKeys called on a non-object");var u=[];for(var i in o)e.call(o,i)&&u.push(i);if(t)for(var a=0;a<n;a++)e.call(o,r[a])&&u.push(r[a]);return u}}(),Array.prototype.indexOf=Array.prototype.indexOf||function(e){return t.inArray(e,this)},n}(_dereq_("./debug"),_dereq_("./jquery"))},{"./debug":77,"./jquery":78}],81:[function(_dereq_,module,exports){function delegateEvents(e,t,n,E){undelegateEvents(e,n),t instanceof EventMap&&(t=t.withContext(E));for(var r in t)if(t.hasOwnProperty(r)){var o=t[r];if("string"==typeof o&&(o=E[o]),!o)throw"Undefined method for: "+r;o=$.proxy(o,E);var a=r.match(EVENT_SPLITTER);if(!a)throw"Invalid event/selector pair: "+r;var d=a[1],i=a[2];d+=EVENT_ANTENNA+n,""===i?e.on(d,o):e.on(d,i,o)}}function getUniqueId(){return++idCounts+""}function undelegateEvents(e,t){e.off(EVENT_ANTENNA+t)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),EventMap=_dereq_("./event-map"),EVENT_ANTENNA=".delegateEvents",EVENT_SPLITTER=/^(\S+)\s*(.*)$/,idCounts=0;module.exports={delegateEvents:delegateEvents,getUniqueId:getUniqueId,undelegateEvents:undelegateEvents}},{"./../../../node_modules/jquery/dist/jquery":96,"./event-map":82}],82:[function(_dereq_,module,exports){"use strict";function EventMap(t){this._factories=[],extend(this,[t])}function extend(t,e){var n,i,o,r;t=t||{},e=e||[],r=e.length;for(var s=0;s<r;s++)if(void 0!==(o=e[s])){if("function"==typeof o){t._factories.push(o);continue}for(i in o)o.hasOwnProperty(i)&&(n=o[i],"_factories"===i&&n.slice&&(n=n.slice()),t!==n&&void 0!==n&&(t[i]=n))}return t}EventMap.prototype.extended=function(){var t=new EventMap(this);return extend(t,[].slice.apply(arguments)),t},EventMap.prototype.withContext=function(t){for(var e,n,i=[],o={},r=0,s=this._factories.length;r<s;r++)e=this._factories[r],n={},i.push(e.call(t,n)||n);return extend(o,[this].concat(i)),o},module.exports=EventMap},{}],83:[function(_dereq_,module,exports){var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),delegate=_dereq_("./delegate"),EventEmitter=_dereq_("./../../event-emitter/src/event-emitter"),EventMap=_dereq_("./event-map"),inherits=_dereq_("./../../inherits/inherits.js"),View=function(e){EventEmitter.call(this),e=e||{},this.opts=e,this.uid=delegate.getUniqueId(),this.setElement(e.el||document.createElement(this.elTag))};inherits(View,EventEmitter);View.prototype.$=function(e){return this.$el.find(e)},View.prototype.getElementsByClass=function(e){return this.$el.find("."+e)},View.prototype.elTag="div",View.prototype.elClass="",View.prototype.events=new EventMap,View.prototype.getTemplateContext=function(){return this},View.prototype.template=null,View.prototype.setElement=function(e){return this.el&&(this.$el.removeClass(this.elClass),this.undelegateEvents()),this.$el=e instanceof $?e:$(e),this.el=this.$el[0],this.elClass&&this.$el.addClass(this.elClass),this.delegateEvents(),this},View.prototype.delegateEvents=function(e){return e||(e=this.events)?(delegate.delegateEvents(this.$el,e,this.uid,this),this):this},View.prototype.undelegateEvents=function(){return delegate.undelegateEvents(this.$el,this.uid),this},View.prototype.render=function(){var e;"function"==typeof this.template&&(e=this.getTemplateContext(),this.$el.html(this.template(e)))},View.prototype.detach=function(){this.$el.detach()},View.prototype.destroy=function(){this.$el.remove(),this.template=null,this.undelegateEvents(),this.removeAllListeners()},module.exports=View},{"./../../../node_modules/jquery/dist/jquery":96,"./../../event-emitter/src/event-emitter":10,"./../../inherits/inherits.js":11,"./delegate":81,"./event-map":82}],84:[function(_dereq_,module,exports){function AbstractRange(){}var abstractMethod=_dereq_("./util/base").abstractMethod;AbstractRange.prototype._createNativeRange=abstractMethod,AbstractRange.prototype.addToSelection=abstractMethod,AbstractRange.prototype.backup=abstractMethod,AbstractRange.prototype.clearNativeSelection=abstractMethod,AbstractRange.prototype.deleteContents=abstractMethod,AbstractRange.prototype.getBoundingClientRect=abstractMethod,AbstractRange.prototype.getEndNode=abstractMethod,AbstractRange.prototype.getEndOffset=abstractMethod,AbstractRange.prototype.getOriginalString=abstractMethod,AbstractRange.prototype.getParentNode=abstractMethod,AbstractRange.prototype.getStartNode=abstractMethod,AbstractRange.prototype.getStartOffset=abstractMethod,AbstractRange.prototype.insertNode=abstractMethod,AbstractRange.prototype.selectNodeContents=abstractMethod,AbstractRange.prototype.setEnd=abstractMethod,AbstractRange.prototype.setStart=abstractMethod,AbstractRange.prototype.toHtmlString=abstractMethod,AbstractRange.prototype.toString=abstractMethod,module.exports=AbstractRange},{"./util/base":88}],85:[function(_dereq_,module,exports){function Highlighter(e){this._className=e.className}var domUtil=_dereq_("./util/dom"),XRange=_dereq_("./xrange");Highlighter.prototype._highlightNode=function(e,t,i){var n=e.nodeValue,r=t||0,a=i||n.length,o=document.createDocumentFragment();r>0&&o.appendChild(document.createTextNode(n.substring(0,r)));var g=document.createElement("span");return g.className=this._className,g.innerHTML=n.substring(r,a),o.appendChild(g),a<n.length&&o.appendChild(document.createTextNode(n.substring(a))),e.parentNode.replaceChild(o,e),g},Highlighter.prototype.highlight=function(e){function t(e){domUtil.forEachSibling(e,function(e){if(e===i)return e=h._highlightNode(e,0,n),g=!0,!0;e=h._highlightNode(e)}),g||e.parentNode===o||t(e.parentNode)}e.backup()
;var i=e.getEndNode(),n=e.getEndOffset(),r=e.getStartNode(),a=e.getStartOffset();if(r===i)return void this._highlightNode(r,a,n);var o=e.getParentNode(),g=!1,h=this;t(this._highlightNode(r,a)),e.clearNativeSelection()},Highlighter.prototype.unhighlight=function(e){var t,i=e.getParentNode(),n=this;domUtil.forEachNode(i,function(e){t=e.parentNode,t.className.indexOf(n._className)>-1&&t.parentNode.replaceChild(e,t)}),domUtil.normalize(i),XRange.getRangeByString(e.getOriginalString(),i,e)},module.exports=Highlighter},{"./util/dom":89,"./xrange":90}],86:[function(_dereq_,module,exports){function IERange(t){this._nativeRange=t||this._createNativeRange(),this._originalString=null,this._endNode=null,this._endOffset=0,this._startNode=null,this._startOffset=0}var AbstractRange=_dereq_("./abstractrange");_dereq_("./../../inherits/inherits.js")(IERange,AbstractRange),IERange.prototype._createNativeRange=function(){return document.selection.createRange()},IERange.prototype.addToSelection=function(){},IERange.prototype.backup=function(){this._originalString=this.toHtmlString()},IERange.prototype.clearNativeSelection=function(){},IERange.prototype.deleteContents=function(){},IERange.prototype.getBoundingClientRect=function(){},IERange.prototype.getEndNode=function(){return this._endNode},IERange.prototype.getEndOffset=function(){return this._endOffset},IERange.prototype.getOriginalString=function(){return this._originalString},IERange.prototype.getParentNode=function(){return this._nativeRange.parentElement()},IERange.prototype.getStartNode=function(){return this._startNode},IERange.prototype.getStartOffset=function(){return this._startOffset},IERange.prototype.insertNode=function(t){},IERange.prototype.selectNodeContents=function(t){},IERange.prototype.setEnd=function(t,e){this._endNode=t,this._endOffset=e},IERange.prototype.setStart=function(t,e){this._startNode=t,this._startOffset=e},IERange.prototype.toHtmlString=function(){return""},IERange.prototype.toString=function(){return""},module.exports=IERange},{"./../../inherits/inherits.js":11,"./abstractrange":84}],87:[function(_dereq_,module,exports){function StandardRange(t){this._nativeRange=t||this._createNativeRange(),this._originalString=null}var AbstractRange=_dereq_("./abstractrange");_dereq_("./../../inherits/inherits.js")(StandardRange,AbstractRange),StandardRange.prototype._createNativeRange=function(){var t=window.getSelection();return!t.rangeCount||t.isCollapsed?document.createRange():t.getRangeAt(0)},StandardRange.prototype.addToSelection=function(){window.getSelection().addRange(this._nativeRange)},StandardRange.prototype.backup=function(){this._originalString=this.toHtmlString()},StandardRange.prototype.clearNativeSelection=function(){var t=window.getSelection();t.empty&&t.empty(),t.removeAllRanges&&t.removeAllRanges()},StandardRange.prototype.deleteContents=function(){this._nativeRange.deleteContents()},StandardRange.prototype.getBoundingClientRect=function(){return this._nativeRange.getBoundingClientRect()},StandardRange.prototype.getEndNode=function(){return this._nativeRange.endContainer},StandardRange.prototype.getEndOffset=function(){return this._nativeRange.endOffset},StandardRange.prototype.getOriginalString=function(){return this._originalString},StandardRange.prototype.getParentNode=function(){var t=this._nativeRange.commonAncestorContainer;return 1!==t.nodeType&&(t=t.parentNode),t},StandardRange.prototype.getStartNode=function(){return this._nativeRange.startContainer},StandardRange.prototype.getStartOffset=function(){return this._nativeRange.startOffset},StandardRange.prototype.insertNode=function(t){this._nativeRange.insertNode(t)},StandardRange.prototype.selectNodeContents=function(t){this._nativeRange.selectNodeContents(t)},StandardRange.prototype.setEnd=function(t,n){this._nativeRange.setEnd(t,n)},StandardRange.prototype.setStart=function(t,n){this._nativeRange.setStart(t,n)},StandardRange.prototype.toHtmlString=function(){var t=document.createElement("div");return t.appendChild(this._nativeRange.cloneContents()),t.innerHTML},StandardRange.prototype.toString=function(){return this._nativeRange.toString()},module.exports=StandardRange},{"./../../inherits/inherits.js":11,"./abstractrange":84}],88:[function(_dereq_,module,exports){var util={};util.abstractMethod=function(){throw"This function must be overridden"},util.memoize=function(t){return function(){var n=t.call(this);return t=function(){return n},n}},module.exports=util},{}],89:[function(_dereq_,module,exports){function processNode(e,t,o){return e.hasChildNodes()?o(e,t):3===e.nodeType?t(e):void 0}var util={};util.findNodeInElement=function(e,t){var o;return(t?util.forEachNodeReverse:util.forEachNode)(e,function(e){return o=e,!0}),o},util.forEachNode=function(e,t){for(var o=e.childNodes,i=0;i<o.length;i++)if(processNode(o[i],t,util.forEachNode))return!0},util.forEachNodeReverse=function(e,t){for(var o=e.childNodes,i=o.length-1;i>=0;i--)if(processNode(o[i],t,util.forEachNodeReverse))return!0},util.forEachSibling=function(e,t){for(var o=e.nextSibling;o;){if(processNode(o,t,util.forEachNode))return!0;o=o.nextSibling}return!1},util.getBoundingClientRect=function(e){var t=e.getBoundingClientRect();return t.height||t.top||(t=e.getBoundingClientRect()),void 0===typeof t.height&&(t={top:t.top,right:t.right,bottom:t.bottom,left:t.left},t.height=t.bottom-t.top,t.width=t.right-t.left),t},util.normalize=function(e){var t,o,i,n,r=e.childNodes,l=[];for(t=0,o=r.length;t<o;t++)if(i=r[t],i.hasChildNodes())util.normalize(i),n=null;else if(n){if(3===i.nodeType){l.push(i),n.nodeValue+=i.nodeValue;continue}n=null}else 3===i.nodeType&&(n=i);for(t=0,o=l.length;t<o;t++)e.removeChild(l[t])},module.exports=util},{}],90:[function(_dereq_,module,exports){var domUtil=_dereq_("./util/dom"),XRange=_dereq_(window.getSelection?"./standardrange":"./ierange");XRange.getRangeByString=function(e,n,r){function t(n,r){var t;o.setEnd(n,r);for(var i=0;i<l.length;i++)if(t=l[i],o.setStart(t[0],t[1]),o.toHtmlString()===e)return!0;return!1}var i=document.createElement("div");i.innerHTML=e;var a=domUtil.findNodeInElement(i),d=domUtil.findNodeInElement(i,!0);if(a&&d){a=a.nodeValue,d=d.nodeValue;var o=r||new XRange,l=[];return domUtil.forEachNode(n,function(e){var n=e.nodeValue.indexOf(a);n>-1&&l.push([e,n]);var r=e.nodeValue.indexOf(d);if(r>-1&&t(e,r+d.length))return!0})?o:null}},module.exports=XRange},{"./ierange":86,"./standardrange":87,"./util/dom":89}],91:[function(_dereq_,module,exports){(function(process,global){!function(t,e){"object"==typeof exports&&void 0!==module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.ES6Promise=e()}(this,function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function n(t){z=t}function r(t){B=t}function o(){return function(){W(s)}}function i(){var t=setTimeout;return function(){return t(s,1)}}function s(){for(var t=0;t<U;t+=2)(0,R[t])(R[t+1]),R[t]=void 0,R[t+1]=void 0;U=0}function u(t,e){var n=arguments,r=this,o=new this.constructor(a);void 0===o[X]&&P(o);var i=r._state;return i?function(){var t=n[i-1];B(function(){return E(i,o,t,r._result)})}():g(r,o,t,e),o}function c(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var n=new e(a);return y(n,t),n}function a(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function l(){return new TypeError("A promises callback cannot return that same promise.")}function h(t){try{return t.then}catch(t){return et.error=t,et}}function p(t,e,n,r){try{t.call(e,n,r)}catch(t){return t}}function v(t,e,n){B(function(t){var r=!1,o=p(n,e,function(n){r||(r=!0,e!==n?y(t,n):b(t,n))},function(e){r||(r=!0,w(t,e))},"Settle: "+(t._label||" unknown promise"));!r&&o&&(r=!0,w(t,o))},t)}function d(t,e){e._state===$?b(t,e._result):e._state===tt?w(t,e._result):g(e,void 0,function(e){return y(t,e)},function(e){return w(t,e)})}function _(t,n,r){n.constructor===t.constructor&&r===u&&n.constructor.resolve===c?d(t,n):r===et?w(t,et.error):void 0===r?b(t,n):e(r)?v(t,n,r):b(t,n)}function y(e,n){e===n?w(e,f()):t(n)?_(e,n,h(n)):b(e,n)}function m(t){t._onerror&&t._onerror(t._result),A(t)}function b(t,e){t._state===Z&&(t._result=e,t._state=$,0!==t._subscribers.length&&B(A,t))}function w(t,e){t._state===Z&&(t._state=tt,t._result=e,B(m,t))}function g(t,e,n,r){var o=t._subscribers,i=o.length;t._onerror=null,o[i]=e,o[i+$]=n,o[i+tt]=r,0===i&&t._state&&B(A,t)}function A(t){var e=t._subscribers,n=t._state;if(0!==e.length){for(var r=void 0,o=void 0,i=t._result,s=0;s<e.length;s+=3)r=e[s],o=e[s+n],r?E(n,r,o,i):o(i);t._subscribers.length=0}}function S(){this.error=null}function j(t,e){try{return t(e)}catch(t){return nt.error=t,nt}}function E(t,n,r,o){var i=e(r),s=void 0,u=void 0,c=void 0,a=void 0;if(i){if(s=j(r,o),s===nt?(a=!0,u=s.error,s=null):c=!0,n===s)return void w(n,l())}else s=o,c=!0;n._state!==Z||(i&&c?y(n,s):a?w(n,u):t===$?b(n,s):t===tt&&w(n,s))}function T(t,e){try{e(function(e){y(t,e)},function(e){w(t,e)})}catch(e){w(t,e)}}function M(){return rt++}function P(t){t[X]=rt++,t._state=void 0,t._result=void 0,t._subscribers=[]}function x(t,e){this._instanceConstructor=t,this.promise=new t(a),this.promise[X]||P(this.promise),N(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?b(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&b(this.promise,this._result))):w(this.promise,C())}function C(){return new Error("Array Methods must be provided an Array")}function O(t){return new x(this,t).promise}function k(t){var e=this;return new e(N(t)?function(n,r){for(var o=t.length,i=0;i<o;i++)e.resolve(t[i]).then(n,r)}:function(t,e){return e(new TypeError("You must pass an array to race."))})}function Y(t){var e=this,n=new e(a);return w(n,t),n}function q(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function F(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function D(t){this[X]=M(),this._result=this._state=void 0,this._subscribers=[],a!==t&&("function"!=typeof t&&q(),this instanceof D?T(this,t):F())}function K(){var t=void 0;if(void 0!==global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var e=t.Promise;if(e){var n=null;try{n=Object.prototype.toString.call(e.resolve())}catch(t){}if("[object Promise]"===n&&!e.cast)return}t.Promise=D}var L=void 0;L=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var N=L,U=0,W=void 0,z=void 0,B=function(t,e){R[U]=t,R[U+1]=e,2===(U+=2)&&(z?z(s):V())},G="undefined"!=typeof window?window:void 0,H=G||{},I=H.MutationObserver||H.WebKitMutationObserver,J="undefined"==typeof self&&void 0!==process&&"[object process]"==={}.toString.call(process),Q="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,R=new Array(1e3),V=void 0;V=J?function(){return function(){return process.nextTick(s)}}():I?function(){var t=0,e=new I(s),n=document.createTextNode("");return e.observe(n,{characterData:!0}),function(){n.data=t=++t%2}}():Q?function(){var t=new MessageChannel;return t.port1.onmessage=s,function(){return t.port2.postMessage(0)}}():void 0===G&&"function"==typeof _dereq_?function(){try{var t=_dereq_,e=t("vertx");return W=e.runOnLoop||e.runOnContext,o()}catch(t){return i()}}():i();var X=Math.random().toString(36).substring(16),Z=void 0,$=1,tt=2,et=new S,nt=new S,rt=0;return x.prototype._enumerate=function(){for(var t=this.length,e=this._input,n=0;this._state===Z&&n<t;n++)this._eachEntry(e[n],n)},x.prototype._eachEntry=function(t,e){var n=this._instanceConstructor,r=n.resolve;if(r===c){var o=h(t);if(o===u&&t._state!==Z)this._settledAt(t._state,e,t._result);else if("function"!=typeof o)this._remaining--,this._result[e]=t;else if(n===D){var i=new n(a);_(i,t,o),this._willSettleAt(i,e)}else this._willSettleAt(new n(function(e){return e(t)}),e)}else this._willSettleAt(r(t),e)},x.prototype._settledAt=function(t,e,n){var r=this.promise;r._state===Z&&(this._remaining--,t===tt?w(r,n):this._result[e]=n),0===this._remaining&&b(r,this._result)},x.prototype._willSettleAt=function(t,e){var n=this;g(t,void 0,function(t){return n._settledAt($,e,t)},function(t){return n._settledAt(tt,e,t)})},D.all=O,D.race=k,D.resolve=c,D.reject=Y,D._setScheduler=n,D._setAsap=r,D._asap=B,D.prototype={constructor:D,then:u,catch:function(t){return this.then(null,t)}},K(),D.polyfill=K,D.Promise=D,D})}).call(this,_dereq_("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:97}],92:[function(_dereq_,module,exports){!function(t){function n(t){"}"===t.n.substr(t.n.length-1)&&(t.n=t.n.substring(0,t.n.length-1))}function r(t){return t.trim?t.trim():t.replace(/^\s*|\s*$/g,"")}function e(t,n,r){if(n.charAt(r)!=t.charAt(0))return!1;for(var e=1,a=t.length;e<a;e++)if(n.charAt(r+e)!=t.charAt(e))return!1;return!0}function a(n,r,e,c){var o=[],u=null,l=null,f=null;for(l=e[e.length-1];n.length>0;){if(f=n.shift(),l&&"<"==l.tag&&!(f.tag in k))throw new Error("Illegal content in < super tag.");if(t.tags[f.tag]<=t.tags.$||i(f,c))e.push(f),f.nodes=a(n,f.tag,e,c);else{if("/"==f.tag){if(0===e.length)throw new Error("Closing tag without opener: /"+f.n);if(u=e.pop(),f.n!=u.n&&!s(f.n,u.n,c))throw new Error("Nesting error: "+u.n+" vs. "+f.n);return u.end=f.i,o}"\n"==f.tag&&(f.last=0==n.length||"\n"==n[0].tag)}o.push(f)}if(e.length>0)throw new Error("missing closing tag: "+e.pop().n);return o}function i(t,n){for(var r=0,e=n.length;r<e;r++)if(n[r].o==t.n)return t.tag="#",!0}function s(t,n,r){for(var e=0,a=r.length;e<a;e++)if(r[e].c==t&&r[e].o==n)return!0}function c(t){var n=[];for(var r in t)n.push('"'+u(r)+'": function(c,p,t,i) {'+t[r]+"}");return"{ "+n.join(",")+" }"}function o(t){var n=[];for(var r in t.partials)n.push('"'+u(r)+'":{name:"'+u(t.partials[r].name)+'", '+o(t.partials[r])+"}");return"partials: {"+n.join(",")+"}, subs: "+c(t.subs)}function u(t){return t.replace(b,"\\\\").replace(d,'\\"').replace(v,"\\n").replace(m,"\\r").replace(w,"\\u2028").replace(x,"\\u2029")}function l(t){return~t.indexOf(".")?"d":"f"}function f(t,n){var r="<"+(n.prefix||""),e=r+t.n+A++;return n.partials[e]={name:t.n,partials:{}},n.code+='t.b(t.rp("'+u(e)+'",c,p,"'+(t.indent||"")+'"));',e}function g(t,n){n.code+="t.b(t.t(t."+l(t.n)+'("'+u(t.n)+'",c,p,0)));'}function p(t){return"t.b("+t+");"}var h=/\S/,d=/\"/g,v=/\n/g,m=/\r/g,b=/\\/g,w=/\u2028/,x=/\u2029/;t.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12},t.scan=function(a,i){function s(){p.length>0&&(d.push({tag:"_t",text:new String(p)}),p="")}function c(){for(var n=!0,r=b;r<d.length;r++)if(!(n=t.tags[d[r].tag]<t.tags._v||"_t"==d[r].tag&&null===d[r].text.match(h)))return!1;return n}function o(t,n){if(s(),t&&c())for(var r,e=b;e<d.length;e++)d[e].text&&((r=d[e+1])&&">"==r.tag&&(r.indent=d[e].text.toString()),d.splice(e,1));else n||d.push({tag:"\n"});v=!1,b=d.length}var u=a.length,l=0,f=null,g=null,p="",d=[],v=!1,m=0,b=0,w="{{",x="}}";for(i&&(i=i.split(" "),w=i[0],x=i[1]),m=0;m<u;m++)0==l?e(w,a,m)?(--m,s(),l=1):"\n"==a.charAt(m)?o(v):p+=a.charAt(m):1==l?(m+=w.length-1,g=t.tags[a.charAt(m+1)],f=g?a.charAt(m+1):"_v","="==f?(m=function(t,n){var e="="+x,a=t.indexOf(e,n),i=r(t.substring(t.indexOf("=",n)+1,a)).split(" ");return w=i[0],x=i[i.length-1],a+e.length-1}(a,m),l=0):(g&&m++,l=2),v=m):e(x,a,m)?(d.push({tag:f,n:r(p),otag:w,ctag:x,i:"/"==f?v-w.length:m+x.length}),p="",m+=x.length-1,l=0,"{"==f&&("}}"==x?m++:n(d[d.length-1]))):p+=a.charAt(m);return o(v,!0),d};var k={_t:!0,"\n":!0,$:!0,"/":!0};t.stringify=function(n,r,e){return"{code: function (c,p,i) { "+t.wrapMain(n.code)+" },"+o(n)+"}"};var A=0;t.generate=function(n,r,e){A=0;var a={code:"",subs:{},partials:{}};return t.walk(n,a),e.asString?this.stringify(a,r,e):this.makeTemplate(a,r,e)},t.wrapMain=function(t){return'var t=this;t.b(i=i||"");'+t+"return t.fl();"},t.template=t.Template,t.makeTemplate=function(t,n,r){var e=this.makePartials(t);return e.code=new Function("c","p","i",this.wrapMain(t.code)),new this.template(e,n,this,r)},t.makePartials=function(t){var n,r={subs:{},partials:t.partials,name:t.name};for(n in r.partials)r.partials[n]=this.makePartials(r.partials[n]);for(n in t.subs)r.subs[n]=new Function("c","p","t","i",t.subs[n]);return r},t.codegen={"#":function(n,r){r.code+="if(t.s(t."+l(n.n)+'("'+u(n.n)+'",c,p,1),c,p,0,'+n.i+","+n.end+',"'+n.otag+" "+n.ctag+'")){t.rs(c,p,function(c,p,t){',t.walk(n.nodes,r),r.code+="});c.pop();}"},"^":function(n,r){r.code+="if(!t.s(t."+l(n.n)+'("'+u(n.n)+'",c,p,1),c,p,1,0,0,"")){',t.walk(n.nodes,r),r.code+="};"},">":f,"<":function(n,r){var e={partials:{},code:"",subs:{},inPartial:!0};t.walk(n.nodes,e);var a=r.partials[f(n,r)];a.subs=e.subs,a.partials=e.partials},$:function(n,r){var e={subs:{},code:"",partials:r.partials,prefix:n.n};t.walk(n.nodes,e),r.subs[n.n]=e.code,r.inPartial||(r.code+='t.sub("'+u(n.n)+'",c,p,i);')},"\n":function(t,n){n.code+=p('"\\n"'+(t.last?"":" + i"))},_v:function(t,n){n.code+="t.b(t.v(t."+l(t.n)+'("'+u(t.n)+'",c,p,0)));'},_t:function(t,n){n.code+=p('"'+u(t.text)+'"')},"{":g,"&":g},t.walk=function(n,r){for(var e,a=0,i=n.length;a<i;a++)(e=t.codegen[n[a].tag])&&e(n[a],r);return r},t.parse=function(t,n,r){return r=r||{},a(t,"",[],r.sectionTags||[])},t.cache={},t.cacheKey=function(t,n){return[t,!!n.asString,!!n.disableLambda,n.delimiters,!!n.modelGet].join("||")},t.compile=function(n,r){r=r||{};var e=t.cacheKey(n,r),a=this.cache[e];if(a){var i=a.partials;for(var s in i)delete i[s].instance;return a}return a=this.generate(this.parse(this.scan(n,r.delimiters),n,r),n,r),this.cache[e]=a}}(void 0!==exports?exports:Hogan)},{}],93:[function(_dereq_,module,exports){var Hogan=_dereq_("./compiler");Hogan.Template=_dereq_("./template").Template,Hogan.template=Hogan.Template,module.exports=Hogan},{"./compiler":92,"./template":94}],94:[function(_dereq_,module,exports){var Hogan={};!function(t){function i(t,i,s){var e;return i&&"object"==typeof i&&(void 0!==i[t]?e=i[t]:s&&i.get&&"function"==typeof i.get&&(e=i.get(t))),e}function s(t,i,s,e,n,r){function o(){}function u(){}o.prototype=t,u.prototype=t.subs;var a,c=new o;c.subs=new u,c.subsText={},c.buf="",e=e||{},c.stackSubs=e,c.subsText=r;for(a in i)e[a]||(e[a]=i[a]);for(a in e)c.subs[a]=e[a];n=n||{},c.stackPartials=n;for(a in s)n[a]||(n[a]=s[a]);for(a in n)c.partials[a]=n[a];return c}function e(t){return String(null===t||void 0===t?"":t)}function n(t){return t=e(t),h.test(t)?t.replace(r,"&amp;").replace(o,"&lt;").replace(u,"&gt;").replace(a,"&#39;").replace(c,"&quot;"):t}t.Template=function(t,i,s,e){t=t||{},this.r=t.code||this.r,this.c=s,this.options=e||{},this.text=i||"",this.partials=t.partials||{},this.subs=t.subs||{},this.buf=""},t.Template.prototype={r:function(t,i,s){return""},v:n,t:e,render:function(t,i,s){return this.ri([t],i||{},s)},ri:function(t,i,s){return this.r(t,i,s)},ep:function(t,i){var e=this.partials[t],n=i[e.name];if(e.instance&&e.base==n)return e.instance;if("string"==typeof n){if(!this.c)throw new Error("No compiler available.");n=this.c.compile(n,this.options)}if(!n)return null;if(this.partials[t].base=n,e.subs){i.stackText||(i.stackText={});for(key in e.subs)i.stackText[key]||(i.stackText[key]=void 0!==this.activeSub&&i.stackText[this.activeSub]?i.stackText[this.activeSub]:this.text);n=s(n,e.subs,e.partials,this.stackSubs,this.stackPartials,i.stackText)}return this.partials[t].instance=n,n},rp:function(t,i,s,e){var n=this.ep(t,s);return n?n.ri(i,s,e):""},rs:function(t,i,s){var e=t[t.length-1];if(!f(e))return void s(t,i,this);for(var n=0;n<e.length;n++)t.push(e[n]),s(t,i,this),t.pop()},s:function(t,i,s,e,n,r,o){var u;return(!f(t)||0!==t.length)&&("function"==typeof t&&(t=this.ms(t,i,s,e,n,r,o)),u=!!t,!e&&u&&i&&i.push("object"==typeof t?t:i[i.length-1]),u)},d:function(t,s,e,n){var r,o=t.split("."),u=this.f(o[0],s,e,n),a=this.options.modelGet,c=null;if("."===t&&f(s[s.length-2]))u=s[s.length-1];else for(var h=1;h<o.length;h++)r=i(o[h],u,a),void 0!==r?(c=u,u=r):u="";return!(n&&!u)&&(n||"function"!=typeof u||(s.push(c),u=this.mv(u,s,e),s.pop()),u)},f:function(t,s,e,n){for(var r=!1,o=null,u=!1,a=this.options.modelGet,c=s.length-1;c>=0;c--)if(o=s[c],void 0!==(r=i(t,o,a))){u=!0;break}return u?(n||"function"!=typeof r||(r=this.mv(r,s,e)),r):!n&&""},ls:function(t,i,s,n,r){var o=this.options.delimiters;return this.options.delimiters=r,this.b(this.ct(e(t.call(i,n)),i,s)),this.options.delimiters=o,!1},ct:function(t,i,s){if(this.options.disableLambda)throw new Error("Lambda features disabled.");return this.c.compile(t,this.options).render(i,s)},b:function(t){this.buf+=t},fl:function(){var t=this.buf;return this.buf="",t},ms:function(t,i,s,e,n,r,o){var u,a=i[i.length-1],c=t.call(a);return"function"==typeof c?!!e||(u=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text,this.ls(c,a,s,u.substring(n,r),o)):c},mv:function(t,i,s){var n=i[i.length-1],r=t.call(n);return"function"==typeof r?this.ct(e(r.call(n)),n,s):r},sub:function(t,i,s,e){var n=this.subs[t];n&&(this.activeSub=t,n(i,s,this,e),this.activeSub=!1)}};var r=/&/g,o=/</g,u=/>/g,a=/\'/g,c=/\"/g,h=/[&<>\"\']/,f=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}}(void 0!==exports?exports:Hogan)},{}],95:[function(_dereq_,module,exports){module.exports=function(){function t(t,o){var r=function(){};r.prototype=o.prototype,t.prototype=new r,t.prototype.constructor=t}return t.parasitically=function(o,r){for(var e,n=t.keys(r.prototype),p=n.length,y=0;y<p;y++)e=n[y],o.prototype[e]||(o.prototype[e]=r.prototype[e])},t.keys=Object.keys||function(){var t=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=r.length;return function(n){if("object"!=typeof n&&"function"!=typeof n||null===n)throw new TypeError("Object.keys called on a non-object");var p=[];for(var y in n)t.call(n,y)&&p.push(y);if(o)for(var c=0;c<e;c++)t.call(n,r[c])&&p.push(r[c]);return p}}(),t}()},{}],96:[function(_dereq_,module,exports){!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t=!!e&&"length"in e&&e.length,n=ie.type(e);return"function"!==n&&!ie.isWindow(e)&&("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e)}function r(e,t,n){if(ie.isFunction(t))return ie.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return ie.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(he.test(t))return ie.filter(t,e,n);t=ie.filter(t,e)}return ie.grep(e,function(e){return Z.call(t,e)>-1!==n})}function i(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function o(e){var t={};return ie.each(e.match(xe)||[],function(e,n){t[n]=!0}),t}function s(){G.removeEventListener("DOMContentLoaded",s),e.removeEventListener("load",s),ie.ready()}function a(){this.expando=ie.expando+a.uid++}function u(e,t,n){var r;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Ne,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:Ee.test(n)?ie.parseJSON(n):n)}catch(e){}ke.set(e,t,n)}else n=void 0;return n}function l(e,t,n,r){var i,o=1,s=20,a=r?function(){return r.cur()}:function(){return ie.css(e,t,"")},u=a(),l=n&&n[3]||(ie.cssNumber[t]?"":"px"),c=(ie.cssNumber[t]||"px"!==l&&+u)&&je.exec(ie.css(e,t));if(c&&c[3]!==l){l=l||c[3],n=n||[],c=+u||1;do{o=o||".5",c/=o,ie.style(e,t,c+l)}while(o!==(o=a()/u)&&1!==o&&--s)}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}function c(e,t){var n=void 0!==e.getElementsByTagName?e.getElementsByTagName(t||"*"):void 0!==e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&ie.nodeName(e,t)?ie.merge([e],n):n}function f(e,t){for(var n=0,r=e.length;n<r;n++)Ce.set(e[n],"globalEval",!t||Ce.get(t[n],"globalEval"))}function p(e,t,n,r,i){for(var o,s,a,u,l,p,d=t.createDocumentFragment(),h=[],g=0,v=e.length;g<v;g++)if((o=e[g])||0===o)if("object"===ie.type(o))ie.merge(h,o.nodeType?[o]:o);else if(Fe.test(o)){for(s=s||d.appendChild(t.createElement("div")),a=(Le.exec(o)||["",""])[1].toLowerCase(),u=Oe[a]||Oe._default,s.innerHTML=u[1]+ie.htmlPrefilter(o)+u[2],p=u[0];p--;)s=s.lastChild;ie.merge(h,s.childNodes),s=d.firstChild,s.textContent=""}else h.push(t.createTextNode(o));for(d.textContent="",g=0;o=h[g++];)if(r&&ie.inArray(o,r)>-1)i&&i.push(o);else if(l=ie.contains(o.ownerDocument,o),s=c(d.appendChild(o),"script"),l&&f(s),n)for(p=0;o=s[p++];)He.test(o.type||"")&&n.push(o);return d}function d(){return!0}function h(){return!1}function g(){try{return G.activeElement}catch(e){}}function v(e,t,n,r,i,o){var s,a;if("object"==typeof t){"string"!=typeof n&&(r=r||n,n=void 0);for(a in t)v(e,a,n,r,t[a],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=h;else if(!i)return e;return 1===o&&(s=i,i=function(e){return ie().off(e),s.apply(this,arguments)},i.guid=s.guid||(s.guid=ie.guid++)),e.each(function(){ie.event.add(this,t,i,r,n)})}function m(e,t){return ie.nodeName(e,"table")&&ie.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function y(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function x(e){var t=Be.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function b(e,t){var n,r,i,o,s,a,u,l;if(1===t.nodeType){if(Ce.hasData(e)&&(o=Ce.access(e),s=Ce.set(t,o),l=o.events)){delete s.handle,s.events={};for(i in l)for(n=0,r=l[i].length;n<r;n++)ie.event.add(t,i,l[i][n])}ke.hasData(e)&&(a=ke.access(e),u=ie.extend({},a),ke.set(t,u))}}function w(e,t){var n=t.nodeName.toLowerCase();"input"===n&&qe.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function T(e,t,n,r){t=J.apply([],t);var i,o,s,a,u,l,f=0,d=e.length,h=d-1,g=t[0],v=ie.isFunction(g);if(v||d>1&&"string"==typeof g&&!re.checkClone&&$e.test(g))return e.each(function(i){var o=e.eq(i);v&&(t[0]=g.call(this,i,o.html())),T(o,t,n,r)});if(d&&(i=p(t,e[0].ownerDocument,!1,e,r),o=i.firstChild,1===i.childNodes.length&&(i=o),o||r)){for(s=ie.map(c(i,"script"),y),a=s.length;f<d;f++)u=i,f!==h&&(u=ie.clone(u,!0,!0),a&&ie.merge(s,c(u,"script"))),n.call(e[f],u,f);if(a)for(l=s[s.length-1].ownerDocument,ie.map(s,x),f=0;f<a;f++)u=s[f],He.test(u.type||"")&&!Ce.access(u,"globalEval")&&ie.contains(l,u)&&(u.src?ie._evalUrl&&ie._evalUrl(u.src):ie.globalEval(u.textContent.replace(_e,"")))}return e}function C(e,t,n){for(var r,i=t?ie.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||ie.cleanData(c(r)),r.parentNode&&(n&&ie.contains(r.ownerDocument,r)&&f(c(r,"script")),r.parentNode.removeChild(r));return e}function k(e,t){var n=ie(t.createElement(e)).appendTo(t.body),r=ie.css(n[0],"display");return n.detach(),r}function E(e){var t=G,n=ze[e];return n||(n=k(e,t),"none"!==n&&n||(Xe=(Xe||ie("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=Xe[0].contentDocument,t.write(),t.close(),n=k(e,t),Xe.detach()),ze[e]=n),n}function N(e,t,n){var r,i,o,s,a=e.style;return n=n||Ye(e),s=n?n.getPropertyValue(t)||n[t]:void 0,""!==s&&void 0!==s||ie.contains(e.ownerDocument,e)||(s=ie.style(e,t)),n&&!re.pixelMarginRight()&&Ve.test(s)&&Ue.test(t)&&(r=a.width,i=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=r,a.minWidth=i,a.maxWidth=o),void 0!==s?s+"":s}function S(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function j(e){if(e in tt)return e;for(var t=e[0].toUpperCase()+e.slice(1),n=et.length;n--;)if((e=et[n]+t)in tt)return e}function D(e,t,n){var r=je.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function A(e,t,n,r,i){for(var o=n===(r?"border":"content")?4:"width"===t?1:0,s=0;o<4;o+=2)"margin"===n&&(s+=ie.css(e,n+De[o],!0,i)),r?("content"===n&&(s-=ie.css(e,"padding"+De[o],!0,i)),"margin"!==n&&(s-=ie.css(e,"border"+De[o]+"Width",!0,i))):(s+=ie.css(e,"padding"+De[o],!0,i),"padding"!==n&&(s+=ie.css(e,"border"+De[o]+"Width",!0,i)));return s}function q(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,o=Ye(e),s="border-box"===ie.css(e,"boxSizing",!1,o);if(i<=0||null==i){if(i=N(e,t,o),(i<0||null==i)&&(i=e.style[t]),Ve.test(i))return i;r=s&&(re.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+A(e,t,n||(s?"border":"content"),r,o)+"px"}function L(e,t){for(var n,r,i,o=[],s=0,a=e.length;s<a;s++)r=e[s],r.style&&(o[s]=Ce.get(r,"olddisplay"),n=r.style.display,t?(o[s]||"none"!==n||(r.style.display=""),""===r.style.display&&Ae(r)&&(o[s]=Ce.access(r,"olddisplay",E(r.nodeName)))):(i=Ae(r),"none"===n&&i||Ce.set(r,"olddisplay",i?n:ie.css(r,"display"))));for(s=0;s<a;s++)r=e[s],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?o[s]||"":"none"));return e}function H(e,t,n,r,i){return new H.prototype.init(e,t,n,r,i)}function O(){return e.setTimeout(function(){nt=void 0}),nt=ie.now()}function F(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)n=De[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function P(e,t,n){for(var r,i=(I.tweeners[t]||[]).concat(I.tweeners["*"]),o=0,s=i.length;o<s;o++)if(r=i[o].call(n,t,e))return r}function R(e,t,n){var r,i,o,s,a,u,l,c=this,f={},p=e.style,d=e.nodeType&&Ae(e),h=Ce.get(e,"fxshow");n.queue||(a=ie._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,u=a.empty.fire,a.empty.fire=function(){a.unqueued||u()}),a.unqueued++,c.always(function(){c.always(function(){a.unqueued--,ie.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],l=ie.css(e,"display"),"inline"===("none"===l?Ce.get(e,"olddisplay")||E(e.nodeName):l)&&"none"===ie.css(e,"float")&&(p.display="inline-block")),n.overflow&&(p.overflow="hidden",c.always(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],it.exec(i)){if(delete t[r],o=o||"toggle"===i,i===(d?"hide":"show")){if("show"!==i||!h||void 0===h[r])continue;d=!0}f[r]=h&&h[r]||ie.style(e,r)}else l=void 0;if(ie.isEmptyObject(f))"inline"===("none"===l?E(e.nodeName):l)&&(p.display=l);else{h?"hidden"in h&&(d=h.hidden):h=Ce.access(e,"fxshow",{}),o&&(h.hidden=!d),d?ie(e).show():c.done(function(){ie(e).hide()}),c.done(function(){var t;Ce.remove(e,"fxshow");for(t in f)ie.style(e,t,f[t])});for(r in f)s=P(d?h[r]:0,r,c),r in h||(h[r]=s.start,d&&(s.end=s.start,s.start="width"===r||"height"===r?1:0))}}function M(e,t){var n,r,i,o,s;for(n in e)if(r=ie.camelCase(n),i=t[r],o=e[n],ie.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(s=ie.cssHooks[r])&&"expand"in s){o=s.expand(o),delete e[r];for(n in o)n in e||(e[n]=o[n],t[n]=i)}else t[r]=i}function I(e,t,n){var r,i,o=0,s=I.prefilters.length,a=ie.Deferred().always(function(){delete u.elem}),u=function(){if(i)return!1;for(var t=nt||O(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,o=1-r,s=0,u=l.tweens.length;s<u;s++)l.tweens[s].run(o);return a.notifyWith(e,[l,o,n]),o<1&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:ie.extend({},t),opts:ie.extend(!0,{specialEasing:{},easing:ie.easing._default},n),originalProperties:t,originalOptions:n,startTime:nt||O(),duration:n.duration,tweens:[],createTween:function(t,n){var r=ie.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(r),r},
stop:function(t){var n=0,r=t?l.tweens.length:0;if(i)return this;for(i=!0;n<r;n++)l.tweens[n].run(1);return t?(a.notifyWith(e,[l,1,0]),a.resolveWith(e,[l,t])):a.rejectWith(e,[l,t]),this}}),c=l.props;for(M(c,l.opts.specialEasing);o<s;o++)if(r=I.prefilters[o].call(l,e,c,l.opts))return ie.isFunction(r.stop)&&(ie._queueHooks(l.elem,l.opts.queue).stop=ie.proxy(r.stop,r)),r;return ie.map(c,P,l),ie.isFunction(l.opts.start)&&l.opts.start.call(e,l),ie.fx.timer(ie.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function W(e){return e.getAttribute&&e.getAttribute("class")||""}function $(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,o=t.toLowerCase().match(xe)||[];if(ie.isFunction(n))for(;r=o[i++];)"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function B(e,t,n,r){function i(a){var u;return o[a]=!0,ie.each(e[a]||[],function(e,a){var l=a(t,n,r);return"string"!=typeof l||s||o[l]?s?!(u=l):void 0:(t.dataTypes.unshift(l),i(l),!1)}),u}var o={},s=e===kt;return i(t.dataTypes[0])||!o["*"]&&i("*")}function _(e,t){var n,r,i=ie.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&ie.extend(!0,e,r),e}function X(e,t,n){for(var r,i,o,s,a=e.contents,u=e.dataTypes;"*"===u[0];)u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in a)if(a[i]&&a[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}s||(s=i)}o=o||s}if(o)return o!==u[0]&&u.unshift(o),n[o]}function z(e,t,n,r){var i,o,s,a,u,l={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)l[s.toLowerCase()]=e.converters[s];for(o=c.shift();o;)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(s=l[u+" "+o]||l["* "+o]))for(i in l)if(a=i.split(" "),a[1]===o&&(s=l[u+" "+a[0]]||l["* "+a[0]])){!0===s?s=l[i]:!0!==l[i]&&(o=a[0],c.unshift(a[1]));break}if(!0!==s)if(s&&e.throws)t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}function U(e,t,n,r){var i;if(ie.isArray(t))ie.each(t,function(t,i){n||jt.test(e)?r(e,i):U(e+"["+("object"==typeof i&&null!=i?t:"")+"]",i,n,r)});else if(n||"object"!==ie.type(t))r(e,t);else for(i in t)U(e+"["+i+"]",t[i],n,r)}function V(e){return ie.isWindow(e)?e:9===e.nodeType&&e.defaultView}var Y=[],G=e.document,Q=Y.slice,J=Y.concat,K=Y.push,Z=Y.indexOf,ee={},te=ee.toString,ne=ee.hasOwnProperty,re={},ie=function(e,t){return new ie.fn.init(e,t)},oe=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,ae=/-([\da-z])/gi,ue=function(e,t){return t.toUpperCase()};ie.fn=ie.prototype={jquery:"2.2.4",constructor:ie,selector:"",length:0,toArray:function(){return Q.call(this)},get:function(e){return null!=e?e<0?this[e+this.length]:this[e]:Q.call(this)},pushStack:function(e){var t=ie.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e){return ie.each(this,e)},map:function(e){return this.pushStack(ie.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(Q.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:K,sort:Y.sort,splice:Y.splice},ie.extend=ie.fn.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,u=arguments.length,l=!1;for("boolean"==typeof s&&(l=s,s=arguments[a]||{},a++),"object"==typeof s||ie.isFunction(s)||(s={}),a===u&&(s=this,a--);a<u;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],r=e[t],s!==r&&(l&&r&&(ie.isPlainObject(r)||(i=ie.isArray(r)))?(i?(i=!1,o=n&&ie.isArray(n)?n:[]):o=n&&ie.isPlainObject(n)?n:{},s[t]=ie.extend(l,o,r)):void 0!==r&&(s[t]=r));return s},ie.extend({expando:"jQuery"+("2.2.4"+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ie.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){var t=e&&e.toString();return!ie.isArray(e)&&t-parseFloat(t)+1>=0},isPlainObject:function(e){var t;if("object"!==ie.type(e)||e.nodeType||ie.isWindow(e))return!1;if(e.constructor&&!ne.call(e,"constructor")&&!ne.call(e.constructor.prototype||{},"isPrototypeOf"))return!1;for(t in e);return void 0===t||ne.call(e,t)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?ee[te.call(e)]||"object":typeof e},globalEval:function(e){var t,n=eval;(e=ie.trim(e))&&(1===e.indexOf("use strict")?(t=G.createElement("script"),t.text=e,G.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(se,"ms-").replace(ae,ue)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t){var r,i=0;if(n(e))for(r=e.length;i<r&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},trim:function(e){return null==e?"":(e+"").replace(oe,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(n(Object(e))?ie.merge(r,"string"==typeof e?[e]:e):K.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:Z.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,s=!n;i<o;i++)!t(e[i],i)!==s&&r.push(e[i]);return r},map:function(e,t,r){var i,o,s=0,a=[];if(n(e))for(i=e.length;s<i;s++)null!=(o=t(e[s],s,r))&&a.push(o);else for(s in e)null!=(o=t(e[s],s,r))&&a.push(o);return J.apply([],a)},guid:1,proxy:function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),ie.isFunction(e))return r=Q.call(arguments,2),i=function(){return e.apply(t||this,r.concat(Q.call(arguments)))},i.guid=e.guid=e.guid||ie.guid++,i},now:Date.now,support:re}),"function"==typeof Symbol&&(ie.fn[Symbol.iterator]=Y[Symbol.iterator]),ie.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){ee["[object "+t+"]"]=t.toLowerCase()});var le=function(e){function t(e,t,n,r){var i,o,s,a,l,f,p,d,h=t&&t.ownerDocument,g=t?t.nodeType:9;if(n=n||[],"string"!=typeof e||!e||1!==g&&9!==g&&11!==g)return n;if(!r&&((t?t.ownerDocument||t:M)!==A&&D(t),t=t||A,L)){if(11!==g&&(f=ge.exec(e)))if(i=f[1]){if(9===g){if(!(s=t.getElementById(i)))return n;if(s.id===i)return n.push(s),n}else if(h&&(s=h.getElementById(i))&&P(t,s)&&s.id===i)return n.push(s),n}else{if(f[2])return Q.apply(n,t.getElementsByTagName(e)),n;if((i=f[3])&&x.getElementsByClassName&&t.getElementsByClassName)return Q.apply(n,t.getElementsByClassName(i)),n}if(x.qsa&&!_[e+" "]&&(!H||!H.test(e))){if(1!==g)h=t,d=e;else if("object"!==t.nodeName.toLowerCase()){for((a=t.getAttribute("id"))?a=a.replace(me,"\\$&"):t.setAttribute("id",a=R),p=C(e),o=p.length,l=ce.test(a)?"#"+a:"[id='"+a+"']";o--;)p[o]=l+" "+c(p[o]);d=p.join(","),h=ve.test(e)&&u(t.parentNode)||t}if(d)try{return Q.apply(n,h.querySelectorAll(d)),n}catch(e){}finally{a===R&&t.removeAttribute("id")}}}return E(e.replace(oe,"$1"),t,n,r)}function n(){function e(n,r){return t.push(n+" ")>b.cacheLength&&delete e[t.shift()],e[n+" "]=r}var t=[];return e}function r(e){return e[R]=!0,e}function i(e){var t=A.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t){for(var n=e.split("|"),r=n.length;r--;)b.attrHandle[n[r]]=t}function s(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||z)-(~e.sourceIndex||z);if(r)return r;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return r(function(t){return t=+t,r(function(n,r){for(var i,o=e([],n.length,t),s=o.length;s--;)n[i=o[s]]&&(n[i]=!(r[i]=n[i]))})})}function u(e){return e&&void 0!==e.getElementsByTagName&&e}function l(){}function c(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function f(e,t,n){var r=t.dir,i=n&&"parentNode"===r,o=W++;return t.first?function(t,n,o){for(;t=t[r];)if(1===t.nodeType||i)return e(t,n,o)}:function(t,n,s){var a,u,l,c=[I,o];if(s){for(;t=t[r];)if((1===t.nodeType||i)&&e(t,n,s))return!0}else for(;t=t[r];)if(1===t.nodeType||i){if(l=t[R]||(t[R]={}),u=l[t.uniqueID]||(l[t.uniqueID]={}),(a=u[r])&&a[0]===I&&a[1]===o)return c[2]=a[2];if(u[r]=c,c[2]=e(t,n,s))return!0}}}function p(e){return e.length>1?function(t,n,r){for(var i=e.length;i--;)if(!e[i](t,n,r))return!1;return!0}:e[0]}function d(e,n,r){for(var i=0,o=n.length;i<o;i++)t(e,n[i],r);return r}function h(e,t,n,r,i){for(var o,s=[],a=0,u=e.length,l=null!=t;a<u;a++)(o=e[a])&&(n&&!n(o,r,i)||(s.push(o),l&&t.push(a)));return s}function g(e,t,n,i,o,s){return i&&!i[R]&&(i=g(i)),o&&!o[R]&&(o=g(o,s)),r(function(r,s,a,u){var l,c,f,p=[],g=[],v=s.length,m=r||d(t||"*",a.nodeType?[a]:a,[]),y=!e||!r&&t?m:h(m,p,e,a,u),x=n?o||(r?e:v||i)?[]:s:y;if(n&&n(y,x,a,u),i)for(l=h(x,g),i(l,[],a,u),c=l.length;c--;)(f=l[c])&&(x[g[c]]=!(y[g[c]]=f));if(r){if(o||e){if(o){for(l=[],c=x.length;c--;)(f=x[c])&&l.push(y[c]=f);o(null,x=[],l,u)}for(c=x.length;c--;)(f=x[c])&&(l=o?K(r,f):p[c])>-1&&(r[l]=!(s[l]=f))}}else x=h(x===s?x.splice(v,x.length):x),o?o(null,s,x,u):Q.apply(s,x)})}function v(e){for(var t,n,r,i=e.length,o=b.relative[e[0].type],s=o||b.relative[" "],a=o?1:0,u=f(function(e){return e===t},s,!0),l=f(function(e){return K(t,e)>-1},s,!0),d=[function(e,n,r){var i=!o&&(r||n!==N)||((t=n).nodeType?u(e,n,r):l(e,n,r));return t=null,i}];a<i;a++)if(n=b.relative[e[a].type])d=[f(p(d),n)];else{if(n=b.filter[e[a].type].apply(null,e[a].matches),n[R]){for(r=++a;r<i&&!b.relative[e[r].type];r++);return g(a>1&&p(d),a>1&&c(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(oe,"$1"),n,a<r&&v(e.slice(a,r)),r<i&&v(e=e.slice(r)),r<i&&c(e))}d.push(n)}return p(d)}function m(e,n){var i=n.length>0,o=e.length>0,s=function(r,s,a,u,l){var c,f,p,d=0,g="0",v=r&&[],m=[],y=N,x=r||o&&b.find.TAG("*",l),w=I+=null==y?1:Math.random()||.1,T=x.length;for(l&&(N=s===A||s||l);g!==T&&null!=(c=x[g]);g++){if(o&&c){for(f=0,s||c.ownerDocument===A||(D(c),a=!L);p=e[f++];)if(p(c,s||A,a)){u.push(c);break}l&&(I=w)}i&&((c=!p&&c)&&d--,r&&v.push(c))}if(d+=g,i&&g!==d){for(f=0;p=n[f++];)p(v,m,s,a);if(r){if(d>0)for(;g--;)v[g]||m[g]||(m[g]=Y.call(u));m=h(m)}Q.apply(u,m),l&&!r&&m.length>0&&d+n.length>1&&t.uniqueSort(u)}return l&&(I=w,N=y),v};return i?r(s):s}var y,x,b,w,T,C,k,E,N,S,j,D,A,q,L,H,O,F,P,R="sizzle"+1*new Date,M=e.document,I=0,W=0,$=n(),B=n(),_=n(),X=function(e,t){return e===t&&(j=!0),0},z=1<<31,U={}.hasOwnProperty,V=[],Y=V.pop,G=V.push,Q=V.push,J=V.slice,K=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},Z="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ee="[\\x20\\t\\r\\n\\f]",te="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ne="\\["+ee+"*("+te+")(?:"+ee+"*([*^$|!~]?=)"+ee+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+te+"))|)"+ee+"*\\]",re=":("+te+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+ne+")*)|.*)\\)|)",ie=new RegExp(ee+"+","g"),oe=new RegExp("^"+ee+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ee+"+$","g"),se=new RegExp("^"+ee+"*,"+ee+"*"),ae=new RegExp("^"+ee+"*([>+~]|"+ee+")"+ee+"*"),ue=new RegExp("="+ee+"*([^\\]'\"]*?)"+ee+"*\\]","g"),le=new RegExp(re),ce=new RegExp("^"+te+"$"),fe={ID:new RegExp("^#("+te+")"),CLASS:new RegExp("^\\.("+te+")"),TAG:new RegExp("^("+te+"|[*])"),ATTR:new RegExp("^"+ne),PSEUDO:new RegExp("^"+re),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ee+"*(even|odd|(([+-]|)(\\d*)n|)"+ee+"*(?:([+-]|)"+ee+"*(\\d+)|))"+ee+"*\\)|)","i"),bool:new RegExp("^(?:"+Z+")$","i"),needsContext:new RegExp("^"+ee+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ee+"*((?:-\\d)?\\d*)"+ee+"*\\)|)(?=[^-]|$)","i")},pe=/^(?:input|select|textarea|button)$/i,de=/^h\d$/i,he=/^[^{]+\{\s*\[native \w/,ge=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ve=/[+~]/,me=/'|\\/g,ye=new RegExp("\\\\([\\da-f]{1,6}"+ee+"?|("+ee+")|.)","ig"),xe=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},be=function(){D()};try{Q.apply(V=J.call(M.childNodes),M.childNodes),V[M.childNodes.length].nodeType}catch(e){Q={apply:V.length?function(e,t){G.apply(e,J.call(t))}:function(e,t){for(var n=e.length,r=0;e[n++]=t[r++];);e.length=n-1}}}x=t.support={},T=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},D=t.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:M;return r!==A&&9===r.nodeType&&r.documentElement?(A=r,q=A.documentElement,L=!T(A),(n=A.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",be,!1):n.attachEvent&&n.attachEvent("onunload",be)),x.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),x.getElementsByTagName=i(function(e){return e.appendChild(A.createComment("")),!e.getElementsByTagName("*").length}),x.getElementsByClassName=he.test(A.getElementsByClassName),x.getById=i(function(e){return q.appendChild(e).id=R,!A.getElementsByName||!A.getElementsByName(R).length}),x.getById?(b.find.ID=function(e,t){if(void 0!==t.getElementById&&L){var n=t.getElementById(e);return n?[n]:[]}},b.filter.ID=function(e){var t=e.replace(ye,xe);return function(e){return e.getAttribute("id")===t}}):(delete b.find.ID,b.filter.ID=function(e){var t=e.replace(ye,xe);return function(e){var n=void 0!==e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),b.find.TAG=x.getElementsByTagName?function(e,t){return void 0!==t.getElementsByTagName?t.getElementsByTagName(e):x.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){for(;n=o[i++];)1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=x.getElementsByClassName&&function(e,t){if(void 0!==t.getElementsByClassName&&L)return t.getElementsByClassName(e)},O=[],H=[],(x.qsa=he.test(A.querySelectorAll))&&(i(function(e){q.appendChild(e).innerHTML="<a id='"+R+"'></a><select id='"+R+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&H.push("[*^$]="+ee+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||H.push("\\["+ee+"*(?:value|"+Z+")"),e.querySelectorAll("[id~="+R+"-]").length||H.push("~="),e.querySelectorAll(":checked").length||H.push(":checked"),e.querySelectorAll("a#"+R+"+*").length||H.push(".#.+[+~]")}),i(function(e){var t=A.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&H.push("name"+ee+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||H.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),H.push(",.*:")})),(x.matchesSelector=he.test(F=q.matches||q.webkitMatchesSelector||q.mozMatchesSelector||q.oMatchesSelector||q.msMatchesSelector))&&i(function(e){x.disconnectedMatch=F.call(e,"div"),F.call(e,"[s!='']:x"),O.push("!=",re)}),H=H.length&&new RegExp(H.join("|")),O=O.length&&new RegExp(O.join("|")),t=he.test(q.compareDocumentPosition),P=t||he.test(q.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},X=t?function(e,t){if(e===t)return j=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!x.sortDetached&&t.compareDocumentPosition(e)===n?e===A||e.ownerDocument===M&&P(M,e)?-1:t===A||t.ownerDocument===M&&P(M,t)?1:S?K(S,e)-K(S,t):0:4&n?-1:1)}:function(e,t){if(e===t)return j=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],u=[t];if(!i||!o)return e===A?-1:t===A?1:i?-1:o?1:S?K(S,e)-K(S,t):0;if(i===o)return s(e,t);for(n=e;n=n.parentNode;)a.unshift(n);for(n=t;n=n.parentNode;)u.unshift(n);for(;a[r]===u[r];)r++;return r?s(a[r],u[r]):a[r]===M?-1:u[r]===M?1:0},A):A},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==A&&D(e),n=n.replace(ue,"='$1']"),x.matchesSelector&&L&&!_[n+" "]&&(!O||!O.test(n))&&(!H||!H.test(n)))try{var r=F.call(e,n);if(r||x.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(e){}return t(n,A,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==A&&D(e),P(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==A&&D(e);var n=b.attrHandle[t.toLowerCase()],r=n&&U.call(b.attrHandle,t.toLowerCase())?n(e,t,!L):void 0;return void 0!==r?r:x.attributes||!L?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],r=0,i=0;if(j=!x.detectDuplicates,S=!x.sortStable&&e.slice(0),e.sort(X),j){for(;t=e[i++];)t===e[i]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return S=null,e},w=t.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=w(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r++];)n+=w(t);return n},b=t.selectors={cacheLength:50,createPseudo:r,match:fe,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(ye,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(ye,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return fe.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&le.test(n)&&(t=C(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(ye,xe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=$[e+" "];return t||(t=new RegExp("(^|"+ee+")"+e+"("+ee+"|$)"))&&$(e,function(e){return t.test("string"==typeof e.className&&e.className||void 0!==e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,r){return function(i){var o=t.attr(i,e);return null==o?"!="===n:!n||(o+="","="===n?o===r:"!="===n?o!==r:"^="===n?r&&0===o.indexOf(r):"*="===n?r&&o.indexOf(r)>-1:"$="===n?r&&o.slice(-r.length)===r:"~="===n?(" "+o.replace(ie," ")+" ").indexOf(r)>-1:"|="===n&&(o===r||o.slice(0,r.length+1)===r+"-"))}},CHILD:function(e,t,n,r,i){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,u){var l,c,f,p,d,h,g=o!==s?"nextSibling":"previousSibling",v=t.parentNode,m=a&&t.nodeName.toLowerCase(),y=!u&&!a,x=!1;if(v){if(o){for(;g;){for(p=t;p=p[g];)if(a?p.nodeName.toLowerCase()===m:1===p.nodeType)return!1;h=g="only"===e&&!h&&"nextSibling"}return!0}if(h=[s?v.firstChild:v.lastChild],s&&y){for(p=v,f=p[R]||(p[R]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===I&&l[1],x=d&&l[2],p=d&&v.childNodes[d];p=++d&&p&&p[g]||(x=d=0)||h.pop();)if(1===p.nodeType&&++x&&p===t){c[e]=[I,d,x];break}}else if(y&&(p=t,f=p[R]||(p[R]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),l=c[e]||[],d=l[0]===I&&l[1],x=d),!1===x)for(;(p=++d&&p&&p[g]||(x=d=0)||h.pop())&&((a?p.nodeName.toLowerCase()!==m:1!==p.nodeType)||!++x||(y&&(f=p[R]||(p[R]={}),c=f[p.uniqueID]||(f[p.uniqueID]={}),c[e]=[I,x]),p!==t)););return(x-=i)===r||x%r==0&&x/r>=0}}},PSEUDO:function(e,n){var i,o=b.pseudos[e]||b.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return o[R]?o(n):o.length>1?(i=[e,e,"",n],b.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,t){for(var r,i=o(e,n),s=i.length;s--;)r=K(e,i[s]),e[r]=!(t[r]=i[s])}):function(e){return o(e,0,i)}):o}},pseudos:{not:r(function(e){var t=[],n=[],i=k(e.replace(oe,"$1"));return i[R]?r(function(e,t,n,r){for(var o,s=i(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,r,o){return t[0]=e,i(t,null,o,n),t[0]=null,!n.pop()}}),has:r(function(e){return function(n){return t(e,n).length>0}}),contains:r(function(e){return e=e.replace(ye,xe),function(t){return(t.textContent||t.innerText||w(t)).indexOf(e)>-1}}),lang:r(function(e){return ce.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(ye,xe).toLowerCase(),function(t){var n;do{if(n=L?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===q},focus:function(e){return e===A.activeElement&&(!A.hasFocus||A.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return de.test(e.nodeName)},input:function(e){return pe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:a(function(){return[0]}),last:a(function(e,t){return[t-1]}),eq:a(function(e,t,n){return[n<0?n+t:n]}),even:a(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:a(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:a(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:a(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},b.pseudos.nth=b.pseudos.eq;for(y in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[y]=function(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}(y);for(y in{submit:!0,reset:!0})b.pseudos[y]=function(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}(y);return l.prototype=b.filters=b.pseudos,b.setFilters=new l,C=t.tokenize=function(e,n){var r,i,o,s,a,u,l,c=B[e+" "];if(c)return n?0:c.slice(0);for(a=e,u=[],l=b.preFilter;a;){r&&!(i=se.exec(a))||(i&&(a=a.slice(i[0].length)||a),u.push(o=[])),r=!1,(i=ae.exec(a))&&(r=i.shift(),o.push({value:r,type:i[0].replace(oe," ")}),a=a.slice(r.length));for(s in b.filter)!(i=fe[s].exec(a))||l[s]&&!(i=l[s](i))||(r=i.shift(),o.push({value:r,type:s,matches:i}),a=a.slice(r.length));if(!r)break}return n?a.length:a?t.error(e):B(e,u).slice(0)},k=t.compile=function(e,t){var n,r=[],i=[],o=_[e+" "];if(!o){for(t||(t=C(e)),n=t.length;n--;)o=v(t[n]),o[R]?r.push(o):i.push(o);o=_(e,m(i,r)),o.selector=e}return o},E=t.select=function(e,t,n,r){var i,o,s,a,l,f="function"==typeof e&&e,p=!r&&C(e=f.selector||e);if(n=n||[],1===p.length){if(o=p[0]=p[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&x.getById&&9===t.nodeType&&L&&b.relative[o[1].type]){if(!(t=(b.find.ID(s.matches[0].replace(ye,xe),t)||[])[0]))return n;f&&(t=t.parentNode),e=e.slice(o.shift().value.length)}for(i=fe.needsContext.test(e)?0:o.length;i--&&(s=o[i],!b.relative[a=s.type]);)if((l=b.find[a])&&(r=l(s.matches[0].replace(ye,xe),ve.test(o[0].type)&&u(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&c(o)))return Q.apply(n,r),n;break}}return(f||k(e,p))(r,t,!L,n,!t||ve.test(e)&&u(t.parentNode)||t),n},x.sortStable=R.split("").sort(X).join("")===R,x.detectDuplicates=!!j,D(),x.sortDetached=i(function(e){return 1&e.compareDocumentPosition(A.createElement("div"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||o("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),x.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||o("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||o(Z,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),t}(e);ie.find=le,ie.expr=le.selectors,ie.expr[":"]=ie.expr.pseudos,ie.uniqueSort=ie.unique=le.uniqueSort,ie.text=le.getText,ie.isXMLDoc=le.isXML,ie.contains=le.contains;var ce=function(e,t,n){for(var r=[],i=void 0!==n;(e=e[t])&&9!==e.nodeType;)if(1===e.nodeType){if(i&&ie(e).is(n))break;r.push(e)}return r},fe=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},pe=ie.expr.match.needsContext,de=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,he=/^.[^:#\[\.,]*$/;ie.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?ie.find.matchesSelector(r,e)?[r]:[]:ie.find.matches(e,ie.grep(t,function(e){return 1===e.nodeType}))},ie.fn.extend({find:function(e){var t,n=this.length,r=[],i=this;if("string"!=typeof e)return this.pushStack(ie(e).filter(function(){for(t=0;t<n;t++)if(ie.contains(i[t],this))return!0}));for(t=0;t<n;t++)ie.find(e,i[t],r);return r=this.pushStack(n>1?ie.unique(r):r),r.selector=this.selector?this.selector+" "+e:e,r},filter:function(e){return this.pushStack(r(this,e||[],!1))},not:function(e){return this.pushStack(r(this,e||[],!0))},is:function(e){return!!r(this,"string"==typeof e&&pe.test(e)?ie(e):e||[],!1).length}});var ge,ve=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(ie.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||ge,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:ve.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof ie?t[0]:t,ie.merge(this,ie.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:G,!0)),de.test(r[1])&&ie.isPlainObject(t))for(r in t)ie.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=G.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=G,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ie.isFunction(e)?void 0!==n.ready?n.ready(e):e(ie):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),ie.makeArray(e,this))}).prototype=ie.fn,ge=ie(G);var me=/^(?:parents|prev(?:Until|All))/,ye={children:!0,contents:!0,next:!0,prev:!0};ie.fn.extend({has:function(e){var t=ie(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(ie.contains(this,t[e]))return!0})},closest:function(e,t){for(var n,r=0,i=this.length,o=[],s=pe.test(e)||"string"!=typeof e?ie(e,t||this.context):0;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ie.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(o.length>1?ie.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?Z.call(ie(e),this[0]):Z.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ie.uniqueSort(ie.merge(this.get(),ie(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ie.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ce(e,"parentNode")},parentsUntil:function(e,t,n){return ce(e,"parentNode",n)},next:function(e){return i(e,"nextSibling")},prev:function(e){return i(e,"previousSibling")},nextAll:function(e){return ce(e,"nextSibling")},prevAll:function(e){return ce(e,"previousSibling")},nextUntil:function(e,t,n){return ce(e,"nextSibling",n)},prevUntil:function(e,t,n){return ce(e,"previousSibling",n)},siblings:function(e){return fe((e.parentNode||{}).firstChild,e)},children:function(e){return fe(e.firstChild)},contents:function(e){return e.contentDocument||ie.merge([],e.childNodes)}},function(e,t){ie.fn[e]=function(n,r){var i=ie.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=ie.filter(r,i)),this.length>1&&(ye[e]||ie.uniqueSort(i),me.test(e)&&i.reverse()),this.pushStack(i)}});var xe=/\S+/g;ie.Callbacks=function(e){e="string"==typeof e?o(e):ie.extend({},e);var t,n,r,i,s=[],a=[],u=-1,l=function(){for(i=e.once,r=t=!0;a.length;u=-1)for(n=a.shift();++u<s.length;)!1===s[u].apply(n[0],n[1])&&e.stopOnFalse&&(u=s.length,n=!1);e.memory||(n=!1),t=!1,i&&(s=n?[]:"")},c={add:function(){return s&&(n&&!t&&(u=s.length-1,a.push(n)),function t(n){ie.each(n,function(n,r){ie.isFunction(r)?e.unique&&c.has(r)||s.push(r):r&&r.length&&"string"!==ie.type(r)&&t(r)})}(arguments),n&&!t&&l()),this},remove:function(){return ie.each(arguments,function(e,t){for(var n;(n=ie.inArray(t,s,n))>-1;)s.splice(n,1),n<=u&&u--}),this},has:function(e){return e?ie.inArray(e,s)>-1:s.length>0},empty:function(){return s&&(s=[]),this},disable:function(){return i=a=[],s=n="",this},disabled:function(){return!s},lock:function(){return i=a=[],n||(s=n=""),this},locked:function(){return!!i},fireWith:function(e,n){return i||(n=n||[],n=[e,n.slice?n.slice():n],a.push(n),t||l()),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},ie.extend({Deferred:function(e){var t=[["resolve","done",ie.Callbacks("once memory"),"resolved"],["reject","fail",ie.Callbacks("once memory"),"rejected"],["notify","progress",ie.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ie.Deferred(function(n){ie.each(t,function(t,o){var s=ie.isFunction(e[t])&&e[t];i[o[1]](function(){var e=s&&s.apply(this,arguments);e&&ie.isFunction(e.promise)?e.promise().progress(n.notify).done(n.resolve).fail(n.reject):n[o[0]+"With"](this===r?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ie.extend(e,r):r}},i={};return r.pipe=r.then,ie.each(t,function(e,o){var s=o[2],a=o[3];r[o[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),i[o[0]]=function(){return i[o[0]+"With"](this===i?r:this,arguments),this},i[o[0]+"With"]=s.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,r,i=0,o=Q.call(arguments),s=o.length,a=1!==s||e&&ie.isFunction(e.promise)?s:0,u=1===a?e:ie.Deferred(),l=function(e,n,r){return function(i){n[e]=this,r[e]=arguments.length>1?Q.call(arguments):i,r===t?u.notifyWith(n,r):--a||u.resolveWith(n,r)}};if(s>1)for(t=new Array(s),n=new Array(s),r=new Array(s);i<s;i++)o[i]&&ie.isFunction(o[i].promise)?o[i].promise().progress(l(i,n,t)).done(l(i,r,o)).fail(u.reject):--a;return a||u.resolveWith(r,o),u.promise()}});var be;ie.fn.ready=function(e){return ie.ready.promise().done(e),this},ie.extend({isReady:!1,readyWait:1,holdReady:function(e){e?ie.readyWait++:ie.ready(!0)},ready:function(e){(!0===e?--ie.readyWait:ie.isReady)||(ie.isReady=!0,!0!==e&&--ie.readyWait>0||(be.resolveWith(G,[ie]),ie.fn.triggerHandler&&(ie(G).triggerHandler("ready"),ie(G).off("ready"))))}}),ie.ready.promise=function(t){return be||(be=ie.Deferred(),"complete"===G.readyState||"loading"!==G.readyState&&!G.documentElement.doScroll?e.setTimeout(ie.ready):(G.addEventListener("DOMContentLoaded",s),e.addEventListener("load",s))),be.promise(t)},ie.ready.promise();var we=function(e,t,n,r,i,o,s){var a=0,u=e.length,l=null==n;if("object"===ie.type(n)){i=!0;for(a in n)we(e,t,a,n[a],!0,o,s)}else if(void 0!==r&&(i=!0,ie.isFunction(r)||(s=!0),l&&(s?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(ie(e),n)
})),t))for(;a<u;a++)t(e[a],n,s?r:r.call(e[a],a,t(e[a],n)));return i?e:l?t.call(e):u?t(e[0],n):o},Te=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};a.uid=1,a.prototype={register:function(e,t){var n=t||{};return e.nodeType?e[this.expando]=n:Object.defineProperty(e,this.expando,{value:n,writable:!0,configurable:!0}),e[this.expando]},cache:function(e){if(!Te(e))return{};var t=e[this.expando];return t||(t={},Te(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[t]=n;else for(r in t)i[r]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][t]},access:function(e,t,n){var r;return void 0===t||t&&"string"==typeof t&&void 0===n?(r=this.get(e,t),void 0!==r?r:this.get(e,ie.camelCase(t))):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r,i,o=e[this.expando];if(void 0!==o){if(void 0===t)this.register(e);else{ie.isArray(t)?r=t.concat(t.map(ie.camelCase)):(i=ie.camelCase(t),t in o?r=[t,i]:(r=i,r=r in o?[r]:r.match(xe)||[])),n=r.length;for(;n--;)delete o[r[n]]}(void 0===t||ie.isEmptyObject(o))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!ie.isEmptyObject(t)}};var Ce=new a,ke=new a,Ee=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Ne=/[A-Z]/g;ie.extend({hasData:function(e){return ke.hasData(e)||Ce.hasData(e)},data:function(e,t,n){return ke.access(e,t,n)},removeData:function(e,t){ke.remove(e,t)},_data:function(e,t,n){return Ce.access(e,t,n)},_removeData:function(e,t){Ce.remove(e,t)}}),ie.fn.extend({data:function(e,t){var n,r,i,o=this[0],s=o&&o.attributes;if(void 0===e){if(this.length&&(i=ke.get(o),1===o.nodeType&&!Ce.get(o,"hasDataAttrs"))){for(n=s.length;n--;)s[n]&&(r=s[n].name,0===r.indexOf("data-")&&(r=ie.camelCase(r.slice(5)),u(o,r,i[r])));Ce.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof e?this.each(function(){ke.set(this,e)}):we(this,function(t){var n,r;if(o&&void 0===t){if(void 0!==(n=ke.get(o,e)||ke.get(o,e.replace(Ne,"-$&").toLowerCase())))return n;if(r=ie.camelCase(e),void 0!==(n=ke.get(o,r)))return n;if(void 0!==(n=u(o,r,void 0)))return n}else r=ie.camelCase(e),this.each(function(){var n=ke.get(this,r);ke.set(this,r,t),e.indexOf("-")>-1&&void 0!==n&&ke.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ke.remove(this,e)})}}),ie.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Ce.get(e,t),n&&(!r||ie.isArray(n)?r=Ce.access(e,t,ie.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=ie.queue(e,t),r=n.length,i=n.shift(),o=ie._queueHooks(e,t),s=function(){ie.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,s,o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Ce.get(e,n)||Ce.access(e,n,{empty:ie.Callbacks("once memory").add(function(){Ce.remove(e,[t+"queue",n])})})}}),ie.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?ie.queue(this[0],e):void 0===t?this:this.each(function(){var n=ie.queue(this,e,t);ie._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&ie.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ie.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=ie.Deferred(),o=this,s=this.length,a=function(){--r||i.resolveWith(o,[o])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=Ce.get(o[s],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(a));return a(),i.promise(t)}});var Se=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,je=new RegExp("^(?:([+-])=|)("+Se+")([a-z%]*)$","i"),De=["Top","Right","Bottom","Left"],Ae=function(e,t){return e=t||e,"none"===ie.css(e,"display")||!ie.contains(e.ownerDocument,e)},qe=/^(?:checkbox|radio)$/i,Le=/<([\w:-]+)/,He=/^$|\/(?:java|ecma)script/i,Oe={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Oe.optgroup=Oe.option,Oe.tbody=Oe.tfoot=Oe.colgroup=Oe.caption=Oe.thead,Oe.th=Oe.td;var Fe=/<|&#?\w+;/;!function(){var e=G.createDocumentFragment(),t=e.appendChild(G.createElement("div")),n=G.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),re.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",re.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var Pe=/^key/,Re=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Me=/^([^.]*)(?:\.(.+)|)/;ie.event={global:{},add:function(e,t,n,r,i){var o,s,a,u,l,c,f,p,d,h,g,v=Ce.get(e);if(v)for(n.handler&&(o=n,n=o.handler,i=o.selector),n.guid||(n.guid=ie.guid++),(u=v.events)||(u=v.events={}),(s=v.handle)||(s=v.handle=function(t){return void 0!==ie&&ie.event.triggered!==t.type?ie.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(xe)||[""],l=t.length;l--;)a=Me.exec(t[l])||[],d=g=a[1],h=(a[2]||"").split(".").sort(),d&&(f=ie.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=ie.event.special[d]||{},c=ie.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&ie.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||(p=u[d]=[],p.delegateCount=0,f.setup&&!1!==f.setup.call(e,r,h,s)||e.addEventListener&&e.addEventListener(d,s)),f.add&&(f.add.call(e,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),ie.event.global[d]=!0)},remove:function(e,t,n,r,i){var o,s,a,u,l,c,f,p,d,h,g,v=Ce.hasData(e)&&Ce.get(e);if(v&&(u=v.events)){for(t=(t||"").match(xe)||[""],l=t.length;l--;)if(a=Me.exec(t[l])||[],d=g=a[1],h=(a[2]||"").split(".").sort(),d){for(f=ie.event.special[d]||{},d=(r?f.delegateType:f.bindType)||d,p=u[d]||[],a=a[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=p.length;o--;)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||a&&!a.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));s&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||ie.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)ie.event.remove(e,d+t[l],n,r,!0);ie.isEmptyObject(u)&&Ce.remove(e,"handle events")}},dispatch:function(e){e=ie.event.fix(e);var t,n,r,i,o,s=[],a=Q.call(arguments),u=(Ce.get(this,"events")||{})[e.type]||[],l=ie.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||!1!==l.preDispatch.call(this,e)){for(s=ie.event.handlers.call(this,e,u),t=0;(i=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=i.elem,n=0;(o=i.handlers[n++])&&!e.isImmediatePropagationStopped();)e.rnamespace&&!e.rnamespace.test(o.namespace)||(e.handleObj=o,e.data=o.data,void 0!==(r=((ie.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a))&&!1===(e.result=r)&&(e.preventDefault(),e.stopPropagation()));return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,r,i,o,s=[],a=t.delegateCount,u=e.target;if(a&&u.nodeType&&("click"!==e.type||isNaN(e.button)||e.button<1))for(;u!==this;u=u.parentNode||this)if(1===u.nodeType&&(!0!==u.disabled||"click"!==e.type)){for(r=[],n=0;n<a;n++)o=t[n],i=o.selector+" ",void 0===r[i]&&(r[i]=o.needsContext?ie(i,this).index(u)>-1:ie.find(i,this,null,[u]).length),r[i]&&r.push(o);r.length&&s.push({elem:u,handlers:r})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,o=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||G,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===o||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[ie.expando])return e;var t,n,r,i=e.type,o=e,s=this.fixHooks[i];for(s||(this.fixHooks[i]=s=Re.test(i)?this.mouseHooks:Pe.test(i)?this.keyHooks:{}),r=s.props?this.props.concat(s.props):this.props,e=new ie.Event(o),t=r.length;t--;)n=r[t],e[n]=o[n];return e.target||(e.target=G),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==g()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===g()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&ie.nodeName(this,"input"))return this.click(),!1},_default:function(e){return ie.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},ie.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},ie.Event=function(e,t){if(!(this instanceof ie.Event))return new ie.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?d:h):this.type=e,t&&ie.extend(this,t),this.timeStamp=e&&e.timeStamp||ie.now(),this[ie.expando]=!0},ie.Event.prototype={constructor:ie.Event,isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=d,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=d,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=d,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},ie.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ie.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,o=e.handleObj;return i&&(i===r||ie.contains(r,i))||(e.type=o.origType,n=o.handler.apply(this,arguments),e.type=t),n}}}),ie.fn.extend({on:function(e,t,n,r){return v(this,e,t,n,r)},one:function(e,t,n,r){return v(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ie(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=h),this.each(function(){ie.event.remove(this,e,n,t)})}});var Ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,We=/<script|<style|<link/i,$e=/checked\s*(?:[^=]|=\s*.checked.)/i,Be=/^true\/(.*)/,_e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;ie.extend({htmlPrefilter:function(e){return e.replace(Ie,"<$1></$2>")},clone:function(e,t,n){var r,i,o,s,a=e.cloneNode(!0),u=ie.contains(e.ownerDocument,e);if(!(re.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ie.isXMLDoc(e)))for(s=c(a),o=c(e),r=0,i=o.length;r<i;r++)w(o[r],s[r]);if(t)if(n)for(o=o||c(e),s=s||c(a),r=0,i=o.length;r<i;r++)b(o[r],s[r]);else b(e,a);return s=c(a,"script"),s.length>0&&f(s,!u&&c(e,"script")),a},cleanData:function(e){for(var t,n,r,i=ie.event.special,o=0;void 0!==(n=e[o]);o++)if(Te(n)){if(t=n[Ce.expando]){if(t.events)for(r in t.events)i[r]?ie.event.remove(n,r):ie.removeEvent(n,r,t.handle);n[Ce.expando]=void 0}n[ke.expando]&&(n[ke.expando]=void 0)}}}),ie.fn.extend({domManip:T,detach:function(e){return C(this,e,!0)},remove:function(e){return C(this,e)},text:function(e){return we(this,function(e){return void 0===e?ie.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return T(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||m(this,e).appendChild(e)})},prepend:function(){return T(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=m(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return T(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return T(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ie.cleanData(c(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ie.clone(this,e,t)})},html:function(e){return we(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!We.test(e)&&!Oe[(Le.exec(e)||["",""])[1].toLowerCase()]){e=ie.htmlPrefilter(e);try{for(;n<r;n++)t=this[n]||{},1===t.nodeType&&(ie.cleanData(c(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=[];return T(this,arguments,function(t){var n=this.parentNode;ie.inArray(this,e)<0&&(ie.cleanData(c(this)),n&&n.replaceChild(t,this))},e)}}),ie.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ie.fn[e]=function(e){for(var n,r=[],i=ie(e),o=i.length-1,s=0;s<=o;s++)n=s===o?this:this.clone(!0),ie(i[s])[t](n),K.apply(r,n.get());return this.pushStack(r)}});var Xe,ze={HTML:"block",BODY:"block"},Ue=/^margin/,Ve=new RegExp("^("+Se+")(?!px)[a-z%]+$","i"),Ye=function(t){var n=t.ownerDocument.defaultView;return n&&n.opener||(n=e),n.getComputedStyle(t)},Ge=function(e,t,n,r){var i,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];i=n.apply(e,r||[]);for(o in t)e.style[o]=s[o];return i},Qe=G.documentElement;!function(){function t(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Qe.appendChild(s);var t=e.getComputedStyle(a);n="1%"!==t.top,o="2px"===t.marginLeft,r="4px"===t.width,a.style.marginRight="50%",i="4px"===t.marginRight,Qe.removeChild(s)}var n,r,i,o,s=G.createElement("div"),a=G.createElement("div");a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",re.clearCloneStyle="content-box"===a.style.backgroundClip,s.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",s.appendChild(a),ie.extend(re,{pixelPosition:function(){return t(),n},boxSizingReliable:function(){return null==r&&t(),r},pixelMarginRight:function(){return null==r&&t(),i},reliableMarginLeft:function(){return null==r&&t(),o},reliableMarginRight:function(){var t,n=a.appendChild(G.createElement("div"));return n.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",n.style.marginRight=n.style.width="0",a.style.width="1px",Qe.appendChild(s),t=!parseFloat(e.getComputedStyle(n).marginRight),Qe.removeChild(s),a.removeChild(n),t}}))}();var Je=/^(none|table(?!-c[ea]).+)/,Ke={position:"absolute",visibility:"hidden",display:"block"},Ze={letterSpacing:"0",fontWeight:"400"},et=["Webkit","O","Moz","ms"],tt=G.createElement("div").style;ie.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=N(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,s,a=ie.camelCase(t),u=e.style;if(t=ie.cssProps[a]||(ie.cssProps[a]=j(a)||a),s=ie.cssHooks[t]||ie.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(e,!1,r))?i:u[t];o=typeof n,"string"===o&&(i=je.exec(n))&&i[1]&&(n=l(e,t,i),o="number"),null!=n&&n===n&&("number"===o&&(n+=i&&i[3]||(ie.cssNumber[a]?"":"px")),re.clearCloneStyle||""!==n||0!==t.indexOf("background")||(u[t]="inherit"),s&&"set"in s&&void 0===(n=s.set(e,n,r))||(u[t]=n))}},css:function(e,t,n,r){var i,o,s,a=ie.camelCase(t);return t=ie.cssProps[a]||(ie.cssProps[a]=j(a)||a),s=ie.cssHooks[t]||ie.cssHooks[a],s&&"get"in s&&(i=s.get(e,!0,n)),void 0===i&&(i=N(e,t,r)),"normal"===i&&t in Ze&&(i=Ze[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),ie.each(["height","width"],function(e,t){ie.cssHooks[t]={get:function(e,n,r){if(n)return Je.test(ie.css(e,"display"))&&0===e.offsetWidth?Ge(e,Ke,function(){return q(e,t,r)}):q(e,t,r)},set:function(e,n,r){var i,o=r&&Ye(e),s=r&&A(e,t,r,"border-box"===ie.css(e,"boxSizing",!1,o),o);return s&&(i=je.exec(n))&&"px"!==(i[3]||"px")&&(e.style[t]=n,n=ie.css(e,t)),D(e,n,s)}}}),ie.cssHooks.marginLeft=S(re.reliableMarginLeft,function(e,t){if(t)return(parseFloat(N(e,"marginLeft"))||e.getBoundingClientRect().left-Ge(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),ie.cssHooks.marginRight=S(re.reliableMarginRight,function(e,t){if(t)return Ge(e,{display:"inline-block"},N,[e,"marginRight"])}),ie.each({margin:"",padding:"",border:"Width"},function(e,t){ie.cssHooks[e+t]={expand:function(n){for(var r=0,i={},o="string"==typeof n?n.split(" "):[n];r<4;r++)i[e+De[r]+t]=o[r]||o[r-2]||o[0];return i}},Ue.test(e)||(ie.cssHooks[e+t].set=D)}),ie.fn.extend({css:function(e,t){return we(this,function(e,t,n){var r,i,o={},s=0;if(ie.isArray(t)){for(r=Ye(e),i=t.length;s<i;s++)o[t[s]]=ie.css(e,t[s],!1,r);return o}return void 0!==n?ie.style(e,t,n):ie.css(e,t)},e,t,arguments.length>1)},show:function(){return L(this,!0)},hide:function(){return L(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ae(this)?ie(this).show():ie(this).hide()})}}),ie.Tween=H,H.prototype={constructor:H,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||ie.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(ie.cssNumber[n]?"":"px")},cur:function(){var e=H.propHooks[this.prop];return e&&e.get?e.get(this):H.propHooks._default.get(this)},run:function(e){var t,n=H.propHooks[this.prop];return this.options.duration?this.pos=t=ie.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):H.propHooks._default.set(this),this}},H.prototype.init.prototype=H.prototype,H.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=ie.css(e.elem,e.prop,""),t&&"auto"!==t?t:0)},set:function(e){ie.fx.step[e.prop]?ie.fx.step[e.prop](e):1!==e.elem.nodeType||null==e.elem.style[ie.cssProps[e.prop]]&&!ie.cssHooks[e.prop]?e.elem[e.prop]=e.now:ie.style(e.elem,e.prop,e.now+e.unit)}}},H.propHooks.scrollTop=H.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ie.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},ie.fx=H.prototype.init,ie.fx.step={};var nt,rt,it=/^(?:toggle|show|hide)$/,ot=/queueHooks$/;ie.Animation=ie.extend(I,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return l(n.elem,e,je.exec(t),n),n}]},tweener:function(e,t){ie.isFunction(e)?(t=e,e=["*"]):e=e.match(xe);for(var n,r=0,i=e.length;r<i;r++)n=e[r],I.tweeners[n]=I.tweeners[n]||[],I.tweeners[n].unshift(t)},prefilters:[R],prefilter:function(e,t){t?I.prefilters.unshift(e):I.prefilters.push(e)}}),ie.speed=function(e,t,n){var r=e&&"object"==typeof e?ie.extend({},e):{complete:n||!n&&t||ie.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ie.isFunction(t)&&t};return r.duration=ie.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in ie.fx.speeds?ie.fx.speeds[r.duration]:ie.fx.speeds._default,null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){ie.isFunction(r.old)&&r.old.call(this),r.queue&&ie.dequeue(this,r.queue)},r},ie.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Ae).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=ie.isEmptyObject(e),o=ie.speed(t,n,r),s=function(){var t=I(this,ie.extend({},e),o);(i||Ce.get(this,"finish"))&&t.stop(!0)};return s.finish=s,i||!1===o.queue?this.each(s):this.queue(o.queue,s)},stop:function(e,t,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=ie.timers,s=Ce.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&ot.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));!t&&n||ie.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=Ce.get(this),r=n[e+"queue"],i=n[e+"queueHooks"],o=ie.timers,s=r?r.length:0;for(n.finish=!0,ie.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;t<s;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),ie.each(["toggle","show","hide"],function(e,t){var n=ie.fn[t];ie.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(F(t,!0),e,r,i)}}),ie.each({slideDown:F("show"),slideUp:F("hide"),slideToggle:F("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ie.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),ie.timers=[],ie.fx.tick=function(){var e,t=0,n=ie.timers;for(nt=ie.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||ie.fx.stop(),nt=void 0},ie.fx.timer=function(e){ie.timers.push(e),e()?ie.fx.start():ie.timers.pop()},ie.fx.interval=13,ie.fx.start=function(){rt||(rt=e.setInterval(ie.fx.tick,ie.fx.interval))},ie.fx.stop=function(){e.clearInterval(rt),rt=null},ie.fx.speeds={slow:600,fast:200,_default:400},ie.fn.delay=function(t,n){return t=ie.fx?ie.fx.speeds[t]||t:t,n=n||"fx",this.queue(n,function(n,r){var i=e.setTimeout(n,t);r.stop=function(){e.clearTimeout(i)}})},function(){var e=G.createElement("input"),t=G.createElement("select"),n=t.appendChild(G.createElement("option"));e.type="checkbox",re.checkOn=""!==e.value,re.optSelected=n.selected,t.disabled=!0,re.optDisabled=!n.disabled,e=G.createElement("input"),e.value="t",e.type="radio",re.radioValue="t"===e.value}();var st,at=ie.expr.attrHandle;ie.fn.extend({attr:function(e,t){return we(this,ie.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ie.removeAttr(this,e)})}}),ie.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===e.getAttribute?ie.prop(e,t,n):(1===o&&ie.isXMLDoc(e)||(t=t.toLowerCase(),i=ie.attrHooks[t]||(ie.expr.match.bool.test(t)?st:void 0)),void 0!==n?null===n?void ie.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:(r=ie.find.attr(e,t),null==r?void 0:r))},attrHooks:{type:{set:function(e,t){if(!re.radioValue&&"radio"===t&&ie.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r,i=0,o=t&&t.match(xe);if(o&&1===e.nodeType)for(;n=o[i++];)r=ie.propFix[n]||n,ie.expr.match.bool.test(n)&&(e[r]=!1),e.removeAttribute(n)}}),st={set:function(e,t,n){return!1===t?ie.removeAttr(e,n):e.setAttribute(n,n),n}},ie.each(ie.expr.match.bool.source.match(/\w+/g),function(e,t){var n=at[t]||ie.find.attr;at[t]=function(e,t,r){var i,o;return r||(o=at[t],at[t]=i,i=null!=n(e,t,r)?t.toLowerCase():null,at[t]=o),i}});var ut=/^(?:input|select|textarea|button)$/i,lt=/^(?:a|area)$/i;ie.fn.extend({prop:function(e,t){return we(this,ie.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ie.propFix[e]||e]})}}),ie.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&ie.isXMLDoc(e)||(t=ie.propFix[t]||t,i=ie.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=ie.find.attr(e,"tabindex");return t?parseInt(t,10):ut.test(e.nodeName)||lt.test(e.nodeName)&&e.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),re.optSelected||(ie.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),ie.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ie.propFix[this.toLowerCase()]=this});var ct=/[\t\r\n\f]/g;ie.fn.extend({addClass:function(e){var t,n,r,i,o,s,a,u=0;if(ie.isFunction(e))return this.each(function(t){ie(this).addClass(e.call(this,t,W(this)))});if("string"==typeof e&&e)for(t=e.match(xe)||[];n=this[u++];)if(i=W(n),r=1===n.nodeType&&(" "+i+" ").replace(ct," ")){for(s=0;o=t[s++];)r.indexOf(" "+o+" ")<0&&(r+=o+" ");a=ie.trim(r),i!==a&&n.setAttribute("class",a)}return this},removeClass:function(e){var t,n,r,i,o,s,a,u=0;if(ie.isFunction(e))return this.each(function(t){ie(this).removeClass(e.call(this,t,W(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof e&&e)for(t=e.match(xe)||[];n=this[u++];)if(i=W(n),r=1===n.nodeType&&(" "+i+" ").replace(ct," ")){for(s=0;o=t[s++];)for(;r.indexOf(" "+o+" ")>-1;)r=r.replace(" "+o+" "," ");a=ie.trim(r),i!==a&&n.setAttribute("class",a)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):ie.isFunction(e)?this.each(function(n){ie(this).toggleClass(e.call(this,n,W(this),t),t)}):this.each(function(){var t,r,i,o;if("string"===n)for(r=0,i=ie(this),o=e.match(xe)||[];t=o[r++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else void 0!==e&&"boolean"!==n||(t=W(this),t&&Ce.set(this,"__className__",t),this.setAttribute&&this.setAttribute("class",t||!1===e?"":Ce.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;for(t=" "+e+" ";n=this[r++];)if(1===n.nodeType&&(" "+W(n)+" ").replace(ct," ").indexOf(t)>-1)return!0;return!1}});var ft=/\r/g,pt=/[\x20\t\r\n\f]+/g;ie.fn.extend({val:function(e){var t,n,r,i=this[0];return arguments.length?(r=ie.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=r?e.call(this,n,ie(this).val()):e,null==i?i="":"number"==typeof i?i+="":ie.isArray(i)&&(i=ie.map(i,function(e){return null==e?"":e+""})),(t=ie.valHooks[this.type]||ie.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=ie.valHooks[i.type]||ie.valHooks[i.nodeName.toLowerCase()])&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(ft,""):null==n?"":n):void 0}}),ie.extend({valHooks:{option:{get:function(e){var t=ie.find.attr(e,"value");return null!=t?t:ie.trim(ie.text(e)).replace(pt," ")}},select:{get:function(e){for(var t,n,r=e.options,i=e.selectedIndex,o="select-one"===e.type||i<0,s=o?null:[],a=o?i+1:r.length,u=i<0?a:o?i:0;u<a;u++)if(n=r[u],(n.selected||u===i)&&(re.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!ie.nodeName(n.parentNode,"optgroup"))){if(t=ie(n).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var n,r,i=e.options,o=ie.makeArray(t),s=i.length;s--;)r=i[s],(r.selected=ie.inArray(ie.valHooks.option.get(r),o)>-1)&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),ie.each(["radio","checkbox"],function(){ie.valHooks[this]={set:function(e,t){if(ie.isArray(t))return e.checked=ie.inArray(ie(e).val(),t)>-1}},re.checkOn||(ie.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var dt=/^(?:focusinfocus|focusoutblur)$/;ie.extend(ie.event,{trigger:function(t,n,r,i){var o,s,a,u,l,c,f,p=[r||G],d=ne.call(t,"type")?t.type:t,h=ne.call(t,"namespace")?t.namespace.split("."):[];if(s=a=r=r||G,3!==r.nodeType&&8!==r.nodeType&&!dt.test(d+ie.event.triggered)&&(d.indexOf(".")>-1&&(h=d.split("."),d=h.shift(),h.sort()),l=d.indexOf(":")<0&&"on"+d,t=t[ie.expando]?t:new ie.Event(d,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=h.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=r),n=null==n?[t]:ie.makeArray(n,[t]),f=ie.event.special[d]||{},i||!f.trigger||!1!==f.trigger.apply(r,n))){if(!i&&!f.noBubble&&!ie.isWindow(r)){for(u=f.delegateType||d,dt.test(u+d)||(s=s.parentNode);s;s=s.parentNode)p.push(s),a=s;a===(r.ownerDocument||G)&&p.push(a.defaultView||a.parentWindow||e)}for(o=0;(s=p[o++])&&!t.isPropagationStopped();)t.type=o>1?u:f.bindType||d,c=(Ce.get(s,"events")||{})[t.type]&&Ce.get(s,"handle"),c&&c.apply(s,n),(c=l&&s[l])&&c.apply&&Te(s)&&(t.result=c.apply(s,n),!1===t.result&&t.preventDefault());return t.type=d,i||t.isDefaultPrevented()||f._default&&!1!==f._default.apply(p.pop(),n)||!Te(r)||l&&ie.isFunction(r[d])&&!ie.isWindow(r)&&(a=r[l],a&&(r[l]=null),ie.event.triggered=d,r[d](),ie.event.triggered=void 0,a&&(r[l]=a)),t.result}},simulate:function(e,t,n){var r=ie.extend(new ie.Event,n,{type:e,isSimulated:!0});ie.event.trigger(r,null,t)}}),ie.fn.extend({trigger:function(e,t){return this.each(function(){ie.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return ie.event.trigger(e,t,n,!0)}}),ie.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ie.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ie.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),re.focusin="onfocusin"in e,re.focusin||ie.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){ie.event.simulate(t,e.target,ie.event.fix(e))};ie.event.special[t]={setup:function(){var r=this.ownerDocument||this,i=Ce.access(r,t);i||r.addEventListener(e,n,!0),Ce.access(r,t,(i||0)+1)},teardown:function(){var r=this.ownerDocument||this,i=Ce.access(r,t)-1;i?Ce.access(r,t,i):(r.removeEventListener(e,n,!0),Ce.remove(r,t))}}});var ht=e.location,gt=ie.now(),vt=/\?/;ie.parseJSON=function(e){return JSON.parse(e+"")},ie.parseXML=function(t){var n;if(!t||"string"!=typeof t)return null;try{n=(new e.DOMParser).parseFromString(t,"text/xml")}catch(e){n=void 0}return n&&!n.getElementsByTagName("parsererror").length||ie.error("Invalid XML: "+t),n};var mt=/#.*$/,yt=/([?&])_=[^&]*/,xt=/^(.*?):[ \t]*([^\r\n]*)$/gm,bt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,wt=/^(?:GET|HEAD)$/,Tt=/^\/\//,Ct={},kt={},Et="*/".concat("*"),Nt=G.createElement("a");Nt.href=ht.href,ie.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ht.href,type:"GET",isLocal:bt.test(ht.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Et,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ie.parseJSON,"text xml":ie.parseXML},flatOptions:{
url:!0,context:!0}},ajaxSetup:function(e,t){return t?_(_(e,ie.ajaxSettings),t):_(ie.ajaxSettings,e)},ajaxPrefilter:$(Ct),ajaxTransport:$(kt),ajax:function(t,n){function r(t,n,r,a){var l,f,y,x,w,C=n;2!==b&&(b=2,u&&e.clearTimeout(u),i=void 0,s=a||"",T.readyState=t>0?4:0,l=t>=200&&t<300||304===t,r&&(x=X(p,T,r)),x=z(p,x,T,l),l?(p.ifModified&&(w=T.getResponseHeader("Last-Modified"),w&&(ie.lastModified[o]=w),(w=T.getResponseHeader("etag"))&&(ie.etag[o]=w)),204===t||"HEAD"===p.type?C="nocontent":304===t?C="notmodified":(C=x.state,f=x.data,y=x.error,l=!y)):(y=C,!t&&C||(C="error",t<0&&(t=0))),T.status=t,T.statusText=(n||C)+"",l?g.resolveWith(d,[f,C,T]):g.rejectWith(d,[T,C,y]),T.statusCode(m),m=void 0,c&&h.trigger(l?"ajaxSuccess":"ajaxError",[T,p,l?f:y]),v.fireWith(d,[T,C]),c&&(h.trigger("ajaxComplete",[T,p]),--ie.active||ie.event.trigger("ajaxStop")))}"object"==typeof t&&(n=t,t=void 0),n=n||{};var i,o,s,a,u,l,c,f,p=ie.ajaxSetup({},n),d=p.context||p,h=p.context&&(d.nodeType||d.jquery)?ie(d):ie.event,g=ie.Deferred(),v=ie.Callbacks("once memory"),m=p.statusCode||{},y={},x={},b=0,w="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!a)for(a={};t=xt.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=x[n]=x[n]||e,y[e]=t),this},overrideMimeType:function(e){return b||(p.mimeType=e),this},statusCode:function(e){var t;if(e)if(b<2)for(t in e)m[t]=[m[t],e[t]];else T.always(e[T.status]);return this},abort:function(e){var t=e||w;return i&&i.abort(t),r(0,t),this}};if(g.promise(T).complete=v.add,T.success=T.done,T.error=T.fail,p.url=((t||p.url||ht.href)+"").replace(mt,"").replace(Tt,ht.protocol+"//"),p.type=n.method||n.type||p.method||p.type,p.dataTypes=ie.trim(p.dataType||"*").toLowerCase().match(xe)||[""],null==p.crossDomain){l=G.createElement("a");try{l.href=p.url,l.href=l.href,p.crossDomain=Nt.protocol+"//"+Nt.host!=l.protocol+"//"+l.host}catch(e){p.crossDomain=!0}}if(p.data&&p.processData&&"string"!=typeof p.data&&(p.data=ie.param(p.data,p.traditional)),B(Ct,p,n,T),2===b)return T;c=ie.event&&p.global,c&&0==ie.active++&&ie.event.trigger("ajaxStart"),p.type=p.type.toUpperCase(),p.hasContent=!wt.test(p.type),o=p.url,p.hasContent||(p.data&&(o=p.url+=(vt.test(o)?"&":"?")+p.data,delete p.data),!1===p.cache&&(p.url=yt.test(o)?o.replace(yt,"$1_="+gt++):o+(vt.test(o)?"&":"?")+"_="+gt++)),p.ifModified&&(ie.lastModified[o]&&T.setRequestHeader("If-Modified-Since",ie.lastModified[o]),ie.etag[o]&&T.setRequestHeader("If-None-Match",ie.etag[o])),(p.data&&p.hasContent&&!1!==p.contentType||n.contentType)&&T.setRequestHeader("Content-Type",p.contentType),T.setRequestHeader("Accept",p.dataTypes[0]&&p.accepts[p.dataTypes[0]]?p.accepts[p.dataTypes[0]]+("*"!==p.dataTypes[0]?", "+Et+"; q=0.01":""):p.accepts["*"]);for(f in p.headers)T.setRequestHeader(f,p.headers[f]);if(p.beforeSend&&(!1===p.beforeSend.call(d,T,p)||2===b))return T.abort();w="abort";for(f in{success:1,error:1,complete:1})T[f](p[f]);if(i=B(kt,p,n,T)){if(T.readyState=1,c&&h.trigger("ajaxSend",[T,p]),2===b)return T;p.async&&p.timeout>0&&(u=e.setTimeout(function(){T.abort("timeout")},p.timeout));try{b=1,i.send(y,r)}catch(e){if(!(b<2))throw e;r(-1,e)}}else r(-1,"No Transport");return T},getJSON:function(e,t,n){return ie.get(e,t,n,"json")},getScript:function(e,t){return ie.get(e,void 0,t,"script")}}),ie.each(["get","post"],function(e,t){ie[t]=function(e,n,r,i){return ie.isFunction(n)&&(i=i||r,r=n,n=void 0),ie.ajax(ie.extend({url:e,type:t,dataType:i,data:n,success:r},ie.isPlainObject(e)&&e))}}),ie._evalUrl=function(e){return ie.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},ie.fn.extend({wrapAll:function(e){var t;return ie.isFunction(e)?this.each(function(t){ie(this).wrapAll(e.call(this,t))}):(this[0]&&(t=ie(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return ie.isFunction(e)?this.each(function(t){ie(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ie(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ie.isFunction(e);return this.each(function(n){ie(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ie.nodeName(this,"body")||ie(this).replaceWith(this.childNodes)}).end()}}),ie.expr.filters.hidden=function(e){return!ie.expr.filters.visible(e)},ie.expr.filters.visible=function(e){return e.offsetWidth>0||e.offsetHeight>0||e.getClientRects().length>0};var St=/%20/g,jt=/\[\]$/,Dt=/\r?\n/g,At=/^(?:submit|button|image|reset|file)$/i,qt=/^(?:input|select|textarea|keygen)/i;ie.param=function(e,t){var n,r=[],i=function(e,t){t=ie.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=ie.ajaxSettings&&ie.ajaxSettings.traditional),ie.isArray(e)||e.jquery&&!ie.isPlainObject(e))ie.each(e,function(){i(this.name,this.value)});else for(n in e)U(n,e[n],t,i);return r.join("&").replace(St,"+")},ie.fn.extend({serialize:function(){return ie.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ie.prop(this,"elements");return e?ie.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ie(this).is(":disabled")&&qt.test(this.nodeName)&&!At.test(e)&&(this.checked||!qe.test(e))}).map(function(e,t){var n=ie(this).val();return null==n?null:ie.isArray(n)?ie.map(n,function(e){return{name:t.name,value:e.replace(Dt,"\r\n")}}):{name:t.name,value:n.replace(Dt,"\r\n")}}).get()}}),ie.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(e){}};var Lt={0:200,1223:204},Ht=ie.ajaxSettings.xhr();re.cors=!!Ht&&"withCredentials"in Ht,re.ajax=Ht=!!Ht,ie.ajaxTransport(function(t){var n,r;if(re.cors||Ht&&!t.crossDomain)return{send:function(i,o){var s,a=t.xhr();if(a.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)a[s]=t.xhrFields[s];t.mimeType&&a.overrideMimeType&&a.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(s in i)a.setRequestHeader(s,i[s]);n=function(e){return function(){n&&(n=r=a.onload=a.onerror=a.onabort=a.onreadystatechange=null,"abort"===e?a.abort():"error"===e?"number"!=typeof a.status?o(0,"error"):o(a.status,a.statusText):o(Lt[a.status]||a.status,a.statusText,"text"!==(a.responseType||"text")||"string"!=typeof a.responseText?{binary:a.response}:{text:a.responseText},a.getAllResponseHeaders()))}},a.onload=n(),r=a.onerror=n("error"),void 0!==a.onabort?a.onabort=r:a.onreadystatechange=function(){4===a.readyState&&e.setTimeout(function(){n&&r()})},n=n("abort");try{a.send(t.hasContent&&t.data||null)}catch(e){if(n)throw e}},abort:function(){n&&n()}}}),ie.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return ie.globalEval(e),e}}}),ie.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ie.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(r,i){t=ie("<script>").prop({charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&i("error"===e.type?404:200,e.type)}),G.head.appendChild(t[0])},abort:function(){n&&n()}}}});var Ot=[],Ft=/(=)\?(?=&|$)|\?\?/;ie.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ot.pop()||ie.expando+"_"+gt++;return this[e]=!0,e}}),ie.ajaxPrefilter("json jsonp",function(t,n,r){var i,o,s,a=!1!==t.jsonp&&(Ft.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Ft.test(t.data)&&"data");if(a||"jsonp"===t.dataTypes[0])return i=t.jsonpCallback=ie.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Ft,"$1"+i):!1!==t.jsonp&&(t.url+=(vt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return s||ie.error(i+" was not called"),s[0]},t.dataTypes[0]="json",o=e[i],e[i]=function(){s=arguments},r.always(function(){void 0===o?ie(e).removeProp(i):e[i]=o,t[i]&&(t.jsonpCallback=n.jsonpCallback,Ot.push(i)),s&&ie.isFunction(o)&&o(s[0]),s=o=void 0}),"script"}),ie.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||G;var r=de.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=p([e],t,i),i&&i.length&&ie(i).remove(),ie.merge([],r.childNodes))};var Pt=ie.fn.load;ie.fn.load=function(e,t,n){if("string"!=typeof e&&Pt)return Pt.apply(this,arguments);var r,i,o,s=this,a=e.indexOf(" ");return a>-1&&(r=ie.trim(e.slice(a)),e=e.slice(0,a)),ie.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),s.length>0&&ie.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,s.html(r?ie("<div>").append(ie.parseHTML(e)).find(r):e)}).always(n&&function(e,t){s.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},ie.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ie.fn[t]=function(e){return this.on(t,e)}}),ie.expr.filters.animated=function(e){return ie.grep(ie.timers,function(t){return e===t.elem}).length},ie.offset={setOffset:function(e,t,n){var r,i,o,s,a,u,l,c=ie.css(e,"position"),f=ie(e),p={};"static"===c&&(e.style.position="relative"),a=f.offset(),o=ie.css(e,"top"),u=ie.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+u).indexOf("auto")>-1,l?(r=f.position(),s=r.top,i=r.left):(s=parseFloat(o)||0,i=parseFloat(u)||0),ie.isFunction(t)&&(t=t.call(e,n,ie.extend({},a))),null!=t.top&&(p.top=t.top-a.top+s),null!=t.left&&(p.left=t.left-a.left+i),"using"in t?t.using.call(e,p):f.css(p)}},ie.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ie.offset.setOffset(this,e,t)});var t,n,r=this[0],i={top:0,left:0},o=r&&r.ownerDocument;return o?(t=o.documentElement,ie.contains(t,r)?(i=r.getBoundingClientRect(),n=V(o),{top:i.top+n.pageYOffset-t.clientTop,left:i.left+n.pageXOffset-t.clientLeft}):i):void 0},position:function(){if(this[0]){var e,t,n=this[0],r={top:0,left:0};return"fixed"===ie.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ie.nodeName(e[0],"html")||(r=e.offset()),r.top+=ie.css(e[0],"borderTopWidth",!0),r.left+=ie.css(e[0],"borderLeftWidth",!0)),{top:t.top-r.top-ie.css(n,"marginTop",!0),left:t.left-r.left-ie.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent;e&&"static"===ie.css(e,"position");)e=e.offsetParent;return e||Qe})}}),ie.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n="pageYOffset"===t;ie.fn[e]=function(r){return we(this,function(e,r,i){var o=V(e);if(void 0===i)return o?o[t]:e[r];o?o.scrollTo(n?o.pageXOffset:i,n?i:o.pageYOffset):e[r]=i},e,r,arguments.length)}}),ie.each(["top","left"],function(e,t){ie.cssHooks[t]=S(re.pixelPosition,function(e,n){if(n)return n=N(e,t),Ve.test(n)?ie(e).position()[t]+"px":n})}),ie.each({Height:"height",Width:"width"},function(e,t){ie.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,r){ie.fn[r]=function(r,i){var o=arguments.length&&(n||"boolean"!=typeof r),s=n||(!0===r||!0===i?"margin":"border");return we(this,function(t,n,r){var i;return ie.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===r?ie.css(t,n,s):ie.style(t,n,r,s)},t,o?r:void 0,o,null)}})}),ie.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},size:function(){return this.length}}),ie.fn.andSelf=ie.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ie});var Rt=e.jQuery,Mt=e.$;return ie.noConflict=function(t){return e.$===ie&&(e.$=Mt),t&&e.jQuery===ie&&(e.jQuery=Rt),ie},t||(e.jQuery=e.$=ie),ie})},{}],97:[function(_dereq_,module,exports){function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}function runTimeout(e){if(cachedSetTimeout===setTimeout)return setTimeout(e,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(e,0);try{return cachedSetTimeout(e,0)}catch(t){try{return cachedSetTimeout.call(null,e,0)}catch(t){return cachedSetTimeout.call(this,e,0)}}}function runClearTimeout(e){if(cachedClearTimeout===clearTimeout)return clearTimeout(e);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(e);try{return cachedClearTimeout(e)}catch(t){try{return cachedClearTimeout.call(null,e)}catch(t){return cachedClearTimeout.call(this,e)}}}function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var e=runTimeout(cleanUpNextTick);draining=!0;for(var t=queue.length;t;){for(currentQueue=queue,queue=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue.push(new Item(e,t)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(e){return[]},process.binding=function(e){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(e){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},{}],98:[function(_dereq_,module,exports){var engine=_dereq_("../src/store-engine"),storages=_dereq_("../storages/all"),plugins=[_dereq_("../plugins/json2")];module.exports=engine.createStore(storages,plugins)},{"../plugins/json2":99,"../src/store-engine":101,"../storages/all":103}],99:[function(_dereq_,module,exports){function json2Plugin(){return _dereq_("./lib/json2"),{}}module.exports=json2Plugin},{"./lib/json2":100}],100:[function(_dereq_,module,exports){"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(t){return t<10?"0"+t:t}function this_value(){return this.valueOf()}function quote(t){return rx_escapable.lastIndex=0,rx_escapable.test(t)?'"'+t.replace(rx_escapable,function(t){var e=meta[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'}function str(t,e){var r,n,o,u,f,a=gap,i=e[t];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(t)),"function"==typeof rep&&(i=rep.call(e,t,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,f=[],"[object Array]"===Object.prototype.toString.apply(i)){for(u=i.length,r=0;r<u;r+=1)f[r]=str(r,i)||"null";return o=0===f.length?"[]":gap?"[\n"+gap+f.join(",\n"+gap)+"\n"+a+"]":"["+f.join(",")+"]",gap=a,o}if(rep&&"object"==typeof rep)for(u=rep.length,r=0;r<u;r+=1)"string"==typeof rep[r]&&(n=rep[r],(o=str(n,i))&&f.push(quote(n)+(gap?": ":":")+o));else for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(o=str(n,i))&&f.push(quote(n)+(gap?": ":":")+o);return o=0===f.length?"{}":gap?"{\n"+gap+f.join(",\n"+gap)+"\n"+a+"}":"{"+f.join(",")+"}",gap=a,o}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(t,e,r){var n;if(gap="",indent="","number"==typeof r)for(n=0;n<r;n+=1)indent+=" ";else"string"==typeof r&&(indent=r);if(rep=e,e&&"function"!=typeof e&&("object"!=typeof e||"number"!=typeof e.length))throw new Error("JSON.stringify");return str("",{"":t})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(t,e){var r,n,o=t[e];if(o&&"object"==typeof o)for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(n=walk(o,r),void 0!==n?o[r]=n:delete o[r]);return reviver.call(t,e,o)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}()},{}],101:[function(_dereq_,module,exports){function _warn(){var e="undefined"==typeof console?null:console;e&&(e.warn?e.warn:e.log).apply(e,arguments)}function createStore(e,t,i){i||(i=""),e&&!isList(e)&&(e=[e]),t&&!isList(t)&&(t=[t]);var r=i?"__storejs_"+i+"_":"",n=i?new RegExp("^"+r):null;if(!/^[a-zA-Z0-9_\-]*$/.test(i))throw new Error("store.js namespaces can only have alphanumerics + underscores and dashes");var a={_namespacePrefix:r,_namespaceRegexp:n,_testStorage:function(e){try{var t="__storejs__test__";e.write(t,t);var i=e.read(t)===t;return e.remove(t),i}catch(e){return!1}},_assignPluginFnProp:function(e,t){var i=this[t];this[t]=function(){function t(){if(i)return each(arguments,function(e,t){r[t]=e}),i.apply(n,r)}var r=slice(arguments,0),n=this,a=[t].concat(r);return e.apply(n,a)}},_serialize:function(e){return JSON.stringify(e)},_deserialize:function(e,t){if(!e)return t;var i="";try{i=JSON.parse(e)}catch(t){i=e}return void 0!==i?i:t},_addStorage:function(e){this.enabled||this._testStorage(e)&&(this.storage=e,this.enabled=!0)},_addPlugin:function(e){var t=this;if(isList(e))return void each(e,function(e){t._addPlugin(e)});if(!pluck(this.plugins,function(t){return e===t})){if(this.plugins.push(e),!isFunction(e))throw new Error("Plugins must be function values that return objects");var i=e.call(this);if(!isObject(i))throw new Error("Plugins must return an object of function properties");each(i,function(i,r){if(!isFunction(i))throw new Error("Bad plugin property: "+r+" from plugin "+e.name+". Plugins should only return functions.");t._assignPluginFnProp(i,r)})}},addStorage:function(e){_warn("store.addStorage(storage) is deprecated. Use createStore([storages])"),this._addStorage(e)}},s=create(a,storeAPI,{plugins:[]});return s.raw={},each(s,function(e,t){isFunction(e)&&(s.raw[t]=bind(s,e))}),each(e,function(e){s._addStorage(e)}),each(t,function(e){s._addPlugin(e)}),s}var util=_dereq_("./util"),slice=util.slice,pluck=util.pluck,each=util.each,bind=util.bind,create=util.create,isList=util.isList,isFunction=util.isFunction,isObject=util.isObject;module.exports={createStore:createStore};var storeAPI={version:"2.0.12",enabled:!1,get:function(e,t){var i=this.storage.read(this._namespacePrefix+e);return this._deserialize(i,t)},set:function(e,t){return void 0===t?this.remove(e):(this.storage.write(this._namespacePrefix+e,this._serialize(t)),t)},remove:function(e){this.storage.remove(this._namespacePrefix+e)},each:function(e){var t=this;this.storage.each(function(i,r){e.call(t,t._deserialize(i),(r||"").replace(t._namespaceRegexp,""))})},clearAll:function(){this.storage.clearAll()},hasNamespace:function(e){return this._namespacePrefix=="__storejs_"+e+"_"},createStore:function(){return createStore.apply(this,arguments)},addPlugin:function(e){this._addPlugin(e)},namespace:function(e){return createStore(this.storage,this.plugins,e)}}},{"./util":102}],102:[function(_dereq_,module,exports){(function(global){function bind(t,n){return function(){return n.apply(t,Array.prototype.slice.call(arguments,0))}}function slice(t,n){return Array.prototype.slice.call(t,n||0)}function each(t,n){pluck(t,function(t,e){return n(t,e),!1})}function map(t,n){var e=isList(t)?[]:{};return pluck(t,function(t,i){return e[i]=n(t,i),!1}),e}function pluck(t,n){if(isList(t)){for(var e=0;e<t.length;e++)if(n(t[e],e))return t[e]}else for(var i in t)if(t.hasOwnProperty(i)&&n(t[i],i))return t[i]}function isList(t){return null!=t&&"function"!=typeof t&&"number"==typeof t.length}function isFunction(t){return t&&"[object Function]"==={}.toString.call(t)}function isObject(t){return t&&"[object Object]"==={}.toString.call(t)}var assign=function(){return Object.assign?Object.assign:function(t,n,e,i){for(var r=1;r<arguments.length;r++)each(Object(arguments[r]),function(n,e){t[e]=n});return t}}(),create=function(){function t(){}return Object.create?function(t,n,e,i){var r=slice(arguments,1);return assign.apply(this,[Object.create(t)].concat(r))}:function(n,e,i,r){var c=slice(arguments,1);return t.prototype=n,assign.apply(this,[new t].concat(c))}}(),trim=function(){return String.prototype.trim?function(t){return String.prototype.trim.call(t)}:function(t){return t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}}(),Global="undefined"!=typeof window?window:global;module.exports={assign:assign,create:create,trim:trim,bind:bind,slice:slice,each:each,map:map,pluck:pluck,isList:isList,isFunction:isFunction,isObject:isObject,Global:Global}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],103:[function(_dereq_,module,exports){module.exports=[_dereq_("./localStorage"),_dereq_("./oldFF-globalStorage"),_dereq_("./oldIE-userDataStorage"),_dereq_("./cookieStorage"),_dereq_("./sessionStorage"),_dereq_("./memoryStorage")]},{"./cookieStorage":104,"./localStorage":105,"./memoryStorage":106,"./oldFF-globalStorage":107,"./oldIE-userDataStorage":108,"./sessionStorage":109}],104:[function(_dereq_,module,exports){function read(e){if(!e||!_has(e))return null;var c="(?:^|.*;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*";return unescape(doc.cookie.replace(new RegExp(c),"$1"))}function each(e){for(var c=doc.cookie.split(/; ?/g),a=c.length-1;a>=0;a--)if(trim(c[a])){var r=c[a].split("="),o=unescape(r[0]),i=unescape(r[1]);e(i,o)}}function write(e,c){e&&(doc.cookie=escape(e)+"="+escape(c)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/")}function remove(e){e&&_has(e)&&(doc.cookie=escape(e)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/")}function clearAll(){each(function(e,c){remove(c)})}function _has(e){return new RegExp("(?:^|;\\s*)"+escape(e).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(doc.cookie)}var util=_dereq_("../src/util"),Global=util.Global,trim=util.trim;module.exports={name:"cookieStorage",read:read,write:write,each:each,remove:remove,clearAll:clearAll};var doc=Global.document},{"../src/util":102}],105:[function(_dereq_,module,exports){function localStorage(){return Global.localStorage}function read(e){return localStorage().getItem(e)}function write(e,r){return localStorage().setItem(e,r)}function each(e){for(var r=localStorage().length-1;r>=0;r--){var l=localStorage().key(r);e(read(l),l)}}function remove(e){return localStorage().removeItem(e)}function clearAll(){return localStorage().clear()}var util=_dereq_("../src/util"),Global=util.Global;module.exports={name:"localStorage",read:read,write:write,each:each,remove:remove,clearAll:clearAll}},{"../src/util":102}],106:[function(_dereq_,module,exports){function read(e){return memoryStorage[e]}function write(e,r){memoryStorage[e]=r}function each(e){for(var r in memoryStorage)memoryStorage.hasOwnProperty(r)&&e(memoryStorage[r],r)}function remove(e){delete memoryStorage[e]}function clearAll(e){memoryStorage={}}module.exports={name:"memoryStorage",read:read,write:write,each:each,remove:remove,clearAll:clearAll};var memoryStorage={}},{}],107:[function(_dereq_,module,exports){function read(e){return globalStorage[e]}function write(e,l){globalStorage[e]=l}function each(e){for(var l=globalStorage.length-1;l>=0;l--){var a=globalStorage.key(l);e(globalStorage[a],a)}}function remove(e){return globalStorage.removeItem(e)}function clearAll(){each(function(e,l){delete globalStorage[e]})}var util=_dereq_("../src/util"),Global=util.Global;module.exports={name:"oldFF-globalStorage",read:read,write:write,each:each,remove:remove,clearAll:clearAll};var globalStorage=Global.globalStorage},{"../src/util":102}],108:[function(_dereq_,module,exports){function write(e,t){if(!disable){var a=fixKey(e);_withStorageEl(function(e){e.setAttribute(a,t),e.save(storageName)})}}function read(e){if(!disable){var t=fixKey(e),a=null;return _withStorageEl(function(e){a=e.getAttribute(t)}),a}}function each(e){_withStorageEl(function(t){for(var a=t.XMLDocument.documentElement.attributes,r=a.length-1;r>=0;r--){var o=a[r];e(t.getAttribute(o.name),o.name)}})}function remove(e){var t=fixKey(e);_withStorageEl(function(e){e.removeAttribute(t),e.save(storageName)})}function clearAll(){_withStorageEl(function(e){var t=e.XMLDocument.documentElement.attributes;e.load(storageName);for(var a=t.length-1;a>=0;a--)e.removeAttribute(t[a].name);e.save(storageName)})}function fixKey(e){return e.replace(/^\d/,"___$&").replace(forbiddenCharsRegex,"___")}var util=_dereq_("../src/util"),Global=util.Global;module.exports={name:"oldIE-userDataStorage",write:write,read:read,each:each,remove:remove,clearAll:clearAll};var storageName="storejs",doc=Global.document,_withStorageEl=function(){if(!doc||!doc.documentElement||!doc.documentElement.addBehavior)return null;var e,t,a;try{t=new ActiveXObject("htmlfile"),t.open(),t.write('<script>document.w=window<\/script><iframe src="/favicon.ico"></iframe>'),t.close(),e=t.w.frames[0].document,a=e.createElement("div")}catch(t){a=doc.createElement("div"),e=doc.body}return function(t){var r=[].slice.call(arguments,0);r.unshift(a),e.appendChild(a),a.addBehavior("#default#userData"),a.load(storageName),t.apply(this,r),e.removeChild(a)}}(),disable=(Global.navigator?Global.navigator.userAgent:"").match(/ (MSIE 8|MSIE 9|MSIE 10)\./),forbiddenCharsRegex=new RegExp("[!\"#$%&'()*+,/\\\\:;<=>?@[\\]^`{|}~]","g")},{"../src/util":102}],109:[function(_dereq_,module,exports){function sessionStorage(){return Global.sessionStorage}function read(e){return sessionStorage().getItem(e)}function write(e,r){return sessionStorage().setItem(e,r)}function each(e){for(var r=sessionStorage().length-1;r>=0;r--){var o=sessionStorage().key(r);e(read(o),o)}}function remove(e){return sessionStorage().removeItem(e)}function clearAll(){return sessionStorage().clear()}var util=_dereq_("../src/util"),Global=util.Global;module.exports={name:"sessionStorage",read:read,write:write,each:each,remove:remove,clearAll:clearAll}},{"../src/util":102}],110:[function(_dereq_,module,exports){var raf=function(){return"requestAnimationFrame"in window?window.requestAnimationFrame.bind(window):function(n){window.setTimeout(n,1e3/60)}}();module.exports={raf:raf}},{}],111:[function(_dereq_,module,exports){function WorkerPool(e){function r(e,r){var o=r.data;try{o=JSON.parse(o)}catch(e){}"ack"===o.type&&("function"==typeof Worker?e.removeEventListener("message",e.onWorkerReady):window.removeEventListener("message",e.onWorkerReady),e.ready=!0,t.maybeDequeueJob())}this.workers=Array(e.workerCount),this.queuedJobs=[];for(var o,t=this,n=0;n<e.workerCount;n++)o=function(e,r,o){if("function"==typeof Worker){var t=new Worker(e);return t.onWorkerReady=o.bind(null,t),t.addEventListener("message",t.onWorkerReady),t}var n=document.createElement("iframe");return n.height=n.width=0,n.onWorkerReady=o.bind(null,n),window.addEventListener("message",n.onWorkerReady,!1),n.src=r,raf(function(){document.body.appendChild(n)}),n}(e.workerPath,e.iframePath,r),o.running=!1,o.ready=!1,this.workers[n]=o}var raf=_dereq_("./dom").raf;WorkerPool.prototype.queueJob=function(e,r){this.queuedJobs.push([e,r]),this.maybeDequeueJob()},WorkerPool.prototype.maybeDequeueJob=function(){for(var e,r=0;r<this.workers.length;r++)if(!this.workers[r].running&&this.workers[r].ready){e=this.workers[r];break}if(e&&this.queuedJobs.length){var o=this.queuedJobs.shift(),t=function(e,r){var n=r.data;try{n=JSON.parse(n)}catch(e){}var s=this.workers[e];"function"==typeof Worker?s.removeEventListener("message",t):window.removeEventListener("message",t),s.running=!1,o[1]({data:n}),this.maybeDequeueJob()}.bind(this,r);e.running=!0;var n=JSON.stringify(o[0]);"function"==typeof Worker?(e.addEventListener("message",t),e.postMessage(n)):(window.addEventListener("message",t,!1),e.contentWindow.postMessage(n,"*"))}},WorkerPool.prototype.destroy=function(){this.queuedJobs=[],this.workers.forEach(function(e){e.terminate?e.terminate():e.parentElement.removeChild(e)}),this.workers=[]},module.exports=WorkerPool},{"./dom":110}],112:[function(_dereq_,module,exports){function adaptPermalink(t){if(!t)return null;var e=t[BootstrapKeys.DATA][BootstrapKeys.URL];return 0!==e.indexOf("http://")&&(e="http://"+e),e}function adaptSettings(t,e){t.settings=t.settings||{};for(var o,n,i=!1,r=SCOPE_CHAIN.length-1;r>=0;r--)(n=e[SCOPE_CHAIN[r]])&&(0===r&&(n=n.config),"number"==typeof n.editMode&&(i=1===n.editMode),o=n.editCommentInterval||o);t.settings.allowEditComments=i,t.settings.editCommentInterval=o||5,t.maxEventId=(e.headDocument||{}).event||0}function adaptAvatar(t){return t&&adaptAvatar.IS_SECURE?t.replace("http://avatars.fyre.co","https://lfavatar-a.akamaihd.net"):t}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Author=_dereq_("../models/author"),auth=_dereq_("../util/auth"),Comment=_dereq_("../models/comment"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),nullFunction=_dereq_("../util/internals").nullFunction,StateToContent=_dereq_("./../../../lib/streamhub-sdk/src/content/state-to-content"),Storage=_dereq_("../util/storage"),visEnums=_dereq_("../enums").commentVisibility,BootstrapKeys={ANCHORS:"anchors",ANNOTATION:"annotation",AUTHORS:"authors",AUTHOR_ID:"authorId",BLOCK_ID:"blockId",BODY_HTML:"bodyHtml",CONTENT:"content",CREATED_AT:"createdAt",DATA:"data",EREFS:"erefs",HINTS:"hints",ID:"id",INDEX:"index",MESSAGES:"messages",META:"meta",MODERATOR:"moderator",NUM_ANNOTATIONS:"num_annotations",NUM_VISIBLE:"numVisible",PARENT_ID:"parentId",SIMHASH:"simhash",STATES:"states",URL:"url",VOTE:"vote"},AnnotationsStateToContent=function(t){t=t||{},
this._erefProcessor=t.erefProcessor,t.replies=!0,t.storage=Storage,StateToContent.call(this,t)};inherits(AnnotationsStateToContent,StateToContent),AnnotationsStateToContent.prototype._addReplyOrStore=nullFunction,AnnotationsStateToContent.prototype._createContent=function(t,e){var o=e[t.content.authorId];return o instanceof Author||(o=new Author(o)),t.author=o,new Comment(t)},AnnotationsStateToContent.prototype._getUpdatedProperties=function(t){var e=Storage.get(t.id);if(t.erefs||t.visibility===visEnums.NONE)return{lastVisibility:e.visibility,visibility:t.visibility};if(t.meta.event<e.meta.event&&!e.erefs)return{};var o=StateToContent.prototype._getUpdatedProperties.call(this,t);return t.blockId&&(o.blockId=t.blockId),t.parentId&&(o.parentId=t.parentId),t.selectedText&&(o.selectedText=t.selectedText),t.votes&&(o.votes=$.extend(t.votes,e.votes)),o.hasBeenRendered=e.hasBeenRendered,o.origin=e.origin,e.visibility!==t.visibility&&(o.lastVisibility=e.visibility),e.set(o),Storage.set(e.id,e),o},AnnotationsStateToContent.prototype._handleNonPublic=function(t){if(t.visibility===visEnums.GROUP)return t.body?[t]:void(this._erefProcessor&&this._erefProcessor.write(t.erefs));if(t.visibility===visEnums.OWNER){var e=auth.get("livefyre");if(e&&e.get("id")===t.author.id&&t.body)return[t];this._erefProcessor&&this._erefProcessor.write(t.erefs)}return t.visibility===visEnums.NONE?[t]:void 0},AnnotationsStateToContent.prototype.adaptPermalinkThread=function(t){return{blockId:t[BootstrapKeys.DATA][BootstrapKeys.META].blockId,comments:this.adaptThread(t,!0)}},AnnotationsStateToContent.prototype.adaptThread=function(t,e){t=t[BootstrapKeys.DATA];var o,n=[],i=t[BootstrapKeys.AUTHORS],r=[];t[BootstrapKeys.CONTENT]?r=t[BootstrapKeys.CONTENT]:t[BootstrapKeys.MESSAGES]&&(r=t[BootstrapKeys.MESSAGES]),r.sort(function(t){return t[BootstrapKeys.CONTENT][BootstrapKeys.PARENT_ID]?1:-1});var s=[],a=this;return $.each(r,function(t,r){if(e&&(r.origin=Comment.ORIGIN.BOOTSTRAP),o=a.transform(r,i,{replies:!0}),!(o=o?o[0]:null)||o.visibility===visEnums.NONE)return void s.push(r[BootstrapKeys.CONTENT][BootstrapKeys.ID]);o.parentId&&s.indexOf(o.parentId)>-1||n.push(o)}),n},AnnotationsStateToContent.prototype.updateAuthors=function(t){$.extend(this._authors,t)};var SCOPE_CHAIN=["collectionSettings","siteSettings","networkSettings"];adaptAvatar.IS_SECURE="https:"===location.protocol,module.exports={adaptPermalink:adaptPermalink,adaptSettings:adaptSettings,AnnotationsStateToContent:AnnotationsStateToContent,BootstrapKeys:BootstrapKeys,adaptAvatar:adaptAvatar}},{"../enums":133,"../models/author":154,"../models/comment":156,"../util/auth":192,"../util/internals":196,"../util/storage":204,"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/content/state-to-content":68,"./../../../node_modules/jquery/dist/jquery":96}],113:[function(_dereq_,module,exports){function addAnnotationInfo(n,t){n.blockId=t.blockId,n.selectedText=t.selectedText||null}function withAnnotations(n){n.added.annotation=addAnnotationInfo}var Annotator=_dereq_("./../../../lib/streamhub-sdk/src/content/annotator"),AnnotatorExtensions=_dereq_("./../../../lib/streamhub-sdk/src/content/annotator-extensions"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),CommentAnnotator=function(){Annotator.call(this),AnnotatorExtensions.withVotes(this),withAnnotations(this)};inherits(CommentAnnotator,Annotator),module.exports=CommentAnnotator},{"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/content/annotator":66,"./../../../lib/streamhub-sdk/src/content/annotator-extensions":65}],114:[function(_dereq_,module,exports){function BlockController(o){BaseController.call(this,o),this._elementIdToBlock={},this._blockCounts={},this._selectionPopover=null}var BaseController=(_dereq_("./../../../node_modules/jquery/dist/jquery"),_dereq_("../controller/base")),Block=_dereq_("../models/block"),BlockEvents=_dereq_("../events/events").block,BootstrapKeys=_dereq_("../adapters/adapters").BootstrapKeys,EventMap=_dereq_("./../../../lib/view/src/event-map"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),Storage=(_dereq_("../events/events").source,_dereq_("../util/storage")),ThreadEvents=_dereq_("../events/events").thread;inherits(BlockController,BaseController),BlockController.prototype.events=new EventMap(function(){var o={};return o[BlockEvents.UPDATE_COUNT]="_handleUpdateBlockCount",o}),BlockController.prototype._activateBlock=function(o){this.$antenna.trigger(ThreadEvents.ACTIVATE_THREAD),this._collection.block=o},BlockController.prototype._handleUpdateBlockCount=function(o,e){var t=Storage.get(e.blockId);t.updateNumAnnotations(e.inc,e.count);var n=this._blockCounts[t.id];n&&(n.num_annotations=t.numAnnotations),this.$antenna.trigger(BlockEvents.COUNT_UPDATED,{id:t.id,count:t.numAnnotations})},BlockController.prototype.updateManualBlock=function(o,e){var t=Storage.get(o);return t||(t=new Block,t.id=o,t.blockType=1,t.index=0),t.el=e,Storage.set(t.id,t),this._collection.block=t,t},BlockController.prototype.getBlockCount=function(o){var e=this._blockCounts[o];return e?e.num_annotations:0},BlockController.prototype.initializeBlocks=function(o,e){e()},BlockController.prototype.destroy=function(){BaseController.prototype.destroy.call(this),this._elementIdToBlock=null},BlockController.prototype.initialize=function(o){var e=o[BootstrapKeys.ANCHORS];e&&(this._blockCounts=e[BootstrapKeys.CONTENT])},module.exports=BlockController},{"../adapters/adapters":112,"../controller/base":127,"../events/events":134,"../models/block":155,"../util/storage":204,"./../../../lib/inherits/inherits.js":11,"./../../../lib/view/src/event-map":82,"./../../../node_modules/jquery/dist/jquery":96}],115:[function(_dereq_,module,exports){function BlockController(e){BaseController.call(this,e),this._blockIdToThreadBtn={},this._elementIdToBlock={},this._highlightedBlock=null,this._highlightedText=null,this._highlighter=new Highlighter(e.config.selectors,this.$antenna),this._initAnchorContent=null,this._selectionPopover=null}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),BaseController=_dereq_("../controller/base"),Block=_dereq_("../models/block"),BlockDetector=_dereq_("./detector"),BlockEvents=_dereq_("../events/events").block,BootstrapKeys=_dereq_("../adapters/adapters").BootstrapKeys,EventMap=_dereq_("./../../../lib/view/src/event-map"),Highlighter=_dereq_("./highlighter"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),NumComments=_dereq_("./ui/counter/numcomments"),SelectionPopover=_dereq_("./ui/selectionpopover"),SourceEvents=_dereq_("../events/events").source,Storage=_dereq_("../util/storage"),ThreadBtn=_dereq_("./ui/thread-btn"),ThreadEvents=_dereq_("../events/events").thread,UserAgentUtil=_dereq_("../util/useragent"),XRange=_dereq_("./../../../lib/xrange/src/xrange");inherits(BlockController,BaseController),BlockController.CLASSES={MOBILE_THREAD_BUTTON:"lf-mobile-thread-btn",THREAD_BUTTON:"lf-thread-btn"},BlockController.prototype.events=new EventMap(function(){var e={};return e[BlockEvents.UPDATE_COUNT]="_handleUpdateBlockCount",e[SourceEvents.ADD_ANNOTATION_CLICK]="_handleAddAnnotationClick",e[SourceEvents.TEXT_HIGHLIGHTED]="_handleTextHighlighted",e[SourceEvents.THREAD_BTN_CLICK]="_handleThreadBtnClick",e[ThreadEvents.ACTIVATE_BLOCK]="_handleActivateBlock",e[ThreadEvents.ACTIVATE_HIGHLIGHTED_TEXT]="_handleActivateHighlightedText",e[ThreadEvents.DEACTIVATE_HIGHLIGHTED_TEXT]="_handleDeactivateHighlightedText",UserAgentUtil.isMobile()&&(e[SourceEvents.TEXT_HIGHLIGHTED]="_handleTextHighlightedMobile"),e}),BlockController.prototype.globalEvents=new EventMap(function(){var e={};return e.mousedown="_handleDeactivateHighlightedText",e[SourceEvents.THREAD_BTN_CLICK]="_handleGlobalThreadBtnClick",e[ThreadEvents.DESTROY_THREAD]="_deactivateBlock",e}),BlockController.prototype._activateBlock=function(e){this.$antenna.trigger(ThreadEvents.ACTIVATE_THREAD),this._toggleThreadBtn(e,!0)},BlockController.prototype._deactivateBlock=function(){var e=this._getActiveBlock();e&&(this._collection.block=null,this._toggleThreadBtn(e,!1),this._unfreezeHighlight())},BlockController.prototype._freezeHighlight=function(){this._highlightedRange&&this._highlighter.freezeHighlight(this._highlightedRange,this._highlightedText)},BlockController.prototype._handleActivateBlock=function(e,t){this._toggleThreadBtn(t.block,!0)},BlockController.prototype._handleActivateHighlightedText=function(e,t){if(!this._highlightedRange){t=t||{};var o=t.blockId||this._collection.block.id,l=t.selectedText||this._collection.selectedText;this._setRangeForText(o,l)}},BlockController.prototype._handleAddAnnotationClick=function(e){this._deactivateBlock(),this._freezeHighlight();var t=this._collection.block=this._highlightedBlock;this._activateBlock(t)},BlockController.prototype._handleDeactivateHighlightedText=function(e){this._unfreezeHighlight()},BlockController.prototype._handleGlobalThreadBtnClick=BaseController.onlyHandleExternalMessage(BlockController.prototype._deactivateBlock),BlockController.prototype._handleTextHighlightedBase=function(e,t){var o=this._elementIdToBlock[t.blockId],l=this._highlightedRange=t.range;return this._collection.selectedText=this._highlightedText=t.text,this._highlightedBlock=o,l},BlockController.prototype._handleTextHighlighted=function(e,t){if(!this._highlightedRange){this._selectionPopover||(this._selectionPopover=new SelectionPopover({antenna:this.$antenna}));var o=this._handleTextHighlightedBase(e,t);this._selectionPopover.onHide($.proxy(function(){this._selectionPopover.show(o)},this))}},BlockController.prototype._handleTextHighlightedMobile=function(e,t){if(this._handleTextHighlightedBase(e,t),!this._collection.block){var o=this._elementIdToBlock[t.blockId];this._collection.block=o,this.$antenna.trigger(ThreadEvents.ACTIVATE_THREAD,{forceWriteCard:!0})}},BlockController.prototype._handleThreadBtnClick=function(e,t){e.preventDefault();var o=t.blockId;if(this._blockIdToThreadBtn[o].isActive())return void this.$antenna.trigger(ThreadEvents.DESTROY_THREAD);this._deactivateBlock();var l=this._elementIdToBlock[o];this._collection.block=l,this._collection.selectedText=null,this._activateBlock(l)},BlockController.prototype._handleUpdateBlockCount=function(e,t){var o=Storage.get(t.blockId),l=o.updateNumAnnotations(t.inc,t.count);this._numComments&&this._numComments.updateNumAnnotations(l)},BlockController.prototype._setRangeForText=function(e,t){var o=this._blockIdToThreadBtn[e].el.parentNode,l=XRange.getRangeByString(t,o);l&&(this._highlightedRange=l,this._highlightedText=t,this._freezeHighlight())},BlockController.prototype._setThreadBtns=function(e){var t,o=this;$.each(e,function(e,l){t=new ThreadBtn({antenna:o.$antenna,block:l,el:l.el.appendChild(document.createElement("span")),iconVisibility:o._config.iconVisibility,threadBtnDelegate:o._config.threadBtnDelegate});var i=BlockController.CLASSES,n=UserAgentUtil.isMobile()?i.MOBILE_THREAD_BUTTON:i.THREAD_BUTTON;t.render(),t.$el.addClass(n);var r=l.id;o._elementIdToBlock[r]=l,o._blockIdToThreadBtn[r]=t})},BlockController.prototype._toggleThreadBtn=function(e,t){this._blockIdToThreadBtn[e.getId()].setActiveState(t)},BlockController.prototype._unfreezeHighlight=function(){this._highlightedRange&&(this._highlighter.unfreezeHighlight(this._highlightedRange,this._highlightedText),this._highlightedRange=null,this._highlightedText=null)},BlockController.prototype._unwrapBlocks=function(){var e=this;$.each(this._elementIdToBlock,function(t,o){e._unwrapBlock(o)})},BlockController.prototype._unwrapBlock=function(e){var t=e.getId();this._blockIdToThreadBtn[t].destroy(),BlockDetector.unwrapBlock(e)},BlockController.prototype.unwrapBlockByElement=function(e){var t=e.getAttribute(Block.DATA_ID)||e.getAttribute(BlockDetector.CUSTOM_BLOCK_ID_ATTR)||e.getAttribute(BlockDetector.CUSTOM_BLOCK_ID_ATTR_BACKCOMPAT);t&&t in this._elementIdToBlock&&this._unwrapBlock(this._elementIdToBlock[t])},BlockController.prototype.destroy=function(){this._selectionPopover&&this._selectionPopover.destroy(),this._deactivateBlock(),this._unwrapBlocks(),this._elementIdToBlock=null,this._blockIdToThreadBtn=null,$("body").off("mousedown",$.proxy(this._handleDeactivateHighlightedText,this)),this.blockDetector&&this.blockDetector.destroy(),BaseController.prototype.destroy.call(this)},BlockController.prototype.initialize=function(e){var t=e[BootstrapKeys.ANCHORS],o=0,l=this._config.numSidenotesEl;t&&(this._initAnchorContent=t[BootstrapKeys.CONTENT],o=t[BootstrapKeys.NUM_VISIBLE]),l&&(this._numComments=this._numComments||new NumComments({numVisible:o}),this._numComments.decorate(l))},BlockController.prototype.initializeBlocks=function(e,t){this.blockDetector=new BlockDetector({content:this._initAnchorContent,selectors:e});var o=this;this.blockDetector.detect(function(e,l){if(e)throw e;o._setThreadBtns(l),t&&t()})},module.exports=BlockController},{"../adapters/adapters":112,"../controller/base":127,"../events/events":134,"../models/block":155,"../util/storage":204,"../util/useragent":206,"./../../../lib/inherits/inherits.js":11,"./../../../lib/view/src/event-map":82,"./../../../lib/xrange/src/xrange":90,"./../../../node_modules/jquery/dist/jquery":96,"./detector":116,"./highlighter":117,"./ui/counter/numcomments":118,"./ui/selectionpopover":120,"./ui/thread-btn":121}],116:[function(_dereq_,module,exports){function applyDisplay(t,e){var r=e.css("display");"inline"===r&&(r="inline-block"),t.css("display",r)}function applyPosition(t,e){var r="position",o=e.css(r);-1===["relative","absolute"].indexOf(o)&&(o="relative"),t.css(r,o),e.css(r,"relative")}function getBlockSet(t){return t.map(function(t,e){var r=new Block,o=BlockDetector.CLASSES,i=e instanceof $?e[0]:e,s=$(i),n=(s.attr(CUSTOM_BLOCK_TYPE_ATTR)||s.attr(CUSTOM_BLOCK_TYPE_ATTR_BACKCOMPAT)||"text").toUpperCase();if(isMedia(i)||n===Block.TYPES.MEDIA?(r.el=wrapMedia(i),r.blockType=Block.TYPES.MEDIA):(r.el=wrapElement(i),r.blockType=Block.TYPES[n],$(r.el).addClass(o[n])),r.el){if($(r.el).addClass(o.BLOCK),s.is("img")){r.blockType=Block.TYPES.IMAGE;var a=s.attr("src");return 0===a.indexOf("/")&&(a=locationUtil.getOrigin()+a),r.content=a,r}return r.content=s.text(),r}}).get()}function isMedia(t){return-1!==$.inArray(t.tagName,MEDIA_ELEMENTS)}function wrapElement(t){if("#text"!==t.nodeName)return $(t)[0];if(!t.nodeValue.trim().length)return null;var e=$(wrap.render({content:t.nodeValue}))[0];return t.parentNode.replaceChild(e,t),e}function wrapMedia(t){var e=$(t);e.attr(SAVED_STYLE_ATTR,e.attr("style"));var r,o=e.wrap(mediaWrapper.render()).parent();$.each(IMG_STYLE_ATTRS,function(t,i){r=e.css(t),o.css(t,r||i),e.css(t,"inherit"===i?r:i)}),applyDisplay(o,e),applyPosition(o,e);var i=BlockDetector.CLASSES,s=t.tagName===MEDIA_ELEMENTS[0]?i.IMAGE:i.VIDEO;return o.addClass(s),o[0]}function unwrapElement(t){var e=$(t);if("SPAN"===t.tagName)return void $(t.childNodes[0]).unwrap();$.each(BlockDetector.CLASSES,function(t,r){e.removeClass(r)}),e.removeAttr(Block.DATA_ID)}function unwrapMedia(t){var e=$(t).children();e.attr("style",e.attr(SAVED_STYLE_ATTR)||""),e.removeAttr(SAVED_STYLE_ATTR),e.unwrap()}function filterBlocks(t,e){return filter(t,function(t){return t.type===e})}function updateIndices(t,e,r){e in t?t[e]+=isNumber(r)?r:1:t[e]=0,t[e]<0&&delete t[e]}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Block=_dereq_("../models/block"),filter=_dereq_("./../../../lib/mout/src/array/filter"),isNumber=_dereq_("./../../../lib/mout/src/lang/isNumber"),KEYS=_dereq_("../adapters/adapters").BootstrapKeys,locationUtil=_dereq_("../util/location"),map=_dereq_("./../../../lib/mout/src/array/map"),mediaWrapper=_dereq_("../../templates/blocks/mediawrapper.mustache"),Promise=_dereq_("es6-promise").Promise,reduce=_dereq_("./../../../lib/mout/src/array/reduce"),SimhashLookup=_dereq_("../util/simhashlookup"),Storage=_dereq_("../util/storage"),wrap=_dereq_("../../templates/blocks/elementwrap.mustache"),BlockDetector=function(t){this._bootstrap=t.content||{},this._selectors=t.selectors,this._simhashLookup=new SimhashLookup(this._bootstrap)},BLOCK_MATCH_TYPE={CUSTOM:"custom",EXACT:"exact",NEW:"new",PARTIAL:"partial"},CUSTOM_BLOCK_TYPE_ATTR_BACKCOMPAT="data-lf-block-type",CUSTOM_BLOCK_TYPE_ATTR="data-lf-custom-anchor-type",IMG_STYLE_ATTRS={bottom:0,float:"none",left:0,margin:0,padding:0,right:0,top:0},MEDIA_ELEMENTS=["IMG"],MEDIA_TYPES=[Block.TYPES.IMAGE,Block.TYPES.MEDIA,Block.TYPES.VIDEO],SAVED_STYLE_ATTR="data-lf-saved-style";BlockDetector.CLASSES={BLOCK:"lf-block",IMAGE:"lf-image-block",MEDIA_WRAPPER:"lf-media-wrapper",RICH:"lf-rich-block",TEXT:"lf-text-block",VIDEO:"lf-video-block"},BlockDetector.SIMILARITY_THRESHOLD=.65,BlockDetector.prototype.buildBlockMap=function(t){return this._attachSimhashes(t).then(this._buildBlockMap.bind(this))},BlockDetector.prototype._attachSimhashes=function(t){var e=map(t,function(t){return this._simhashLookup.getSimhash(t.content).then(function(t,e){return t.$el=$(t.el),t.simhash=e,t}.bind(null,t))},this);return Promise.all(e).then(function(){return t})},BlockDetector.prototype._buildBlockMap=function(t){var e={},r={},o=this,i=function(t,r){t in e?e[t].push(r):e[t]=[r]};return reduce(t,function(t,e){var s=e.$el.attr("data-lf-custom-anchor-id")||e.$el.attr("data-lf-block-id");return s?t.then(function(){return updateIndices(r,e.simhash),e.type=BLOCK_MATCH_TYPE.CUSTOM,e.customId=s,i(s,e),e}):t.then(function(){return o._getBlockId(e,0,!1).then(function(t,e){return updateIndices(r,t.simhash),e.type===BLOCK_MATCH_TYPE.PARTIAL?(updateIndices(r,t.partialSimhash),updateIndices(r,t.simhash,-1),i(t.partialSimhash,t)):i(t.simhash,t),t}.bind(null,e))})},Promise.resolve()).then(function(){return e})},BlockDetector.prototype._buildBsMap=function(){var t,e,r={};for(t in this._bootstrap)this._bootstrap.hasOwnProperty(t)&&(e=t.split(":")[0],void 0===r[e]&&(r[e]=0),r[e]+=1);return r},BlockDetector.prototype._getBlockId=function(t,e,r){t.index=e;var o={type:BLOCK_MATCH_TYPE.EXACT};return(o.blockId=this._simhashLookup.getBlockId(t.simhash,e))?(t.type=o.type,Promise.resolve(o)):this._simhashLookup.getBlockIdWithThreshold(t.simhash,e,BlockDetector.SIMILARITY_THRESHOLD).then(function(e){return o.blockId=e,e&&!r?(t.type=o.type=BLOCK_MATCH_TYPE.PARTIAL,t.partialSimhash=e.split(":")[0]):t.type=o.type=BLOCK_MATCH_TYPE.NEW,o})},BlockDetector.prototype._processBlocks=function(t,e,r){var o={},i=this;return reduce(t,function(t,e){return e.type===BLOCK_MATCH_TYPE.CUSTOM?t.then(function(){var t=r?e.simhash:t;return updateIndices(o,t),e.index=o[t],e.generatedId=e.id=e.customId,Storage.set(e.generatedId,e),e.$el.attr(Block.DATA_ID,e.id),e}):t.then(function(){var t=r?e.simhash:t;return updateIndices(o,t),i._getBlockId(e,o[t],r).then(function(t){switch(t.type){case BLOCK_MATCH_TYPE.NEW:e.generatedId=e.id=e.simhash+":"+e.index,Storage.set(e.generatedId,e),e.$el.attr(Block.DATA_ID,e.id);break;default:var r=t.blockId;e.index=i._bootstrap[r][KEYS.HINTS][KEYS.INDEX],e.id=r,e.numAnnotations=i._bootstrap[r][KEYS.NUM_ANNOTATIONS],Storage.set(e.id,e),e.$el.attr(Block.DATA_ID,e.id)}return e})})},Promise.resolve())},BlockDetector.prototype.detect=function(t){var e=getBlockSet(this._selectors);if(0===e.length)return t(null,[]);var r=[];this.buildBlockMap(e).then(function(o){var i,s,n,a,l,c,u,p=this._buildBsMap(),T=0;for(u in o)o.hasOwnProperty(u)&&(i=o[u],s=filterBlocks(i,BLOCK_MATCH_TYPE.CUSTOM),s.length!==i.length?(n=filterBlocks(i,BLOCK_MATCH_TYPE.EXACT),T=n.length,l=p[u]||0,i.length<=l?r.push(this._processBlocks(i,u)):T>0&&T===l?(a=filterBlocks(i,BLOCK_MATCH_TYPE.NEW),c=filterBlocks(i,BLOCK_MATCH_TYPE.PARTIAL),r.push(this._processBlocks(n,u)),r.push(this._processBlocks(c,u,!0)),r.push(this._processBlocks(a,u,!0))):T<l?r.push(this._processBlocks(i,u)):r.push(this._processBlocks(i,u,!0))):r.push(this._processBlocks(i,u)));Promise.all(r).then(function(){t(null,e)})}.bind(this)).catch(function(e){t(e)})},BlockDetector.prototype.destroy=function(){this._simhashLookup.destroy(),this._simhashLookup=null,this._selectors=this._bootstrap=null},BlockDetector.unwrapBlock=function(t){if(MEDIA_TYPES.indexOf(t.blockType)>-1)return void unwrapMedia(t.el);unwrapElement(t.el)},module.exports=BlockDetector,module.exports.CUSTOM_BLOCK_ID_ATTR="data-lf-custom-anchor-id",module.exports.CUSTOM_BLOCK_ID_ATTR_BACKCOMPAT="data-lf-block-id"},{"../../templates/blocks/elementwrap.mustache":207,"../../templates/blocks/mediawrapper.mustache":209,"../adapters/adapters":112,"../models/block":155,"../util/location":197,"../util/simhashlookup":201,"../util/storage":204,"./../../../lib/mout/src/array/filter":21,"./../../../lib/mout/src/array/map":22,"./../../../lib/mout/src/array/reduce":23,"./../../../lib/mout/src/lang/isNumber":34,"./../../../node_modules/jquery/dist/jquery":96,"es6-promise":91}],117:[function(_dereq_,module,exports){function Highlighter(e,t){this._sourceElements=e,this.$antenna=t,this.delegateEvents(),this._highlighter=new XHighlighter({className:Highlighter.CLASSES.HIGHLIGHTED_TEXT}),EventEmitter.call(this)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Block=_dereq_("../models/block"),BlockDetector=_dereq_("./detector"),debounce=_dereq_("../util/internals").debounce,EventEmitter=_dereq_("./../../../lib/event-emitter/src/event-emitter"),highlighterTemplate=_dereq_("../../templates/blocks/highlight.mustache"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),SourceEvents=_dereq_("../events/events").source,UserAgentUtil=_dereq_("../util/useragent"),XHighlighter=_dereq_("./../../../lib/xrange/src/highlighter"),XRange=_dereq_("./../../../lib/xrange/src/xrange");inherits(Highlighter,EventEmitter),Highlighter.mouseEvents="mouseup.Highlighter",Highlighter.keyboardEvents="keyup.Highlighter",Highlighter.touchEvents="tapend.Highlighter",Highlighter.prototype.events=null,Highlighter.prototype.template=highlighterTemplate.render.bind(highlighterTemplate),Highlighter.CLASSES={HIGHLIGHTED_TEXT:"lf-highlight-text",MOBILE_THREAD_BUTTON:"lf-mobile-thread-btn",THREAD_BUTTON:"lf-thread-btn"},Highlighter.prototype._handleTextHighlighted=function(){var e=new XRange,t=Highlighter.CLASSES,i={range:e,text:e.toHtmlString()},h=e.getEndNode();if(!(i.text.indexOf(t.THREAD_BUTTON)>-1||i.text.indexOf(t.MOBILE_THREAD_BUTTON)>-1||$(h).hasClass(BlockDetector.CLASSES.BLOCK))){var r=e.getParentNode();if(r){var g=$(r).closest("."+BlockDetector.CLASSES.TEXT);i.blockId=g.attr(Block.DATA_ID),this.$antenna.trigger(SourceEvents.TEXT_HIGHLIGHTED,i)}}},Highlighter.prototype.delegateEvents=function(){var e=UserAgentUtil.isMobile();this.events=e?Highlighter.touchEvents:Highlighter.mouseEvents,this.undelegateEvents();var t=$.proxy(this._handleTextHighlighted,this);this._sourceElements.on(this.events,t),e?$(document).on("selectionchange.Highlighter",debounce(t,400,!0)):$("body").on(Highlighter.keyboardEvents,t)},Highlighter.prototype.destroy=function(){this.undelegateEvents(),this._sourceElements=null,this._highlighter=null},Highlighter.prototype.freezeHighlight=function(e,t){this._highlighter.highlight(e)},Highlighter.prototype.undelegateEvents=function(){this._sourceElements.off(this.events),$(document).off("selectionchange.Highlighter"),$("body").off(Highlighter.mouseEvents)},Highlighter.prototype.unfreezeHighlight=function(e,t){this._highlighter.unhighlight(e)},module.exports=Highlighter},{"../../templates/blocks/highlight.mustache":208,"../events/events":134,"../models/block":155,"../util/internals":196,"../util/useragent":206,"./../../../lib/event-emitter/src/event-emitter":10,"./../../../lib/inherits/inherits.js":11,"./../../../lib/xrange/src/highlighter":85,"./../../../lib/xrange/src/xrange":90,"./../../../node_modules/jquery/dist/jquery":96,"./detector":116}],118:[function(_dereq_,module,exports){function NumComments(e){e=e||{},View.call(this,e),this._commentCount=e.numVisible||0,this._questionPopover}var inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),QuestionPopover=_dereq_("./questionpopover"),numCommentsTemplate=_dereq_("../../../../templates/blocks/numcomments.mustache"),textEnumeration=_dereq_("../../..//i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,UserAgentUtil=_dereq_("../../../util/useragent"),View=_dereq_("./../../../../../lib/view/src/view.js"),viewEnum=_dereq_("../../../enums").navigableViews;inherits(NumComments,View),NumComments.CLASSES={MAIN:"lf-num-sidenotes"},NumComments.prototype._handleClick=function(){this._questionPopover||(this._questionPopover=new QuestionPopover,this._questionPopover.render()),this._questionPopover.isShowing()||this._questionPopover.isVisible()||this._questionPopover.show(this.el)},NumComments.prototype._handleTouch=function(){this.$el.trigger(ThreadEvents.CHANGE_VIEW,{value:viewEnum.QUESTION})},NumComments.prototype.decorate=function(e){this.render(),e.appendChild(this.el)},NumComments.prototype.destroy=function(){View.prototype.destroy.call(this),this._questionPopover&&this._questionPopover.destroy(),this._questionPopover=null,this._commentCount=null},NumComments.prototype.elClass=NumComments.CLASSES.MAIN,NumComments.prototype.events=function(){var e={};return UserAgentUtil.isMobile()?e.tap="_handleTouch":e.click="_handleClick",e}(),NumComments.prototype.getTemplateContext=function(){return{commentCount:this._commentCount,strings:{appName:textEnumeration.get(textEnumeration.KEYS.APP_NAME)}}},NumComments.prototype.template=numCommentsTemplate.render.bind(numCommentsTemplate),NumComments.prototype.updateNumAnnotations=function(e){this._commentCount+=e,this.render()},module.exports=NumComments},{"../../../../templates/blocks/numcomments.mustache":210,"../../..//i18n/enumeration":135,"../../../enums":133,"../../../events/events":134,"../../../util/useragent":206,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83,"./questionpopover":119}],119:[function(_dereq_,module,exports){function QuestionPopover(t){Popover.call(this,$.extend({sidePadding:10,topSpacing:10},t)),this._height,this._width,this._position=Popover.POSITIONS.SMART}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),contentTemplate=_dereq_("../../../../templates/blocks/questionpopover.mustache"),domUtil=_dereq_("../../../util/dom"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),internals=_dereq_("../../../util/internals"),Popover=_dereq_("../../../ui/popover"),textEnumeration=_dereq_("../../../i18n/enumeration");inherits(QuestionPopover,Popover),QuestionPopover.CLASSES={EXPLANATION:"lf-explanation-text",TITLE:"lf-title-text",MAIN:"lf-question-popover"},$.extend(QuestionPopover.CLASSES,Popover.CLASSES),QuestionPopover.prototype._handleClick=function(t){t.stopPropagation()},QuestionPopover.prototype._getBottomPosition=function(t){return this._activePosition=Popover.POSITIONS.BOTTOM,{top:this._boundingRect.bottom+domUtil.getScrollY()+10,left:this._boundingRect.left+domUtil.getScrollX()+this._boundingRect.width/2-this._width/2}},QuestionPopover.prototype._getContentTemplateContext=function(){var t=textEnumeration.KEYS;return{strings:{explanation:textEnumeration.get(t.QUESTION_EXPLANATION),mockText:textEnumeration.get(t.QUESTION_MOCK_TEXT),title:textEnumeration.get(t.QUESTION_TITLE)}}},QuestionPopover.prototype._getRightPosition=function(t){return this._activePosition=Popover.POSITIONS.RIGHT,{top:this._boundingRect.top+domUtil.getScrollY()+this._boundingRect.height/2-this._height/2,left:this._boundingRect.right+domUtil.getScrollX()+10}},QuestionPopover.prototype._scrollIntoPosition=internals.nullFunction,QuestionPopover.prototype._getSmartPosition=function(t){if(this._boundingRect=domUtil.getBoundingClientRect(t),!this._height){var o=domUtil.getBoundingClientRect(this.el);this._height=o.height,this._width=o.width}var e=this._getRightPosition(t);return e.top<0?this._getBottomPosition(t):(this._boundingRect=null,e)},QuestionPopover.prototype.events=function(){var t={};return $.extend(t,Popover.prototype.events),t.click="_handleClick",t}(),QuestionPopover.prototype.destroy=function(){$(document.body).off("mousedown.QuestionPopover",$.proxy(this.hide,this)),Popover.prototype.destroy.call(this)},QuestionPopover.prototype.elClass=[Popover.CLASSES.BASE,QuestionPopover.CLASSES.MAIN].join(" "),QuestionPopover.prototype.hideInternal=function(t){$(document.body).off("mousedown.QuestionPopover",$.proxy(this.hide,this)),Popover.prototype.hideInternal.call(this,t)},QuestionPopover.prototype.render=function(){Popover.prototype.render.call(this),this.setContentNode($(contentTemplate.render(this._getContentTemplateContext())))},QuestionPopover.prototype.show=function(t,o){var e=$.proxy(this.hide,this);Popover.prototype.show.call(this,t,function(){$(document.body).one("mousedown.QuestionPopover",e),o&&o()})},module.exports=QuestionPopover},{"../../../../templates/blocks/questionpopover.mustache":211,"../../../i18n/enumeration":135,"../../../ui/popover":189,"../../../util/dom":194,"../../../util/internals":196,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96}],120:[function(_dereq_,module,exports){var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),actionsTemplate=_dereq_("../../../templates/blocks/selectionpopover.mustache"),domUtil=_dereq_("../../util/dom"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),Popover=_dereq_("../../ui/popover"),SourceEvents=_dereq_("../../events/events").source,SelectionPopover=function(e){Popover.call(this,e),this.$antenna=e.antenna};inherits(SelectionPopover,Popover),SelectionPopover.CLASSES={ADD_ANNOTATION:"lf-add-annotation",MAIN:"lf-selection-popover",SHARE_FACEBOOK:"lf-share-facebook",SHARE_TWITTER:"lf-share-twitter"},SelectionPopover.EVENT_MAP={annotation:SourceEvents.ADD_ANNOTATION_CLICK,facebook:SourceEvents.SHARE_CLICK,twitter:SourceEvents.SHARE_CLICK},SelectionPopover.prototype.elClass=[Popover.prototype.elClass,SelectionPopover.CLASSES.MAIN].join(" "),SelectionPopover.prototype._handlePress=function(e){if(13===e.which||"keyup"!==e.type){Popover.prototype._handlePress.call(this,e);var o=$(e.target).attr("data-value");o&&(this.$antenna.trigger(SelectionPopover.EVENT_MAP[o],{value:o}),this.hide())}},SelectionPopover.prototype.destroy=function(){$(document.body).off("mousedown.SelectionPopover",$.proxy(this.hide,this,null)),Popover.prototype.destroy.call(this)},SelectionPopover.prototype.hideInternal=function(e){$(document.body).off("mousedown.SelectionPopover",$.proxy(this.hide,this,null)),Popover.prototype.hideInternal.call(this,e)},SelectionPopover.prototype.render=function(){Popover.prototype.render.call(this),this.setContentNode($(actionsTemplate.render()))},SelectionPopover.prototype.resizeAndReposition=function(e){var o=domUtil.getBoundingClientRect(e),t=o.top+domUtil.getScrollY()-this.$el.height(),r=o.width/2,i=this.$el.width()/2,n=r+domUtil.getScrollX()+o.left-i;this.$el.css({top:t,left:n})},SelectionPopover.prototype.show=function(e){var o=$.proxy(this.hide,this,null);Popover.prototype.show.call(this,e,function(){$(document.body).one("mousedown.SelectionPopover",o)}),this.$el.focus()},module.exports=SelectionPopover},{"../../../templates/blocks/selectionpopover.mustache":212,"../../events/events":134,"../../ui/popover":189,"../../util/dom":194,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96}],121:[function(_dereq_,module,exports){function ThreadBtn(t){View.call(this,t),this._active=!1,this._block=t.block,this._threadBtnDelegate=t.threadBtnDelegate,this.$antenna=t.antenna,Observer(this),this.listenTo(this._block,"change:numAnnotations",$.proxy(this.render,this))}
var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),Block=_dereq_("../../models/block"),EventMap=_dereq_("./../../../../lib/view/src/event-map"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),Observer=_dereq_("./../../../../lib/observer/src/observer.js"),SourceEvents=_dereq_("../../events/events").source,textEnumeration=_dereq_("../../i18n/enumeration"),threadBtnTemplate=_dereq_("../../../templates/blocks/thread-btn.mustache"),UserAgentUtil=_dereq_("../../util/useragent"),View=_dereq_("./../../../../lib/view/src/view.js");inherits(ThreadBtn,View),ThreadBtn.CLASSES={ACTIVE:"lf-active",BUTTON:"fycon-action-view",CUSTOM_BTN:"lf-custom-thread-btn",HAS_NUM:"lf-has-num",HOVER:"lf-thread-vis-hover"};var ICON_VIS={HOVER:"hover",STATIC:"static"};ThreadBtn.prototype.template=threadBtnTemplate.render.bind(threadBtnTemplate),ThreadBtn.prototype.events=new EventMap(function(){var t=ThreadBtn.CLASSES,e={};return UserAgentUtil.isMobile()?(e["tap ."+t.BUTTON]="_handleThreadBtnClick",e["mousedown ."+t.BUTTON]="_handleClearMobileMousedown",e["tapstart ."+t.BUTTON]="_handleThreadBtnMousedown"):(e["click ."+t.BUTTON]="_handleThreadBtnClick",e["keyup ."+t.BUTTON]="_handleThreadEnter",e["mousedown ."+t.BUTTON]="_handleThreadBtnMousedown"),e}),ThreadBtn.prototype._handleClearMobileMousedown=function(t){t.stopPropagation()},ThreadBtn.prototype._handleThreadEnter=function(t){t.stopPropagation(),13===t.which&&"keyup"===t.type&&this.$antenna.trigger(SourceEvents.THREAD_BTN_CLICK,{blockId:this._block.id})},ThreadBtn.prototype._handleThreadBtnClick=function(t){t.stopPropagation(),this.$antenna.trigger(SourceEvents.THREAD_BTN_CLICK,{blockId:this._block.id})},ThreadBtn.prototype._handleThreadBtnMousedown=function(t){t.stopPropagation(),this.$antenna.trigger(SourceEvents.THREAD_BTN_MOUSEDOWN,{blockId:this._block.id})},ThreadBtn.prototype._isMedia=function(){return[Block.TYPES.MEDIA,Block.TYPES.IMAGE].indexOf(this._block.blockType)>-1},ThreadBtn.prototype.destroy=function(){View.prototype.destroy.call(this),this.stopListening()},ThreadBtn.prototype.getTemplateContext=function(){var t=textEnumeration.KEYS;return{active:this._active,blockType:this._block.blockType,count:Math.max(this._block.numAnnotations||0,0),isMedia:this._isMedia(),strings:{emptyImageBlockTxt:textEnumeration.get(t.EMPTY_IMAGE_BLOCK_TXT),emptyTextBlockTxt:textEnumeration.get(t.EMPTY_TEXT_BLOCK_TXT)}}},ThreadBtn.prototype.isActive=function(){return this._active},ThreadBtn.prototype.render=function(){var t=ThreadBtn.CLASSES,e=!1;if(this._threadBtnDelegate){var n=this._threadBtnDelegate(this.getTemplateContext());n&&(n="string"==typeof n?$(n)[0]:n,this.$el.html("").append(n).addClass(t.CUSTOM_BTN),e=!0)}e||View.prototype.render.call(this);var i=Math.max(this._block.numAnnotations||0,0)>0,r=this.opts.iconVisibility.empty===ICON_VIS.HOVER,o=this.opts.iconVisibility.num===ICON_VIS.HOVER&&i;this.$("."+t.BUTTON).attr(Block.DATA_ID,this._block.id),this.$el.toggleClass(t.HAS_NUM,i),this.$el.toggleClass(t.HOVER,o||r&&!i)},ThreadBtn.prototype.setActiveState=function(t){this._active=t,this.$el.toggleClass(ThreadBtn.CLASSES.ACTIVE,t)},module.exports=ThreadBtn},{"../../../templates/blocks/thread-btn.mustache":214,"../../events/events":134,"../../i18n/enumeration":135,"../../models/block":155,"../../util/useragent":206,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/observer/src/observer.js":42,"./../../../../lib/view/src/event-map":82,"./../../../../lib/view/src/view.js":83,"./../../../../node_modules/jquery/dist/jquery":96}],122:[function(_dereq_,module,exports){function AnnotationsCollection(t){this.protocol=t.protocol,this.block=null,this.config=null,this.selectedText=null;var e=this._erefProcessor=new ErefProcessor;this._annotationsSTC=new Adapters.AnnotationsStateToContent({erefProcessor:e}),Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this.processStoredErefs,this)),this.listenTo(auth,"logout",function(){e.setKeys([])}),this.listenTo(e,"data",$.proxy(this.fetchErefs,this)),t.bootstrapClient=this._getClient("bootstrap"),t.maxInitAttempts=10,Collection.call(this,t)}function getDefaultHandler(t,e){return function(o,n){var i=this._getClient(t),r=this._getBaseOpts();$.extend(r,o),i[e].call(i,r,getMediatedCallback(n))}}function getMediatedCallback(t){return function(e,o){e||200===o.code||(e=o.error_type),t(e,o)}}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Adapters=_dereq_("../adapters/adapters"),AnnotationsHttpClient=_dereq_("./annotationshttpclient"),auth=_dereq_("../util/auth"),BootstrapKeys=_dereq_("../adapters/adapters").BootstrapKeys,Collection=_dereq_("./../../../lib/streamhub-sdk/src/collection/main"),CommentAnnotator=_dereq_("../adapters/commentannotator"),ErefProcessor=_dereq_("./../../../lib/eref-js/src/erefprocessor"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),memoize=_dereq_("../util/internals").memoize,Observer=_dereq_("./../../../lib/observer/src/observer.js"),permissions=_dereq_("./../../../lib/livefyre-auth/src/permissions"),Storage=_dereq_("../util/storage");inherits(AnnotationsCollection,Collection),AnnotationsCollection.prototype._handleInitComplete=function(t,e){e&&Adapters.adaptSettings(this,e),Collection.prototype._handleInitComplete.call(this,t,e);var o=e.headDocument&&e.headDocument.event;o=o||e.collectionSettings&&e.collectionSettings.event,this._updater&&(this._updater._latestEvent=o||1),this.processStoredErefs()},AnnotationsCollection.prototype.createUpdater=function(t){t=t||{};var e,o=this;return t.createStateToContent=function(t){return t&&t.authors&&o._annotationsSTC.updateAuthors(t.authors),o._annotationsSTC},t.createAnnotator=function(){return new CommentAnnotator},e=Collection.prototype.createUpdater.call(this,t),e.on("error",function(t){}),e},AnnotationsCollection.prototype._getBaseOpts=function(){var t=auth.get("livefyre");return{network:this.network,environment:this.environment,collectionId:this.id,lftoken:t?t.get("token"):""}},AnnotationsCollection.prototype._getClient=function(t){return new AnnotationsHttpClient({serviceName:t})},AnnotationsCollection.prototype.destroy=function(){Collection.prototype.pause.call(this),this.stopListening(),this._annotationsSTC=null,this._erefProcessor=null,this._handleUpdate=null,this._updater=null},AnnotationsCollection.prototype.fetchErefs=function(t,e){var o=this._getClient("bootstrap"),n=this,i=this._getBaseOpts();$.extend(i,{refs:t}),o.fetchErefs(i,getMediatedCallback(function(t,o){if(t)return void(e&&e(t));var i,r=n._annotationsSTC.adaptThread(o),s=[];$.each(r,function(t,e){!(i=e.erefs)||$.isArray(i)&&!i.length||s.push(i)}),n._erefProcessor.handleDecrypted(s),n.push.apply(n,r),e&&e(t,r)}))},AnnotationsCollection.prototype.fetchThread=function(t,e){var o=this._getClient("bootstrap"),n=this._getBaseOpts(),i=this;n.blockId=t,o.getAnnotations(n,getMediatedCallback(function(o,n){if(n){var r=Storage.get(t);r&&r.setFetchedState(!0),e(o,i._annotationsSTC.adaptThread(n,!0))}}))},AnnotationsCollection.prototype.generateAdminUrl=function(){var t=this._getClient("admin"),e=this._getBaseOpts(),o=auth.get("livefyre");return[t.getUrlBase(e),"/admin/content?lftoken=",o?o.get("token"):""].join("")},AnnotationsCollection.prototype.getPermalink=function(t,e){var o=this._getClient("bootstrap"),n=this._getBaseOpts();$.extend(n,t),o.getPermalink(n,getMediatedCallback(function(t,o){e(t,Adapters.adaptPermalink(o))}))},AnnotationsCollection.prototype.getThread=function(t,e){var o=this._getClient("bootstrap"),n=this._getBaseOpts(),i=this;$.extend(n,t),o.getThread(n,getMediatedCallback(function(t,o){if(!t){var n=i._annotationsSTC.adaptPermalinkThread(o);e(t,n.blockId,n.comments)}}))},AnnotationsCollection.prototype.isCustomNetwork=memoize(function(){return!!this.network.match(/fyre\.co$/)}),AnnotationsCollection.prototype.postAnnotation=function(t,e){var o=this._getClient("quill"),n=this._getBaseOpts(),i=this;$.extend(n,t),n.postData.lftoken=n.lftoken,o.postAnnotation(n,getMediatedCallback(function(t,o){if(t)return void e(t);e(t,i._annotationsSTC.adaptThread(o))}))},AnnotationsCollection.prototype.postApprove=getDefaultHandler("quill","postApprove"),AnnotationsCollection.prototype.postDelete=getDefaultHandler("quill","postDelete"),AnnotationsCollection.prototype.postEdit=getDefaultHandler("quill","postEdit"),AnnotationsCollection.prototype.postFlag=getDefaultHandler("quill","postFlag"),AnnotationsCollection.prototype.postHide=getDefaultHandler("quill","postHide"),AnnotationsCollection.prototype.postVote=function(t,e){var o=this._getClient("quill"),n=this._getBaseOpts();$.extend(n,t),o.postVote(n,getMediatedCallback(function(t,o){if(t)return void e(t);o=o[BootstrapKeys.DATA],e(t,o)}))},AnnotationsCollection.prototype.processStoredErefs=function(){var t=this,e=auth.get("livefyre");this.id&&e&&permissions.getKeys(e,this,function(e,o){t._erefProcessor.setKeys(o||[]),t._erefProcessor.processStorage()})},module.exports=AnnotationsCollection},{"../adapters/adapters":112,"../adapters/commentannotator":113,"../util/auth":192,"../util/internals":196,"../util/storage":204,"./../../../lib/eref-js/src/erefprocessor":8,"./../../../lib/inherits/inherits.js":11,"./../../../lib/livefyre-auth/src/permissions":15,"./../../../lib/observer/src/observer.js":42,"./../../../lib/streamhub-sdk/src/collection/main":60,"./../../../node_modules/jquery/dist/jquery":96,"./annotationshttpclient":123}],123:[function(_dereq_,module,exports){function AnnotationsHttpClient(t){LivefyreHttpClient.call(this,t)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),base64=_dereq_("./../../../lib/base64/base64"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),LivefyreHttpClient=_dereq_("./../../../lib/streamhub-sdk/src/collection/clients/http-client");inherits(AnnotationsHttpClient,LivefyreHttpClient),AnnotationsHttpClient.prototype._getCollectionUrl=function(t,e){return[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId].join("")+e},AnnotationsHttpClient.prototype._getContentUrl=function(t,e){return[this._getUrlBase(t),"/api/v3.0/content"].join("")+e},AnnotationsHttpClient.prototype._getMessageUrl=function(t,e){return[this._getUrlBase(t),"/api/v3.0/message/",t.messageId].join("")+e},AnnotationsHttpClient.prototype.getUrlBase=function(t){return this._getUrlBase(t)},AnnotationsHttpClient.prototype.getAnnotations=function(t,e){this._request({url:this._getCollectionUrl(t,"/annotation/"+t.blockId+"/")},e)},AnnotationsHttpClient.prototype.getContent=function(t,e){t=t||{},e=e||function(){};var n=t.environment=t.environment||"livefyre.com",o="livefyre.com"!==n&&"fyre"!==n&&"fy.re"!==n,i=[this._getUrlBase(t),"/bs3/v3.1/",o?t.environment+"/":"",t.network,"/",t.siteId,"/",base64.btoa(t.articleId.toString()),"/",void 0!==t.page?t.page+".json":"init"].join("");this._request({url:i},e)},AnnotationsHttpClient.prototype.getPermalink=function(t,e){this._request({data:{collection_id:t.collectionId},url:this._getMessageUrl(t,"/permalink/")},e)},AnnotationsHttpClient.prototype.getThread=function(t,e){this._request({data:{collection_id:t.collectionId,content_id:t.contentId},url:this._getContentUrl(t,"/thread/")},e)},AnnotationsHttpClient.prototype.postAnnotation=function(t,e){this._request({method:"POST",url:this._getCollectionUrl(t,"/post/annotation/"),data:t.postData},e)},AnnotationsHttpClient.prototype.postApprove=function(t,e){this._request({method:"POST",url:this._getMessageUrl(t,"/approve/"),data:{lftoken:t.lftoken,collection_id:t.collectionId}},e)},AnnotationsHttpClient.prototype.postDelete=function(t,e){this._request({method:"POST",url:this._getMessageUrl(t,"/delete/"),data:{lftoken:t.lftoken,collection_id:t.collectionId}},e)},AnnotationsHttpClient.prototype.postEdit=function(t,e){this._request({method:"POST",url:this._getMessageUrl(t,t.model.id+"/edit/"),data:{body:t.body,lftoken:t.lftoken,collection_id:t.collectionId}},e)},AnnotationsHttpClient.prototype.postFlag=function(t,e){this._request({method:"POST",url:this._getMessageUrl(t,"/flag/"+t.value+"/"),data:{lftoken:t.lftoken,collection_id:t.collectionId}},e)},AnnotationsHttpClient.prototype.postHide=function(t,e){this._request({method:"POST",url:this._getMessageUrl(t,"/hide/"),data:{lftoken:t.lftoken,collection_id:t.collectionId}},e)},AnnotationsHttpClient.prototype.postVote=function(t,e){var n={lftoken:t.lftoken,collection_id:t.collectionId,message_id:t.messageId,value:t.value};this._request({method:"POST",url:this._getMessageUrl(t,"/vote/"),data:n},e)},AnnotationsHttpClient.prototype.fetchErefs=function(t,e){e=e||function(){};var n=[this._getUrlBase(t),"/api/v3.0/collection/",t.collectionId,"/erefs/"].join("");this._request({url:n,data:$.param({ref:t.refs,expanded:1},!0)},e)},module.exports=AnnotationsHttpClient},{"./../../../lib/base64/base64":5,"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/collection/clients/http-client":56,"./../../../node_modules/jquery/dist/jquery":96}],124:[function(_dereq_,module,exports){function LivefyreTranslationClient(e){e=e||{},this._version=e.version||"v4",LivefyreHttpClient.call(this,e)}function isLocaldev(e){return"fyre"===e||"fy.re"===e}var inherits=_dereq_("./../../../lib/inherits/inherits.js"),LivefyreHttpClient=_dereq_("./../../../lib/streamhub-sdk/src/collection/clients/http-client");inherits(LivefyreTranslationClient,LivefyreHttpClient),LivefyreTranslationClient.prototype._serviceName="bootstrap",LivefyreTranslationClient.prototype._getHost=function(e){var t=e.environment||"livefyre.com",i="bootstrap."+t;return isLocaldev(t)&&(i="bsserver."+t),i},LivefyreTranslationClient.prototype.getTranslations=function(e,t){e=e||{},t=t||function(){};var i=this._getUrlBase(e)+"/api/"+this._version+"/configuration/"+e.network+"/site/"+e.siteId+"/",n={data:{section:"translations","translations.lang_code":e.language||window.navigator.language},url:i};e.appType&&(n.data["translations.app"]=e.appType),this._request(n,t)},module.exports=LivefyreTranslationClient},{"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/collection/clients/http-client":56}],125:[function(_dereq_,module,exports){function parseIconVisibility(e){function t(e){if(-1===$.inArray(e,SUPPORTED_VISIBILITY))throw new TypeError(ERRORS.SUPPORTED_VISIBILITY+SUPPORTED_VISIBILITY.join(", "))}if(!e)return{empty:"static",num:"static"};var r=e;return"string"==typeof e&&(r={empty:e,num:e}),t(r.empty),t(r.num),r}function throwErr(e){throw new TypeError([e,ERRORS.MISSING].join(" "))}var $=_dereq_("./../../node_modules/jquery/dist/jquery"),ASSET_SERVER="//cdn.livefyre.com/libs/sidenotes/v1.6.1",auth=_dereq_("./util/auth"),CDN="//cdn.livefyre.com",authAdapter=_dereq_("./../../lib/livefyre-auth/src/auth-adapters"),base64=_dereq_("./../../lib/base64/base64"),selectorUtil=_dereq_("./util/selector"),styleUtil=_dereq_("./util/style"),textEnumeration=_dereq_("./i18n/enumeration"),UserAgentUtil=_dereq_("./util/useragent"),CUSTOM_ICON_CFG={height:12,marginLeft:6,marginRight:2,marginTop:1,width:12},ERRORS={ARTICLE_ID:"articleId should be in collectionMeta or configuration",AUTH:"auth",COLLECTION_META:"collectionMeta",DELEGATE:"auth delegate",META:"The signed collectionMeta is not a properly formed JWT",META_PARSE:"collectionMeta does not parse properly",MISSING:"missing from Annotations App config",SELECTOR:"selectors string, object, or element(s)",SITE_ID:"siteId should be in collectionMeta or configuration",SUPPORTED_POSITION:"invalid placement, supported placements are: ",SUPPORTED_VISIBILITY:"invalid icon visibility, supported visibilities are: "},SUPPORTED_POSITION=["smart","left","right","bottom"],SUPPORTED_VISIBILITY=["hover","static"],util={};util.data={assetServer:ASSET_SERVER,cdn:CDN},util.parseCollMeta=function(e){var t=e.split(".");if(t.length<3)throw new TypeError(ERRORS.META);var r;try{r=JSON.parse(base64.url.atob(t[1]))}catch(e){throw new TypeError(ERRORS.META_PARSE)}return r},util.parseConfig=function(e){var t={},r=e.collectionMeta,i=e.collectionMeta||throwErr(ERRORS.COLLECTION_META);if("string"==typeof i&&(i=util.parseCollMeta(i)),e.inlineThreads&&!UserAgentUtil.isMobile()&&(t.inlineThreads=!0),e.threadContainerEl&&(t.threadContainerEl=selectorUtil.matchElement(e.threadContainerEl),t.inlineThreads=!1),"string"==typeof e.position){if(-1===$.inArray(e.position,SUPPORTED_POSITION))throw new TypeError(ERRORS.SUPPORTED_POSITION+SUPPORTED_POSITION.join(", "));t.position=e.position}"string"==typeof e.customIcon&&$("head").append(_dereq_("../templates/blocks/thread-btn-override.mustache").render({customIcon:e.customIcon,customIconCfg:$.extend({},CUSTOM_ICON_CFG,e.customIconCfg)})),t.iconVisibility=parseIconVisibility(e.iconVisibility),"boolean"==typeof e.disableStream&&(t.disableStream=e.disableStream),!e.disableStream&&UserAgentUtil.isMobile()&&(t.disableStream=!0),"object"==typeof e.customStyles&&styleUtil.parseStyles(e.customStyles||{}),e.numSidenotesEl&&(t.numSidenotesEl=selectorUtil.matchElement(e.numSidenotesEl)),"function"==typeof e.threadBtnDelegate&&(t.threadBtnDelegate=e.threadBtnDelegate),"function"==typeof e.permalinkScrollDelegate&&(t.permalinkScrollDelegate=e.permalinkScrollDelegate),t.commentsOnly=!!e.commentsOnly&&e.commentsOnly,e.onInit&&"[object Array]"===Object.prototype.toString.call(e.onInit)&&(t.onInit=e.onInit);var o=i.articleId||e.articleId||e.collection.siteId||throwErr(ERRORS.ARTICLE_ID),n=i.siteId||e.siteId||e.collection.siteId||throwErr(ERRORS.SITE_ID),l=i.network||e.network||e.collection.network||"livefyre.com",a=i.environment||e.environment||null;e.authDelegate&&authAdapter.isOld(e.authDelegate)&&(auth.delegate(authAdapter.oldToNew(e.authDelegate)),window.fyre&&window.fyre.conv&&(fyre.conv.initializeGlobalServices({articleId:o,siteId:n,networkId:l,authDelegate:e.authDelegate}),fyre.conv.ready.hasFired()||fyre.conv.ready.trigger()));var s=e.strings||{};return textEnumeration.set(s),"option.selectors_prompt"===e.selectors&&(e.selectors=window.prompt("Enter the anchor selectors for Sidenotes",".article > p")),$.extend(t,{collection:e.collection||{articleId:o,network:l,siteId:n,environment:a},collectionMeta:r,defaultAvatar:ASSET_SERVER+"/images/default-avatar.png",selectors:selectorUtil.parseSelectors(e.selectors),selectorString:e.selectors,servers:{assets:ASSET_SERVER,cdn:CDN},strings:s})},module.exports=util},{"../templates/blocks/thread-btn-override.mustache":213,"./../../lib/base64/base64":5,"./../../lib/livefyre-auth/src/auth-adapters":12,"./../../node_modules/jquery/dist/jquery":96,"./i18n/enumeration":135,"./util/auth":192,"./util/selector":200,"./util/style":205,"./util/useragent":206}],126:[function(_dereq_,module,exports){function AnalyticsController(e){BaseController.call(this,e),this._initialize()}function getTypeFromEvent(e){return[e.type,e.namespace].join(".")}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../util/auth"),BaseController=_dereq_("./base"),events=_dereq_("../events/events"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),trackerTemplate=_dereq_("../../templates/tracker-js.mustache"),voteEnum=_dereq_("./../../../lib/streamhub-sdk/src/content/annotator-extensions").voteEnums.vote;inherits(AnalyticsController,BaseController),AnalyticsController.EVENT_TO_STAT_MAP=function(){var e={};return e[events.source.ADD_ANNOTATION_CLICK]=["button","click","selection thread"],e[events.source.SHARE_CLICK]=["button","click","selection share"],e[events.source.THREAD_BTN_CLICK]=["button","click","thread"],e[events.user.EDIT_PROFILE]=["button","click","edit profile"],e[events.user.LOGIN]=["button","click","login"],e[events.user.LOGOUT]=["button","click","logout"],e[events.user.VIEW_PROFILE]=["button","click","view profile"],e[events.write.POST_ANNOTATION]=["comment","post"],e[events.write.POST_APPROVE]=["comment","approve"],e[events.write.POST_DELETE]=["comment","delete"],e[events.write.POST_EDIT]=["comment","edit"],e[events.write.POST_FLAG]=["comment","flag",null],e[events.write.POST_HIDE]=["comment","trash"],e[events.write.POST_REPLY]=["comment","reply"],e[events.write.POST_SHARE]=["comment","share",null],e[events.write.POST_VOTE]="_handleCommentVote",e}(),AnalyticsController.prototype.events=function(){var e={};return $.each(AnalyticsController.EVENT_TO_STAT_MAP,function(t,n){e[t]=$.isArray(n)?"_handleEvent":n}),e}(),AnalyticsController.prototype._handleEvent=function(e,t){var n=t||{},o=AnalyticsController.EVENT_TO_STAT_MAP[getTypeFromEvent(e)];if(void 0===n.value)return void this._send(o);this._send($.merge($.merge([],o),[n.value]))},AnalyticsController.prototype._handleCommentVote=function(e,t){function n(e){return e===voteEnum.UPVOTE?"like":e===voteEnum.DOWNVOTE?"dislike":void 0}var o;o=t.value===voteEnum.UNSET?"un"+n(t.lastValue):n(t.value),this._send(["comment",o])},AnalyticsController.prototype._handleUserLogin=function(){var e=auth.get("livefyre"),t=e?e.get("id"):null;t&&(window.lft("set","userId",t),this._send(["login"]))},AnalyticsController.prototype._handleUserLogout=function(){window.lft("set","userId",""),this._send(["logout"])},AnalyticsController.prototype._initialize=function(){window.lft||this.$antenna.append(trackerTemplate.render({cdn:this._config.servers.cdn}));var e=window.lft;e("set","app","sidenotes"),e("set","collectionId",this._collection.id),e("set","siteId",this._collection.siteId),e("set","networkId",this._collection.networkId),auth.on("login.livefyre",$.proxy(this._handleUserLogin,this)),auth.on("logout",$.proxy(this._handleUserLogout,this))},AnalyticsController.prototype._send=function(e){var t=window.lft;t.apply(t,$.merge(["send","event"],e))},module.exports=AnalyticsController},{"../../templates/tracker-js.mustache":262,"../events/events":134,"../util/auth":192,"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/content/annotator-extensions":65,"./../../../node_modules/jquery/dist/jquery":96,"./base":127}],127:[function(_dereq_,module,exports){function BaseController(e){EventEmitter.call(this),this.$antenna=e.antenna,this.$globalAntenna=$(document.body),this._collection=e.collection,this._config=e.config,this._uid=delegate.getUniqueId(),this.delegateEvents(),this.delegateEvents(this.$globalAntenna,this.globalEvents)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),delegate=_dereq_("./../../../lib/view/src/delegate"),EventEmitter=_dereq_("./../../../lib/event-emitter/src/event-emitter");_dereq_("./../../../lib/inherits/inherits.js")(BaseController,EventEmitter),BaseController.onlyHandleExternalMessage=function(e){return function(t,n){t.target!==this.$antenna[0]&&e.call(this,t,n)}},BaseController.prototype.events={},BaseController.prototype.globalEvents={},BaseController.prototype.bindListeners=function(e){if(this.containerEvents){var t=this;e.on(this.containerEvents.join(" "),function(e,n){t.$antenna.trigger([e.type,e.namespace].join("."),n)})}},BaseController.prototype.delegateEvents=function(e,t){delegate.delegateEvents(e||this.$antenna,t||this.events,this._uid,this)},BaseController.prototype._getActiveBlock=function(){return this._collection.block},BaseController.prototype.destroy=function(){delegate.undelegateEvents(this.$antenna,this._uid),delegate.undelegateEvents(this.$globalAntenna,this._uid),this.$antenna=this.$globalAntenna=null},module.exports=BaseController},{"./../../../lib/event-emitter/src/event-emitter":10,"./../../../lib/inherits/inherits.js":11,"./../../../lib/view/src/delegate":81,"./../../../node_modules/jquery/dist/jquery":96}],128:[function(_dereq_,module,exports){function BodyController(e){BaseController.call(this,e)}var BaseController=_dereq_("./base"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),ThreadEvents=_dereq_("../events/events").thread;inherits(BodyController,BaseController),BodyController.prototype.globalEvents={"mousedown.BodyController":"_handleBodyMousedown"},BodyController.prototype._handleBodyMousedown=function(){this.$antenna.trigger(ThreadEvents.DESTROY_THREAD)},module.exports=BodyController},{"../events/events":134,"./../../../lib/inherits/inherits.js":11,"./base":127}],129:[function(_dereq_,module,exports){function CommentController(e){BaseController.call(this,e)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),BaseController=_dereq_("./base"),CommentEvents=_dereq_("../events/events").comment,inherits=_dereq_("./../../../lib/inherits/inherits.js"),internals=_dereq_("../util/internals"),requireAuth=_dereq_("../util/auth").requireAuth,SocialUtil=_dereq_("../util/social"),SourceEvents=_dereq_("../events/events").source,WriteEvents=_dereq_("../events/events").write;inherits(CommentController,BaseController);var COLLECTION_FN_MAP=function(){var e={};return e[CommentEvents.GET_PERMALINK]="getPermalink",e[WriteEvents.POST_APPROVE]="postApprove",e[WriteEvents.POST_DELETE]="postDelete",e[WriteEvents.POST_EDIT]="postEdit",e[WriteEvents.POST_FLAG]="postFlag",e[WriteEvents.POST_HIDE]="postHide",e[WriteEvents.POST_VOTE]="postVote",e}(),SUCCESS_EVENT_MAP=function(){var e={};return e[WriteEvents.POST_FLAG]=WriteEvents.COMMENT_FLAGGED,e[WriteEvents.POST_VOTE]=WriteEvents.COMMENT_VOTED,e}(),SHARE_URLS={facebook:"https://www.facebook.com/dialog/feed",twitter:"https://twitter.com/intent/tweet"};CommentController.prototype.events=function(){var e={};return e[CommentEvents.GET_PERMALINK]="_handleEvent",e[SourceEvents.SHARE_CLICK]="_handleSourceShare",e[WriteEvents.POST_ANNOTATION]="_handlePostAnnotation",e[WriteEvents.POST_APPROVE]="_handleAuthenticatedEvent",e[WriteEvents.POST_EDIT]="_handleAuthenticatedEvent",e[WriteEvents.POST_DELETE]="_handleAuthenticatedEvent",e[WriteEvents.POST_FLAG]="_handleEvent",e[WriteEvents.POST_HIDE]="_handleAuthenticatedEvent",e[WriteEvents.POST_REPLY]="_handlePostAnnotation",e[WriteEvents.POST_SHARE]="_handleShare",e[WriteEvents.POST_VOTE]="_handleAuthenticatedEvent",e}(),CommentController.prototype._handleAuthenticatedEvent=requireAuth(function(e,t){this._handleEvent(e,t)}),CommentController.prototype._handleEvent=function(e,t){var n=e.type+"."+e.namespace,o=COLLECTION_FN_MAP[n],r=this,i=SUCCESS_EVENT_MAP[n];this._collection[o].call(this._collection,t,function(n,o){(t.callback||internals.nullFunction)(n,o),r.$antenna.trigger(CommentEvents.ACTION_SUCCESS,{event:e}),i&&r.$antenna.trigger(i,t)})},CommentController.prototype._handlePostAnnotation=requireAuth(function(e,t){t.postData=this._hydrateAnnotation(t);var n=this;this._collection.postAnnotation(t,function(e,o){e&&t.callback(e),!e&&n._collection.block&&(t.callback(e,o),n._collection.push.apply(n._collection,o),n.$antenna.trigger(WriteEvents.COMMENT_POSTED,o[0]))})}),CommentController.prototype._handleShare=function(e,t){var n=SHARE_URLS[t.value],o=["height=",420,",width=",550].join(""),r=t.model||{author:{displayName:this._config.twitterHandle||""},body:t.body||this._collection.selectedText||"",isSource:t.isSource,permalink:window.location.href},i=SocialUtil.contentToShare(r,t.value);i.assetServer=this._config.servers.assets,i.provider=t.value;var l=SocialUtil.generateParams(i);window.open(n+l,"intent",o),this.$antenna.trigger(WriteEvents.COMMENT_SHARED,$.extend({},r,i))},CommentController.prototype._handleSourceShare=function(e,t){t.isSource=!0,this._handleShare(e,t)},CommentController.prototype._hydrateAnnotation=function(e){var t={},n=this._getActiveBlock();return t.block_id=n.getId(),t.body=e.body,t._bi=Math.random(),t.share_types=e.shareTypes,e.parentId?(t.parent_id=e.parentId,t):(t.block_type=n.blockType,t.index=n.index,t.hash=n.simhash,t.full_text=n.content,t.selected_text=this._collection.selectedText,t)},module.exports=CommentController},{"../events/events":134,"../util/auth":192,"../util/internals":196,"../util/social":202,"./../../../lib/inherits/inherits.js":11,"./../../../node_modules/jquery/dist/jquery":96,"./base":127}],130:[function(_dereq_,module,exports){function CookieController(o){BaseController.call(this,o)}var auth=_dereq_("../util/auth"),BaseController=_dereq_("./base"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),permalinkUtil=_dereq_("../util/permalink"),Store=_dereq_("store"),UserEvents=_dereq_("../events/events").user;CookieController.prototype.COOKIE_KEY="sidenotes-auth",inherits(CookieController,BaseController),CookieController.prototype.COOKIE_KEY="sidenotes-auth",CookieController.prototype._permalinkUtil=permalinkUtil,CookieController.prototype.events=function(){var o={};return o[UserEvents.LOGIN]="_createCookie",o}(),CookieController.prototype.checkForCookie=function(){var o=Store.get(this.COOKIE_KEY);o&&o.collectionId&&void 0!==o.blockId&&this._collection.id===o.collectionId&&this._permalinkUtil.scrollToPermalink(o.blockId),this._removeCookie(),auth.on("login",this._removeCookie)},CookieController.prototype._createCookie=function(){auth.get("livefyre")||Store.set(this.COOKIE_KEY,{collectionId:this._collection.id,blockId:this._collection.block.id})},CookieController.prototype._removeCookie=function(){Store.remove(this.COOKIE_KEY)},CookieController.prototype.destroy=function(){auth.removeListener("login",this._removeCookie),BaseController.prototype.destroy.call(this)},module.exports=CookieController},{"../events/events":134,"../util/auth":192,"../util/permalink":199,"./../../../lib/inherits/inherits.js":11,"./base":127,store:98}],131:[function(_dereq_,module,exports){function ExternalController(e){BaseController.call(this,e),this._app=e.app,Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this._onUserLoggedIn,this)),this.listenTo(auth,"logout",$.proxy(this._onUserLoggedOut,this))}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../util/auth"),BaseController=_dereq_("./base"),BlockEvents=_dereq_("../events/events").block,ExternalEvents=_dereq_("../events/events").external,inherits=_dereq_("./../../../lib/inherits/inherits.js"),Observer=_dereq_("./../../../lib/observer/src/observer.js"),UserEvents=_dereq_("../events/events").user,WriteEvents=_dereq_("../events/events").write;inherits(ExternalController,BaseController),ExternalController.prototype.events=function(){var e={};return e[BlockEvents.COUNT_UPDATED]="_onBlockCountUpdate",e[UserEvents.LOGIN]="_onUserLoggingIn",e[WriteEvents.COMMENT_FLAGGED]="_onCommentFlagged",e[WriteEvents.COMMENT_POSTED]="_onCommentPosted",e[WriteEvents.COMMENT_SHARED]="_onCommentShared",e[WriteEvents.COMMENT_VOTED]="_onCommentVoted",e}(),ExternalController.prototype._onBlockCountUpdate=function(e,t){this._app.emit(ExternalEvents.BLOCK_COUNT_UPDATE,t)},ExternalController.prototype._onCommentFlagged=function(e,t){this._app.emit(ExternalEvents.COMMENT_FLAGGED,{targetId:t.messageId,type:t.value})},ExternalController.prototype._onCommentPosted=function(e,t){this._app.emit(ExternalEvents.COMMENT_POSTED,{authorId:t.author.id,bodyHtml:t.body,id:t.id,parent:t.parentId})},ExternalController.prototype._onCommentShared=function(e,t){this._app.emit(ExternalEvents.COMMENT_SHARED,{targetId:t.id,sharedToFacebook:"facebook"===t.provider,sharedToTwitter:"twitter"===t.provider})},ExternalController.prototype._onCommentVoted=function(e,t){this._app.emit(ExternalEvents.COMMENT_VOTED,{targetId:t.messageId,targetAuthorId:t.authorId,type:t.value})},ExternalController.prototype._onUserLoggedIn=function(e){this._app.emit(ExternalEvents.USER_LOGGED_IN,{avatar:e.get("avatar"),displayName:e.get("displayName"),id:e.get("id"),isModerator:e.isMod({collectionId:this._collection.id})})},ExternalController.prototype._onUserLoggedOut=function(){this._app.emit(ExternalEvents.USER_LOGGED_OUT)},ExternalController.prototype._onUserLoggingIn=function(){this._app.emit(ExternalEvents.USER_LOGGING_IN)},ExternalController.prototype.destroy=function(){BaseController.prototype.destroy.call(this),this.stopListening()},module.exports=ExternalController},{"../events/events":134,"../util/auth":192,"./../../../lib/inherits/inherits.js":11,"./../../../lib/observer/src/observer.js":42,"./../../../node_modules/jquery/dist/jquery":96,"./base":127}],132:[function(_dereq_,module,exports){function TranslationController(t){t=t||{},this._appType="sidenotes",
this._client=new LivefyreTranslationClient,this._strings=t.strings||{}}var LivefyreTranslationClient=_dereq_("../clients/translationclient"),Promise=_dereq_("es6-promise").Promise,textEnumeration=_dereq_("../i18n/enumeration");TranslationController.prototype.fetchTranslations=function(t){var e=this;return t.appType=this._appType,new Promise(function(n,i){if("livefyre.com"===t.network)return n();e._client.getTranslations(t,function(t,i){t||200!==i.code||(textEnumeration.set((i.data.translations||{})[e._appType]||{}),textEnumeration.set(e._strings)),n()})})},module.exports=TranslationController},{"../clients/translationclient":124,"../i18n/enumeration":135,"es6-promise":91}],133:[function(_dereq_,module,exports){var visibilityEnum=_dereq_("./../../lib/streamhub-sdk/src/content/main").enums.visibility,enums={};enums.commentVisibility={NONE:visibilityEnum[0],EVERYONE:visibilityEnum[1],OWNER:visibilityEnum[2],GROUP:visibilityEnum[3]},enums.navigableViews={AUTH:"auth",CONFIRM:"confirm",EDIT:"edit",EDITOR:"editor",ETC:"etc",FLAG:"flag",INFO:"info",REPLIES:"commentreplies",SHARE:"share",THREAD:"thread",USER:"user"},module.exports=enums},{"./../../lib/streamhub-sdk/src/content/main":67}],134:[function(_dereq_,module,exports){var Events={};Events.block={UPDATE_COUNT:"block.update_count",COUNT_UPDATED:"block.manual_update_count"},Events.comment={ACTION_SUCCESS:"comment.action_success",HIDDEN:"comment.hidden",GET_PERMALINK:"comment.get_permalink"},Events.content={FETCH_EREFS:"content.fetch_erefs"},Events.editor={HIDE:"editor.hide"},Events.source={ADD_ANNOTATION_CLICK:"source.add_annotation_click",SHARE_CLICK:"source.share_click",TEXT_HIGHLIGHTED:"source.text_highlighted",THREAD_BTN_CLICK:"source.thread_btn_click",THREAD_BTN_MOUSEDOWN:"source.thread_btn_mousedown"},Events.thread={ACTIVATE_BLOCK:"thread.activate_block",ACTIVATE_HIGHLIGHTED_TEXT:"thread.activate_highlighted_text",ACTIVATE_THREAD:"thread.activate_thread",CHANGE_VIEW:"thread.change_view",DEACTIVATE_HIGHLIGHTED_TEXT:"thread.deactivate_highlighted_text",DESTROY_THREAD:"thread.destroy_thread",NAVIGATE:"thread.navigate",NAVIGATE_BACK:"thread.navigate_back",NAVIGATE_TO_THREAD:"thread.navigate_to_thread",PERMALINK_BACK:"thread.permalink_back",SHOW_QUEUED_CONTENT:"thread.show_queued_content",TUCK_THREAD:"thread.tuck",UNTUCK_THREAD:"thread.untuck"},Events.user={ADMIN:"user.admin",EDIT_PROFILE:"user.edit_profile",LOGIN:"user.login",LOGOUT:"user.logout",VIEW_PROFILE:"user.view_profile"},Events.write={COMMENT_FLAGGED:"write.comment_flagged",COMMENT_POSTED:"write.comment_posted",COMMENT_SHARED:"write.comment_shared",COMMENT_VOTED:"write.comment_voted",POST_ANNOTATION:"write.post_annotation",POST_APPROVE:"write.post_approve",POST_DELETE:"write.post_delete",POST_EDIT:"write.post_edit",POST_FLAG:"write.post_flag",POST_HIDE:"write.post_hide",POST_REPLY:"write.post_reply",POST_SHARE:"write.post_share",POST_VOTE:"write.post_vote"},Events.external={BLOCK_COUNT_UPDATE:"sidenotes.blockCountUpdate",COMMENT_FLAGGED:"sidenotes.commentFlagged",COMMENT_POSTED:"sidenotes.commentPosted",COMMENT_SHARED:"sidenotes.commentShared",COMMENT_VOTED:"sidenotes.commentVoted",INITIALIZED:"sidenotes.initialized",USER_LOGGED_IN:"sidenotes.userLoggedIn",USER_LOGGED_OUT:"sidenotes.userLoggedOut",USER_LOGGING_IN:"sidenotes.userLoggingIn"},module.exports=Events},{}],135:[function(_dereq_,module,exports){var TextEnumeration=function(){this.values_={},this.set(TextEnumeration.VALUES)};TextEnumeration.prototype.KEYS={APP_NAME:"appName",APP_VERSION:"appVersion",COMMENT_MODERATOR_TAG:"commentModeratorTag",COMMENT_PENDING_TAG:"commentPendingTag",COMMENT_VOTE_COUNT:"commentVoteCount",COMMENT_VOTE_COUNT_SING:"commentVoteCountSing",COMMENT_READ_MORE:"commentReadMoreLink",COMMENT_REPLY_LINK:"commentReplyLink",COMMENT_REPLY_LINK_SING:"commentReplyLinkSing",DATETIME_MINUTE_ABBREVIATION:"datetimeMinutePrefix",DATETIME_MONTHS:"datetimeMonths",EDITOR_EDIT_BTN:"editorEditBtn",EDITOR_PLACEHOLDER:"editorPlaceholder",EDITOR_POST_BTN:"editorPostBtn",EDITOR_POST_BTN_MOBILE:"editorPostBtnMobile",EDITOR_POSTING:"editorPosting",EDITOR_REPLY_BTN:"editorReplyBtn",EDITOR_TITLE:"editorTitle",EDITOR_REPLY_TITLE:"editorReplyTitle",EDITOR_EDIT_POSTING:"editorEditPosting",EDITOR_EDIT_TITLE:"editorEditTitle",EDITOR_EDIT_REPLY_TITLE:"editorEditReplyTitle",EMPTY_IMAGE_BLOCK_TXT:"emptyImageBlockTxt",EMPTY_TEXT_BLOCK_TXT:"emptyTextBlockTxt",MENU_AUTH_SIGN_IN_BTN:"menuAuthSignInBtn",MENU_AUTH_SIGNED_IN_MSG:"menuAuthSignedInMsg",MENU_BACK_BTN:"menuBackBtn",MENU_CONFIRM_ACCEPT:"menuConfirmAccept",MENU_CONFIRM_CANCEL:"menuConfirmCancel",MENU_CONFIRM_TITLE:"menuConfirmTitle",MENU_ETC_OPTION_APPROVE:"menuEtcOptionApprove",MENU_ETC_OPTION_DELETE:"menuEtcOptionDelete",MENU_ETC_OPTION_EDIT:"menuEtcOptionEdit",MENU_ETC_OPTION_FLAG:"menuEtcOptionFlag",MENU_ETC_OPTION_SHARE:"menuEtcOptionShare",MENU_ETC_POSTED_AT:"menuEtcPostedAt",MENU_ETC_TITLE:"menuEtcTitle",MENU_FLAG_OPTION_DISAGREE:"menuFlagOptionDisagree",MENU_FLAG_OPTION_OFFENSIVE:"menuFlagOptionOffensive",MENU_FLAG_OPTION_OFF_TOPIC:"menuFlagOptionOffTopic",MENU_FLAG_OPTION_SPAM:"menuFlagOptionSpam",MENU_FLAG_TITLE:"menuFlagTitle",MENU_INFO_COPYRIGHT:"menuInfoCopyright",MENU_INFO_HELP:"menuInfoHelp",MENU_INFO_LF_LINK:"menuInfoLivefyreLink",MENU_REPLIES_VIEW_TITLE:"menuRepliesViewTitle",MENU_REPLIES_VIEW_REPLY:"menuRepliesViewReply",MENU_SHARE_OPTION_FACEBOOK:"menuShareOptionFacebook",MENU_SHARE_OPTION_TWITTER:"menuShareOptionTwitter",MENU_SHARE_TITLE:"menuShareTitle",MENU_USER_EDIT_PROFILE:"menuUserEditProfile",MENU_USER_ADMIN:"menuUserAdmin",MENU_USER_LOGOUT:"menuUserLogout",MENU_USER_BACK_BTN:"menuUserBackBtn",QUESTION_EXPLANATION:"questionExplanation",QUESTION_MOCK_TEXT:"questionMockText",QUESTION_TITLE:"questionTitle",QUEUED_COMMENTS_PLURAL:"queuedCommentsPlural",QUEUED_COMMENTS_SINGULAR:"queuedCommentsSingular",QUEUED_REPLIES_PLURAL:"queuedRepliesPlural",QUEUED_REPLIES_SINGULAR:"queuedRepliesSingular",REPLY_BTN:"replyBtn",SIGN_IN_TO_POST:"signInToPost",THREAD_COLLAPSE_BTN:"threadCollapseBtn",THREAD_EXPAND_BTN_PLURAL:"threadExpandBtnPlural",THREAD_EXPAND_BTN_SINGULAR:"threadExpandBtnSingular",THREAD_REPLY_BTN:"threadReplyBtn",PERMALINK_TITLE:"permalinkTitle",PERMALINK_BACK_BTN:"permalinkBackBtn",PERMALINK_MISSING:"permalinkMissing",NOTIFICATION_APPROVED:"notificationApproved",NOTIFICATION_DELETED:"notificationDeleted",NOTIFICATION_FLAGGED:"notificationFlagged",FACEBOOK_SHARE_DESCRIPTION:"facebookShareDescription",FACEBOOK_SHARE_DESCRIPTION_SOURCE:"facebookShareDescriptionSource",FACEBOOK_SHARE_CAPTION:"facebookShareCaption",SLIDER_COMMENT_TALLY:"sliderCommentTally",SLIDER_INVITE_READ:"sliderInviteRead",SLIDER_INVITE_WRITE:"sliderInviteWrite",SLIDER_LOADING:"sliderLoading",SLIDER_WRITE_TEXT:"sliderWriteText",ERROR_CONNECTION:"errorConnection",ERROR_DUPLICATE:"errorDuplicate",ERROR_GENERAL:"errorGeneral",ERROR_SERVER:"errorServer"},TextEnumeration.VALUES=function(){var E={},e=TextEnumeration.prototype.KEYS;return E[e.APP_NAME]="Sidenotes",E[e.APP_VERSION]="v1.2.1",E[e.COMMENT_MODERATOR_TAG]="Mod",E[e.COMMENT_PENDING_TAG]="Pending",E[e.COMMENT_READ_MORE]="Read More",E[e.COMMENT_REPLY_LINK]="See {number} replies",E[e.COMMENT_REPLY_LINK_SING]="See reply",E[e.COMMENT_VOTE_COUNT]="votes",E[e.COMMENT_VOTE_COUNT_SING]="vote",E[e.DATETIME_MINUTE_ABBREVIATION]="m",E[e.DATETIME_MONTHS]=["January","February","March","April","May","June","July","August","September","October","November","December"],E[e.EDITOR_EDIT_BTN]="Save",E[e.EDITOR_PLACEHOLDER]="What do you think?",E[e.EDITOR_POST_BTN]="Post Sidenote",E[e.EDITOR_POST_BTN_MOBILE]="Post",E[e.EDITOR_POSTING]="Posting...",E[e.EDITOR_REPLY_BTN]="Post Reply",E[e.EDITOR_TITLE]="Write Sidenote",E[e.EDITOR_REPLY_TITLE]="Write Reply",E[e.EDITOR_EDIT_POSTING]="Saving...",E[e.EDITOR_EDIT_TITLE]="Edit Sidenote",E[e.EDITOR_EDIT_REPLY_TITLE]="Edit Reply",E[e.EMPTY_IMAGE_BLOCK_TXT]="What do you think?",E[e.EMPTY_TEXT_BLOCK_TXT]="+",E[e.MENU_AUTH_SIGN_IN_BTN]="Sign in",E[e.MENU_AUTH_SIGNED_IN_MSG]="You must be signed in to {action}",E[e.MENU_BACK_BTN]="Back",E[e.MENU_CONFIRM_ACCEPT]="Yes, {action}",E[e.MENU_CONFIRM_CANCEL]="Cancel",E[e.MENU_CONFIRM_TITLE]="Are you sure?",E[e.MENU_ETC_OPTION_APPROVE]="Approve",E[e.MENU_ETC_OPTION_DELETE]="Delete",E[e.MENU_ETC_OPTION_EDIT]="Edit",E[e.MENU_ETC_OPTION_FLAG]="Flag",E[e.MENU_ETC_OPTION_SHARE]="Share",E[e.MENU_ETC_POSTED_AT]="Posted on {date}",E[e.MENU_ETC_TITLE]="More",E[e.MENU_INFO_COPYRIGHT]="&copy; Livefyre, Inc. 2016",E[e.MENU_INFO_HELP]="Help",E[e.MENU_INFO_LF_LINK]="Visit Livefyre.com",E[e.MENU_FLAG_OPTION_DISAGREE]="Disagree",E[e.MENU_FLAG_OPTION_OFFENSIVE]="Offensive",E[e.MENU_FLAG_OPTION_OFF_TOPIC]="Off Topic",E[e.MENU_FLAG_OPTION_SPAM]="Spam",E[e.MENU_FLAG_TITLE]="Flag as...",E[e.MENU_REPLIES_VIEW_TITLE]="Details",E[e.MENU_REPLIES_VIEW_REPLY]="Reply to Conversation",E[e.MENU_SHARE_OPTION_FACEBOOK]="Facebook",E[e.MENU_SHARE_OPTION_TWITTER]="Twitter",E[e.MENU_SHARE_TITLE]="Share",E[e.MENU_USER_EDIT_PROFILE]="Edit Profile",E[e.MENU_USER_ADMIN]="Admin Console",E[e.MENU_USER_LOGOUT]="Sign Out",E[e.MENU_USER_BACK_BTN]="All",E[e.QUEUED_COMMENTS_PLURAL]="{number} New Sidenotes",E[e.QUEUED_COMMENTS_SINGULAR]="1 New Sidenote",E[e.QUEUED_REPLIES_PLURAL]="{number} New Replies",E[e.QUEUED_REPLIES_SINGULAR]="1 New Reply",E[e.QUESTION_TITLE]="What is a Sidenote?",E[e.QUESTION_EXPLANATION]='You can now read and write comments directly on sentences, paragraphs, images and quotes.<br><br><span class="lf-highlight-text">Highlight text</span> and click the <span class="fycon-write"></span> icon or click the <span class="fycon-action-view"></span> icon at the end of each paragraph.',E[e.QUESTION_MOCK_TEXT]="What is familiarly known is not properly known, just for the reason that it is familiar.",E[e.REPLY_BTN]="Reply",E[e.SIGN_IN_TO_POST]="<u>Sign in</u> to write a sidenote",E[e.THREAD_COLLAPSE_BTN]="Collapse",E[e.THREAD_EXPAND_BTN_PLURAL]="Expand {number} Replies",E[e.THREAD_EXPAND_BTN_SINGULAR]="Expand 1 Reply",E[e.THREAD_REPLY_BTN]="Reply to Conversation",E[e.PERMALINK_TITLE]="Permalink",E[e.PERMALINK_BACK_BTN]="All",E[e.PERMALINK_MISSING]="This Sidenote is no longer visible.",E[e.NOTIFICATION_APPROVED]="Approved",E[e.NOTIFICATION_DELETED]="Deleted",E[e.NOTIFICATION_FLAGGED]="Flagged",E[e.FACEBOOK_SHARE_DESCRIPTION]='Check out this Sidenote: "{body}"',E[e.FACEBOOK_SHARE_DESCRIPTION_SOURCE]='"{body}"',E[e.FACEBOOK_SHARE_CAPTION]='Sidenotes on "{title}"',E[e.SLIDER_COMMENT_TALLY]="of",E[e.SLIDER_INVITE_READ]="Read",E[e.SLIDER_INVITE_WRITE]="Slide to Comment",E[e.SLIDER_LOADING]="Loading...",E[e.SLIDER_WRITE_TEXT]="What do you think? Tap to write.",E[e.ERROR_CONNECTION]="Uh-oh. You don't seem to have a good connection.",E[e.ERROR_DUPLICATE]="We like your note too, but you can't post it twice.",E[e.ERROR_GENERAL]="An error has occurred. Please try again.",E[e.ERROR_SERVER]="Something went wrong with our server. Try that again?",E}(),TextEnumeration.prototype.get=function(E){return this.values_[E]},TextEnumeration.prototype.getAndReplace=function(E,e){var _=this.get(E);if(!_||-1===_.indexOf("%s"))return _;for(var T=e.length,t=0;t<T;t++)_=_.replace(/\%s/,e[t]);return _},TextEnumeration.prototype.reset=function(){this.set(TextEnumeration.VALUES)},TextEnumeration.prototype.set=function(E,e){if("string"==typeof E)return void(this.values_[E]=e);var _;for(_ in E)E.hasOwnProperty(_)&&this.set(_,E[_])},module.exports=new TextEnumeration},{}],136:[function(_dereq_,module,exports){function AnnotationApp(t){EventEmitter.call(this),this._initMessenger(),this._blockController=null,this._bodyController=null,this._commentController=null,this._externalController=null,this._streamRunning=!1,this._threadController=null,this._userController=null,this._config=null,this._initFlags={},Observer(this),this._config=parseConfig(t),this._initialize()}function createThreadController(t){return new(_dereq_(UserAgentUtil.isMobile()?"./mobile/thread/controller":"./thread/controller"))(t)}var $=_dereq_("./../../node_modules/jquery/dist/jquery"),AnnotationsCollection=(_dereq_("./controller/analytics"),_dereq_("./clients/annotationscollection")),BlockController=_dereq_("./blocks/controller"),CommentController=_dereq_("./controller/comment"),CommentsOnlyController=_dereq_("./blocks/commentsonlycontroller"),CookieController=_dereq_("./controller/cookie"),domUtil=(_dereq_("./config").data,_dereq_("./util/dom")),EventEmitter=_dereq_("./../../lib/event-emitter/src/event-emitter"),ExternalController=_dereq_("./controller/external"),ExternalEvents=_dereq_("./events/events").external,inherits=_dereq_("./../../lib/inherits/inherits.js"),Observer=_dereq_("./../../lib/observer/src/observer.js"),parseConfig=_dereq_("./config").parseConfig,Promise=_dereq_("es6-promise").Promise,ScriptLoader=_dereq_("./../../lib/scriptloader/src/javascript/scriptloader.js"),selectorUtil=_dereq_("./util/selector"),TranslationController=_dereq_("./controller/translation"),UserAgentUtil=_dereq_("./util/useragent"),UserController=_dereq_("./user/controller");inherits(AnnotationApp,EventEmitter);var messengerId=0;AnnotationApp.prototype._createBodyController=function(t){if(!this._config.inlineThreads)return new(_dereq_(UserAgentUtil.isMobile()?"./mobile/controller/body":"./controller/body"))(t)},AnnotationApp.prototype._getControllerOptions=function(){return{app:this,antenna:this.$antenna,collection:this._collection,config:this._config}},AnnotationApp.prototype._initMessenger=function(){messengerId++;var t=this;this.$antenna=$('<div id="fyre-messenger-'+messengerId+'"></div>'),domUtil.raf(function(){t.$antenna.appendTo(document.body)})},AnnotationApp.prototype._handleCollectionInitComplete=function(t,e){var o,n=this;UserAgentUtil.isMobile()?(o=this._config.servers.assets+"/css/mobile-block.css",_dereq_("./mobile/jquery-mobile-events")):o=this._config.servers.assets+"/css/block.css",this._blockController.initialize(t),this.updateAnchors(void 0,function(){n._executeOnInit({collectionInitialized:!0}),n.emit(ExternalEvents.INITIALIZED),n.cookieController&&n.cookieController.checkForCookie(),e&&e(),domUtil.raf(function(){ScriptLoader.loadCSS(o)})})},AnnotationApp.prototype._initialize=function(){var t=this._config.collection,e={environment:t.environment,network:t.network,siteId:t.siteId},o=new TranslationController({strings:this._config.strings}),n=this;this._collection=new AnnotationsCollection($.extend({},e,{articleId:this._config.collection.articleId,collectionMeta:this._config.collectionMeta,signed:"string"==typeof this._config.collectionMeta}));var r=new Promise(function(t,e){n._collection.initFromBootstrap(function(o,n,r){if(o)return e();t([n,r])})});Promise.all([o.fetchTranslations(e),r]).then($.proxy(this._handleInitComplete,this))},AnnotationApp.prototype._handleInitComplete=function(t){this._loadControllers(),this.startStream(),this._executeOnInit({constructed:!0}),this._handleCollectionInitComplete.apply(this,t[1])},AnnotationApp.prototype._loadControllers=function(){var t=this._getControllerOptions();this._blockController=this._config.commentsOnly?new CommentsOnlyController(t):new BlockController(t),this._bodyController=this._createBodyController(t),this._commentController=new CommentController(t),this._cookieController=this._config.commentsOnly?null:new CookieController(t),this._externalController=new ExternalController(t),this._threadController=createThreadController(t),this._userController=new UserController(t)},AnnotationApp.prototype.destroy=function(){this.stopStream(),this._collection&&this._collection.destroy(),this._collection=null,this._config=null,this._blockController&&this._blockController.destroy(),this._blockController=null,this._bodyController&&this._bodyController.destroy(),this._bodyController=null,this._commentController&&this._commentController.destroy(),this._commentController=null,this._externalController&&this._externalController.destroy(),this._externalController=null,this._threadController&&this._threadController.destroy(),this._threadController=null,this._userController&&this._userController.destroy(),this._userController=null,this.$antenna.remove()},AnnotationApp.prototype.startStream=function(){if(!this._streamRunning){this._streamRunning=!0;var t=$.proxy(this._threadController.handleReadable,this._threadController);this.listenTo(this._collection,"readable",t),this._config.disableStream&&this._collection.pause()}},AnnotationApp.prototype.stopStream=function(){this._streamRunning&&(this._streamRunning=!1,this.stopListening())},AnnotationApp.prototype.updateAnchors=function(t,e){if(!this._blockController)throw"Sidenotes app has not initialized yet, please wait...";var o=t||this._config.selectorString;o=selectorUtil.parseSelectors(o),o=o.not(":has(.lf-thread-btn)").not(":has(.lf-mobile-thread-btn)"),this._blockController.initializeBlocks(o,e)},AnnotationApp.prototype.removeAnchors=function(t){if(!this._blockController)throw"Sidenotes app has not initialized yet, please wait...";var e=this;t=selectorUtil.parseSelectors(t),t.each(function(t,o){e._blockController.unwrapBlockByElement(o)})},AnnotationApp.prototype.manualActivateThread=function(t,e){this._config.commentsOnly&&(this._threadController.deactivating||(this._blockController.updateManualBlock(t,e),this._threadController._activateThread()))},AnnotationApp.prototype.manualDestroyThread=function(){this._config.commentsOnly&&this._threadController._destroyThread()},AnnotationApp.prototype.getBlockCount=function(t){if(this._config.commentsOnly)return this._blockController.getBlockCount(t)},AnnotationApp.prototype._executeOnInit=function(t){var e=this._config.onInit;if($.extend(this._initFlags,t),e&&this._initFlags.constructed&&this._initFlags.collectionInitialized)for(var o=0;o<e.length;o++)"function"==typeof e[o]&&e[o](this)},module.exports=AnnotationApp},{"./../../lib/event-emitter/src/event-emitter":10,"./../../lib/inherits/inherits.js":11,"./../../lib/observer/src/observer.js":42,"./../../lib/scriptloader/src/javascript/scriptloader.js":44,"./../../node_modules/jquery/dist/jquery":96,"./blocks/commentsonlycontroller":114,"./blocks/controller":115,"./clients/annotationscollection":122,"./config":125,"./controller/analytics":126,"./controller/body":128,"./controller/comment":129,"./controller/cookie":130,"./controller/external":131,"./controller/translation":132,"./events/events":134,"./mobile/controller/body":137,"./mobile/jquery-mobile-events":138,"./mobile/thread/controller":139,"./thread/controller":157,"./user/controller":190,"./util/dom":194,"./util/selector":200,"./util/useragent":206,"es6-promise":91}],137:[function(_dereq_,module,exports){function MobileBodyController(o){BodyController.call(this,o),this._isScrolling=!1,this._onScrollStop=null,delegate.delegateEvents($(document),{scroll:"_handleOnScoll"},this._uid,this)}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),BodyController=_dereq_("../../controller/body"),delegate=_dereq_("./../../../../lib/view/src/delegate"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),ThreadEvents=_dereq_("../../events/events").thread;inherits(MobileBodyController,BodyController),MobileBodyController.SCROLL_DELAY=250,MobileBodyController.prototype.globalEvents=function(){var o={};return o.touchend="_handleScrollEnd",o.touchstart="_handleScrollStart",o}(),MobileBodyController.prototype._handleOnScoll=function(){var o=this;this._onScrollStop&&clearTimeout(this._onScrollStop),this._onScrollStop=setTimeout(function(){o._handleScrollEnd()},MobileBodyController.SCROLL_DELAY)},MobileBodyController.prototype._handleScrollStart=function(){this._isScrolling||(this._isScrolling=!0,this.$antenna.trigger(ThreadEvents.TUCK_THREAD))},MobileBodyController.prototype._handleScrollEnd=function(){this._isScrolling&&this.$antenna.trigger(ThreadEvents.UNTUCK_THREAD),this._isScrolling=!1},MobileBodyController.prototype.destroy=function(){BodyController.prototype.destroy.call(this),delegate.undelegateEvents($(document),this._uid)},module.exports=MobileBodyController},{"../../controller/body":128,"../../events/events":134,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/view/src/delegate":81,"./../../../../node_modules/jquery/dist/jquery":96}],138:[function(_dereq_,module,exports){!function(e){function t(){var e=c();e!==s&&(s=e,u.trigger("orientationchange"))}function a(t,a,n,o){var i=n.type;n.type=a,e.event.dispatch.call(t,n,o),n.type=i}e.attrFn=e.attrFn||{};var n=navigator.userAgent.toLowerCase(),o=n.indexOf("chrome")>-1&&(n.indexOf("windows")>-1||n.indexOf("macintosh")>-1||n.indexOf("linux")>-1)&&n.indexOf("mobile")<0,i={tap_pixel_range:5,swipe_h_threshold:50,swipe_v_threshold:50,taphold_threshold:750,doubletap_int:500,touch_capable:"ontouchstart"in document.documentElement&&!o,orientation_support:"orientation"in window&&"onorientationchange"in window,startevent:"ontouchstart"in document.documentElement&&!o?"touchstart":"mousedown",endevent:"ontouchstart"in document.documentElement&&!o?"touchend":"mouseup",moveevent:"ontouchstart"in document.documentElement&&!o?"touchmove":"mousemove",tapevent:"ontouchstart"in document.documentElement&&!o?"tap":"click",scrollevent:"ontouchstart"in document.documentElement&&!o?"touchmove":"scroll",hold_timer:null,tap_timer:null};e.isTouchCapable=function(){return i.touch_capable},e.getStartEvent=function(){return i.startevent},e.getEndEvent=function(){return i.endevent},e.getMoveEvent=function(){return i.moveevent},e.getTapEvent=function(){return i.tapevent},e.getScrollEvent=function(){return i.scrollevent},e.each(["tapstart","tapend","tap","singletap","doubletap","taphold","swipe","swipeup","swiperight","swipedown","swipeleft","swipeend","scrollstart","scrollend","orientationchange"],function(t,a){e.fn[a]=function(e){return e?this.on(a,e):this.trigger(a)},e.attrFn[a]=!0}),e.event.special.tapstart={setup:function(){var t=this,n=e(t);n.on(i.startevent,function(e){if(n.data("callee",arguments.callee),e.which&&1!==e.which)return!1;var o=e.originalEvent,c={position:{x:i.touch_capable?o.touches[0].screenX:e.screenX,y:i.touch_capable?o.touches[0].screenY:e.screenY},offset:{x:i.touch_capable?o.touches[0].pageX-o.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?o.touches[0].pageY-o.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};return a(t,"tapstart",e,c),!0})},remove:function(){e(this).off(i.startevent,e(this).data.callee)}},e.event.special.tapmove={setup:function(){var t=this,n=e(t);n.on(i.moveevent,function(e){n.data("callee",arguments.callee);var o=e.originalEvent,c={position:{x:i.touch_capable?o.touches[0].screenX:e.screenX,y:i.touch_capable?o.touches[0].screenY:e.screenY},offset:{x:i.touch_capable?o.touches[0].pageX-o.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?o.touches[0].pageY-o.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};return a(t,"tapmove",e,c),!0})},remove:function(){e(this).off(i.moveevent,e(this).data.callee)}},e.event.special.tapend={setup:function(){var t=this,n=e(t);n.on(i.endevent,function(e){n.data("callee",arguments.callee);var o=e.originalEvent,c={position:{x:i.touch_capable?o.changedTouches[0].screenX:e.screenX,y:i.touch_capable?o.changedTouches[0].screenY:e.screenY},offset:{x:i.touch_capable?o.changedTouches[0].pageX-o.changedTouches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?o.changedTouches[0].pageY-o.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};return a(t,"tapend",e,c),!0})},remove:function(){e(this).off(i.endevent,e(this).data.callee)}},e.event.special.taphold={setup:function(){var t,n=this,o=e(n),c={x:0,y:0};o.on(i.startevent,function(e){if(e.which&&1!==e.which)return!1;o.data("tapheld",!1),t=e.target;var s=e.originalEvent,r=(new Date).getTime(),h={x:i.touch_capable?s.touches[0].screenX:e.screenX,y:i.touch_capable?s.touches[0].screenY:e.screenY},u={x:i.touch_capable?s.touches[0].pageX-s.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?s.touches[0].pageY-s.touches[0].target.offsetTop:e.offsetY};return c.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,c.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY,i.hold_timer=window.setTimeout(function(){var l=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,p=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY;if(e.target==t&&c.x==l&&c.y==p){o.data("tapheld",!0);var g=(new Date).getTime(),f={x:i.touch_capable?s.touches[0].screenX:e.screenX,y:i.touch_capable?s.touches[0].screenY:e.screenY},d={x:i.touch_capable?s.touches[0].pageX-s.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?s.touches[0].pageY-s.touches[0].target.offsetTop:e.offsetY};duration=g-r;var v={startTime:r,endTime:g,startPosition:h,startOffset:u,endPosition:f,endOffset:d,duration:duration,target:e.target};o.data("callee1",arguments.callee),a(n,"taphold",e,v)}},i.taphold_threshold),!0}).on(i.endevent,function(){o.data("callee2",arguments.callee),o.data("tapheld",!1),window.clearTimeout(i.hold_timer)})},remove:function(){e(this).off(i.startevent,e(this).data.callee1).off(i.endevent,e(this).data.callee2)}},e.event.special.doubletap={setup:function(){var t,n,o,c,s=this,r=e(s);r.on(i.startevent,function(e){return!(e.which&&1!==e.which||(r.data("doubletapped",!1),t=e.target,r.data("callee1",arguments.callee),c=e.originalEvent,o={position:{x:i.touch_capable?c.touches[0].screenX:e.screenX,y:i.touch_capable?c.touches[0].screenY:e.screenY},offset:{x:i.touch_capable?c.touches[0].pageX-c.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?c.touches[0].pageY-c.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target},0))}).on(i.endevent,function(e){var h=(new Date).getTime(),u=r.data("lastTouch")||h+1,l=h-u;if(window.clearTimeout(n),r.data("callee2",arguments.callee),l<i.doubletap_int&&l>0&&e.target==t&&l>100){r.data("doubletapped",!0),window.clearTimeout(i.tap_timer);var p={position:{x:i.touch_capable?c.touches[0].screenX:e.screenX,y:i.touch_capable?c.touches[0].screenY:e.screenY},offset:{x:i.touch_capable?c.touches[0].pageX-c.touches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?c.touches[0].pageY-c.touches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target},g={firstTap:o,secondTap:p,interval:p.time-o.time};a(s,"doubletap",e,g)}else r.data("lastTouch",h),n=window.setTimeout(function(e){window.clearTimeout(n)},i.doubletap_int,[e]);r.data("lastTouch",h)})},remove:function(){e(this).off(i.startevent,e(this).data.callee1).off(i.endevent,e(this).data.callee2)}},e.event.special.singletap={setup:function(){var t=this,n=e(t),o=null,c=null,s={x:0,y:0};n.on(i.startevent,function(e){return!(e.which&&1!==e.which||(c=(new Date).getTime(),o=e.target,n.data("callee1",arguments.callee),s.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,s.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY,0))}).on(i.endevent,function(e){n.data("callee2",arguments.callee),e.target==o&&(end_pos_x=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageX:e.pageX,end_pos_y=e.originalEvent.changedTouches?e.originalEvent.changedTouches[0].pageY:e.pageY,i.tap_timer=window.setTimeout(function(){if(!n.data("doubletapped")&&!n.data("tapheld")&&s.x==end_pos_x&&s.y==end_pos_y){var o=e.originalEvent,r={position:{x:i.touch_capable?o.changedTouches[0].screenX:e.screenX,y:i.touch_capable?o.changedTouches[0].screenY:e.screenY},offset:{x:i.touch_capable?o.changedTouches[0].pageX-o.changedTouches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?o.changedTouches[0].pageY-o.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};r.time-c<i.taphold_threshold&&a(t,"singletap",e,r)}},i.doubletap_int))})},remove:function(){e(this).off(i.startevent,e(this).data.callee1).off(i.endevent,e(this).data.callee2)}},e.event.special.tap={setup:function(){var t,n=this,o=e(n),c=!1,s=null,r={x:0,y:0};o.on(i.startevent,function(e){return o.data("callee1",arguments.callee),!(e.which&&1!==e.which||(c=!0,r.x=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageX:e.pageX,r.y=e.originalEvent.targetTouches?e.originalEvent.targetTouches[0].pageY:e.pageY,t=(new Date).getTime(),s=e.target,0))}).on(i.endevent,function(e){o.data("callee2",arguments.callee);var h=e.originalEvent.targetTouches?e.originalEvent.changedTouches[0].pageX:e.pageX,u=e.originalEvent.targetTouches?e.originalEvent.changedTouches[0].pageY:e.pageY;if(diff_x=r.x-h,diff_y=r.y-u,s==e.target&&c&&(new Date).getTime()-t<i.taphold_threshold&&(r.x==h&&r.y==u||diff_x>=-i.tap_pixel_range&&diff_x<=i.tap_pixel_range&&diff_y>=-i.tap_pixel_range&&diff_y<=i.tap_pixel_range)){var l=e.originalEvent,p={position:{x:i.touch_capable?l.changedTouches[0].screenX:e.screenX,y:i.touch_capable?l.changedTouches[0].screenY:e.screenY},offset:{x:i.touch_capable?l.changedTouches[0].pageX-l.changedTouches[0].target.offsetLeft:e.offsetX,y:i.touch_capable?l.changedTouches[0].pageY-l.changedTouches[0].target.offsetTop:e.offsetY},time:(new Date).getTime(),target:e.target};a(n,"tap",e,p)}})},remove:function(){e(this).off(i.startevent,e(this).data.callee1).off(i.endevent,e(this).data.callee2)}},e.event.special.swipe={setup:function(){function t(t){s=e(t.target),s.data("callee1",arguments.callee),u.x=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageX:t.pageX,u.y=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageY:t.pageY,l.x=u.x,l.y=u.y,r=!0;var a=t.originalEvent;o={position:{x:i.touch_capable?a.touches[0].screenX:t.screenX,y:i.touch_capable?a.touches[0].screenY:t.screenY},offset:{x:i.touch_capable?a.touches[0].pageX-a.touches[0].target.offsetLeft:t.offsetX,y:i.touch_capable?a.touches[0].pageY-a.touches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target};for(var n=new Date;new Date-n<100;);}function a(t){s=e(t.target),s.data("callee2",arguments.callee),l.x=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageX:t.pageX,l.y=t.originalEvent.targetTouches?t.originalEvent.targetTouches[0].pageY:t.pageY,window.clearTimeout(i.hold_timer);var a,n=s.data("xthreshold"),c=s.data("ythreshold"),p=void 0!==n&&!1!==n&&parseInt(n)?parseInt(n):i.swipe_h_threshold,g=void 0!==c&&!1!==c&&parseInt(c)?parseInt(c):i.swipe_v_threshold;if(u.y>l.y&&u.y-l.y>g&&(a="swipeup"),u.x<l.x&&l.x-u.x>p&&(a="swiperight"),u.y<l.y&&l.y-u.y>g&&(a="swipedown"),u.x>l.x&&u.x-l.x>p&&(a="swipeleft"),void 0!=a&&r){u.x=0,u.y=0,l.x=0,l.y=0,r=!1;var f=t.originalEvent;endEvnt={position:{x:i.touch_capable?f.touches[0].screenX:t.screenX,y:i.touch_capable?f.touches[0].screenY:t.screenY},offset:{x:i.touch_capable?f.touches[0].pageX-f.touches[0].target.offsetLeft:t.offsetX,y:i.touch_capable?f.touches[0].pageY-f.touches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target};var d=Math.abs(o.position.x-endEvnt.position.x),v=Math.abs(o.position.y-endEvnt.position.y),w={startEvnt:o,endEvnt:endEvnt,direction:a.replace("swipe",""),xAmount:d,yAmount:v,duration:endEvnt.time-o.time};h=!0,s.trigger("swipe",w).trigger(a,w)}}function n(t){s=e(t.target);var a="";if(s.data("callee3",arguments.callee),h){var n=s.data("xthreshold"),c=s.data("ythreshold"),u=void 0!==n&&!1!==n&&parseInt(n)?parseInt(n):i.swipe_h_threshold,l=void 0!==c&&!1!==c&&parseInt(c)?parseInt(c):i.swipe_v_threshold,p=t.originalEvent;endEvnt={position:{x:i.touch_capable?p.changedTouches[0].screenX:t.screenX,y:i.touch_capable?p.changedTouches[0].screenY:t.screenY},offset:{x:i.touch_capable?p.changedTouches[0].pageX-p.changedTouches[0].target.offsetLeft:t.offsetX,y:i.touch_capable?p.changedTouches[0].pageY-p.changedTouches[0].target.offsetTop:t.offsetY},time:(new Date).getTime(),target:t.target},o.position.y>endEvnt.position.y&&o.position.y-endEvnt.position.y>l&&(a="swipeup"),o.position.x<endEvnt.position.x&&endEvnt.position.x-o.position.x>u&&(a="swiperight"),
o.position.y<endEvnt.position.y&&endEvnt.position.y-o.position.y>l&&(a="swipedown"),o.position.x>endEvnt.position.x&&o.position.x-endEvnt.position.x>u&&(a="swipeleft");var g=Math.abs(o.position.x-endEvnt.position.x),f=Math.abs(o.position.y-endEvnt.position.y),d={startEvnt:o,endEvnt:endEvnt,direction:a.replace("swipe",""),xAmount:g,yAmount:f,duration:endEvnt.time-o.time};s.trigger("swipeend",d)}r=!1,h=!1}var o,c=this,s=e(c),r=!1,h=!1,u={x:0,y:0},l={x:0,y:0};s.on(i.startevent,t),s.on(i.moveevent,a),s.on(i.endevent,n)},remove:function(){e(this).off(i.startevent,e(this).data.callee1).off(i.moveevent,e(this).data.callee2).off(i.endevent,e(this).data.callee3)}},e.event.special.scrollstart={setup:function(){function t(e,t){n=t,a(c,n?"scrollstart":"scrollend",e)}var n,o,c=this,s=e(c);s.on(i.scrollevent,function(e){s.data("callee",arguments.callee),n||t(e,!0),clearTimeout(o),o=setTimeout(function(){t(e,!1)},50)})},remove:function(){e(this).off(i.scrollevent,e(this).data.callee)}};var c,s,r,h,u=e(window),l={0:!0,180:!0};if(i.orientation_support){var p=window.innerWidth||e(window).width(),g=window.innerHeight||e(window).height();r=p>g&&p-g>50,h=l[window.orientation],(r&&h||!r&&!h)&&(l={"-90":!0,90:!0})}e.event.special.orientationchange={setup:function(){return!i.orientation_support&&(s=c(),u.on("throttledresize",t),!0)},teardown:function(){return!i.orientation_support&&(u.off("throttledresize",t),!0)},add:function(e){var t=e.handler;e.handler=function(e){return e.orientation=c(),t.apply(this,arguments)}}},e.event.special.orientationchange.orientation=c=function(){var e=!0,t=document.documentElement;return e=i.orientation_support?l[window.orientation]:t&&t.clientWidth/t.clientHeight<1.1,e?"portrait":"landscape"},e.event.special.throttledresize={setup:function(){e(this).on("resize",w)},teardown:function(){e(this).off("resize",w)}};var f,d,v,w=function(){d=(new Date).getTime(),v=d-m,v>=250?(m=d,e(this).trigger("throttledresize")):(f&&window.clearTimeout(f),f=window.setTimeout(t,250-v))},m=0;e.each({scrollend:"scrollstart",swipeup:"swipe",swiperight:"swipe",swipedown:"swipe",swipeleft:"swipe",swipeend:"swipe"},function(t,a,n){e.event.special[t]={setup:function(){e(this).on(a,e.noop)}}})}(_dereq_("./../../../node_modules/jquery/dist/jquery"))},{"./../../../node_modules/jquery/dist/jquery":96}],139:[function(_dereq_,module,exports){function MobileThreadController(e){ThreadController.call(this,e),this._range}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),MobileEditorView=_dereq_("./ui/editorview"),MobileNotificationView=_dereq_("./ui/thread/notification"),MobileThreadPopover=_dereq_("./ui/threadpopover"),MobileThreadView=_dereq_("./ui/thread/view"),MobileQuestionMenu=_dereq_("./ui/menu/question"),RepliesThreadContainer=_dereq_("./ui/stream/repliesthreadcontainer"),ThreadController=_dereq_("../..//thread/controller"),ThreadEvents=_dereq_("../../events/events").thread,viewEnum=_dereq_("../../enums").navigableViews,WriteEvents=_dereq_("../../events/events").write,XRange=_dereq_("./../../../../lib/xrange/src/xrange");inherits(MobileThreadController,ThreadController);MobileThreadController.prototype.events=function(){var e={};return e[ThreadEvents.TUCK_THREAD]="_handleTuckThread",e[ThreadEvents.UNTUCK_THREAD]="_handleUntuckThread",e}(),$.extend(MobileThreadController.prototype.events,ThreadController.prototype.events),MobileThreadController.prototype.threadCSS="/css/mobile-thread.css",MobileThreadController.prototype.VIEW_MAP=function(){var e={};return $.extend(e,ThreadController.prototype.VIEW_MAP),e[viewEnum.EDIT]=MobileEditorView,e[viewEnum.EDITOR]=MobileEditorView,e[viewEnum.QUESTION]=MobileQuestionMenu,e[viewEnum.REPLIES]=RepliesThreadContainer,e}(),MobileThreadController.prototype._applyScrollPosition=function(){window.scrollTo(0,this._scrollTop),this._scrollTop=0,this._range&&this._range.addToSelection(),this._range=null},MobileThreadController.prototype._handleCommentActionSuccess=function(e,r){var t=[r.event.type,r.event.namespace].join(".");t!==WriteEvents.POST_DELETE&&t!==WriteEvents.POST_HIDE||this.$antenna.trigger(ThreadEvents.DESTROY_THREAD),ThreadController.prototype._handleCommentActionSuccess.call(this,e,r)},MobileThreadController.prototype._handleNavigate=function(e,r){this._activeView&&this._activeView instanceof MobileThreadView&&(this._scrollTop=window.pageYOffset||document.documentElement.scrollTop),ThreadController.prototype._handleNavigate.call(this,e,r),this._range=new XRange,this._range.clearNativeSelection(),this._container.setFullScreen()},MobileThreadController.prototype._handleNavigateBack=function(e,r){ThreadController.prototype._handleNavigateBack.call(this,e,r),0===this._viewHistory.length&&(this._container.unsetFullScreen&&this._container.unsetFullScreen(),this._activeView instanceof MobileThreadView&&this._applyScrollPosition())},MobileThreadController.prototype._handleNavigateToThread=function(){ThreadController.prototype._handleNavigateToThread.call(this),this._container.unsetFullScreen(),this._activeView instanceof MobileThreadView&&this._applyScrollPosition()},MobileThreadController.prototype._handlePermalinkBack=function(){this._container.unsetFullScreen(),this._viewHistory=[],ThreadController.prototype._handlePermalinkBack.call(this)},MobileThreadController.prototype._handleTuckThread=function(){if(this._activeView instanceof MobileThreadView){var e=this._container.$el.outerHeight()-56,r=e+"px";0!==e&&(r="-"+r),this._container.$el.css("bottom",r)}},MobileThreadController.prototype._handleUntuckThread=function(){this._container.$el.css("bottom","")},MobileThreadController.prototype.createContainer=function(e){return new MobileThreadPopover(e)},MobileThreadController.prototype.createNotification=function(e){return new MobileNotificationView(e)},MobileThreadController.prototype.createPermalinkThreadContainer=function(){var e=new RepliesThreadContainer({permalinkView:!0});return this._container.setFullScreen(),this._viewHistory.push(e),e},MobileThreadController.prototype.createThreadView=function(){return new MobileThreadView({blockId:this._getActiveBlock().id})},module.exports=MobileThreadController},{"../..//thread/controller":157,"../../enums":133,"../../events/events":134,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/xrange/src/xrange":90,"./../../../../node_modules/jquery/dist/jquery":96,"./ui/editorview":144,"./ui/menu/question":145,"./ui/stream/repliesthreadcontainer":148,"./ui/thread/notification":151,"./ui/thread/view":152,"./ui/threadpopover":153}],140:[function(_dereq_,module,exports){function MobileCommentActions(e){CommentActions.call(this,e)}var CommentActions=_dereq_("../../../../thread/ui/comment/actions"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),mobileActionsTemplate=_dereq_("../../../../../templates/mobile/actions.mustache"),MobileVoteContainer=_dereq_("./votecontainer");inherits(MobileCommentActions,CommentActions),MobileCommentActions.prototype.createVoteContainer=function(){return new MobileVoteContainer(this.opts)},MobileCommentActions.prototype.template=mobileActionsTemplate.render.bind(mobileActionsTemplate),module.exports=MobileCommentActions},{"../../../../../templates/mobile/actions.mustache":216,"../../../../thread/ui/comment/actions":160,"./../../../../../../lib/inherits/inherits.js":11,"./votecontainer":143}],141:[function(_dereq_,module,exports){var BaseCommentView=_dereq_("../../../../thread/ui/comment/baseview"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),mobileReplyViewTemplate=_dereq_("../../../../../templates/mobile/reply.mustache"),ThreadEvents=_dereq_("../../../../events/events").thread,MobileReplyView=function(e){BaseCommentView.call(this,e)};inherits(MobileReplyView,BaseCommentView),MobileReplyView.prototype._handleMoreClick=function(){this.$el.trigger(ThreadEvents.NAVIGATE,{model:this._model,value:"etc"})},MobileReplyView.prototype.elClass=[BaseCommentView.CLASSES.COMMENT,BaseCommentView.CLASSES.REPLY].join(" "),MobileReplyView.prototype.events=function(){var e=BaseCommentView.CLASSES,i={};return i["tap ."+e.MORE_BTN]="_handleMoreClick",i}(),MobileReplyView.prototype.template=mobileReplyViewTemplate.render.bind(mobileReplyViewTemplate),module.exports=MobileReplyView},{"../../../../../templates/mobile/reply.mustache":224,"../../../../events/events":134,"../../../../thread/ui/comment/baseview":161,"./../../../../../../lib/inherits/inherits.js":11}],142:[function(_dereq_,module,exports){function MobileCommentView(e){Observer(this),BaseCommentView.call(this,e)}var $=_dereq_("./../../../../../../node_modules/jquery/dist/jquery"),BaseCommentView=_dereq_("../../../../thread/ui/comment/baseview"),BaseThreadContainer=_dereq_("../../../../thread/ui/basethreadcontainer"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),MobileCommentActions=_dereq_("./actions"),mobileCommentViewTemplate=_dereq_("../../../../../templates/mobile/comment.mustache"),MobileReplyView=_dereq_("./reply"),MobileVoteContainer=_dereq_("./votecontainer"),Observer=_dereq_("./../../../../../../lib/observer/src/observer.js"),readMoreTemplate=_dereq_("../../../../../templates/mobile/readmore.mustache"),textEnumeration=_dereq_("../../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../../events/events").thread;inherits(MobileCommentView,BaseCommentView),MobileCommentView.CLASSES={CARD:"lf-card",READ_MORE:"lf-read-more",REPLY_CONTAINER:"lf-reply-container",VOTE_COUNT:"lf-vote-count"},MobileCommentView.prototype._bodyOverflow=function(){var e=this.$bodyEl[0];return e.offsetHeight<e.scrollHeight},MobileCommentView.prototype._handleMoreClick=function(e){e.preventDefault(),this.$el.trigger(ThreadEvents.NAVIGATE,{model:this._model,value:"etc"})},MobileCommentView.prototype.createActions=function(){var e=new MobileCommentActions({model:this._model});return this.listenTo(e.getVoteContainer(),MobileVoteContainer.EVENTS.USER_VOTED,$.proxy(this.render,this)),e},MobileCommentView.prototype.events=function(){var e=BaseCommentView.CLASSES,t={};return t["tap ."+e.MORE_BTN]="_handleMoreClick",t}(),MobileCommentView.prototype.enterDocument=function(){this._bodyOverflow()&&this.addReadMore()},MobileCommentView.prototype.addReadMore=function(){var e=readMoreTemplate.render({strings:{readMore:textEnumeration.get(textEnumeration.KEYS.COMMENT_READ_MORE)}});this.$bodyEl.append($(e))},MobileCommentView.prototype.destroy=function(){BaseCommentView.prototype.destroy.call(this),this.stopListening()},MobileCommentView.prototype.getTemplateContext=function(){var e,t,o=BaseCommentView.prototype.getTemplateContext.call(this),i=textEnumeration.KEYS;return o.voteCount=this._model.votes.helpfulness,o.replyCount=this._model.replyCount,o.hasReplies=o.replyCount>0,o.replyCount>1?(e=textEnumeration.get(i.COMMENT_REPLY_LINK),e=e.replace("{number}",o.replyCount)):e=textEnumeration.get(i.COMMENT_REPLY_LINK_SING),t=1===o.voteCount?textEnumeration.get(i.COMMENT_VOTE_COUNT_SING):textEnumeration.get(i.COMMENT_VOTE_COUNT),o.strings=o.strings||{},o.strings.voteCount=t,o.strings.replyLink=e,o},MobileCommentView.prototype.getThreadContainer=function(){return this._replyContainer},MobileCommentView.prototype.render=function(){BaseCommentView.prototype.render.call(this),this.$bodyEl=this.$("."+BaseCommentView.CLASSES.BODY),this._replyContainer=new BaseThreadContainer({commentConstructor:MobileReplyView,el:this.$("."+MobileCommentView.CLASSES.REPLY_CONTAINER)}),this._replyContainer.render(),this.enterDocument()},MobileCommentView.prototype.template=mobileCommentViewTemplate.render.bind(mobileCommentViewTemplate),module.exports=MobileCommentView},{"../../../../../templates/mobile/comment.mustache":217,"../../../../../templates/mobile/readmore.mustache":222,"../../../../events/events":134,"../../../../i18n/enumeration":135,"../../../../thread/ui/basethreadcontainer":159,"../../../../thread/ui/comment/baseview":161,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../lib/observer/src/observer.js":42,"./../../../../../../node_modules/jquery/dist/jquery":96,"./actions":140,"./reply":141,"./votecontainer":143}],143:[function(_dereq_,module,exports){function MobileVoteContainer(e){VoteContainer.call(this,e)}var auth=_dereq_("../../../../util/auth"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),mobileVoteContainerTemplate=_dereq_("../../../../../templates/mobile/votecontainer.mustache"),VoteContainer=_dereq_("../../../../thread/ui/comment/votecontainer");inherits(MobileVoteContainer,VoteContainer),MobileVoteContainer.CLASSES=VoteContainer.CLASSES,MobileVoteContainer.EVENTS={USER_VOTED:"votes.userVoted"},MobileVoteContainer.prototype.events={"tap a":"_handleVoteClick"},MobileVoteContainer.prototype.template=mobileVoteContainerTemplate.render.bind(mobileVoteContainerTemplate),MobileVoteContainer.prototype._instantFeedbackRender=function(e){if(auth.get("livefyre")){var t=this._getDiff(e);this._model.votes.helpfulness+=t,this.emit(MobileVoteContainer.EVENTS.USER_VOTED),this._updateVoteStatus(e)}},module.exports=MobileVoteContainer},{"../../../../../templates/mobile/votecontainer.mustache":229,"../../../../thread/ui/comment/votecontainer":164,"../../../../util/auth":192,"./../../../../../../lib/inherits/inherits.js":11}],144:[function(_dereq_,module,exports){function MobileEditorView(e){BaseEditorView.call(this,e),this._setType(e),this._nav=new Navbar({actionDesc:this._actionStr,actionHandler:$.proxy(this.handlePostBtnClick,this),title:this._titleStr})}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),BaseEditorView=_dereq_("../../../thread/ui/baseeditorview"),editorUtil=_dereq_("../../../util/editor"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),loader=_dereq_("./../../../../../lib/livefyre-bootstrap/src/loader"),loaderTemplate=_dereq_("../../../../templates/thread/loader.mustache"),mobileEditorViewTemplate=_dereq_("../../../../templates/mobile/editor.mustache"),Navbar=_dereq_("./navbar"),normalizeParagraphTags=_dereq_("../../../util/editor").normalizeParagraphTags,textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,WriteEvents=_dereq_("../../../events/events").write;inherits(MobileEditorView,BaseEditorView),MobileEditorView.TYPES=BaseEditorView.TYPES,MobileEditorView.prototype._handleNavigateBack=function(){this._setDraft(this.opts.editorId,this.$textareaEl.val())},MobileEditorView.prototype._handlePostComplete=function(e){if(e)return void this.showError(BaseEditorView.ERRORS.GENERIC);this._type===BaseEditorView.TYPES.EDIT&&this.opts.model.set({body:this._getContents()}),this._setDraft(this.opts.editorId,null),this.$el.trigger(ThreadEvents.NAVIGATE_TO_THREAD)},MobileEditorView.prototype._setType=function(e){var t=textEnumeration.KEYS;if(e.parentId)this._postEvent=WriteEvents.POST_REPLY,this._titleStr=textEnumeration.get(t.EDITOR_REPLY_TITLE),this._actionStr=textEnumeration.get(t.EDITOR_POST_BTN_MOBILE),this._type=BaseEditorView.TYPES.REPLY;else if(e.model){this._postEvent=WriteEvents.POST_EDIT;var i=e.model.parentId?t.EDITOR_EDIT_REPLY_TITLE:t.EDITOR_EDIT_TITLE;this._titleStr=textEnumeration.get(i),this._actionStr=textEnumeration.get(t.EDITOR_EDIT_BTN),this._type=BaseEditorView.TYPES.EDIT}else this._postEvent=WriteEvents.POST_ANNOTATION,this._titleStr=textEnumeration.get(t.EDITOR_TITLE),this._actionStr=textEnumeration.get(t.EDITOR_POST_BTN_MOBILE),this._type=BaseEditorView.TYPES.WRITE},MobileEditorView.prototype.classes={EDITOR:"lf-mobile-editor",FIELD:"lf-editor-field",POST_BTN:"lf-editor-post-btn"},MobileEditorView.prototype.elClass=MobileEditorView.prototype.classes.EDITOR,MobileEditorView.prototype.events=function(){var e={};return e[ThreadEvents.NAVIGATE_BACK]="_handleNavigateBack",e}(),MobileEditorView.prototype.initialize=function(){this._type===MobileEditorView.TYPES.EDIT&&this.$textareaEl.val(normalizeParagraphTags(this.opts.model.body)),this.focus()},MobileEditorView.prototype.focus=function(){this.$textareaEl.one("focus",function(e){window.scrollTo(0,0)}),editorUtil.focusAndPlaceCursorAtEnd(this.$textareaEl)},MobileEditorView.prototype.render=function(){BaseEditorView.prototype.render.call(this),this._nav.setElement(this.$("."+Navbar.CLASSES.HEADER)),this._nav.render();var e=this._getDraft(this.opts.editorId);if(e)return void this.$textareaEl.val(e);this._type===BaseEditorView.TYPES.EDIT&&this.$textareaEl.val(normalizeParagraphTags(this.opts.model.body)),window.scrollTo(0,0)},MobileEditorView.prototype.sendPostEvent=function(e){this.$el.trigger(this._postEvent,e);var t=$(loaderTemplate.render());loader.decorate(t,60),this.$textareaEl.replaceWith(t)},MobileEditorView.prototype.showError=function(e){window.alert(e)},MobileEditorView.prototype.template=mobileEditorViewTemplate.render.bind(mobileEditorViewTemplate),module.exports=MobileEditorView},{"../../../../templates/mobile/editor.mustache":218,"../../../../templates/thread/loader.mustache":244,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../thread/ui/baseeditorview":158,"../../../util/editor":195,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/livefyre-bootstrap/src/loader":20,"./../../../../../node_modules/jquery/dist/jquery":96,"./navbar":146}],145:[function(_dereq_,module,exports){function QuestionMenu(e){Navigable.call(this,e)}var $=_dereq_("./../../../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),Navigable=_dereq_("../../../../thread/ui/navigable"),questionMenuTemplate=_dereq_("../../../../../templates/blocks/questionpopover.mustache"),textEnumeration=_dereq_("../../../../i18n/enumeration");inherits(QuestionMenu,Navigable),QuestionMenu.prototype.events=Navigable.prototype.events,QuestionMenu.prototype.getTemplateContext=function(){var e=Navigable.prototype.getTemplateContext.call(this),t=textEnumeration.KEYS;return $.extend(e.strings,{explanation:textEnumeration.get(t.QUESTION_EXPLANATION),mockText:textEnumeration.get(t.QUESTION_MOCK_TEXT),title:textEnumeration.get(t.QUESTION_TITLE)}),e},QuestionMenu.prototype.subTemplate=questionMenuTemplate,module.exports=QuestionMenu},{"../../../../../templates/blocks/questionpopover.mustache":211,"../../../../i18n/enumeration":135,"../../../../thread/ui/navigable":176,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../node_modules/jquery/dist/jquery":96}],146:[function(_dereq_,module,exports){function NavBar(a){Navigable.call(this,a)}var inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),Navigable=_dereq_("../../../thread/ui/navigable"),navBarTemplate=_dereq_("../../../../templates/mobile/navbar.mustache");inherits(NavBar,Navigable),NavBar.CLASSES=Navigable.CLASSES,NavBar.prototype.elClass=Navigable.CLASSES.HEADER,NavBar.prototype.template=navBarTemplate.render.bind(navBarTemplate),NavBar.prototype.elTag="header",module.exports=NavBar},{"../../../../templates/mobile/navbar.mustache":221,"../../../thread/ui/navigable":176,"./../../../../../lib/inherits/inherits.js":11}],147:[function(_dereq_,module,exports){function MobileStreamFooter(e){View.call(this,e),this._streamCount=0,this._currIndex=0,this._loading=!0}var inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),mobileStreamFooterTemplate=_dereq_("../../../../../templates/mobile/streamfooter.mustache"),textEnumeration=_dereq_("../../../../i18n/enumeration"),View=_dereq_("./../../../../../../lib/view/src/view.js");inherits(MobileStreamFooter,View),MobileStreamFooter.CLASSES={STREAM_FOOTER:"lf-stream-footer"},MobileStreamFooter.prototype.elTag="footer",MobileStreamFooter.prototype.elClass=MobileStreamFooter.CLASSES.STREAM_FOOTER,MobileStreamFooter.prototype.getIndex=function(){return this._currIndex},MobileStreamFooter.prototype.getStreamCount=function(){return this._streamCount},MobileStreamFooter.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS,t=this.getIndex();return{index:t,indexOne:1===t,inviteRead:this.getStreamCount()>0&&!t,inviteWrite:t===this._streamCount&&1!==this._streamCount,loading:this._loading,streamCount:this.getStreamCount(),strings:{loading:textEnumeration.get(e.SLIDER_LOADING),read:textEnumeration.get(e.SLIDER_INVITE_READ),tally:textEnumeration.get(e.SLIDER_COMMENT_TALLY),write:textEnumeration.get(e.SLIDER_INVITE_WRITE)}}},MobileStreamFooter.prototype.setIndex=function(e){this._currIndex=e},MobileStreamFooter.prototype.setStreamCount=function(e){this._loading=!1,this._streamCount=e},MobileStreamFooter.prototype.template=mobileStreamFooterTemplate.render.bind(mobileStreamFooterTemplate),module.exports=MobileStreamFooter},{"../../../../../templates/mobile/streamfooter.mustache":227,"../../../../i18n/enumeration":135,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../lib/view/src/view.js":83}],148:[function(_dereq_,module,exports){var inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),MobileCommentView=_dereq_("../comment/view"),Navbar=_dereq_("../navbar"),requireAuth=_dereq_("../../../../util/auth").requireAuth,repliesThreadContainerTemplate=_dereq_("../../../../../templates/mobile/repliesthreadcontainer.mustache"),SortingUtil=_dereq_("../../../../util/sorting"),textEnumeration=_dereq_("../../../../i18n/enumeration"),ThreadContainer=_dereq_("../../../../thread/ui/threadcontainer"),ThreadEvents=_dereq_("../../../../events/events").thread,viewEnum=_dereq_("../../../../enums").navigableViews,WriteEvents=_dereq_("../../../../events/events").write,RepliesThreadContainer=function(e){e=e||{},ThreadContainer.call(this,e),this._commentConstructor=MobileCommentView,this._topComment=e.topComment,this._replies=e.replies;var t=textEnumeration.KEYS;this._nav=new Navbar({backEvent:e.permalinkView&&ThreadEvents.PERMALINK_BACK,backStr:e.permalinkView&&textEnumeration.get(t.PERMALINK_BACK_BTN),title:textEnumeration.get(t.MENU_REPLIES_VIEW_TITLE)})};inherits(RepliesThreadContainer,ThreadContainer),RepliesThreadContainer.CLASSES={COMMENT_REPLIES:"lf-comment-replies",THREAD:"lf-thread",REPLY_BUTTON:"lf-reply-btn"},RepliesThreadContainer.prototype._handleReplyClick=requireAuth(function(){this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.EDITOR,parentId:this._topComment.id,editorId:this._topComment.id})},WriteEvents.POST_REPLY),RepliesThreadContainer.prototype.comparator=SortingUtil.createdAtComparator,RepliesThreadContainer.prototype.elClass=RepliesThreadContainer.CLASSES.COMMENT_REPLIES,RepliesThreadContainer.prototype.elTag="section",RepliesThreadContainer.prototype.events=function(){var e={};return e["tap ."+RepliesThreadContainer.CLASSES.REPLY_BUTTON]="_handleReplyClick",e}(),RepliesThreadContainer.prototype.getContainerElement=function(){return this.$("."+RepliesThreadContainer.CLASSES.THREAD)},RepliesThreadContainer.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS;return{strings:{backBtn:textEnumeration.get(e.MENU_BACK_BTN),reply:textEnumeration.get(e.MENU_REPLIES_VIEW_REPLY)}}},RepliesThreadContainer.prototype.initialize=function(e){if(e||(e=[],e.push(this._topComment),e.push.apply(e,this._replies)),!this._topComment)for(var t=0,r=e.length;t<r&&(this._topComment=e[t]).parentId;t++);ThreadContainer.prototype.initialize.call(this,e)},RepliesThreadContainer.prototype.render=function(){ThreadContainer.prototype.render.call(this),this._nav.setElement(this.$("."+Navbar.CLASSES.HEADER)),this._nav.render()},RepliesThreadContainer.prototype.template=repliesThreadContainerTemplate.render.bind(repliesThreadContainerTemplate),module.exports=RepliesThreadContainer},{"../../../../../templates/mobile/repliesthreadcontainer.mustache":223,"../../../../enums":133,"../../../../events/events":134,"../../../../i18n/enumeration":135,"../../../../thread/ui/threadcontainer":186,"../../../../util/auth":192,"../../../../util/sorting":203,"../comment/view":142,"../navbar":146,"./../../../../../../lib/inherits/inherits.js":11}],149:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../../node_modules/jquery/dist/jquery"),ArrayUtil=_dereq_("../../../../util/array"),BaseThreadContainer=_dereq_("../../../../thread/ui/basethreadcontainer"),CommentActions=_dereq_("../../../../thread/ui/comment/actions"),delegate=_dereq_("./../../../../../../lib/view/src/delegate"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),loader=_dereq_("./../../../../../../lib/livefyre-bootstrap/src/loader"),loadercardTemplate=_dereq_("../../../../../templates/mobile/loadercard.mustache"),MobileCommentView=_dereq_("../comment/view"),MobileStreamFooter=_dereq_("./footer"),mobileStreamViewTemplate=_dereq_("../../../../../templates/mobile/stream.mustache"),requireAuth=_dereq_("../../../../util/auth").requireAuth,slideTemplate=_dereq_("../../../../../templates/mobile/slide.mustache"),SortingUtil=_dereq_("../../../../util/sorting"),Swipe=_dereq_("./../../../../../../lib/Swipe/swipe.js"),ThreadEvents=_dereq_("../../../../events/events").thread,View=_dereq_("./../../../../../../lib/view/src/view.js"),viewEnum=_dereq_("../../../../enums").navigableViews,WriteEvents=_dereq_("../../../../events/events").write,WriteSlide=_dereq_("./writeslide"),MobileStreamView=function(e){e=e||{},e.commentConstructor=MobileCommentView,BaseThreadContainer.call(this,e),this._replies={},this._replyIds={},this._swipe=null,this._streamFooter=new MobileStreamFooter};inherits(MobileStreamView,BaseThreadContainer),MobileStreamView.CLASSES={CONTAINER_FOOTER:"lf-comment-container-footer",ESCAPE:"lf-escape-button",LOADER:"lf-loader-container",LOADER_CARD:"lf-loader-card",SLIDE:"lf-slide",STREAM:"lf-stream",STREAM_FOOTER:"lf-stream-footer",WRAPPER:"lf-swipe-wrapper"},MobileStreamView.SLIDE_OFFSET=1,MobileStreamView.MAX_COMMENT_HEIGHT=250,MobileStreamView.prototype._handleNewComment=function(e){if(!e.isPending()){var t=this._commentIds.indexOf(e.id);-1===t&&e.parentId&&(t=this._commentIds.indexOf(e.parentId)),-1!==t&&this._swipe.slide(t+MobileStreamView.SLIDE_OFFSET)}},MobileStreamView.prototype._addSlide=function(e,t,i){var r=i||this.getContainerElement(),o=r.children();e.render();var s=$(slideTemplate.render());s.append(e.$el),t>=o.length?r.append(s):o.eq(t).before(s)},MobileStreamView.prototype._handleReplyClick=requireAuth(function(e,t){var i=this.getCurrentComment();this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.EDITOR,parentId:i.id,editorId:i.id})},WriteEvents.POST_REPLY),MobileStreamView.prototype._addWriteCard=function(e){this._writeSlide=new WriteSlide,this._addSlide(this._writeSlide,0,$(e))},MobileStreamView.prototype._handleSlideMove=function(){this._setMaxHeight()},MobileStreamView.prototype._handleShowReplies=function(){var e=this.getCurrentComment();this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.REPLIES,topComment:e,replies:this._replies[e.id]||[]})},MobileStreamView.prototype._handleSlideChange=function(){var e=this.getCurrentComment();this._highlightSelection(e),this._streamFooter.setIndex(this._swipe.getPos()),this._streamFooter.render()},MobileStreamView.prototype._handleWriteClick=function(e,t){e.target.className.indexOf(MobileStreamView.CLASSES.ESCAPE)>-1||this._handlePostAnnotation(e,t)},MobileStreamView.prototype._handlePostAnnotation=requireAuth(function(e,t){this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.EDITOR,editorId:this.opts.blockId})},WriteEvents.POST_ANNOTATION),MobileStreamView.prototype._handleThreadEscape=function(e){e.preventDefault(),this.$el.trigger(ThreadEvents.DESTROY_THREAD)},MobileStreamView.prototype._highlightSelection=function(e){var t;e&&(t=e.selectedText),this.$el.trigger(ThreadEvents.DEACTIVATE_HIGHLIGHTED_TEXT),t&&this.$el.trigger(ThreadEvents.ACTIVATE_HIGHLIGHTED_TEXT,{selectedText:t,blockId:e.blockId})},MobileStreamView.prototype._matchSlideHeight=function(){var e=this._swipe.getPos(),t=$(this.$wrapperEl.children()[e].firstChild).outerHeight();this.$wrapperEl.height(t)},MobileStreamView.prototype._setMaxHeight=function(){this.$wrapperEl.height(MobileStreamView.MAX_COMMENT_HEIGHT)},MobileStreamView.prototype.addComment=function(e){$.isArray(e)||(e=[e]),this.reinitialize(e),this._handleNewComment(e[0])},MobileStreamView.prototype.comparator=SortingUtil.helpfulnessComparator,MobileStreamView.prototype.destroy=function(){BaseThreadContainer.prototype.destroy.call(this),this._streamFooter&&this._streamFooter.destroy(),this._swipe.kill()},MobileStreamView.prototype.elClass=MobileStreamView.CLASSES.STREAM,MobileStreamView.prototype.elTag="section",MobileStreamView.prototype.enterDocument=function(){for(var e,t,i=this._commentIds.length-1;i>=0;i--)t=this._commentIds[i],e=this._comments[t],e.enterDocument()},MobileStreamView.prototype.delegateEvents=function(e){if(this.$wrapperEl)return e||(e=this.events)?(delegate.delegateEvents(this.$wrapperEl,e,this.uid,this),this):this},MobileStreamView.prototype.events=function(){var e={};return e["tap ."+MobileStreamView.CLASSES.ESCAPE]="_handleThreadEscape",e["tap ."+MobileStreamView.CLASSES.CONTAINER_FOOTER]="_handleShowReplies",e["tap ."+MobileCommentView.CLASSES.READ_MORE]="_handleShowReplies",e["tap ."+CommentActions.CLASSES.REPLY_BTN]="_handleReplyClick",e["tap ."+WriteSlide.prototype.elClass]="_handleWriteClick",e[ThreadEvents.SLIDE_TO_COMMENT]="_handleNewComment",e}(),MobileStreamView.prototype.getContainerElement=function(){return this.$wrapperEl},MobileStreamView.prototype.getCurrentComment=function(){var e=this._swipe.getPos(),t=this._commentIds[e-MobileStreamView.SLIDE_OFFSET];if(t)return this._comments[t].getModel()},MobileStreamView.prototype.initialize=function(e){this._loaderView&&this._loaderView.destroy(),this._loaderView=null;var t,i,r=[];e=e||[];for(var o=e.length-1;o>=0;o--)t=e[o],i=t.parentId,i?(this._replies[i]=this._replies[i]||[],!this._replyIds[t.id]&&this._replies[i].push(t),this._replyIds[t.id]=!0):t.isVisible()&&r.push(t);var s=document.createDocumentFragment();$.each(r,$.proxy(this.processComment,this,!1,$(s))),this._addWriteCard(s),this.getContainerElement().append(s),this.enterDocument();var a=this._commentIds.length>0?1:0;this._swipe=Swipe(this.el,{callback:$.proxy(this._handleSlideChange,this),continuous:r.length>1,disableScroll:!0,slideMove:$.proxy(this._handleSlideMove,this),startSlide:a,stopPropagation:!0,transitionEnd:$.proxy(this._matchSlideHeight,this)}),this._streamFooter.setStreamCount(this._commentIds.length),this._handleSlideChange(),this._matchSlideHeight(),this.delegateEvents()},MobileStreamView.prototype.reinitialize=function(e){this._swipe&&this._swipe.kill(),this._setMaxHeight(),BaseThreadContainer.prototype.reinitialize.call(this,e)},MobileStreamView.prototype.template=mobileStreamViewTemplate.render.bind(mobileStreamViewTemplate),MobileStreamView.prototype.processComment=function(e,t,i,r){if(!this._comments[r.id]){var o=this._replies[r.id];o&&(r.replyCount=o.length);var s=new this._commentConstructor(this._getCommentOptions(r));this._comments[r.id]=s;var a=$.proxy(this.comparator,this),l=ArrayUtil.findIndex(this._commentIds,r.id,a);if(this._addSlide(s,l,t),l>=this._commentIds.length)return void this._commentIds.push(r.id);this._commentIds.splice(l,0,r.id)}},MobileStreamView.prototype.render=function(){View.prototype.render.call(this);var e=MobileStreamView.CLASSES;this._streamFooter.setElement(this.$("."+e.STREAM_FOOTER)),this._streamFooter.render(),this.$wrapperEl=this.$("."+e.WRAPPER),this._loaderView=new View,this._loaderView.template=loadercardTemplate.render.bind(loadercardTemplate),this._loaderView.$el.addClass(MobileStreamView.CLASSES.LOADER_CARD),this._loaderView.render(),loader.decorate(this._loaderView.$("."+MobileStreamView.CLASSES.LOADER),60),this._streamFooter.$el.before(this._loaderView.$el)},module.exports=MobileStreamView},{"../../../../../templates/mobile/loadercard.mustache":220,"../../../../../templates/mobile/slide.mustache":225,"../../../../../templates/mobile/stream.mustache":226,"../../../../enums":133,"../../../../events/events":134,
"../../../../thread/ui/basethreadcontainer":159,"../../../../thread/ui/comment/actions":160,"../../../../util/array":191,"../../../../util/auth":192,"../../../../util/sorting":203,"../comment/view":142,"./../../../../../../lib/Swipe/swipe.js":1,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../lib/livefyre-bootstrap/src/loader":20,"./../../../../../../lib/view/src/delegate":81,"./../../../../../../lib/view/src/view.js":83,"./../../../../../../node_modules/jquery/dist/jquery":96,"./footer":147,"./writeslide":150}],150:[function(_dereq_,module,exports){function WriteSlide(e){View.call(this,e),Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this.render,this)),this.listenTo(auth,"logout",$.proxy(this.render,this))}var $=_dereq_("./../../../../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../../../../util/auth"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),Observer=_dereq_("./../../../../../../lib/observer/src/observer.js"),textEnumeration=_dereq_("../../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../../events/events").thread,View=_dereq_("./../../../../../../lib/view/src/view.js"),writeSlideTemplate=_dereq_("../../../../../templates/mobile/writeslide.mustache");inherits(WriteSlide,View),WriteSlide.CLASSES={USER_SETTINGS:"lf-user-settings"},WriteSlide.prototype._handleSettingsTap=function(e){e.stopPropagation(),this.$el.trigger(ThreadEvents.NAVIGATE,{value:"user"})},WriteSlide.prototype.elClass="lf-write-card",WriteSlide.prototype.events=function(){var e={};return e["tap ."+WriteSlide.CLASSES.USER_SETTINGS]="_handleSettingsTap",e}(),WriteSlide.prototype.template=writeSlideTemplate.render.bind(writeSlideTemplate),WriteSlide.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS;return{userLoggedIn:auth.get("livefyre"),strings:{title:textEnumeration.get(e.EDITOR_TITLE),text:textEnumeration.get(e.SLIDER_WRITE_TEXT)}}},WriteSlide.prototype.destroy=function(){View.prototype.destroy.call(this),this.stopListening()},module.exports=WriteSlide},{"../../../../../templates/mobile/writeslide.mustache":230,"../../../../events/events":134,"../../../../i18n/enumeration":135,"../../../../util/auth":192,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../lib/observer/src/observer.js":42,"./../../../../../../lib/view/src/view.js":83,"./../../../../../../node_modules/jquery/dist/jquery":96}],151:[function(_dereq_,module,exports){function MobileNotificationView(i){NotificationView.call(this,i)}var $=_dereq_("./../../../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),NotificationView=_dereq_("../../../../thread/ui/thread/notification");inherits(MobileNotificationView,NotificationView),MobileNotificationView.prototype.decorate=function(){this.render(),$(document.body).append(this.$el)},module.exports=MobileNotificationView},{"../../../../thread/ui/thread/notification":184,"./../../../../../../lib/inherits/inherits.js":11,"./../../../../../../node_modules/jquery/dist/jquery":96}],152:[function(_dereq_,module,exports){var inherits=_dereq_("./../../../../../../lib/inherits/inherits.js"),MobileStreamView=_dereq_("../stream/view"),nullFunction=_dereq_("../../../../util/internals").nullFunction,ThreadView=_dereq_("../../../../thread/ui/thread/baseview"),MobileThreadView=function(e){ThreadView.call(this,e)};inherits(MobileThreadView,ThreadView),MobileThreadView.prototype._handleUserLogin=nullFunction,MobileThreadView.prototype._handleUserLogout=nullFunction,MobileThreadView.prototype.createStreamView=function(){return new MobileStreamView({blockId:this.opts.blockId})},MobileThreadView.prototype.handleFetchThreadSuccess=function(e){this._streamView.initialize(e)},MobileThreadView.prototype.getThreadContainer=function(){return this._streamView},MobileThreadView.prototype.render=function(){ThreadView.prototype.render(this),this._streamView.render(),this.$el.prepend(this._streamView.$el)},module.exports=MobileThreadView},{"../../../../thread/ui/thread/baseview":183,"../../../../util/internals":196,"../stream/view":149,"./../../../../../../lib/inherits/inherits.js":11}],153:[function(_dereq_,module,exports){function MobileThreadPopover(e){e=e||{},Popover.call(this,$.extend({minPopoverInView:MAX_COMMENT_HEIGHT,scrollDuration:500,topSpacing:10},e)),this.$_contentElements=null;var o=e.rootContentEl||document.body;this.$_rootContentEl=$(o)}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),domUtil=_dereq_("../../../util/dom"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),MAX_COMMENT_HEIGHT=_dereq_("./stream/view").MAX_COMMENT_HEIGHT,mobileThreadPopoverTemplate=_dereq_("../../../../templates/mobile/threadpopover.mustache"),Popover=_dereq_("../../../ui/popover");inherits(MobileThreadPopover,Popover),MobileThreadPopover.CLASSES=function(){var e={};return $.extend(e,Popover.CLASSES),e.FULLSCREEN="lf-fullscreen",e.LF="lf",e.MAIN="lf-thread-popover",e.POPOVER="lf-mobile-popover",e}(),MobileThreadPopover.prototype.elClass=[MobileThreadPopover.CLASSES.POPOVER,MobileThreadPopover.CLASSES.MAIN].join(" "),MobileThreadPopover.prototype.template=mobileThreadPopoverTemplate.render.bind(mobileThreadPopoverTemplate),MobileThreadPopover.prototype.resizeAndReposition=function(e){var o=domUtil.getBoundingClientRect(e),t=o.bottom+domUtil.getScrollY()+10;this._scrollIntoPosition(t)},MobileThreadPopover.prototype.setFullScreen=function(){var e=MobileThreadPopover.CLASSES;this.$el.addClass(e.FULLSCREEN),this.$_contentNode.addClass(e.FULLSCREEN),this.$el.children().addClass(e.FULLSCREEN),this.$_contentElements||(this.$_contentElements=this.$_rootContentEl.children().filter(function(){return-1===this.className.indexOf(e.LF)&&$(this).is(":visible")}),this.$_contentElements.hide(),this.$el.show())},MobileThreadPopover.prototype.unsetFullScreen=function(){var e=MobileThreadPopover.CLASSES;this.$el.removeClass(e.FULLSCREEN),this.$_contentNode.removeClass(e.FULLSCREEN),this.$el.children().removeClass(e.FULLSCREEN),this.$_contentElements&&(this.$_contentElements.show(),this.$_contentElements=null)},module.exports=MobileThreadPopover},{"../../../../templates/mobile/threadpopover.mustache":228,"../../../ui/popover":189,"../../../util/dom":194,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./stream/view":149}],154:[function(_dereq_,module,exports){var Author=function(a){a=a||{},this.avatar=a.avatar||"",this.displayName=a.displayName||"",this.handle=a.handle||"",this.id=a.id||"",this.profileUrl=a.profileUrl||""};module.exports=Author},{}],155:[function(_dereq_,module,exports){var Content=_dereq_("./../../../lib/streamhub-sdk/src/content/main"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),Block=function(){Content.call(this),this.id=null,this.blockType=Block.TYPES.UNSET,this.numAnnotations=0,this.simhash="",this.index=-1,this.el=null,this.content=null,this.generatedId="",this.isFetched=!1};inherits(Block,Content),Block.DATA_ID="data-lf-anchor-id",Block.TYPES={UNSET:0,TEXT:1,IMAGE:2,MEDIA:3,RICH:4},Block.prototype.getId=function(){return this.id||this.generatedId},Block.prototype.setId=function(t){this.id=t},Block.prototype.isSaved=function(){return!!this.id},Block.prototype.setFetchedState=function(t){this.isFetched=t},Block.prototype.getFetchedState=function(){return this.isFetched},Block.prototype.updateNumAnnotations=function(t,n){var e="number"==typeof n,i=e?n:this.numAnnotations+t,o=i-this.numAnnotations;return this.set({numAnnotations:i}),o},module.exports=Block},{"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/content/main":67}],156:[function(_dereq_,module,exports){function Comment(t){t=t||{},this.blockId=null,this.collectionId=t.collectionId,this.hasBeenRendered=!1,this.lastCount=0,this.origin=t.origin||Comment.ORIGIN.UNKNOWN,this.permalink=null,this.selectedText=null,this.votes={upvotes:0,downvotes:0,helpfulness:0,list:[]},this.erefs=t.erefs||null,this.replyCount=0,LivefyreContent.call(this,t)}var auth=_dereq_("../util/auth"),CommentAnnotator=_dereq_("../adapters/commentannotator"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),LivefyreContent=_dereq_("./../../../lib/streamhub-sdk/src/content/types/livefyre-content"),visEnums=_dereq_("../enums").commentVisibility;inherits(Comment,LivefyreContent),Comment.ORIGIN={UNKNOWN:0,BOOTSTRAP:1,STREAM:2},Comment.prototype._calculateVisibility=function(t){var i=auth.get("livefyre"),e=this.isUserAuthor(),n=i&&i.isMod({collectionId:this.collectionId});switch(t){case visEnums.EVERYONE:return!0;case visEnums.OWNER:return e;case visEnums.GROUP:return e||n;default:return!1}},Comment.prototype._createAnnotator=function(){return new CommentAnnotator},Comment.prototype.calculateCountIncrement=function(){var t=this._calculateVisibility(this.visibility),i=this._calculateVisibility(this.lastVisibility),e=!i&&t,n=i&&!t,s=e?1:n?-1:0,o=s===this.lastCount?0:s;return 0!==o&&(this.lastCount=o),o},Comment.prototype.isPending=function(){return this.visibility===visEnums.GROUP},Comment.prototype.isUserAuthor=function(t){var i=auth.get("livefyre"),e=t?t.id:i?i.get("id"):null;return this.author.id===e},Comment.prototype.isVisible=function(){return this._calculateVisibility(this.visibility)},module.exports=Comment},{"../adapters/commentannotator":113,"../enums":133,"../util/auth":192,"./../../../lib/inherits/inherits.js":11,"./../../../lib/streamhub-sdk/src/content/types/livefyre-content":69}],157:[function(_dereq_,module,exports){function ThreadController(e){BaseController.call(this,e),this._cssLoaded=!1,this._activeView=null,this._container=this.createContainer(e.config),this.bindListeners(this._container.$el),this._scrollTop=0,this._threadView=null,this._viewHistory=[],this._initPermalink()}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),AuthMenu=_dereq_("./ui/menu/auth"),BaseController=_dereq_("../controller/base"),BlockEvents=_dereq_("../events/events").block,Comment=_dereq_("../models/comment"),CommentEvents=_dereq_("../events/events").comment,ConfirmMenu=_dereq_("./ui/menu/confirm"),Container=_dereq_("../ui/container"),EditMenu=_dereq_("./ui/menu/edit"),EtcMenu=_dereq_("./ui/menu/etc"),FlagMenu=_dereq_("./ui/menu/flag"),InfoMenu=_dereq_("./ui/menu/info"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),NotificationView=_dereq_("./ui/thread/notification"),objectUtil=_dereq_("../util/object"),PermalinkThreadContainer=_dereq_("./ui/permalinkthreadcontainer"),permalinkUtil=_dereq_("../util/permalink"),ScriptLoader=_dereq_("./../../../lib/scriptloader/src/javascript/scriptloader.js"),ShareMenu=_dereq_("./ui/menu/share"),SourceEvents=_dereq_("../events/events").source,Storage=_dereq_("../util/storage"),ThreadEvents=_dereq_("../events/events").thread,ThreadPopover=_dereq_("./ui/threadpopover"),ThreadView=_dereq_("./ui/thread/view"),userAgentUtil=_dereq_("../util/useragent"),UserEvents=_dereq_("../events/events").user,UserMenu=_dereq_("./ui/menu/user"),viewEnum=_dereq_("../enums").navigableViews,WriteEvents=_dereq_("../events/events").write;inherits(ThreadController,BaseController);var VALID_NOTIFICATION_EVENTS=function(){var e={};return e[WriteEvents.POST_APPROVE]=!0,e[WriteEvents.POST_DELETE]=!0,e[WriteEvents.POST_FLAG]=!0,e[WriteEvents.POST_HIDE]=!0,e}();ThreadController.prototype.containerEvents=function(){return $.map([CommentEvents,SourceEvents,ThreadEvents,UserEvents,WriteEvents],function(e){return objectUtil.getValues(e)})}(),ThreadController.prototype.events=function(){var e={};return e[CommentEvents.ACTION_SUCCESS]="_handleCommentActionSuccess",e[ThreadEvents.ACTIVATE_THREAD]="_activateThread",e[ThreadEvents.CHANGE_VIEW]="_handleViewChange",e[ThreadEvents.DESTROY_THREAD]="_destroyThread",e[ThreadEvents.NAVIGATE]="_handleNavigate",e[ThreadEvents.NAVIGATE_BACK]="_handleNavigateBack",e[ThreadEvents.NAVIGATE_TO_THREAD]="_handleNavigateToThread",e[ThreadEvents.PERMALINK_BACK]="_handlePermalinkBack",e[WriteEvents.POST_APPROVE]="_handleNavigateToThread",e[WriteEvents.POST_DELETE]="_handleNavigateToThread",e[WriteEvents.POST_FLAG]="_handleNavigateToThread",e[WriteEvents.POST_HIDE]="_handleNavigateToThread",e}(),ThreadController.prototype.globalEvents=function(){var e={};return e[SourceEvents.THREAD_BTN_CLICK]="_handleGlobalThreadBtnClick",e}(),ThreadController.prototype.threadCSS="/css/thread.css",ThreadController.prototype.VIEW_MAP=function(){var e={};return e[viewEnum.AUTH]=AuthMenu,e[viewEnum.CONFIRM]=ConfirmMenu,e[viewEnum.EDIT]=EditMenu,e[viewEnum.ETC]=EtcMenu,e[viewEnum.FLAG]=FlagMenu,e[viewEnum.INFO]=InfoMenu,e[viewEnum.SHARE]=ShareMenu,e[viewEnum.THREAD]=ThreadView,e[viewEnum.USER]=UserMenu,e}(),ThreadController.prototype._activateThread=function(e,t){if(this._getActiveBlock()&&!this._container.isShowing()){this._destroyThread();var i=this;this._destroyThread(),this._container.onHide(function(){i._initThread(function(){i._loadThreadContent({forceEmpty:!!(t||{}).forceWriteCard})})})}},ThreadController.prototype._applyScrollPosition=function(){this._activeView.getThreadContainer().$el.scrollTop(this._scrollTop),this._scrollTop=0},ThreadController.prototype._destroyThread=function(e){this.deactivating=!0;var t=$.proxy(function(){this._threadView&&this._threadView.destroy(),this._threadView=null,this._activeView&&this._activeView.destroy(),this._activeView=null,$.each(this._viewHistory,function(e,t){t.destroy()}),this._viewHistory=[],this.deactivating=!1},this);if(this._container.isVisible())return void this._container.hide(t);t()},ThreadController.prototype._fetchThread=function(){var e=this._getActiveBlock(),t=$.proxy(this._handleThreadFetched,this,e);this._collection.fetchThread(e.id,t)},ThreadController.prototype._handleCommentActionSuccess=function(e,t){var i=t.event.type+"."+t.event.namespace;VALID_NOTIFICATION_EVENTS[i]&&this._activeView&&this.createNotification({event:i}).decorate(this._activeView.$el)},ThreadController.prototype._handleCommentBatch=function(e){var t,i=this._threadView.getThreadContainer();$.each(e,function(e,r){r.origin=r.origin||Comment.ORIGIN.STREAM,t=r.isUserAuthor()&&!r.parentId,i.addComment(r,t)})},ThreadController.prototype._handleGlobalThreadBtnClick=BaseController.onlyHandleExternalMessage(ThreadController.prototype._destroyThread),ThreadController.prototype._handleNavigate=function(e,t){var i=this.VIEW_MAP[t.value];i&&(this._activeView&&(this._activeView instanceof ThreadView&&(this._scrollTop=this._activeView.getThreadContainer().$el.scrollTop()),this._activeView.detach(),this._viewHistory.push(this._activeView)),t.collection=this._collection,this._activeView=new i(t),this._activeView.render(),this._container.setContentNode(this._activeView.$el),this._initializeView(this._activeView))},ThreadController.prototype._handleNavigateBack=function(){this._activeView.destroy(),this._activeView=this._viewHistory.pop(),this._activeView&&this._container.setContentNode(this._activeView.$el),this._activeView instanceof ThreadView&&this._applyScrollPosition()},ThreadController.prototype._handleNavigateToThread=function(){$.each(this._viewHistory,$.proxy(function(e,t){t instanceof this._threadView.constructor||t.destroy()},this)),this._activeView=this._threadView,this._container.setContentNode(this._activeView.$el),this._initializeView(this._activeView),this._viewHistory=[],this._activeView instanceof ThreadView&&this._applyScrollPosition()},ThreadController.prototype._handlePermalink=function(e){if(e){var t=this;this._collection.getThread({contentId:e},function(e,i,r){function n(){t._activeView=t._threadView=t.createPermalinkThreadContainer(),t._loadPopover(t._activeView),t._activeView.initialize(r)}var o=Storage.get(i),a=t._config.permalinkScrollDelegate;if(t._collection.block=o,t.$antenna.trigger(ThreadEvents.ACTIVATE_BLOCK,{block:o}),a)return void a({el:o.el},n);permalinkUtil.scrollToPermalink(o.el,n)})}},ThreadController.prototype._initPermalink=function(){var e="annotations",t=window.addEventListener?"message":"onmessage",r=function(t){var i=null;if("object"==typeof t.data)i=t.data;else try{i=JSON.parse(t.data)}catch(e){return}i.to===e&&i.data&&"put"===i.action&&this._handlePermalink(i.data.contentId)},n=this;(window.addEventListener||window.attachEvent)(t,function(e){r.call(n,e)},!1),function(t){var i={from:e,to:"permalink",action:"post",data:{name:e,collectionId:t}};window.postMessage(JSON.stringify(i),"*")}(this._collection.id)},ThreadController.prototype._handlePermalinkBack=function(){this._activeView.destroy(),this._initThread($.proxy(this._loadThreadContent,this))},ThreadController.prototype._handleThreadFetched=function(e,t){if(this._getActiveBlock().getId()===e.id){if(t)return void this._threadView.handleFetchThreadFailure(t);var i=Storage.getCommentsForBlock(e.id);this.$antenna.trigger(BlockEvents.UPDATE_COUNT,{blockId:e.id,count:Storage.getNumCommentsForBlock(e.id)}),this._threadView.handleFetchThreadSuccess(i)}},ThreadController.prototype._handleViewChange=function(e,t){this._viewHistory=[],this._handleNavigate(e,t)},ThreadController.prototype._initializeView=function(e){"function"==typeof e.initialize&&e.initialize()},ThreadController.prototype._initThread=function(e){var t=this;this._loadCSS(function(){t._threadView=t._activeView=t.createThreadView(),t._loadPopover(t._activeView),e()})},ThreadController.prototype._loadCSS=function(e){if(this._cssLoaded)return e();this._cssLoaded=!0,ScriptLoader.loadCSS(this._config.servers.assets+this.threadCSS),userAgentUtil.isIE()&&8===userAgentUtil.getIEVersion()&&ScriptLoader.loadCSS(this._config.servers.assets+"/css/ie8.css"),setTimeout(e,200)},ThreadController.prototype._loadPopover=function(e){this._container.show(this._getActiveBlock().el),e.render(),this._container.setContentNode(e.$el)},ThreadController.prototype._loadThreadContent=function(e){var t=this._getActiveBlock();if((e||{}).forceEmpty)return void this._threadView.handleFetchThreadSuccess();if(t.getFetchedState()){var i=Storage.getCommentsForBlock(t.id);return void this._threadView.handleFetchThreadSuccess(i)}this._fetchThread()},ThreadController.prototype._maybeCountComment=function(e,t){this._collection.maxEventId>=e.meta.event||this.$antenna.trigger(BlockEvents.UPDATE_COUNT,{blockId:t.id,inc:e.calculateCountIncrement()})},ThreadController.prototype.createContainer=function(e){return this._config.threadContainerEl?(e.parentEl=this._config.threadContainerEl,new Container(e)):this._config.inlineThreads?new Container(e):new ThreadPopover(e)},ThreadController.prototype.createNotification=function(e){return new NotificationView(e)},ThreadController.prototype.createPermalinkThreadContainer=function(){return new PermalinkThreadContainer},ThreadController.prototype.createThreadView=function(){return new ThreadView({assetServer:this._config.servers.assets,blockId:this._getActiveBlock().id,defaultAvatar:this._config.defaultAvatar,isCustomNetwork:this._collection.isCustomNetwork()})},ThreadController.prototype.destroy=function(){BaseController.prototype.destroy.call(this),this._destroyThread(),this._container.destroy(),this._collection=null,this._config=null},ThreadController.prototype.handleReadable=function(){for(var e,t,i,r=this._getActiveBlock(),n=[],o=r&&this._threadView;t=this._collection.read();)i=Storage.get(t.id),(e=Storage.get(t.blockId||i.blockId))&&(this._maybeCountComment(t,e),o&&e.id===r.id&&n.push(t));o&&this._handleCommentBatch(n)},module.exports=ThreadController},{"../controller/base":127,"../enums":133,"../events/events":134,"../models/comment":156,"../ui/container":188,"../util/object":198,"../util/permalink":199,"../util/storage":204,"../util/useragent":206,"./../../../lib/inherits/inherits.js":11,"./../../../lib/scriptloader/src/javascript/scriptloader.js":44,"./../../../node_modules/jquery/dist/jquery":96,"./ui/menu/auth":167,"./ui/menu/confirm":169,"./ui/menu/edit":170,"./ui/menu/etc":171,"./ui/menu/flag":172,"./ui/menu/info":173,"./ui/menu/share":174,"./ui/menu/user":175,"./ui/permalinkthreadcontainer":177,"./ui/thread/notification":184,"./ui/thread/view":185,"./ui/threadpopover":187}],158:[function(_dereq_,module,exports){function BaseEditorView(e){Editor.call(this,e)}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),Editor=_dereq_("./../../../../lib/streamhub-editor/src/javascript/editor"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),normalizeNewlines=_dereq_("../../util/editor").normalizeNewlines,textEnumeration=_dereq_("../../i18n/enumeration");inherits(BaseEditorView,Editor),BaseEditorView.TYPES={EDIT:"edit",REPLY:"reply",WRITE:"write"};var DRAFTS={};BaseEditorView.ERRORS={BODY:"Please enter a body",GENERIC:"There was an error"},BaseEditorView.prototype._getContents=function(){var e=this.$textareaEl.val();return normalizeNewlines(e,!0)},BaseEditorView.prototype.buildPostEventObj=function(){return{body:this._getContents(),callback:$.proxy(this._handlePostComplete,this),model:this.opts.model,parentId:this.opts.parentId,shareTypes:[]}},BaseEditorView.prototype._getDraft=function(e){return DRAFTS["draft-"+e]},BaseEditorView.prototype._setDraft=function(e,t){return DRAFTS["draft-"+e]=t},BaseEditorView.prototype.validate=function(e){var t=e.body;if(!t)return this.showError(BaseEditorView.ERRORS.BODY),!1;var r=textEnumeration.KEYS;return t!==textEnumeration.get(r.EDITOR_PLACEHOLDER)||(this.showError(BaseEditorView.ERRORS.BODY),!1)},module.exports=BaseEditorView},{"../../i18n/enumeration":135,"../../util/editor":195,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/streamhub-editor/src/javascript/editor":51,"./../../../../node_modules/jquery/dist/jquery":96}],159:[function(_dereq_,module,exports){var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),ArrayUtil=_dereq_("../../util/array"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),SortingUtil=_dereq_("../../util/sorting"),View=_dereq_("./../../../../lib/view/src/view.js"),BaseThreadContainer=function(e){View.call(this,e),this._commentConstructor=this.opts.commentConstructor,this._commentIds=[],this._comments={}};inherits(BaseThreadContainer,View),BaseThreadContainer.prototype._getCommentOptions=function(e){return{assetServer:this.opts.assetServer,defaultAvatar:this.opts.defaultAvatar,model:e}},BaseThreadContainer.prototype.addComment=function(e,t,i){var r=i||this.getContainerElement();$.isArray(e)||(e=[e]),$.each(e,$.proxy(this.processComment,this,!!t,$(r)))},BaseThreadContainer.prototype.comparator=SortingUtil.createdAtComparator,BaseThreadContainer.prototype.getContainerElement=function(){return this.$el},BaseThreadContainer.prototype.initialize=function(e){var t=this.getContainerElement(),i=document.createDocumentFragment();this.addComment(e,!1,i),t.append(i)},BaseThreadContainer.prototype.processComment=function(e,t,i,r){if(!this._comments[r.id]){var n=new this._commentConstructor(this._getCommentOptions(r));if(n.render(),n.handleVisChange(),this._comments[r.id]=n,e)return this._commentIds.splice(0,0,r.id),void t.prepend(n.$el);var o=$.proxy(this.comparator,this),s=ArrayUtil.findIndex(this._commentIds,r.id,o);if(s>=this._commentIds.length)return this._commentIds.push(r.id),void t.append(n.$el);this._commentIds.splice(s,0,r.id),n.$el.insertBefore(t[0].childNodes[s])}},BaseThreadContainer.prototype.reinitialize=function(e){e=e||[];for(var t,i,r=[],n=0,o=this._commentIds.length;n<o;n++)i=this._comments[this._commentIds[n]],t=i.getModel(),r.push(t),i.destroy();this._commentIds=[],this._comments={},r.push.apply(r,e),this.getContainerElement().empty(),this.initialize(r)},module.exports=BaseThreadContainer},{"../../util/array":191,"../../util/sorting":203,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/view/src/view.js":83,"./../../../../node_modules/jquery/dist/jquery":96}],160:[function(_dereq_,module,exports){var commentActionsTemplate=_dereq_("../../../../templates/thread/comment/actions.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),View=_dereq_("./../../../../../lib/view/src/view.js"),VoteContainer=_dereq_("./votecontainer"),CommentActions=function(t){View.call(this,t),this._model=t.model,this._voteContainer=this.createVoteContainer()};inherits(CommentActions,View),CommentActions.CLASSES={ACTIONS:"lf-comment-actions",REPLY_BTN:"lf-reply-btn",SEPARATOR:"lf-separator",VOTES:"lf-votes"},CommentActions.prototype.createVoteContainer=function(){return new VoteContainer(this.opts)},CommentActions.prototype.template=commentActionsTemplate.render.bind(commentActionsTemplate),CommentActions.prototype.getTemplateContext=function(){return{strings:{replyBtn:textEnumeration.get(textEnumeration.KEYS.REPLY_BTN)}}},CommentActions.prototype.getVoteContainer=function(){return this._voteContainer},CommentActions.prototype.hideReplyBtn=function(){this.$_replyBtn.hide(),this.$_separator.hide()},CommentActions.prototype.render=function(){View.prototype.render.call(this);var t=CommentActions.CLASSES;this._voteContainer.setElement(this.$("."+t.VOTES)[0]),this._voteContainer.render(),this.$_replyBtn=this.$("."+t.REPLY_BTN),this.$_separator=this.$("."+t.SEPARATOR)},module.exports=CommentActions},{"../../../../templates/thread/comment/actions.mustache":232,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83,"./votecontainer":164}],161:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),adaptAvatar=_dereq_("../../../adapters/adapters").adaptAvatar,auth=_dereq_("../../../util/auth"),commentViewTemplate=_dereq_("../../../../templates/thread/comment/comment.mustache"),baseCommentTemplate=_dereq_("../../../../templates/thread/comment/base.mustache"),BlockEvents=_dereq_("../../../events/events").block,CommentActions=_dereq_("./actions"),etcCommentTemplate=_dereq_("../../../../templates/thread/comment/etc.mustache"),footerCommentTemplate=_dereq_("../../../../templates/thread/comment/footer.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),tagsTemplate=_dereq_("../../../../templates/thread/comment/tags.mustache"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,UserEvents=_dereq_("../../../events/events").user,View=_dereq_("./../../../../../lib/view/src/view.js"),visEnums=_dereq_("../../../enums").commentVisibility,BaseCommentView=function(e){View.call(this,e),this._model=e.model,this._model.on("change:visibility",$.proxy(this.handleVisChange,this)),this._model.on("change:body",$.proxy(this.render,this)),this._actions=this.createActions()};inherits(BaseCommentView,View),BaseCommentView.CLASSES={ACTIONS:"lf-comment-actions",AVATAR:"lf-comment-author-avatar",BODY:"lf-comment-body",COMMENT:"lf-comment",CONTAINER:"lf-comment-container",DISPLAY_NAME:"lf-comment-author-name",HEADER:"lf-comment-header",REPLY:"lf-reply",MORE_BTN:"lf-etc-btn",PENDING_TAG:"lf-comment-pending-tag",FOOTER:"lf-comment-footer"},BaseCommentView.prototype.elClass=BaseCommentView.CLASSES.COMMENT,BaseCommentView.prototype.elTag="article",BaseCommentView.prototype.events=function(){var e=BaseCommentView.CLASSES,t={};return t["click ."+e.AVATAR]="_handleViewProfile",t["click ."+e.DISPLAY_NAME]="_handleViewProfile",t["click ."+e.MORE_BTN]="_handleMoreClick",t["keydown ."+e.MORE_BTN]="_handleMoreClick",t}(),BaseCommentView.prototype.template=commentViewTemplate.render.bind(commentViewTemplate),BaseCommentView.prototype._handleMoreClick=function(e){9===e.which&&"keydown"===e.type&&this.hideEtcBtn(),13!==e.which&&"keydown"===e.type||this.$el.trigger(ThreadEvents.CHANGE_VIEW,{model:this._model,value:"etc"})},BaseCommentView.prototype.hideEtcBtn=function(){var e=this.$el.find("."+BaseCommentView.CLASSES.MORE_BTN);"block"===e.css("display")&&e.css("display","")},BaseCommentView.prototype._handleViewProfile=function(e){e.stopPropagation(),this.$el.trigger(UserEvents.VIEW_PROFILE,{author:this._model.author})},BaseCommentView.prototype._show=function(){this.$el.show()},BaseCommentView.prototype._triggerVisEvent=function(){this.$el.trigger(BlockEvents.UPDATE_COUNT,{blockId:this._model.blockId,inc:this._model.calculateCountIncrement()})},BaseCommentView.prototype.createActions=function(){return new CommentActions({model:this._model})},BaseCommentView.prototype.destroy=function(){View.prototype.destroy.call(this),this._actions&&this._actions.destroy(),this._actions=null},BaseCommentView.prototype.getModel=function(){return this._model},BaseCommentView.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS;return{author:this._model.author,avatar:adaptAvatar(this._model.author.avatar),body:this._model.body,defaultAvatar:this.opts.defaultAvatar,moderator:this._model.moderator,pending:this._model.isPending(),strings:{commentModeratorTag:textEnumeration.get(e.COMMENT_MODERATOR_TAG),commentPendingTag:textEnumeration.get(e.COMMENT_PENDING_TAG)}}},BaseCommentView.prototype.handleVisChange=function(){switch(this._triggerVisEvent(),this._model.visibility){case visEnums.NONE:return this.handleVisNone();case visEnums.EVERYONE:return this.handleVisEveryone();case visEnums.OWNER:return this.handleVisOwner();case visEnums.GROUP:return this.handleVisGroup();default:throw"Not supported visibility type: "+this._model.visibility}},BaseCommentView.prototype.handleVisEveryone=function(){this.render(),this._show()},BaseCommentView.prototype.handleVisGroup=function(){var e=auth.get("livefyre"),t=!!e&&e.isMod({collectionId:this._model.collectionId});if(this._model.isUserAuthor()||t)return this.render(),void this._show();this.hide()},BaseCommentView.prototype.handleVisNone=function(){this.hide()},BaseCommentView.prototype.handleVisOwner=function(){if(this._model.isUserAuthor())return this.render(),void this._show();this.hide()},BaseCommentView.prototype.hide=function(){this.$el.hide()},BaseCommentView.prototype.render=function(){this.$el.html(this.template(this.getTemplateContext(),{base:baseCommentTemplate,etc:etcCommentTemplate,footer:footerCommentTemplate,tags:tagsTemplate})),this.$footerEl=this.$("."+BaseCommentView.CLASSES.FOOTER),this._actions.setElement(this.$footerEl.find("."+BaseCommentView.CLASSES.ACTIONS)),this._actions.render(),this.$el.attr("id",this._model.id),this._model.hasBeenRendered=!0},BaseCommentView.prototype.shouldRender=function(){var e=auth.get("livefyre"),t=this._model.isUserAuthor(),i=!!e&&e.isMod({collectionId:this._model.collectionId});switch(this._model.visibility){case visEnums.NONE:return!1;case visEnums.EVERYONE:return!0;case visEnums.OWNER:return t;case visEnums.GROUP:return i||t;default:return!1}},module.exports=BaseCommentView},{"../../../../templates/thread/comment/base.mustache":233,"../../../../templates/thread/comment/comment.mustache":234,"../../../../templates/thread/comment/etc.mustache":235,"../../../../templates/thread/comment/footer.mustache":236,"../../../../templates/thread/comment/tags.mustache":237,"../../../adapters/adapters":112,"../../../enums":133,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/auth":192,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83,"./../../../../../node_modules/jquery/dist/jquery":96,"./actions":160}],162:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),BaseCommentView=_dereq_("./baseview"),commentTemplate=_dereq_("../../../../templates/thread/comment/comment.mustache"),etcTemplate=_dereq_("../../../../templates/thread/comment/etc.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),ReplyView=function(e){BaseCommentView.call(this,e)};inherits(ReplyView,BaseCommentView),ReplyView.prototype.elClass=[BaseCommentView.CLASSES.COMMENT,BaseCommentView.CLASSES.REPLY].join(" "),ReplyView.prototype.template=commentTemplate.render.bind(commentTemplate),ReplyView.prototype.render=function(){BaseCommentView.prototype.render.call(this),
this.$("."+BaseCommentView.CLASSES.BODY).children().last().append($(etcTemplate.render()))},module.exports=ReplyView},{"../../../../templates/thread/comment/comment.mustache":234,"../../../../templates/thread/comment/etc.mustache":235,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./baseview":161}],163:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../../../util/auth"),BaseCommentView=_dereq_("./baseview"),CommentActions=_dereq_("./actions"),CommentEvents=_dereq_("../../../events/events").comment,EditorEvents=_dereq_("../../../events/events").editor,EditorView=_dereq_("../editorview"),QueuedExpandableThreadContainer=_dereq_("../queued-expandable-thread-container"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),internals=_dereq_("../../../util/internals"),QueueButton=_dereq_("../queuebutton"),ReplyCommentView=_dereq_("./replyview"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,topCommentTemplate=_dereq_("../../../../templates/thread/comment/topcomment.mustache"),viewEnum=_dereq_("../../../enums").navigableViews,WriteEvents=_dereq_("../../../events/events").write,TopCommentView=function(e){BaseCommentView.call(this,e),this._mouseEventsDisabled=!1,this._replyContainer=null,this._replyEditor=null};inherits(TopCommentView,BaseCommentView),TopCommentView.CLASSES={EDITOR_CONTAINER:"lf-editor-container",REPLY_CONTAINER:"lf-reply-container",ETC_BUTTON:"lf-etc-btn"},$.extend(TopCommentView.CLASSES,BaseCommentView.CLASSES),TopCommentView.prototype.events=function(){var e={},t=QueuedExpandableThreadContainer.EVENTS;return e["click ."+CommentActions.CLASSES.REPLY_BTN]="_toggleReplyEditor",e["keyup ."+CommentActions.CLASSES.REPLY_BTN]="_toggleReplyEditor",e["click ."+QueuedExpandableThreadContainer.CLASSES.REPLY_BTN]="_toggleReplyEditor",e["keyup ."+QueuedExpandableThreadContainer.CLASSES.REPLY_BTN]="_toggleReplyEditor",e[WriteEvents.POST_REPLY]="_interceptReply",e[t.HIDE_REPLY_BTN]="_handleHideReplyBtn",e[ThreadEvents.SHOW_QUEUED_CONTENT]="_handleShowQueuedContent",e.mouseenter="handleMouseEnter",e.mouseleave="handleMouseLeave",e}(),$.extend(TopCommentView.prototype.events,BaseCommentView.prototype.events),TopCommentView.prototype.template=topCommentTemplate.render.bind(topCommentTemplate),TopCommentView.prototype._handleHideReplyBtn=function(){this._actions.hideReplyBtn()},TopCommentView.prototype._handleShowQueuedContent=function(e){e.stopPropagation(),this._replyContainer.$el.trigger(ThreadEvents.SHOW_QUEUED_CONTENT)},TopCommentView.prototype._interceptReply=function(e,t){var i=this,n=t.callback||function(){};t.callback=function(e,t){n(e,t),e||(i.$_editorContainerEl.hide(),i.getThreadContainer().addComment(t))},t.parentId=this._model.id},TopCommentView.prototype._toggleReplyEditor=function(e){function t(){i.getThreadContainer().getReplyButton().show()}var i=this;if(9===e.which&&"keyup"===e.type&&this.showEtcBtn(),13===e.which||"keyup"!==e.type){if(!auth.get("livefyre"))return t(),void this.$el.trigger(ThreadEvents.NAVIGATE,{event:WriteEvents.POST_REPLY,value:viewEnum.AUTH});if(this._replyEditor&&this.$_editorContainerEl.is(":visible"))return void this.$_editorContainerEl.hide();this._replyEditor?this._replyEditor.reset():(this._replyEditor=new EditorView({editorId:this._model.id,el:this.$_editorContainerEl,hideOnBlur:!0,postEvent:WriteEvents.POST_REPLY,type:EditorView.TYPES.REPLY}),this._replyEditor.render()),this.$_editorContainerEl.show(),this._replyEditor.initialize(),$(e.target).hasClass(QueuedExpandableThreadContainer.CLASSES.REPLY_BTN)&&this._replyEditor.$el.one(EditorEvents.HIDE,t)}},TopCommentView.prototype.showEtcBtn=function(){this.$el.find("."+TopCommentView.CLASSES.ETC_BUTTON).css("display","block")},TopCommentView.prototype.destroy=function(){BaseCommentView.prototype.destroy.call(this),this._replyEditor&&this._replyEditor.destroy(),this._replyEditor=null},TopCommentView.prototype.disableMouseEvents=function(e){this._mouseEventsDisabled=e},TopCommentView.prototype.getThreadContainer=function(){return this._replyContainer},TopCommentView.prototype.handleMouseEnter=function(e){if(!this._mouseEventsDisabled){var t=this._model.selectedText;if(t){var i=this;setTimeout(function(){i.$el.trigger(ThreadEvents.ACTIVATE_HIGHLIGHTED_TEXT,{selectedText:t,blockId:i._model.blockId})},1)}}},TopCommentView.prototype.handleMouseLeave=function(e){this._model.selectedText&&!this._mouseEventsDisabled&&this.$el.trigger(ThreadEvents.DEACTIVATE_HIGHLIGHTED_TEXT)},TopCommentView.prototype.hide=function(){BaseCommentView.prototype.hide.call(this),this.$el.trigger(CommentEvents.HIDDEN,this._model)},TopCommentView.prototype.render=function(){var e=TopCommentView.CLASSES,t=textEnumeration.KEYS;BaseCommentView.prototype.render.call(this),this.$_editorContainerEl=this.$("."+e.EDITOR_CONTAINER);var i=new QueueButton({plural:textEnumeration.get(t.QUEUED_REPLIES_PLURAL),singular:textEnumeration.get(t.QUEUED_REPLIES_SINGULAR)});i.render().hide(),this.$footerEl.append(i.$el),this._replyContainer=new QueuedExpandableThreadContainer({assetServer:this.opts.assetServer,commentConstructor:ReplyCommentView,commentQueueBtn:i,defaultAvatar:this.opts.defaultAvatar,el:this.$("."+e.REPLY_CONTAINER)}),this._replyContainer.render()},TopCommentView.prototype.renderEtc=internals.nullFunction,module.exports=TopCommentView},{"../../../../templates/thread/comment/topcomment.mustache":238,"../../../enums":133,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/auth":192,"../../../util/internals":196,"../editorview":165,"../queuebutton":178,"../queued-expandable-thread-container":179,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./actions":160,"./baseview":161,"./replyview":162}],164:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../../../util/auth"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),Observer=_dereq_("./../../../../../lib/observer/src/observer.js"),View=_dereq_("./../../../../../lib/view/src/view.js"),voteContainerTemplate=_dereq_("../../../../templates/thread/comment/votecontainer.mustache"),voteEnums=_dereq_("./../../../../../lib/streamhub-sdk/src/content/annotator-extensions").voteEnums,WriteEvents=_dereq_("../../../events/events").write,voteEnum=voteEnums.vote,voteToCount=voteEnums.voteToCount,VoteContainer=function(t){View.call(this,t),this._model=this.opts.model;var e=this._hasVoted();this._currentVote=e?e.value:voteEnum.UNSET,this._disabled=!1,this._processing=!1,this._model.on("change:votes",$.proxy(this._handleVotesUpdated,this)),Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this._handleUserLogin,this)),this.listenTo(auth,"logout",$.proxy(this._handleUserLogout,this))};inherits(VoteContainer,View),VoteContainer.CLASSES={COUNT:"lf-count",DISABLED:"lf-disabled",DOWNVOTE:"lf-downvote",MAIN:"lf-votes",UPVOTE:"lf-upvote",VOTED:"lf-voted"},VoteContainer.prototype.events={"click a":"_handleVoteClick","keyup a":"_handleVoteClick"},VoteContainer.prototype.template=voteContainerTemplate.render.bind(voteContainerTemplate),VoteContainer.prototype._handleUserLogin=function(){var t=this._hasVoted();this._currentVote=t?t.value:voteEnum.UNSET,this._updateVoteStatus(),this._updateButtonState()},VoteContainer.prototype._handleUserLogout=function(){this._currentVote=voteEnum.UNSET,this._updateVoteStatus(),this._updateButtonState()},VoteContainer.prototype._handleVoteClick=function(t){if(!(13!==t.which&&"keyup"===t.type||this._disabled||this._processing)){this._processing=!0;var e=VoteContainer.CLASSES,o=$(t.target),n=o.hasClass(e.DOWNVOTE),i=n?voteEnum.DOWNVOTE:voteEnum.UPVOTE,r=this._currentVote===i?voteEnum.UNSET:i;o.toggleClass(e.VOTED,r!==voteEnum.UNSET),this.$el.trigger(WriteEvents.POST_VOTE,{authorId:this._model.author.id,callback:$.proxy(this._handleVoteComplete,this),lastValue:this._currentVote,messageId:this._model.id,value:r}),this._instantFeedbackRender(r),this._processing=!1}},VoteContainer.prototype._handleVoteComplete=function(t,e){if(t)return void this.render();this._setCurrentVote(e)},VoteContainer.prototype._handleVotesUpdated=function(t,e){var o=this._hasVoted();this._setCurrentVote(o),this.render()},VoteContainer.prototype._hasVoted=function(){var t=auth.get("livefyre"),e=t?t.get("id"):null;if(!e)return null;for(var o,n=this._model.votes.list,i=0,r=n.length;i<r;i++)if(o=n[i],e===o.author)return o;return null},VoteContainer.prototype._instantFeedbackRender=function(t){if(auth.get("livefyre")){var e=this._getDiff(t);this._model.votes.helpfulness+=e,this._updateVoteCount(),this._updateVoteStatus(t)}},VoteContainer.prototype._getDiff=function(t){var e=-1*voteToCount[this._currentVote];return t!==voteEnum.UNSET&&(e+=voteToCount[t]),e},VoteContainer.prototype._setCurrentVote=function(t){this._currentVote=t?t.value:voteEnum.UNSET},VoteContainer.prototype._updateButtonState=function(){this._disabled=this._model.isUserAuthor(),this.$el.toggleClass(VoteContainer.CLASSES.DISABLED,this._disabled)},VoteContainer.prototype._updateVoteCount=function(t){var e=this._model.votes.helpfulness;void 0!==t&&(e=t),this.$("."+VoteContainer.CLASSES.COUNT).html(e)},VoteContainer.prototype._updateVoteStatus=function(t){var e,o=VoteContainer.CLASSES;if(e=void 0!==t?t:this._currentVote,this.$el.attr("class",o.MAIN),e!==voteEnum.UNSET&&!this._model.isUserAuthor()){var n=e===voteEnum.UPVOTE?o.UPVOTE:o.DOWNVOTE;this.$el.addClass(n)}},VoteContainer.prototype.destroy=function(){View.prototype.destroy.call(this),this.stopListening()},VoteContainer.prototype.getTemplateContext=function(){return{count:this._model.votes.helpfulness}},VoteContainer.prototype.render=function(){View.prototype.render.call(this),this._updateVoteStatus(),this._updateButtonState()},module.exports=VoteContainer},{"../../../../templates/thread/comment/votecontainer.mustache":239,"../../../events/events":134,"../../../util/auth":192,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/observer/src/observer.js":42,"./../../../../../lib/streamhub-sdk/src/content/annotator-extensions":65,"./../../../../../lib/view/src/view.js":83,"./../../../../../node_modules/jquery/dist/jquery":96}],165:[function(_dereq_,module,exports){function EditorView(t){BaseEditorView.call(this,t),this._hideOnBlur=!!t.hideOnBlur,this._isPostBtnVisible=!0,this._isPosting=!1,this._originalHeight=null,this._placeholderSupported=!0,this._type=this.opts.type}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),BaseEditorView=_dereq_("./baseeditorview"),EditorEvents=_dereq_("../../events/events").editor,editorUtil=_dereq_("../../util/editor"),editorViewTemplate=_dereq_("../../../templates/thread/editor.mustache"),errorTemplate=_dereq_("../../../templates/thread/editorerror.mustache"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadEvents=_dereq_("../../events/events").thread;inherits(EditorView,BaseEditorView),EditorView.TYPES=BaseEditorView.TYPES,EditorView.prototype.classes={EDITOR:"lf-editor",FIELD:"lf-editor-field",FOCUS:"lf-editor-focus",POST_BTN:"lf-editor-post-btn",RESIZE:"lf-editor-resize"},EditorView.prototype.elClass=EditorView.prototype.classes.EDITOR,EditorView.prototype.events=function(){var t=EditorView.prototype.classes,e={};return e["blur ."+t.FIELD]="_handleEditorBlur",e["click ."+t.POST_BTN]="handlePostBtnClick",e["focus ."+t.FIELD]="_handleEditorFocus",e["keydown ."+t.FIELD]="_handleEditorKeydown",e["keyup ."+t.FIELD]="_handleEditorKeyup",e}(),EditorView.prototype.template=editorViewTemplate.render.bind(editorViewTemplate),EditorView.prototype._getPostBtnText=function(){var t=textEnumeration.KEYS;return this._isPosting&&this._type===BaseEditorView.TYPES.EDIT?textEnumeration.get(t.EDITOR_EDIT_POSTING):this._isPosting?textEnumeration.get(t.EDITOR_POSTING):this._type===BaseEditorView.TYPES.REPLY?textEnumeration.get(t.EDITOR_REPLY_BTN):this._type===BaseEditorView.TYPES.EDIT?textEnumeration.get(t.EDITOR_EDIT_BTN):textEnumeration.get(t.EDITOR_POST_BTN)},EditorView.prototype._handleEditorBlur=function(){if(this._hideOnBlur&&!this.$textareaEl.val())return this.$el.hide(),void this.$el.trigger(EditorEvents.HIDE);if(this.$el.toggleClass(this.classes.FOCUS,!1),!this._placeholderSupported&&""===this.$textareaEl.val()){var t=textEnumeration.KEYS,e=textEnumeration.get(t.EDITOR_PLACEHOLDER);this.$textareaEl.val(e)}},EditorView.prototype._handleEditorFocus=function(){if(this.$el.toggleClass(this.classes.FOCUS,!0),!this._placeholderSupported){var t=textEnumeration.KEYS,e=textEnumeration.get(t.EDITOR_PLACEHOLDER);this.$textareaEl.val()===e&&this.$textareaEl.val("")}},EditorView.prototype._handleEditorKeydown=function(t){t.stopPropagation(),this._resize(),13===t.keyCode&&!t.shiftKey&&(t.preventDefault(),this.handlePostBtnClick())},EditorView.prototype._handleEditorKeyup=function(t){t.preventDefault(),t.stopPropagation();var e=this.$textareaEl.val();if(this._setDraft(this.opts.editorId,e),this._resize(),0===e.length)return void this._hidePostBtn();this._showPostBtn()},EditorView.prototype._handlePostComplete=function(t,e){if(this._isPosting=!1,this._updatePostBtnText(),t)return void this.showError(t);this._type===BaseEditorView.TYPES.EDIT&&(this.opts.model.set({body:this._getContents()}),this.$el.trigger(ThreadEvents.NAVIGATE_TO_THREAD)),this.reset()},EditorView.prototype._hidePostBtn=function(){this._isPostBtnVisible&&this.$postBtnEl.hide(),this._isPostBtnVisible=!1},EditorView.prototype._processPlaceholders=function(){var t=textEnumeration.KEYS,e=textEnumeration.get(t.EDITOR_PLACEHOLDER);if(void 0!==this.$textareaEl[0].placeholder)return void this.$textareaEl.attr("placeholder",e);this._placeholderSupported=!1,this.$textareaEl.val(e)},EditorView.prototype._resize=function(){var t=this.$textareaEl.val(),e=0;t=editorUtil.escapeHTML(t),this.$resizeEl[0].innerHTML=editorUtil.normalizeNewlines(t),$.each(this.$resizeEl.children(),function(t,i){e+=$(i).height()}),this.$textareaEl.height(e)},EditorView.prototype._showPostBtn=function(){this._isPostBtnVisible||this.$postBtnEl.css("display","block"),this._isPostBtnVisible=!0},EditorView.prototype._updatePostBtnText=function(){this.$postBtnEl.html(this._getPostBtnText())},EditorView.prototype.focus=function(){editorUtil.focusAndPlaceCursorAtEnd(this.$textareaEl)},EditorView.prototype.getTemplateContext=function(){return{strings:{postBtn:this._getPostBtnText()}}},EditorView.prototype.initialize=function(){this._originalHeight=this.$textareaEl.height(),this._type!==BaseEditorView.TYPES.EDIT&&this._hidePostBtn(),this.focus()},EditorView.prototype.render=function(){BaseEditorView.prototype.render.call(this),this.$postBtnEl=this.$("."+this.classes.POST_BTN),this.$resizeEl=this.$("."+this.classes.RESIZE);var t=this.opts.model;if(t)return void this.$textareaEl.val(editorUtil.normalizeParagraphTags(t.body));var e=this._getDraft(this.opts.editorId);if(e)return void this.$textareaEl.val(e);this._processPlaceholders()},EditorView.prototype.reset=function(){this.$resizeEl.html(""),this.$textareaEl.val(""),this._hidePostBtn(),this.$textareaEl.height(this._originalHeight),this._setDraft(this.opts.editorId,null)},EditorView.prototype.sendPostEvent=function(t){this._isPosting||(this._isPosting=!0,this._updatePostBtnText(),this.$el.trigger(this.opts.postEvent,t))},EditorView.prototype.showError=function(t){this.$errorEl||(this.$errorEl=$(errorTemplate.render({msg:BaseEditorView.ERRORS.GENERIC})),this.$el.append(this.$errorEl),this.$errorEl.fadeTo(500,.98),this.$textareaEl.blur(),this.$errorEl.one("click",$.proxy(function(t){t.stopPropagation(),this.$errorEl.remove(),this.$errorEl=null,this.focus()},this)))},module.exports=EditorView},{"../../../templates/thread/editor.mustache":240,"../../../templates/thread/editorerror.mustache":241,"../../events/events":134,"../../i18n/enumeration":135,"../../util/editor":195,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96,"./baseeditorview":158}],166:[function(_dereq_,module,exports){var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),BaseThreadContainer=_dereq_("./basethreadcontainer"),expandableThreadContainerTemplate=_dereq_("../../../templates/thread/expandablethreadcontainer.mustache"),QueueButton=_dereq_("./queuebutton"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadEvents=_dereq_("../../events/events").thread,ExpandableThreadContainer=function(e){BaseThreadContainer.call(this,e),this._expanded=!0,this._oldestCollapsedVisibleIdx=0;var t=textEnumeration.KEYS;this._toggleBtn=new QueueButton({plural:textEnumeration.get(t.THREAD_EXPAND_BTN_PLURAL),singular:textEnumeration.get(t.THREAD_EXPAND_BTN_SINGULAR)})};inherits(ExpandableThreadContainer,BaseThreadContainer),ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS=2,ExpandableThreadContainer.CLASSES={CONTAINER:"lf-expandable-container",MAIN:"lf-expandable-thread-container",REPLY_BTN:"lf-expand-reply-btn",TOGGLE_BTN:"lf-expand-toggle-btn",TOGGLE_BTN_TEXT:"lf-expand-toggle-text"},ExpandableThreadContainer.EVENTS={HIDE_REPLY_BTN:"hideReplyBtn"},ExpandableThreadContainer.prototype.elClass=ExpandableThreadContainer.CLASSES.MAIN,ExpandableThreadContainer.prototype.events=function(){var e=ExpandableThreadContainer.CLASSES,t={};return t["click ."+e.REPLY_BTN]="_handleReplyClick",t[ThreadEvents.SHOW_QUEUED_CONTENT]="_handleToggleClick",t}(),ExpandableThreadContainer.prototype.template=expandableThreadContainerTemplate.render.bind(expandableThreadContainerTemplate),ExpandableThreadContainer.prototype._handleReplyClick=function(){this._$replyBtnEl.hide()},ExpandableThreadContainer.prototype._handleToggleClick=function(){this._expanded||(this._expanded=!0,this.expand(),this._updateButtonText())},ExpandableThreadContainer.prototype._updateButtonText=function(){this._expanded||this._toggleBtn.setCount(this.getNumQueued())},ExpandableThreadContainer.prototype.addComment=function(e,t,n){BaseThreadContainer.prototype.addComment.apply(this,arguments),this.updateButtonVisibility()},ExpandableThreadContainer.prototype.expand=function(){var e,t=document.createDocumentFragment(),n=this._commentIds.slice(0,this._oldestCollapsedVisibleIdx),a=this;$.each(n,function(n,r){e=a._comments[r],e.render(),t.appendChild(e.el)}),this.getContainerElement().prepend(t.childNodes),this._toggleBtn.hide()},ExpandableThreadContainer.prototype.getContainerElement=function(){return this._$containerEl},ExpandableThreadContainer.prototype.getNumQueued=function(){return this._commentIds.length-ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS},ExpandableThreadContainer.prototype.getReplyButton=function(){return this._$replyBtnEl},ExpandableThreadContainer.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS;return{strings:{replyBtnText:textEnumeration.get(e.THREAD_REPLY_BTN),toggleBtnText:textEnumeration.get(e.THREAD_EXPAND_BTN_SINGULAR)}}},ExpandableThreadContainer.prototype.initialize=function(e){e.sort(function(e,t){var n=e.createdAt,a=t.createdAt;return n<a?-1:n>a?1:0});var t,n=this.getContainerElement(),a=e.length,r=0;$.each(e.reverse(),$.proxy(function(e,i){this._comments[i.id]||(t=new this._commentConstructor(this._getCommentOptions(i)),this._comments[i.id]=t,this._commentIds.splice(0,0,i.id),r!==ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS&&(1===r&&(this._oldestCollapsedVisibleIdx=a-e-1),t.render(),n.prepend(t.$el),t.shouldRender()&&r++))},this));var i=this._commentIds.length;this._expanded=i<=ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS,this._updateButtonText(),this.updateButtonVisibility()},ExpandableThreadContainer.prototype.render=function(){BaseThreadContainer.prototype.render.call(this),this._toggleBtn.render(),this.$el.prepend(this._toggleBtn.$el);var e=ExpandableThreadContainer.CLASSES;this._$containerEl=this.$("."+e.CONTAINER),this._$replyBtnEl=this.$("."+e.REPLY_BTN).css("display","inline-block"),this.updateButtonVisibility()},ExpandableThreadContainer.prototype.updateButtonVisibility=function(){var e=this._commentIds.length;return e?(this.$el.trigger(ExpandableThreadContainer.EVENTS.HIDE_REPLY_BTN),e<=ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS?(this._toggleBtn.hide(),void this._$replyBtnEl.show()):(this._toggleBtn.show(),void this._$replyBtnEl.show())):(this._toggleBtn.hide(),void this._$replyBtnEl.hide())},module.exports=ExpandableThreadContainer},{"../../../templates/thread/expandablethreadcontainer.mustache":242,"../../events/events":134,"../../i18n/enumeration":135,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96,"./basethreadcontainer":159,"./queuebutton":178}],167:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),authMenuTemplate=_dereq_("../../../../templates/thread/menu/auth.mustache"),BaseMenu=_dereq_("./base"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),Navigable=_dereq_("../navigable"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,UserAgentUtil=_dereq_("../../../util/useragent"),UserEvents=_dereq_("../../../events/events").user,WriteEvents=_dereq_("../../../events/events").write,AuthMenu=function(e){BaseMenu.call(this,e)};inherits(AuthMenu,BaseMenu),AuthMenu.CLASSES={AUTH:"lf-auth",SIGNED_IN:"lf-signed-in",SIGNIN_BTN:"lf-signin-btn"};var EVENT_TO_ACTION_MAP=function(){var e={};return e[WriteEvents.POST_ANNOTATION]="Post",e[WriteEvents.POST_APPROVE]="Approve",e[WriteEvents.POST_DELETE]="Delete",e[WriteEvents.POST_HIDE]="Hide",e[WriteEvents.POST_REPLY]="Reply",e[WriteEvents.POST_VOTE]="Vote",e}();AuthMenu.prototype.elClass=[BaseMenu.CLASSES.MENU,AuthMenu.CLASSES.AUTH].join(" "),AuthMenu.prototype.events=function(){var e={};return e[(UserAgentUtil.isMobile()?"tap":"click")+" ."+AuthMenu.CLASSES.SIGNIN_BTN]="_handleLoginClick",e}(),$.extend(AuthMenu.prototype.events,Navigable.prototype.events),AuthMenu.prototype._handleLoginClick=function(){this.$el.trigger(UserEvents.LOGIN),this.$el.trigger(ThreadEvents.NAVIGATE_BACK)},AuthMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this),t=textEnumeration.KEYS,n=textEnumeration.get(t.MENU_AUTH_SIGNED_IN_MSG);return $.extend(e.strings,{signedInMsg:n.replace("{action}",EVENT_TO_ACTION_MAP[this.opts.event]),signInBtn:textEnumeration.get(t.MENU_AUTH_SIGN_IN_BTN)}),e},AuthMenu.prototype.subTemplate=authMenuTemplate,module.exports=AuthMenu},{"../../../../templates/thread/menu/auth.mustache":245,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/useragent":206,"../navigable":176,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./base":168}],168:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),linkTemplate=_dereq_("../../../../templates/thread/menu/link.mustache"),Navigable=_dereq_("../navigable"),UserAgentUtil=_dereq_("../../../util/useragent"),BaseMenu=function(e){Navigable.call(this,e),this._model=e.model,this.postEvent=null};inherits(BaseMenu,Navigable),BaseMenu.CLASSES=Navigable.CLASSES,BaseMenu.prototype.events=function(){var e={};return e[(UserAgentUtil.isMobile()?"tap":"click")+" ."+BaseMenu.CLASSES.BODY+" > li"]="handleOptionClick",UserAgentUtil.isMobile()||(e["keyup ."+BaseMenu.CLASSES.BODY+" > li"]="handleOptionClick"),e}(),$.extend(BaseMenu.prototype.events,Navigable.prototype.events),BaseMenu.prototype._buildMenuLinks=function(){var e=this.getLinkConfig();if(!e.length)return null;var t=document.createDocumentFragment();return $.each(e,function(e,n){t.appendChild($(linkTemplate.render(n))[0])}),t},BaseMenu.prototype.buildEventData=function(e){return{messageId:this._model.id,model:this._model,value:$(e.currentTarget).attr("data-value")}},BaseMenu.prototype.getLinkConfig=function(){return[]},BaseMenu.prototype.handleOptionClick=function(e){e.stopPropagation(),13!==e.which&&"keyup"===e.type||this.$el.trigger(this.postEvent,this.buildEventData(e))},BaseMenu.prototype.loadMenuLinks=function(){var e=this._buildMenuLinks();e&&this.$("."+BaseMenu.CLASSES.BODY).prepend(e)},BaseMenu.prototype.render=function(){Navigable.prototype.render.call(this),this.loadMenuLinks()},module.exports=BaseMenu},{"../../../../templates/thread/menu/link.mustache":249,"../../../util/useragent":206,"../navigable":176,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96}],169:[function(_dereq_,module,exports){var BaseMenu=_dereq_("./base"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),ConfirmMenu=function(t){BaseMenu.call(this,t),this.postEvent=t.postEvent,this.callback=t.callback};inherits(ConfirmMenu,BaseMenu),ConfirmMenu.prototype.getLinkConfig=function(){var t=textEnumeration.KEYS;return[{key:"confirm",str:textEnumeration.get(t.MENU_CONFIRM_ACCEPT).replace("{action}",this.opts.actionStr)},{key:"cancel",str:textEnumeration.get(t.MENU_CONFIRM_CANCEL)}]},ConfirmMenu.prototype.getTemplateContext=function(){var t=BaseMenu.prototype.getTemplateContext.call(this),e=textEnumeration.KEYS;return t.strings.title=textEnumeration.get(e.MENU_CONFIRM_TITLE),t},ConfirmMenu.prototype.handleOptionClick=function(t){var e=this.buildEventData(t);if(e.callback=this.callback,"cancel"===e.value)return void this._handleBackClick(t);this.$el.trigger(this.postEvent,e)},module.exports=ConfirmMenu},{"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./base":168}],170:[function(_dereq_,module,exports){function EditMenu(e){BaseMenu.call(this,e),this.postEvent=WriteEvents.POST_EDIT}var BaseMenu=_dereq_("./base"),EditorView=_dereq_("../editorview"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),WriteEvents=_dereq_("../../../events/events").write;inherits(EditMenu,BaseMenu),EditMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this),t=textEnumeration.KEYS;return e.strings.title=this._model.parentId?textEnumeration.get(t.EDITOR_EDIT_REPLY_TITLE):textEnumeration.get(t.EDITOR_EDIT_TITLE),e},EditMenu.prototype.render=function(){BaseMenu.prototype.render.call(this),this._editorView=new EditorView({hideOnBlur:!1,model:this._model,postEvent:this.postEvent,type:EditorView.TYPES.EDIT}),this._editorView.render(),this.$("."+BaseMenu.CLASSES.BODY).append(this._editorView.$el)},EditMenu.prototype.initialize=function(){this._editorView.initialize()},module.exports=EditMenu},{"../../../events/events":134,"../../../i18n/enumeration":135,"../editorview":165,"./../../../../../lib/inherits/inherits.js":11,"./base":168}],171:[function(_dereq_,module,exports){function isMod(t){var e=auth.get("livefyre");return!!e&&e.isMod({collectionId:t})}function EtcMenu(t){BaseMenu.call(this,t),this.postEvent=ThreadEvents.NAVIGATE}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),auth=_dereq_("../../../util/auth"),BaseMenu=_dereq_("./base"),etcMenuTemplate=_dereq_("../../../../templates/thread/menu/etc.mustache"),etcMenuMobileTemplate=_dereq_("../../../../templates/mobile/etcmenu.mustache"),dateUtil=_dereq_("../../../util/date"),editLinkTemplate=_dereq_("../../../../templates/thread/menu/editlink.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,userAgentUtil=_dereq_("../../../util/useragent"),viewEnum=_dereq_("../../../enums").navigableViews,visEnums=_dereq_("../../../enums").commentVisibility,WriteEvents=_dereq_("../../../events/events").write;inherits(EtcMenu,BaseMenu);var EVENT_MAP={approve:WriteEvents.POST_APPROVE,edit:ThreadEvents.NAVIGATE,flag:ThreadEvents.NAVIGATE,share:ThreadEvents.NAVIGATE};EtcMenu.CLASSES={EDIT_COUNTDOWN:"lf-edit-countdown",POWERED_BY:"lf-powered-by"},EtcMenu.prototype._buildMenuLinks=function(){var t=BaseMenu.prototype._buildMenuLinks.call(this);if(!this._isEditable())return t;var e=!isMod(this._model.meta.collectionId);return this.$editLink=$(editLinkTemplate.render({key:"edit",str:textEnumeration.get(textEnumeration.KEYS.MENU_ETC_OPTION_EDIT),showTimeRemaining:e,timeRemaining:this._getEditTimeRemaining()})),e&&(this.$editCountdownEl=this.$editLink.find("."+EtcMenu.CLASSES.EDIT_COUNTDOWN),this._editCountDown=setInterval($.proxy(this._updateEditTimeRemaining,this),1e3)),t.appendChild(this.$editLink[0]),t},EtcMenu.prototype._buildPostedAt=function(){var t=dateUtil.getPrettyDate(this._model.createdAt);return textEnumeration.get(textEnumeration.KEYS.MENU_ETC_POSTED_AT).replace("{date}",t)},EtcMenu.prototype._getEditTimeRemaining=function(){var t=this._getEditWindow(),e=new Date;return new Date(t-e).getMinutes()+textEnumeration.get(textEnumeration.KEYS.DATETIME_MINUTE_ABBREVIATION)},EtcMenu.prototype._getEditWindow=function(){var t=new Date(this._model.createdAt),e=this.opts.collection.settings.editCommentInterval;return new Date(t.setMinutes(t.getMinutes()+e))},EtcMenu.prototype._handleDeleteClick=function(){function t(){n.set({lastVisibility:n.visibility,visibility:visEnums.NONE})}var e=textEnumeration.KEYS,i=WriteEvents.POST_HIDE;this._isAuthor()&&(i=WriteEvents.POST_DELETE);var n=this._model;this.$el.trigger(this.postEvent,{actionStr:textEnumeration.get(e.MENU_ETC_OPTION_DELETE),model:n,postEvent:i,value:viewEnum.CONFIRM,callback:t})},EtcMenu.prototype._handlePoweredByClick=function(t){this.opts.collection.isCustomNetwork()||(t.preventDefault(),this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.INFO}))},EtcMenu.prototype._isApprovable=function(){var t=this._model.meta.collectionId;return this._model.isPending()&&isMod(t)},EtcMenu.prototype._isAuthor=function(){return this._model.isUserAuthor()},EtcMenu.prototype._isDeletable=function(){return isMod(this._model.meta.collectionId)||this._isAuthor()},EtcMenu.prototype._isEditable=function(){var t=this.opts.collection.settings.allowEditComments,e=this._model.meta.collectionId;return!(this._model.visibility===visEnums.EVERYONE&&this._model.lastVisibility===visEnums.GROUP)&&t&&(isMod(e)||this._isInEditWindow())},EtcMenu.prototype._isFlaggable=function(){return!this._model.isUserAuthor()},EtcMenu.prototype._isInEditWindow=function(){return!!this._isAuthor()&&new Date<this._getEditWindow()},EtcMenu.prototype._updateEditTimeRemaining=function(){return this._isEditable()?isMod(this._model.meta.collectionId)?(this.$editCountdownEl.remove(),void clearInterval(this._editCountDown)):void this.$editCountdownEl.html(this._getEditTimeRemaining()):(this.$editLink.remove(),void clearInterval(this._editCountDown))},EtcMenu.prototype.destroy=function(){BaseMenu.prototype.destroy.call(this),this.$editCountdownEl=null,this.$editLink=null,clearInterval(this._editCountDown)},EtcMenu.prototype.events=function(){var t={};return userAgentUtil.isMobile()&&(t["tap ."+EtcMenu.CLASSES.POWERED_BY]="_handlePoweredByClick"),t}(),$.extend(EtcMenu.prototype.events,BaseMenu.prototype.events),EtcMenu.prototype.getLinkConfig=function(){var t=textEnumeration.KEYS,e=[{key:"share",str:textEnumeration.get(t.MENU_ETC_OPTION_SHARE)}];return this._isFlaggable()&&e.push({key:"flag",str:textEnumeration.get(t.MENU_ETC_OPTION_FLAG)}),this._isDeletable()&&e.push({key:"delete",str:textEnumeration.get(t.MENU_ETC_OPTION_DELETE)}),this._isApprovable()&&e.push({key:"approve",str:textEnumeration.get(t.MENU_ETC_OPTION_APPROVE)}),e},EtcMenu.prototype.getTemplateContext=function(){var t=BaseMenu.prototype.getTemplateContext.call(this),e=textEnumeration.KEYS;return $.extend(t.strings,{appName:textEnumeration.get(e.APP_NAME),
postedAt:this._buildPostedAt(),title:textEnumeration.get(e.MENU_ETC_TITLE)}),t},EtcMenu.prototype.handleOptionClick=function(t){var e=$(t.currentTarget),i=e.attr("data-value");if("delete"===i)return this._handleDeleteClick();this.postEvent=EVENT_MAP[i],BaseMenu.prototype.handleOptionClick.call(this,t)},EtcMenu.prototype.subTemplate=userAgentUtil.isMobile()?etcMenuMobileTemplate:etcMenuTemplate,module.exports=EtcMenu},{"../../../../templates/mobile/etcmenu.mustache":219,"../../../../templates/thread/menu/editlink.mustache":246,"../../../../templates/thread/menu/etc.mustache":247,"../../../enums":133,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/auth":192,"../../../util/date":193,"../../../util/useragent":206,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./base":168}],172:[function(_dereq_,module,exports){var BaseMenu=_dereq_("./base"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),WriteEvents=_dereq_("../../../events/events").write,FlagMenu=function(e){BaseMenu.call(this,e),this.postEvent=WriteEvents.POST_FLAG};inherits(FlagMenu,BaseMenu),FlagMenu.prototype.getLinkConfig=function(){var e=textEnumeration.KEYS;return[{key:"spam",str:textEnumeration.get(e.MENU_FLAG_OPTION_SPAM)},{key:"offensive",str:textEnumeration.get(e.MENU_FLAG_OPTION_OFFENSIVE)},{key:"disagree",str:textEnumeration.get(e.MENU_FLAG_OPTION_DISAGREE)},{key:"off-topic",str:textEnumeration.get(e.MENU_FLAG_OPTION_OFF_TOPIC)}]},FlagMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this);return e.strings.title=textEnumeration.get(textEnumeration.KEYS.MENU_FLAG_TITLE),e},module.exports=FlagMenu},{"../../../events/events":134,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./base":168}],173:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),BaseMenu=_dereq_("./base"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),infoMenuTemplate=_dereq_("../../../../templates/thread/menu/info.mustache"),textEnumeration=_dereq_("../../../i18n/enumeration"),InfoMenu=function(e){BaseMenu.call(this,e)};inherits(InfoMenu,BaseMenu),InfoMenu.CLASSES={INFO:"lf-info"},InfoMenu.prototype.elClass=[BaseMenu.CLASSES.MENU,InfoMenu.CLASSES.INFO].join(" "),InfoMenu.prototype.getLinkConfig=function(){return[]},InfoMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this),n=textEnumeration.KEYS;return $.extend(e.strings,{appName:textEnumeration.get(n.APP_NAME),copyright:textEnumeration.get(n.MENU_INFO_COPYRIGHT),helpLink:textEnumeration.get(n.MENU_INFO_HELP),livefyreLink:textEnumeration.get(n.MENU_INFO_LF_LINK),version:textEnumeration.get(n.APP_VERSION)}),e},InfoMenu.prototype.handleOptionClick=function(e){e.stopPropagation()},InfoMenu.prototype.subTemplate=infoMenuTemplate,module.exports=InfoMenu},{"../../../../templates/thread/menu/info.mustache":248,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./base":168}],174:[function(_dereq_,module,exports){function ShareMenu(e){BaseMenu.call(this,e),this.postEvent=WriteEvents.POST_SHARE}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),BaseMenu=_dereq_("./base"),CommentEvents=_dereq_("../../../events/events").comment,inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),loader=_dereq_("./../../../../../lib/livefyre-bootstrap/src/loader"),loaderTemplate=_dereq_("../../../../templates/thread/loader.mustache"),nullFunction=_dereq_("../../..//util/internals").nullFunction,shareTemplate=_dereq_("../../../../templates/thread/menu/share.mustache"),textEnumeration=_dereq_("../../../i18n/enumeration"),WriteEvents=_dereq_("../../../events/events").write;inherits(ShareMenu,BaseMenu),ShareMenu.CLASSES={FOOTER:"lf-menu-foot",LINK:"lf-link",SHARE:"lf-share"},ShareMenu.prototype.elClass=[BaseMenu.CLASSES.MENU,ShareMenu.CLASSES.SHARE].join(" "),ShareMenu.prototype.events=function(){var e={};return e["click ."+ShareMenu.CLASSES.FOOTER]="_handleTextareaClick",e}(),$.extend(ShareMenu.prototype.events,BaseMenu.prototype.events),ShareMenu.prototype._fetchPermalink=function(){if(this._model.permalink)return void this._renderContent();this.$el.trigger(CommentEvents.GET_PERMALINK,{callback:$.proxy(this._handleFetchSuccess,this),messageId:this._model.id})},ShareMenu.prototype._handleFetchSuccess=function(e,t){this._model.permalink=t,this._renderContent()},ShareMenu.prototype._handleTextareaClick=function(){this.$textarea.select()},ShareMenu.prototype._renderContent=function(){var e=this._buildMenuLinks(),t=$(shareTemplate.render({permalink:this._model.permalink}));this.$textarea=t.children().first(),e.appendChild(t[0]),this.$("."+BaseMenu.CLASSES.BODY).html("").append(e),this.delegateEvents()},ShareMenu.prototype.getLinkConfig=function(){return[{cls:"fycon-source-twitter",key:"twitter",str:"Twitter"},{cls:"fycon-source-facebook",key:"facebook",str:"Facebook"}]},ShareMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this),t=textEnumeration.KEYS;return e.strings.title=textEnumeration.get(t.MENU_SHARE_TITLE),e},ShareMenu.prototype.initialize=function(){this._fetchPermalink()},ShareMenu.prototype.loadMenuLinks=nullFunction,ShareMenu.prototype.render=function(){BaseMenu.prototype.render.call(this);var e=$(loaderTemplate.render());this.$("."+BaseMenu.CLASSES.BODY).append(e),loader.decorate(e,60)},module.exports=ShareMenu},{"../../../../templates/thread/loader.mustache":244,"../../../../templates/thread/menu/share.mustache":250,"../../..//util/internals":196,"../../../events/events":134,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/livefyre-bootstrap/src/loader":20,"./../../../../../node_modules/jquery/dist/jquery":96,"./base":168}],175:[function(_dereq_,module,exports){function UserMenu(e){BaseMenu.call(this,e)}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),adaptAvatar=_dereq_("../../../adapters/adapters").adaptAvatar,auth=_dereq_("../../../util/auth"),BaseMenu=_dereq_("./base"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadEvents=_dereq_("../../../events/events").thread,UserEvents=_dereq_("../../../events/events").user,userMenuTemplate=_dereq_("../../../../templates/thread/menu/user.mustache");inherits(UserMenu,BaseMenu);var OPTIONS={ADMIN:"admin",EDIT_PROFILE:"editProfile",LOGOUT:"logout"},OPTION_EVENT_MAP=function(){var e={};return e[OPTIONS.ADMIN]=UserEvents.ADMIN,e[OPTIONS.EDIT_PROFILE]=UserEvents.EDIT_PROFILE,e[OPTIONS.LOGOUT]=UserEvents.LOGOUT,e}(),CLASSES={USER:"lf-user"};UserMenu.prototype.elClass=[BaseMenu.CLASSES.MENU,CLASSES.USER].join(" "),UserMenu.prototype.getLinkConfig=function(){var e=auth.get("livefyre"),t=textEnumeration.KEYS,r=[{key:OPTIONS.EDIT_PROFILE,str:textEnumeration.get(t.MENU_USER_EDIT_PROFILE)},{key:OPTIONS.LOGOUT,str:textEnumeration.get(t.MENU_USER_LOGOUT)}];return e&&e.isMod({collectionId:this.opts.collection.id})&&r.splice(1,0,{key:OPTIONS.ADMIN,str:textEnumeration.get(t.MENU_USER_ADMIN)}),r},UserMenu.prototype.getTemplateContext=function(){var e=BaseMenu.prototype.getTemplateContext.call(this),t=textEnumeration.KEYS,r=auth.get("livefyre");return e.strings.backBtn=textEnumeration.get(t.MENU_USER_BACK_BTN),e.strings.title=userMenuTemplate.render({avatar:r?adaptAvatar(r.get("avatar")):"",displayName:r?r.get("displayName"):""}),e},UserMenu.prototype.handleOptionClick=function(e){e.stopPropagation();var t=$(e.target).attr("data-value");this.$el.trigger(OPTION_EVENT_MAP[t]),this.$el.trigger(ThreadEvents.NAVIGATE_BACK)},module.exports=UserMenu},{"../../../../templates/thread/menu/user.mustache":251,"../../../adapters/adapters":112,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/auth":192,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../node_modules/jquery/dist/jquery":96,"./base":168}],176:[function(_dereq_,module,exports){var inherits=_dereq_("./../../../../lib/inherits/inherits.js"),internals=_dereq_("../../util/internals"),navigableTemplate=_dereq_("../../../templates/thread/navigable.mustache"),navTemplate=_dereq_("../../../templates/mobile/navbar.mustache"),subTemplate=_dereq_("../../../templates/thread/navigablesub.mustache"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadEvents=_dereq_("../../events/events").thread,UserAgentUtil=_dereq_("../../util/useragent"),View=_dereq_("./../../../../lib/view/src/view.js"),Navigable=function(e){View.call(this,e),this._actionDesc=e.actionDesc,this._actionHandler=e.actionHandler||internals.nullFunction,this._backEvent=e.backEvent,this._backStr=e.backStr,this._title=e.title,this.topNavEnabled=!0};inherits(Navigable,View),Navigable.CLASSES={ACTION_BTN:"lf-menu-action-btn",BACK_BTN:"lf-menu-back-btn",BODY:"lf-menu-body",HEADER:"lf-menu-head",MENU:"lf-menu"},Navigable.prototype.elClass=Navigable.CLASSES.MENU,Navigable.prototype.events=function(){var e=Navigable.CLASSES,t={},a=UserAgentUtil.isMobile()?"tap":"click";return t[a+" ."+e.ACTION_BTN]="_handleActionClick",t[a+" ."+e.BACK_BTN]="_handleBackClick",t}(),Navigable.prototype.navTemplate=navTemplate,Navigable.prototype.subTemplate=subTemplate,Navigable.prototype.template=navigableTemplate.render.bind(navigableTemplate),Navigable.prototype._handleBackClick=function(e){e.preventDefault(),this.$el.trigger(this._backEvent||ThreadEvents.NAVIGATE_BACK)},Navigable.prototype._handleActionClick=function(e){this._actionHandler(e)},Navigable.prototype.getTemplateContext=function(){var e=textEnumeration.KEYS;return{actionButton:!!this._actionDesc,strings:{actionBtn:this._actionDesc,backBtn:this._backStr||textEnumeration.get(e.MENU_BACK_BTN),title:this._title},topNavEnabled:this.topNavEnabled}},Navigable.prototype.render=function(){this.$el.html(this.template(this.getTemplateContext(),{body:this.subTemplate,navbar:this.navTemplate}))},module.exports=Navigable},{"../../../templates/mobile/navbar.mustache":221,"../../../templates/thread/navigable.mustache":252,"../../../templates/thread/navigablesub.mustache":253,"../../events/events":134,"../../i18n/enumeration":135,"../../util/internals":196,"../../util/useragent":206,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/view/src/view.js":83}],177:[function(_dereq_,module,exports){function PermalinkThreadContainer(e){ThreadContainer.call(this,e),this._navbar=null}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),Comment=_dereq_("../../models/comment"),CommentEvents=_dereq_("../../events/events").comment,inherits=_dereq_("./../../../../lib/inherits/inherits.js"),NavBar=_dereq_("../../mobile/thread/ui/navbar"),permalinkMissingTemplate=_dereq_("../../../templates/thread/permalinkmissing.mustache"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadContainer=_dereq_("./threadcontainer"),threadContainerTemplate=_dereq_("../../../templates/thread/threadcontainer.mustache"),ThreadEvents=_dereq_("../../events/events").thread;inherits(PermalinkThreadContainer,ThreadContainer);var CLASSES={MAIN:"lf-permalink",STREAM:"lf-thread-container"};PermalinkThreadContainer.prototype.elClass=CLASSES.MAIN,PermalinkThreadContainer.prototype.elTag="section",PermalinkThreadContainer.prototype.events=function(){var e={};return e[CommentEvents.HIDDEN]="_handleTopCommentHidden",e}(),$.extend(PermalinkThreadContainer.prototype.events,ThreadContainer.prototype.events),PermalinkThreadContainer.prototype.template=threadContainerTemplate.render.bind(threadContainerTemplate),PermalinkThreadContainer.prototype._handleTopCommentHidden=function(e,t){t.id===this._topComment.id&&this._showEmptyPermalinkMessage()},PermalinkThreadContainer.prototype._showEmptyPermalinkMessage=function(){this.getContainerElement().html(permalinkMissingTemplate.render({doesNotExist:textEnumeration.get(textEnumeration.KEYS.PERMALINK_MISSING)}))},PermalinkThreadContainer.prototype.addComment=function(e,t,n){var r=$.isArray(e)?e[0]:e;r&&r.origin!==Comment.ORIGIN.STREAM&&ThreadContainer.prototype.addComment.apply(this,arguments)},PermalinkThreadContainer.prototype.destroy=function(){ThreadContainer.prototype.destroy.call(this),this._navbar&&this._navbar.destroy()},PermalinkThreadContainer.prototype.getContainerElement=function(){return this.$("."+CLASSES.STREAM)},PermalinkThreadContainer.prototype.getThreadContainer=function(){return this},PermalinkThreadContainer.prototype.initialize=function(e){if(!this._initialized){if(this._initialized=!0,!e||!e.length)return void this._showEmptyPermalinkMessage();ThreadContainer.prototype.initialize.call(this,e);for(var t=0,n=e.length;t<n&&(this._topComment=e[t],this._topComment.parentId);t++);var r=this._comments[this._topComment.id];r.handleMouseEnter(),r.disableMouseEvents(!0)}},PermalinkThreadContainer.prototype.render=function(){ThreadContainer.prototype.render.call(this);var e=textEnumeration.KEYS;this._navbar=new NavBar({backEvent:ThreadEvents.PERMALINK_BACK,backStr:textEnumeration.get(e.PERMALINK_BACK_BTN),title:textEnumeration.get(e.PERMALINK_TITLE)}),this._navbar.render(),this.$el.prepend(this._navbar.$el)},module.exports=PermalinkThreadContainer},{"../../../templates/thread/permalinkmissing.mustache":255,"../../../templates/thread/threadcontainer.mustache":261,"../../events/events":134,"../../i18n/enumeration":135,"../../mobile/thread/ui/navbar":146,"../../models/comment":156,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96,"./threadcontainer":186}],178:[function(_dereq_,module,exports){var inherits=_dereq_("./../../../../lib/inherits/inherits.js"),queueButtonTemplate=_dereq_("../../../templates/thread/queuebutton.mustache"),ThreadEvents=_dereq_("../../events/events").thread,View=_dereq_("./../../../../lib/view/src/view.js"),QueueButton=function(t){View.call(this,t),this._count=t.count||0,this._plural=t.plural,this._singular=t.singular};inherits(QueueButton,View),QueueButton.CLASSES={DOWN_ARROW:"fycon-arrow-down",MAIN:"lf-queue-btn",REPLY:"lf-reply-queue-btn",TEXT:"lf-btn-text"},QueueButton.prototype.elClass=QueueButton.CLASSES.MAIN,QueueButton.prototype.events={click:"_handleClick"},QueueButton.prototype.template=queueButtonTemplate.render.bind(queueButtonTemplate),QueueButton.prototype._handleClick=function(){this.$el.trigger(ThreadEvents.SHOW_QUEUED_CONTENT)},QueueButton.prototype.hide=function(){this.$el.hide()},QueueButton.prototype.render=function(){return View.prototype.render.call(this),this._btnTextEl=this.$("."+QueueButton.CLASSES.TEXT),this.setCount(),this},QueueButton.prototype.setCount=function(t){this._count=t||0;var e=1===this._count?this._singular:this._plural;this._btnTextEl.html(e.replace("{number}",this._count))},QueueButton.prototype.setReplyBtn=function(){this.$el.addClass(QueueButton.CLASSES.REPLY)},QueueButton.prototype.show=function(){this.$el.show()},module.exports=QueueButton},{"../../../templates/thread/queuebutton.mustache":256,"../../events/events":134,"./../../../../lib/inherits/inherits.js":11,"./../../../../lib/view/src/view.js":83}],179:[function(_dereq_,module,exports){function addQueueNotifier(e){var t=QueuedExpandableThreadContainer.CLASSES;if(!e.$el.has("."+t.NEW).length){var n=document.createElement("span");n.className=t.NEW,e.$el.find(":first-child").after(n)}}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),Comment=_dereq_("../../models/comment"),ExpandableThreadContainer=_dereq_("./expandablethreadcontainer"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),QueueButton=_dereq_("./queuebutton"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadEvents=_dereq_("../../events/events").thread,QueuedExpandableThreadContainer=function(e){ExpandableThreadContainer.call(this,e);var t=textEnumeration.KEYS;this._commentQueueBtn=e.commentQueueBtn,this._commentQueueBtn.setReplyBtn(),this._footerQueueBtn=new QueueButton({plural:textEnumeration.get(t.QUEUED_REPLIES_PLURAL),singular:textEnumeration.get(t.QUEUED_REPLIES_SINGULAR)}),this._footerQueueBtn.setReplyBtn(),this._queueBtns=[e.commentQueueBtn],this._queuedComments=[]};inherits(QueuedExpandableThreadContainer,ExpandableThreadContainer),QueuedExpandableThreadContainer.CLASSES={FOOTER:"lf-expandable-footer",NEW:"lf-toggle-btn-new"},$.extend(QueuedExpandableThreadContainer.CLASSES,ExpandableThreadContainer.CLASSES),QueuedExpandableThreadContainer.EVENTS=ExpandableThreadContainer.EVENTS,QueuedExpandableThreadContainer.prototype._queueComment=function(e){this._queuedComments.push(e);var t=this,n=function(e,n,a){n.setCount(a||t._queuedComments.length),addQueueNotifier(n)};n(0,this._toggleBtn,this.getNumQueued()),$.each(this._queueBtns,n),this.updateButtonVisibility()},QueuedExpandableThreadContainer.prototype._showQueuedComments=function(e){e&&e.stopPropagation();var t=this.getContainerElement();$.each(this._queuedComments,$.proxy(function(e,n){this.processComment(!1,t,null,n,!0)},this)),this._queuedComments=[],this.updateButtonVisibility()},QueuedExpandableThreadContainer.prototype.destroy=function(){ExpandableThreadContainer.prototype.destroy.call(this);var e=$.proxy(this._showQueuedComments,this);this.$el.off(ThreadEvents.SHOW_QUEUED_CONTENT,e)},QueuedExpandableThreadContainer.prototype.expand=function(){ExpandableThreadContainer.prototype.expand.call(this),this._showQueuedComments()},QueuedExpandableThreadContainer.prototype.getNumQueued=function(){return ExpandableThreadContainer.prototype.getNumQueued.call(this)+this._queuedComments.length},QueuedExpandableThreadContainer.prototype.processComment=function(e,t,n,a,o){if(!(o=a.isUserAuthor()||o)&&a.origin===Comment.ORIGIN.STREAM)return void this._queueComment(a);ExpandableThreadContainer.prototype.processComment.call(this,e,t,n,a)},QueuedExpandableThreadContainer.prototype.render=function(){ExpandableThreadContainer.prototype.render.call(this),this._footerQueueBtn.render().hide(),this._queueBtns.push(this._footerQueueBtn),this.$("."+QueuedExpandableThreadContainer.CLASSES.FOOTER).append(this._footerQueueBtn.$el);var e=$.proxy(this._showQueuedComments,this);this.$el.on(ThreadEvents.SHOW_QUEUED_CONTENT,e)},QueuedExpandableThreadContainer.prototype.updateButtonVisibility=function(){var e=this._commentIds.length,t=this._queuedComments.length>0;return this._toggleBtn.hide(),this._$replyBtnEl.hide(),this._footerQueueBtn.hide(),this._commentQueueBtn.hide(),e?(this.$el.trigger(ExpandableThreadContainer.EVENTS.HIDE_REPLY_BTN),e<=ExpandableThreadContainer.NUM_COLLAPSED_COMMENTS?(this._$replyBtnEl.show(),void(t&&this._footerQueueBtn.show())):(!this._expanded&&this._toggleBtn.show(),this._$replyBtnEl.show(),void(this._expanded&&t&&this._footerQueueBtn.show()))):void(t&&this._commentQueueBtn.show())},module.exports=QueuedExpandableThreadContainer},{"../../events/events":134,"../../i18n/enumeration":135,"../../models/comment":156,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96,"./expandablethreadcontainer":166,"./queuebutton":178}],180:[function(_dereq_,module,exports){function decorateDestroy(e){var t=e.destroy;e.destroy=function(){t.call(this),this._queueBtn.$el.off(ThreadEvents.SHOW_QUEUED_CONTENT,$.proxy(this.showQueuedComments,this))}}function decorateProcessComment(e){var t=e.processComment;e.processComment=function(e,u,n,o,r){var s=o.hasBeenRendered,m=o.isUserAuthor(),i=!!o.parentId,a=o.origin===Comment.ORIGIN.STREAM;if(!r&&!i&&!s&&!m&&a)return void this.queueComment(o);t.call(this,e,u,n,o)}}function queueComment(e){this._queuedComments.push(e),this._queueBtn.el.parentNode||this._queueBtn.$el.insertBefore(this.$el.siblings("."+CLASSES.GRADIENT)),this._queueBtn.setCount(this._queuedComments.length),this._queueBtn.show()}function showQueuedComments(e){e&&e.stopPropagation();var t=this.getContainerElement();$.each(this._queuedComments,$.proxy(function(e,u){this.processComment(!0,t,null,u,!0)},this)),this._queuedComments=[],this._queueBtn.hide()}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),Comment=_dereq_("../../models/comment"),QueueButton=_dereq_("./queuebutton"),textEnumeration=_dereq_("../../i18n/enumeration"),ThreadEvents=_dereq_("../../events/events").thread,QueueDecorator={},CLASSES={GRADIENT:"lf-thread-gradient"};QueueDecorator.decorate=function(e){var t=textEnumeration.KEYS,u=new QueueButton({plural:textEnumeration.get(t.QUEUED_COMMENTS_PLURAL),singular:textEnumeration.get(t.QUEUED_COMMENTS_SINGULAR)});u.render(),e._queueBtn=u,e._queuedComments=[],decorateDestroy(e),decorateProcessComment(e),e.queueComment=queueComment,e.showQueuedComments=showQueuedComments,e._queueBtn.$el.on(ThreadEvents.SHOW_QUEUED_CONTENT,$.proxy(e.showQueuedComments,e))},module.exports=QueueDecorator},{"../../events/events":134,"../../i18n/enumeration":135,"../../models/comment":156,"./../../../../node_modules/jquery/dist/jquery":96,"./queuebutton":178}],181:[function(_dereq_,module,exports){var anonAuthorTemplate=_dereq_("../../../../templates/thread/thread/anonauthor.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),textEnumeration=_dereq_("../../../i18n/enumeration"),View=_dereq_("./../../../../../lib/view/src/view.js"),UserEvents=_dereq_("../../../events/events").user,AnonAuthorView=function(e){View.call(this,e)};inherits(AnonAuthorView,View),AnonAuthorView.CLASSES={ANON_AUTHOR:"lf-anon-author"},AnonAuthorView.prototype.elClass=AnonAuthorView.CLASSES.ANON_AUTHOR,AnonAuthorView.prototype.events={click:"_handleLogin"},AnonAuthorView.prototype.template=anonAuthorTemplate.render.bind(anonAuthorTemplate),AnonAuthorView.prototype._handleLogin=function(e){this.$el.trigger(UserEvents.LOGIN)},AnonAuthorView.prototype.getTemplateContext=function(){return{assetServer:this.opts.assetServer,strings:{signInToPost:textEnumeration.get(textEnumeration.KEYS.SIGN_IN_TO_POST)}}},module.exports=AnonAuthorView},{"../../../../templates/thread/thread/anonauthor.mustache":257,"../../../events/events":134,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83}],182:[function(_dereq_,module,exports){var adaptAvatar=_dereq_("../../../adapters/adapters").adaptAvatar,auth=_dereq_("../../../util/auth"),authorViewTemplate=_dereq_("../../../../templates/thread/thread/author.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),ThreadEvents=_dereq_("../../../events/events").thread,View=_dereq_("./../../../../../lib/view/src/view.js"),AuthorView=function(e){View.call(this,e)};inherits(AuthorView,View),AuthorView.CLASSES={AUTHOR:"lf-author-view"},AuthorView.prototype.elClass=AuthorView.CLASSES.AUTHOR,AuthorView.prototype.events={click:"_handleClick"},AuthorView.prototype.template=authorViewTemplate.render.bind(authorViewTemplate),AuthorView.prototype._handleClick=function(e){e.stopPropagation(),this.$el.trigger(ThreadEvents.NAVIGATE,{value:"user"})},AuthorView.prototype.getTemplateContext=function(){var e=auth.get("livefyre");return{avatar:e?adaptAvatar(e.get("avatar")):"",defaultAvatar:this.opts.defaultAvatar}},module.exports=AuthorView},{"../../../../templates/thread/thread/author.mustache":258,"../../../adapters/adapters":112,"../../../events/events":134,"../../../util/auth":192,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83}],183:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),abstractMethod=_dereq_("../../../util/internals").abstractMethod,auth=_dereq_("../../../util/auth"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),Observer=_dereq_("./../../../../../lib/observer/src/observer.js"),View=_dereq_("./../../../../../lib/view/src/view.js"),ThreadView=function(e){View.call(this,e),this._streamView=this.createStreamView(),Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this._handleUserLogin,this)),this.listenTo(auth,"logout",$.proxy(this._handleUserLogout,this))};inherits(ThreadView,View),ThreadView.CLASSES={LOADER:"lf-loader",THREAD:"lf-thread"},ThreadView.prototype.elClass=ThreadView.CLASSES.THREAD,ThreadView.prototype.elTag="section",ThreadView.prototype._handleUserLogin=abstractMethod,ThreadView.prototype._handleUserLogout=abstractMethod,ThreadView.prototype.destroy=function(){View.prototype.destroy.call(this),this.stopListening()},ThreadView.prototype.handleFetchThreadFailure=abstractMethod,ThreadView.prototype.handleFetchThreadSuccess=abstractMethod,ThreadView.prototype.getStreamView=function(){return this._streamView},ThreadView.prototype.createStreamView=abstractMethod,module.exports=ThreadView},{"../../../util/auth":192,"../../../util/internals":196,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/observer/src/observer.js":42,"./../../../../../lib/view/src/view.js":83,"./../../../../../node_modules/jquery/dist/jquery":96}],184:[function(_dereq_,module,exports){function NotificationView(t){View.call(this,t),this._event=t.event}var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),notificationViewTemplate=_dereq_("../../../../templates/thread/notification.mustache"),textEnumeration=_dereq_("../../../i18n/enumeration"),View=_dereq_("./../../../../../lib/view/src/view.js"),WriteEvents=_dereq_("../../../events/events").write;inherits(NotificationView,View);var CLASSES={APPROVE:"fycon-check-funky",DELETE:"fycon-admin-delete",FLAG:"fycon-admin-flag",ICON:"lf-notification-icon",MAIN:"lf-thread-notification",POPOVER:"lf-thread-popover"},EVENT_TO_CLASS_MAP=function(){var t={};return t[WriteEvents.POST_APPROVE]=CLASSES.APPROVE,t[WriteEvents.POST_DELETE]=CLASSES.DELETE,t[WriteEvents.POST_FLAG]=CLASSES.FLAG,t[WriteEvents.POST_HIDE]=CLASSES.DELETE,t}(),EVENT_TO_ENUMERATION_MAP=function(){var t=textEnumeration.KEYS,e={};return e[WriteEvents.POST_APPROVE]=t.NOTIFICATION_APPROVED,e[WriteEvents.POST_DELETE]=t.NOTIFICATION_DELETED,e[WriteEvents.POST_FLAG]=t.NOTIFICATION_FLAGGED,e[WriteEvents.POST_HIDE]=t.NOTIFICATION_DELETED,e}();NotificationView.prototype.elClass=CLASSES.MAIN,NotificationView.prototype.template=notificationViewTemplate.render.bind(notificationViewTemplate),NotificationView.prototype.decorate=function(t){this.render(),t.append(this.$el),this.position()},NotificationView.prototype.getTemplateContext=function(){return{strings:{title:textEnumeration.get(EVENT_TO_ENUMERATION_MAP[this._event])}}},NotificationView.prototype.position=function(){var t=this.$el.closest("."+CLASSES.POPOVER),e=(t.width()-this.$el.outerWidth())/2,i=(t.height()-this.$el.outerHeight())/2;this.$el.css({left:e+"px",top:i+"px"})},NotificationView.prototype.render=function(){View.prototype.render.call(this),this.$("."+CLASSES.ICON).addClass(EVENT_TO_CLASS_MAP[this._event]),setTimeout($.proxy(this.destroy,this),1500)},module.exports=NotificationView},{"../../../../templates/thread/notification.mustache":254,"../../../events/events":134,"../../../i18n/enumeration":135,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/view/src/view.js":83,"./../../../../../node_modules/jquery/dist/jquery":96}],185:[function(_dereq_,module,exports){var $=_dereq_("./../../../../../node_modules/jquery/dist/jquery"),AnonAuthorView=_dereq_("./anonauthorview"),auth=_dereq_("../../../util/auth"),AuthorView=_dereq_("./authorview"),EditorView=_dereq_("../editorview"),gradientTemplate=_dereq_("../../../../templates/thread/thread/gradient.mustache"),inherits=_dereq_("./../../../../../lib/inherits/inherits.js"),loader=_dereq_("./../../../../../lib/livefyre-bootstrap/src/loader"),loaderTemplate=_dereq_("../../../../templates/thread/loader.mustache"),Observer=_dereq_("./../../../../../lib/observer/src/observer.js"),QueueDecorator=_dereq_("../queuedecorator"),textEnumeration=_dereq_("../../../i18n/enumeration"),ThreadContainer=_dereq_("../threadcontainer"),ThreadEvents=_dereq_("../../../events/events").thread,threadViewTemplate=_dereq_("../../../../templates/thread/thread/view.mustache"),View=_dereq_("./../../../../../lib/view/src/view.js"),viewEnum=_dereq_("../../../enums").navigableViews,WriteEvents=_dereq_("../../../events/events").write,ThreadView=function(e){View.call(this,e),this._authorView=null,this._editorView=null,this._loggedIn=!1,this._streamView=this.createStreamView({assetServer:e.assetServer,defaultAvatar:e.defaultAvatar}),QueueDecorator.decorate(this._streamView),Observer(this),this.listenTo(auth,"login.livefyre",$.proxy(this._handleUserLogin,this)),this.listenTo(auth,"logout",$.proxy(this._handleUserLogout,this))};inherits(ThreadView,View),ThreadView.CLASSES={LOADER:"lf-loader-container",POWERED_BY:"lf-powered-by",THREAD:"lf-thread"},ThreadView.prototype.elClass=ThreadView.CLASSES.THREAD,ThreadView.prototype.elTag="section",ThreadView.prototype.events=function(){var e={};return e["click ."+ThreadView.CLASSES.POWERED_BY]="_handlePoweredByClick",e}(),ThreadView.prototype.template=threadViewTemplate.render.bind(threadViewTemplate),ThreadView.prototype._handlePoweredByClick=function(e){this.opts.isCustomNetwork||(e.preventDefault(),this.$el.trigger(ThreadEvents.NAVIGATE,{value:viewEnum.INFO}))},ThreadView.prototype._handleUserLogin=function(){this._loggedIn||(this._loggedIn=!0,this._authorView&&this._authorView.destroy(),this._authorView=new AuthorView({defaultAvatar:this.opts.defaultAvatar}),this._authorView.render(),this._editorView=new EditorView({editorId:this.opts.blockId,postEvent:WriteEvents.POST_ANNOTATION}),this._editorView.render(),this.$el.prepend(this._authorView.$el,this._editorView.$el),this._editorView.initialize())},ThreadView.prototype._handleUserLogout=function(){this._loggedIn=!1,this._authorView&&this._authorView.destroy(),this._editorView&&this._editorView.destroy(),this._editorView=null,this._authorView=new AnonAuthorView({assetServer:this.opts.assetServer}),this._authorView.render(),this.$el.prepend(this._authorView.$el)},ThreadView.prototype._renderChildren=function(){if(this.$el.prepend($(gradientTemplate.render())),this._streamView.render(),this.$("."+ThreadView.CLASSES.LOADER).remove(),this.$el.children().first().after(this._streamView.$el),auth.get("livefyre"))return void this._handleUserLogin();this._handleUserLogout()},ThreadView.prototype.createStreamView=function(e){return new ThreadContainer(e)},ThreadView.prototype.destroy=function(){View.prototype.destroy.call(this),this._authorView&&this._authorView.destroy(),this._authorView=null,this._editorView&&this._editorView.destroy(),this._editorView=null,this.stopListening()},ThreadView.prototype.getTemplateContext=function(){return{strings:{appName:textEnumeration.get(textEnumeration.KEYS.APP_NAME)}}},ThreadView.prototype.getThreadContainer=function(){return this._streamView},ThreadView.prototype.handleFetchThreadFailure=function(e){this._renderChildren()},ThreadView.prototype.handleFetchThreadSuccess=function(e){this._renderChildren(),e&&e.length&&(e.sort(function(e,t){return e.parentId?1:-1}),this._streamView.initialize(e))},ThreadView.prototype.render=function(){this.$el.html(this.template(this.getTemplateContext(),{loader:loaderTemplate})),loader.decorate(this.$("."+ThreadView.CLASSES.LOADER),60)},module.exports=ThreadView},{"../../../../templates/thread/loader.mustache":244,"../../../../templates/thread/thread/gradient.mustache":259,"../../../../templates/thread/thread/view.mustache":260,"../../../enums":133,"../../../events/events":134,"../../../i18n/enumeration":135,"../../../util/auth":192,"../editorview":165,"../queuedecorator":180,"../threadcontainer":186,"./../../../../../lib/inherits/inherits.js":11,"./../../../../../lib/livefyre-bootstrap/src/loader":20,"./../../../../../lib/observer/src/observer.js":42,"./../../../../../lib/view/src/view.js":83,"./../../../../../node_modules/jquery/dist/jquery":96,
"./anonauthorview":181,"./authorview":182}],186:[function(_dereq_,module,exports){var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),BaseThreadContainer=_dereq_("./basethreadcontainer"),inherits=_dereq_("./../../../../lib/inherits/inherits.js"),SortingUtil=_dereq_("../../util/sorting"),threadContainerTemplate=_dereq_("../../../templates/thread/threadcontainer.mustache"),ThreadEvents=_dereq_("../../events/events").thread,TopCommentView=_dereq_("./comment/topview"),ThreadContainer=function(e){e=e||{},e.commentConstructor=TopCommentView,BaseThreadContainer.call(this,e)};inherits(ThreadContainer,BaseThreadContainer),ThreadContainer.CLASSES={BASE:"lf-thread-container",GRADIENT:"lf-thread-gradient"},ThreadContainer.prototype.elClass=ThreadContainer.CLASSES.BASE,ThreadContainer.prototype.elTag="section",ThreadContainer.prototype.events={mouseenter:"_handleMouseEnter",mouseleave:"_handleMouseLeave"},ThreadContainer.prototype._getParentThreadContainer=function(e){var t=this._comments[e];return t?t.getThreadContainer():null},ThreadContainer.prototype._handleMouseEnter=function(){this.$el.trigger(ThreadEvents.DEACTIVATE_HIGHLIGHTED_TEXT)},ThreadContainer.prototype._handleMouseLeave=function(){this.$el.trigger(ThreadEvents.ACTIVATE_HIGHLIGHTED_TEXT)},ThreadContainer.prototype.comparator=SortingUtil.helpfulnessComparator,ThreadContainer.prototype.initialize=function(e){var t,r,n=$(threadContainerTemplate.render()),a={};$.each(e,function(e,t){r=t.parentId||"root",a[r]||(a[r]=[]),a[r].push(t)}),BaseThreadContainer.prototype.initialize.call(this,a.root,n),delete a.root;for(r in a)a.hasOwnProperty(r)&&(t=this._getParentThreadContainer(r))&&t.initialize(a[r])},ThreadContainer.prototype.processComment=function(e,t,r,n){if(!n.parentId)return void BaseThreadContainer.prototype.processComment.call(this,e,t,r,n);var a=this._getParentThreadContainer(n.parentId);a&&a.addComment(n,!1)},module.exports=ThreadContainer},{"../../../templates/thread/threadcontainer.mustache":261,"../../events/events":134,"../../util/sorting":203,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96,"./basethreadcontainer":159,"./comment/topview":163}],187:[function(_dereq_,module,exports){function ThreadPopover(e){Popover.call(this,$.extend({leftPadding:30,maxWidth:e.maxWidth||600,minPopoverInView:200,minWidth:320,scrollDuration:500,sidePadding:10,topSpacing:20},e)),this._position=this.opts.position||Popover.POSITIONS.SMART}var $=_dereq_("./../../../../node_modules/jquery/dist/jquery"),debounce=_dereq_("../../util/internals").debounce,inherits=_dereq_("./../../../../lib/inherits/inherits.js"),Popover=_dereq_("../../ui/popover");inherits(ThreadPopover,Popover),ThreadPopover.CLASSES={MAIN:"lf-thread-popover",MEDIA_WRAPPER:"lf-media-wrapper",POSITION_PREFIX:"lf-pos-"},$.extend(ThreadPopover.CLASSES,Popover.CLASSES),ThreadPopover.prototype.elClass=[Popover.prototype.elClass,ThreadPopover.CLASSES.MAIN].join(" ");var resizeTimeout;ThreadPopover.prototype._handleResize=debounce(function(){clearTimeout(resizeTimeout),resizeTimeout=setTimeout($.proxy(function(){this.resizeAndReposition(this._blockEl)},this),500)},200),ThreadPopover.prototype.hide=function(e){Popover.prototype.hide.call(this,e),$(window).off("resize",$.proxy(this._handleResize,this))},ThreadPopover.prototype.show=function(e,o){this._blockEl=e,Popover.prototype.show.call(this,e,o),$(window).on("resize",$.proxy(this._handleResize,this)),this.$el.focus()},module.exports=ThreadPopover},{"../../ui/popover":189,"../../util/internals":196,"./../../../../lib/inherits/inherits.js":11,"./../../../../node_modules/jquery/dist/jquery":96}],188:[function(_dereq_,module,exports){function Container(e){View.call(this,e),this._activeVisState=VIS_STATE.HIDDEN,this._queuedEvents={},this._queuedEvents[VIS_EVENT.HIDE]=[],this._queuedEvents[VIS_EVENT.SHOW]=[],this._hideTimeMS=0,this._showTimeMS=0,this.render();var t=this.el.parentNode||this.el;(this.opts.parentEl||document.body).appendChild(t)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),containerTemplate=_dereq_("../../templates/container.mustache"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),UserAgentUtil=(_dereq_("../util/internals").nullFunction,_dereq_("../util/useragent")),View=_dereq_("./../../../lib/view/src/view.js"),lfWrapperTemplate=_dereq_("../../templates/thread/lfwrapper.mustache"),VIS_EVENT={HIDE:"hide",SHOW:"show"},VIS_STATE={HIDDEN:"hidden",HIDING:"hiding",SHOWING:"showing",VISIBLE:"visible"};inherits(Container,View),Container.CLASSES={ACTIVE:"lf-active",BASE:"lf-thread",CONTENT:"lf-thread-content",INLINE_CONTAINER:"lf-inline-thread",REMOVE:"lf-remove"},Container.prototype.elClass=Container.CLASSES.BASE,Container.prototype.events=function(){var e={};return UserAgentUtil.isMobile()||(e.mousedown="_handlePress",e.keyup="_handlePress"),e}(),Container.prototype.render=function(){View.prototype.render.call(this),this.$el.wrap(lfWrapperTemplate.render())},Container.prototype.template=containerTemplate.render.bind(containerTemplate),Container.prototype._handlePress=function(e){e.stopPropagation()},Container.prototype._processQueuedCallbacks=function(e){for(;this._queuedEvents[e].length;)this._queuedEvents[e].pop()()},Container.prototype.hide=function(e){if(this._activeVisState===VIS_STATE.HIDING)return void(e&&this.onHide(e));this.$el.addClass(Container.CLASSES.REMOVE),setTimeout($.proxy(this.hideInternal,this,e),this._hideTimeMS)},Container.prototype.hideInternal=function(e){this.$el.hide().attr("class",this.elClass),this._activeVisState=VIS_STATE.HIDDEN,"function"==typeof e&&e(),this._processQueuedCallbacks(VIS_EVENT.HIDE)},Container.prototype.isShowing=function(){return this._activeVisState===VIS_STATE.SHOWING},Container.prototype.isVisible=function(){return this._activeVisState===VIS_STATE.VISIBLE},Container.prototype.onHide=function(e){if(this._activeVisState===VIS_STATE.HIDDEN)return e();this._queuedEvents[VIS_EVENT.HIDE].push(e)},Container.prototype.onShow=function(e){if(this._activeVisState===VIS_STATE.VISIBLE)return e();this._queuedEvents[VIS_EVENT.SHOW].push(e)},Container.prototype.resizeAndReposition=function(e){this.opts.inlineThreads&&this.$el.closest(".lf").addClass(Container.CLASSES.INLINE_CONTAINER).insertAfter(e)},Container.prototype.setContentNode=function(e){var t=this.$("."+Container.CLASSES.CONTENT);t.empty(),t.append(e)},Container.prototype.show=function(e,t){this._activeVisState!==VIS_STATE.SHOWING&&(this._activeVisState=VIS_STATE.SHOWING,this.resizeAndReposition(e),this.$el.show(),this.$el.addClass(Container.CLASSES.ACTIVE),setTimeout($.proxy(function(){this._activeVisState=VIS_STATE.VISIBLE,t&&t(),this._processQueuedCallbacks(VIS_EVENT.SHOW)},this),this._showTimeMS))},module.exports=Container},{"../../templates/container.mustache":215,"../../templates/thread/lfwrapper.mustache":243,"../util/internals":196,"../util/useragent":206,"./../../../lib/inherits/inherits.js":11,"./../../../lib/view/src/view.js":83,"./../../../node_modules/jquery/dist/jquery":96}],189:[function(_dereq_,module,exports){function Popover(t){Container.call(this,t),this._activePosition=null,this._hideTimeMS=300,this._showTimeMS=300}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Container=_dereq_("./container"),domUtil=_dereq_("../util/dom"),inherits=_dereq_("./../../../lib/inherits/inherits.js"),popoverTemplate=_dereq_("../../templates/popover.mustache");inherits(Popover,Container),Popover.CLASSES={BASE:"lf-popover",CONTENT:"lf-popover-content",POSITION_PREFIX:"lf-pos-",LF:"lf"},Popover.POSITIONS={SMART:"smart",BOTTOM:"bottom",LEFT:"left",RIGHT:"right"},Popover.POSITION_FN_MAP={bottom:"_getBottomPosition",left:"_getLeftPosition",right:"_getRightPosition",smart:"_getSmartPosition"},Popover.prototype.elClass=Popover.CLASSES.BASE,Popover.prototype.template=popoverTemplate.render.bind(popoverTemplate),Popover.prototype._getBottomPosition=function(t){this._activePosition=Popover.POSITIONS.BOTTOM;var o=domUtil.getBoundingClientRect(t),i=o.bottom+domUtil.getScrollY()+10,e=o.right-o.left,r=e<this.opts.maxWidth?e:this.opts.maxWidth,n=(e-r)/2;return n+=o.left+domUtil.getScrollX(),{top:i,left:n,width:r}},Popover.prototype._getLeftPosition=function(t){this._activePosition=Popover.POSITIONS.LEFT;var o=domUtil.getBoundingClientRect(t);return{top:o.top+domUtil.getScrollY(),right:$("body").width()-o.left+this.opts.leftPadding,width:o.left-this.opts.leftPadding}},Popover.prototype._getPopoverWidth=function(t){return t<this.opts.minWidth?this.opts.minWidth:t>this.opts.maxWidth?this.opts.maxWidth:t-=this.opts.sidePadding*(this._activePosition===Popover.POSITIONS.BOTTOM?2:1)},Popover.prototype._getRightPosition=function(t){this._activePosition=Popover.POSITIONS.RIGHT;var o=domUtil.getBoundingClientRect(t),i=o.top+domUtil.getScrollY(),e=o.right+domUtil.getScrollX()+10;return{top:i,left:e,width:document.body.clientWidth-e}},Popover.prototype._getSmartPosition=function(t){var o=this._getRightPosition(t);return o.width<this.opts.minWidth?this._getBottomPosition(t):o},Popover.prototype._scrollIntoPosition=function(t){var o=$("body,html");if(!o.is(":animated")){var i=domUtil.getScrollY(),e=i+$(window).height(),r=t+this.opts.minPopoverInView<=e,n=t>i+this.opts.topSpacing;if(!r||!n){var p;r?n||(p=t-this.opts.topSpacing):p=i+(this.opts.minPopoverInView+t-e),o.animate({scrollTop:p},this.opts.scrollDuration)}}},Popover.prototype.render=function(){Container.prototype.render.call(this),this.$_contentNode=this.$("."+Popover.CLASSES.CONTENT)},Popover.prototype.resizeAndReposition=function(t){var o=this[Popover.POSITION_FN_MAP[this._position]].call(this,t),i=Popover.CLASSES.POSITION_PREFIX;o.width=this._getPopoverWidth(o.width),this.$el.css(o).removeClass(function(){var t=[];for(var o in Popover.POSITIONS)Popover.POSITIONS.hasOwnProperty(o)&&t.push(i+Popover.POSITIONS[o]);return t.join(" ")}).addClass(i+this._activePosition),this._scrollIntoPosition(o.top)},Popover.prototype.setContentNode=function(t){this.$_contentNode.empty(),this.$_contentNode.append(t)},module.exports=Popover},{"../../templates/popover.mustache":231,"../util/dom":194,"./../../../lib/inherits/inherits.js":11,"./../../../node_modules/jquery/dist/jquery":96,"./container":188}],190:[function(_dereq_,module,exports){function UserController(e){BaseController.call(this,e)}var auth=(_dereq_("./../../../node_modules/jquery/dist/jquery"),_dereq_("../util/auth")),BaseController=(_dereq_("./../../../lib/base64/base64"),_dereq_("../controller/base")),inherits=_dereq_("./../../../lib/inherits/inherits.js"),UserEvents=_dereq_("../events/events").user;inherits(UserController,BaseController),UserController.prototype.events=function(){var e={};return e[UserEvents.ADMIN]="_handleAdmin",e[UserEvents.EDIT_PROFILE]="_handleEditProfile",e[UserEvents.LOGIN]="_handleLogin",e[UserEvents.LOGOUT]="_handleLogout",e[UserEvents.VIEW_PROFILE]="_handleViewProfile",e}(),UserController.prototype._handleAdmin=function(){window.open(this._collection.generateAdminUrl())},UserController.prototype._handleEditProfile=function(){auth.editProfile()},UserController.prototype._handleLogin=function(){auth.login()},UserController.prototype._handleLogout=function(){auth.logout()},UserController.prototype._handleViewProfile=function(e,r){auth.viewProfile(r.author)},UserController.prototype.destroy=function(){BaseController.prototype.destroy.call(this)},module.exports=UserController},{"../controller/base":127,"../events/events":134,"../util/auth":192,"./../../../lib/base64/base64":5,"./../../../lib/inherits/inherits.js":11,"./../../../node_modules/jquery/dist/jquery":96}],191:[function(_dereq_,module,exports){var array={};array.defaultComparator=function(r,a){return r<a?-1:r>a?1:0},array.findIndex=function(r,a,t){for(var n=t||array.defaultComparator,e=0,o=r.length;e<o;e++)if(n(a,r[e])<=0)return e;return r.length},module.exports=array},{}],192:[function(_dereq_,module,exports){var ThreadEvents=_dereq_("../events/events").thread,viewEnum=_dereq_("../enums").navigableViews,auth=function(){return"object"==typeof Livefyre&&Livefyre.auth?Livefyre.auth:_dereq_("./../../../lib/auth/src/main")}();auth.requireAuth=function(e,t){return function(r){var i=t||[r.type,r.namespace].join(".");if(!auth.get("livefyre"))return void(this.$antenna||this.$el).trigger(ThreadEvents.NAVIGATE,{event:i,value:viewEnum.AUTH});e.apply(this,arguments)}},module.exports=auth},{"../enums":133,"../events/events":134,"./../../../lib/auth/src/main":3}],193:[function(_dereq_,module,exports){var textEnumeration=_dereq_("../i18n/enumeration"),util={};util.getPrettyDate=function(t){var e=textEnumeration.get(textEnumeration.KEYS.DATETIME_MONTHS);return"string"==typeof e&&(e=e.indexOf(", ")>-1?e.split(", "):e.indexOf(",")>-1?e.split(","):e),[e[t.getMonth()]," ",t.getDate(),", ",t.getFullYear()].join("")},module.exports=util},{"../i18n/enumeration":135}],194:[function(_dereq_,module,exports){var UserAgentUtil=_dereq_("./useragent"),dom={};dom.getBoundingClientRect=function(t){var e=t.getBoundingClientRect();return e.height||e.top||(e=t.getBoundingClientRect()),UserAgentUtil.isIE()&&UserAgentUtil.getIEVersion()<9&&(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left},e.height=e.bottom-e.top,e.width=e.right-e.left),e},dom.getScrollX=function(){return void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft},dom.getScrollY=function(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop},dom.raf=function(){return"requestAnimationFrame"in window?window.requestAnimationFrame.bind(window):function(t){window.setTimeout(t,1e3/60)}}(),module.exports=dom},{"./useragent":206}],195:[function(_dereq_,module,exports){module.exports={normalizeNewlines:function(e,n){return n&&(e=e.replace(/^(\s*)/,"").replace(/(\s*)$/,"")),e="<p>"+e.split("\n").join("</p><p>")+"</p>"},normalizeParagraphTags:function(e){return e=e.replace(/<p>/g,""),e=e.replace(/<\/p>/g,"\n"),-1!==e.indexOf("\n",e.length="\n".length)&&(e=e.slice(0,-1*"\n".length)),e},focusAndPlaceCursorAtEnd:function(e){var n=e[0];if(e.focus(),n.setSelectionRange){var l=2*e.val().length;n.setSelectionRange(l,l)}else e.val(e.val())},escapeHTML:function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}}},{}],196:[function(_dereq_,module,exports){var util={};util.abstractMethod=function(){throw"This function must be overridden"},util.debounce=function(t,n,u){var i=!1;return function(){i||(i=!0,setTimeout(function(){i=!1,u&&t.call(this)},n),!u&&t.call(this))}},util.memoize=function(t){return function(){var n=t.call(this);return t=function(){return n},n}},util.nullFunction=function(){},module.exports=util},{}],197:[function(_dereq_,module,exports){module.exports={getOrigin:function(){return window.location.origin||location.getOriginIE()},getOriginIE:function(){var o="";return window.location.port&&(o=":"+window.location.port),("http:"===window.location.protocol?"http://":"https://")+window.location.hostname+o}}},{}],198:[function(_dereq_,module,exports){module.exports={getKeys:function(r){var e=[];for(var n in r)r.hasOwnProperty(n)&&e.push(n);return e},getValues:function(r){var e=[];for(var n in r)r.hasOwnProperty(n)&&e.push(r[n]);return e}}},{}],199:[function(_dereq_,module,exports){var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),domUtil=_dereq_("./dom"),util={};util.scrollToPermalink=function(o,e){var l=o.offsetTop-20,r=Math.min(2*Math.abs(domUtil.getScrollY()-l),1e3);$("body").animate({scrollTop:l},r,e)},module.exports=util},{"./../../../node_modules/jquery/dist/jquery":96,"./dom":194}],200:[function(_dereq_,module,exports){function process(e,r){for(var t,n=0,u=r.length;n<u;n++)if(t=PROCESSOR_MAP[r[n]](e))return t;return null}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),wrap=_dereq_("../../templates/blocks/elementwrap.mustache"),util={},TYPES={ARRAY:"Array",ELEMENT:"Element",JQUERY:"Jquery",OBJECT:"Object",STRING:"String"},ALL=[TYPES.JQUERY,TYPES.STRING,TYPES.ARRAY,TYPES.ELEMENT,TYPES.OBJECT],ARRAY_SUPPORTS=[TYPES.JQUERY,TYPES.STRING,TYPES.ELEMENT],OBJECT_INCLUDE_SUPPORTS=[TYPES.JQUERY,TYPES.STRING,TYPES.ARRAY],OBJECT_EXCLUDE_SUPPORTS=[TYPES.JQUERY,TYPES.STRING];util.processArray=function(e){if(!(e instanceof HTMLCollection||e instanceof NodeList||$.isArray(e)))return null;var r,t=[];if($.each(e,function(e,n){(r=process(n,ARRAY_SUPPORTS))&&t.push(r)}),!t.length)return null;var n=[];return $.each(t,function(e,r){n=n.concat(r)}),n},util.processElement=function(e){if(!(e instanceof Node))return null;if("#text"===e.nodeName){var r=$(wrap.render({content:e.nodeValue}))[0];return e.parentNode.replaceChild(r,e),r}return e},util.processJquery=function(e){return e instanceof $?e.toArray():null},util.processObject=function(e){if("object"!=typeof e)return null;if(!e.include)return null;var r=process(e.include,OBJECT_INCLUDE_SUPPORTS);if(!r)return null;var t="";return e.exclude&&(t=process(e.exclude,OBJECT_EXCLUDE_SUPPORTS)),$(r).not(t).toArray()},util.processString=function(e){return"string"==typeof e?$(e).toArray():null};var PROCESSOR_MAP=function(){var e={};return e[TYPES.ARRAY]=util.processArray,e[TYPES.ELEMENT]=util.processElement,e[TYPES.JQUERY]=util.processJquery,e[TYPES.OBJECT]=util.processObject,e[TYPES.STRING]=util.processString,e}();util.parseSelectors=function(e){var r=process(e,ALL);if(!r)throw new TypeError('Provided selector: "'+e+'" is not supported.');return $(r)},util.matchElement=function(e){return util.parseSelectors(e)[0]},module.exports=util},{"../../templates/blocks/elementwrap.mustache":207,"./../../../node_modules/jquery/dist/jquery":96}],201:[function(_dereq_,module,exports){function createSimhashToBlockIdLookup(o){var e,r,t,s={};for(var i in o)o.hasOwnProperty(i)&&(e=o[i][KEYS.HINTS],r=e[KEYS.SIMHASH],t=e[KEYS.INDEX],s[r]=s[r]||[],s[r][t]=i);return s}function SimhashLookup(o){var e,r=window.location.protocol+"//cdn.livefyre.com/libs/sidenotes/v1.6.1",t=r+"/simhash-worker.min.js";"function"==typeof Blob&&(e=new Blob(['importScripts("'+r+'/simhash-worker.min.js");'],{type:"text/javascript"}),t=URL.createObjectURL(e));var s=r+"/ie-worker.html",i=getKeys(o).length>100?2:1;this.workerPool=new WorkerPool({workerCount:i,workerPath:t,iframePath:s}),this.simhashToBlockIdLookup=createSimhashToBlockIdLookup(o)}var KEYS=_dereq_("../adapters/adapters").BootstrapKeys,getKeys=_dereq_("./object").getKeys,Promise=_dereq_("es6-promise").Promise,WorkerPool=_dereq_("worker-pool");SimhashLookup.prototype.getBlockId=function(o,e){return this.simhashToBlockIdLookup.hasOwnProperty(o)?this.simhashToBlockIdLookup[o][e]||null:null},SimhashLookup.prototype.getBlockIdWithThreshold=function(o,e,r){var t=getKeys(this.simhashToBlockIdLookup),s=this;return 0===t.length?Promise.resolve(this.getBlockId(void 0,e)):new Promise(function(i,h){s.workerPool.queueJob({type:"similarity",simhash:o,simhashes:t,threshold:r},function(o){var r=o.data.value;i(s.getBlockId(r,e))})})},SimhashLookup.prototype.getSimhash=function(o){var e=this;return new Promise(function(r,t){e.workerPool.queueJob({type:"simhash",value:o},function(o){r(o.data.value)})})},SimhashLookup.prototype.destroy=function(){this.workerPool.destroy(),this.simhashToBlockIdLookup=null},module.exports=SimhashLookup},{"../adapters/adapters":112,"./object":198,"es6-promise":91,"worker-pool":111}],202:[function(_dereq_,module,exports){function cleanHtml(e){return e=e.replace(/\n/g," ").replace(/<br[ \/]?>/g," ").replace(/\s+/g," "),$("<div />").html(e).text()}function generateFacebookParams(e){var t=textEnumeration.get(textEnumeration.KEYS.FACEBOOK_SHARE_CAPTION),o=["http:"===window.location.protocol?"http:":"https:",e.assetServer,"/libs/share/facebook-uri.html"].join("");return t=encodeURIComponent(t.replace("{title}",document.title)),["?app_id=",FACEBOOK_APP_ID,"&caption=",t,"&description=",encodeURIComponent(e.body),"&display=popup","&link=",encodeURIComponent(e.url),"&redirect_uri=",encodeURIComponent(o)].join("")}function generateTwitterParams(e){return["?text=",encodeURIComponent(e.body),"&url=",encodeURIComponent(e.url)].join("")}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),textEnumeration=_dereq_("../i18n/enumeration"),FACEBOOK_APP_ID="595267417193679",Social={};Social.contentToShare=function(e,t){var o=Social.contentToTweet;return"facebook"===t&&(o=Social.contentToFacebookMessage),o(e)},Social.contentToFacebookMessage=function(e){var t=textEnumeration.KEYS,o=textEnumeration.get(t.FACEBOOK_SHARE_DESCRIPTION),n=textEnumeration.get(t.FACEBOOK_SHARE_DESCRIPTION_SOURCE);return{body:(e.isSource?n:o).replace("{body}",cleanHtml(e.body)),url:e.permalink}},Social.contentToTweet=function(e){var t=cleanHtml(e.body),o=e.author.displayName;o=o?"- "+o:"";var n=e.permalink,r=23;0===n.indexOf("https")&&r++;var a=140-r-o.length;return a<t.length+2&&(t=t.substring(0,a-5)+"..."),{body:'"'+t+'"'+o,url:e.permalink}},Social.generateParams=function(e){return"facebook"===e.provider?generateFacebookParams(e):generateTwitterParams(e)},module.exports=Social},{"../i18n/enumeration":135,"./../../../node_modules/jquery/dist/jquery":96}],203:[function(_dereq_,module,exports){module.exports={createdAtComparator:function(e,t){var o=this._comments[e].getModel().createdAt,s=this._comments[t].getModel().createdAt;return o<s?-1:o>s?1:0},helpfulnessComparator:function(e,t){var o=this._comments[e].getModel(),s=this._comments[t].getModel(),r=o.votes.helpfulness,n=s.votes.helpfulness,d=r<n?1:r>n?-1:0;return 0!==d?d:(r=o.votes.downvotes,n=s.votes.downvotes,0!=(d=r<n?-1:r>n?1:0)?d:(r=o.createdAt,n=s.createdAt,r<n?1:r>n?-1:0))}}},{}],204:[function(_dereq_,module,exports){function addCommentToMap(e,r,o){o[e]||(o[e]=[]),$.inArray(r,o[e])>-1||o[e].push(r)}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),Comment=_dereq_("../models/comment"),Storage=_dereq_("./../../../lib/streamhub-sdk/src/storage"),StorageWrapper={};StorageWrapper.blockToCommentMap={},StorageWrapper.get=function(e,r){return Storage.get(e,r)},StorageWrapper.getCommentsForBlock=function(e){return $.map(StorageWrapper.blockToCommentMap[e]||[],function(e){return Storage.get(e)})},StorageWrapper.getNumCommentsForBlock=function(e){var r,o=[];return $.each(StorageWrapper.blockToCommentMap[e]||[],function(e,t){(r=Storage.get(t))&&r.isVisible()&&o.push(t)}),o.length},StorageWrapper.set=function(e,r,o){return Storage.set(e,r,o),r instanceof Comment&&addCommentToMap(r.blockId,r.id,StorageWrapper.blockToCommentMap),r},StorageWrapper.reset=function(){Storage.cache={},StorageWrapper.blockToCommentMap={}},module.exports=StorageWrapper},{"../models/comment":156,"./../../../lib/streamhub-sdk/src/storage":79,"./../../../node_modules/jquery/dist/jquery":96}],205:[function(_dereq_,module,exports){function borderRadius(E){var t=[];return t.push("-webkit-border-radius:"+E+" !important;"),t.push("-moz-border-radius:"+E+" !important;"),t.push("border-radius:"+E+" !important;"),t.join("")}function convertPixel(E){return"number"==typeof E?E+"px":E}function isSupportedElement(E){return E in ELEMENT_TO_PROPERTIES}function isSupportedProperty(E,t){return ELEMENT_TO_PROPERTIES[E].indexOf(t)>-1}var $=_dereq_("./../../../node_modules/jquery/dist/jquery"),util={},PROPERTY_MAP={backgroundColor:["background-color"],border:["border"],borderRadius:[null,borderRadius],fontColor:["color"],fontFamily:["font-family"],fontSize:["font-size",convertPixel],fontWeight:["font-weight"],height:["height"],left:["left"],lineHeight:["line-height"],padding:["padding"],position:["position"],right:["right"],top:["top"],width:["width"]},ELEMENT={BLOCK_BTN:"blockBtn",BLOCK_BTN_ACTIVE:"blockBtnActive",MEDIA_BLOCK_BTN:"mediaBlockBtn",MEDIA_BLOCK_BTN_ACTIVE:"mediaBlockBtnActive",ANONYMOUS_AVATAR:"anonymousAvatar",USER_AVATAR:"userAvatar",POPOVER:"popover",POPOVER_ARROW_LEFT:"popoverArrowLeft",POPOVER_ARROW_RIGHT:"popoverArrowRight",POPOVER_ARROW_TOP:"popoverArrowTop",EDITOR:"editorTextarea",STREAM_QUEUE_BTN:"streamQueueButton",POWERED_BY:"streamPoweredBy",COMMENT_AVATAR:"commentAvatar",COMMENT_BODY:"commentBody",COMMENT_DISPLAY_NAME:"commentDisplayName",COMMENT_TAGS:"commentTags",COMMENT_UPVOTE:"commentUpvote",COMMENT_DOWNVOTE:"commentDownvote",COMMENT_REPLIES_EXPAND:"commentReplyExpand",COMMENT_REPLY_AVATAR:"replyAvatar",NUM_SIDENOTES:"numSidenotes",NUM_SIDENOTES_POPOVER:"numSidenotesPopover"},ELEMENT_TO_SELECTOR=function(){var E={};return E[ELEMENT.BLOCK_BTN]=".lf-thread-btn",E[ELEMENT.BLOCK_BTN_ACTIVE]=".lf-thread-btn:hover, .lf-thread-btn.lf-active",E[ELEMENT.MEDIA_BLOCK_BTN]=".lf-media-wrapper .lf-thread-btn",E[ELEMENT.MEDIA_BLOCK_BTN_ACTIVE]=[".lf-media-wrapper .lf-thread-btn:hover",".lf-media-wrapper .lf-thread-btn.lf-active"].join(","),E[ELEMENT.ANONYMOUS_AVATAR]=".lf img.lf-anon-avatar",E[ELEMENT.USER_AVATAR]=".lf .lf-thread > img.lf-author-avatar",E[ELEMENT.POPOVER]=".lf-thread-popover",E[ELEMENT.POPOVER_ARROW_LEFT]=".lf-pos-right > .lf-popover-arrow",E[ELEMENT.POPOVER_ARROW_RIGHT]=".lf-pos-left > .lf-popover-arrow",E[ELEMENT.POPOVER_ARROW_TOP]=".lf-pos-bottom > .lf-popover-arrow",E[ELEMENT.EDITOR]=".lf textarea.lf-editor-field",E[ELEMENT.STREAM_QUEUE_BTN]=".lf .lf-thread > .lf-queue-btn",E[ELEMENT.POWERED_BY]=".lf .lf-thread .lf-powered-by",E[ELEMENT.COMMENT_AVATAR]=".lf article.lf-comment .lf-comment-author-avatar",E[ELEMENT.COMMENT_BODY]=".lf article.lf-comment .lf-comment-body p",E[ELEMENT.COMMENT_DISPLAY_NAME]=".lf article.lf-comment .lf-comment-author-name",E[ELEMENT.COMMENT_TAGS]=".lf article.lf-comment .lf-tag",E[ELEMENT.COMMENT_UPVOTE]=[".lf article.lf-comment .lf-comment-footer .lf-votes.lf-upvote .lf-count",".lf article.lf-comment .lf-comment-footer .lf-votes.lf-upvote .lf-upvote"].join(","),E[ELEMENT.COMMENT_DOWNVOTE]=[".lf article.lf-comment .lf-comment-footer .lf-votes.lf-downvote .lf-count",".lf article.lf-comment .lf-comment-footer .lf-votes.lf-downvote .lf-downvote"].join(","),E[ELEMENT.COMMENT_REPLIES_EXPAND]=".lf article.lf-comment .lf-reply-container .lf-queue-btn",E[ELEMENT.COMMENT_REPLY_AVATAR]=".lf article.lf-comment.lf-reply .lf-comment-author-avatar",E[ELEMENT.NUM_SIDENOTES]=".lf-num-sidenotes",E[ELEMENT.NUM_SIDENOTES_POPOVER]=".lf-question-popover",E}(),BLOCK_BTN_PROPERTIES=["border","borderRadius","fontColor","fontSize","height","left","lineHeight","padding","position","right","top","width"],FONT_PROPERTIES=["fontColor","fontFamily","fontSize","fontWeight","lineHeight"],POPOVER_ARROW_PROPERTIES=["backgroundImage","height","left","right","top","width"],QUEUE_BUTTON_PROPERTIES=$.merge(["backgroundColor","borderColor","borderWidth"],FONT_PROPERTIES),NUM_SIDENOTES_PROPERTIES=$.merge(["backgroundColor","borderColor","borderWidth","height","width"],FONT_PROPERTIES),ELEMENT_TO_PROPERTIES=function(){var E={};return E[ELEMENT.BLOCK_BTN]=BLOCK_BTN_PROPERTIES,E[ELEMENT.BLOCK_BTN_ACTIVE]=BLOCK_BTN_PROPERTIES,E[ELEMENT.MEDIA_BLOCK_BTN]=BLOCK_BTN_PROPERTIES,E[ELEMENT.MEDIA_BLOCK_BTN_ACTIVE]=BLOCK_BTN_PROPERTIES,E[ELEMENT.ANONYMOUS_AVATAR]=["height","width"],E[ELEMENT.USER_AVATAR]=["height","width"],E[ELEMENT.POPOVER]=["backgroundColor"],E[ELEMENT.POPOVER_ARROW_LEFT]=POPOVER_ARROW_PROPERTIES,E[ELEMENT.POPOVER_ARROW_RIGHT]=POPOVER_ARROW_PROPERTIES,E[ELEMENT.POPOVER_ARROW_TOP]=POPOVER_ARROW_PROPERTIES,E[ELEMENT.EDITOR]=$.extend(["height","width"],FONT_PROPERTIES),E[ELEMENT.STREAM_QUEUE_BTN]=QUEUE_BUTTON_PROPERTIES,E[ELEMENT.POWERED_BY]=["backgroundColor","borderColor","lineHeight"],E[ELEMENT.COMMENT_AVATAR]=["height","width"],E[ELEMENT.COMMENT_BODY]=FONT_PROPERTIES,E[ELEMENT.COMMENT_DISPLAY_NAME]=FONT_PROPERTIES,E[ELEMENT.COMMENT_TAGS]=FONT_PROPERTIES,E[ELEMENT.COMMENT_UPVOTE]=["fontColor","fontSize"],E[ELEMENT.COMMENT_DOWNVOTE]=["fontColor","fontSize"],E[ELEMENT.COMMENT_REPLIES_EXPAND]=QUEUE_BUTTON_PROPERTIES,E[ELEMENT.COMMENT_REPLY_AVATAR]=["height","width"],E[ELEMENT.NUM_SIDENOTES]=NUM_SIDENOTES_PROPERTIES,E[ELEMENT.NUM_SIDENOTES_POPOVER]=NUM_SIDENOTES_PROPERTIES,E}();util.applyStyles=function(E){$("head").append($('<style type="text/css">'+E+"</style>"))},util.parseStyles=function(E){var t,e,o="";$.each(E,function(E,T){isSupportedElement(E)&&(e=[],$.each(T,function(o,T){if(isSupportedProperty(E,o)){if(t=PROPERTY_MAP[o],!t[0])return void e.splice(e.length,0,t[1](T));e.splice(e.length,0,t[0],":"),T=t[1]?t[1](T):T,e.splice(e.length,0,T," !important;")}}),0!==e.length&&(e.splice(0,0,ELEMENT_TO_SELECTOR[E],"{"),e.push("}"),o+=e.join("")))}),o&&util.applyStyles(o)},module.exports=util},{"./../../../node_modules/jquery/dist/jquery":96}],206:[function(_dereq_,module,exports){var internals=_dereq_("./internals"),userAgent={};userAgent.getIEVersion=internals.memoize(function(){return navigator.userAgent.match(/MSIE ([0-9]+)\./)?parseInt(RegExp.$1,10):null}),userAgent.isIE=internals.memoize(function(){return/MSIE ([0-9]+)\./.test(navigator.userAgent)}),userAgent.isMobile=internals.memoize(function(){var e=-1!==navigator.appVersion.indexOf("Mobile"),n=-1!==navigator.appVersion.indexOf("Android");return e||n}),module.exports=userAgent},{"./internals":196}],207:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,s){var t=this;return t.b(s=s||""),t.b('<span class="lf-text-block">'),t.b(t.v(t.f("content",n,a,0))),t.b("</span>"),t.b("\n"),t.fl()},partials:{},subs:{}},'<span class="lf-text-block">{{ content }}</span>\n',Hogan)},{"hogan.js":93}],208:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,s){var t=this;return t.b(s=s||""),t.b('<span class="lf-highlight-text">'),t.b(t.v(t.f("originalText",a,n,0))),t.b("</span>"),t.b("\n"),t.fl()},partials:{},subs:{}},'<span class="lf-highlight-text">{{ originalText }}</span>\n',Hogan)},{"hogan.js":93}],209:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,e,r){var i=this;return i.b(r=r||""),i.b('<div class="lf-media-wrapper"></div>'),i.b("\n"),i.fl()},partials:{},subs:{}},'<div class="lf-media-wrapper"></div>\n',Hogan)},{"hogan.js":93}],210:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,s,a){var p=this;return p.b(a=a||""),p.b('<span class="lf-action-view-wrapper">'),p.b("\n"+a),p.b('    <span class="fycon-action-view"></span>'),p.b("\n"+a),p.b("</span>"),p.b("\n"+a),p.b('<span class="lf-text">'),p.b(p.v(p.f("commentCount",n,s,0))),p.b("&nbsp;"),p.b(p.v(p.d("strings.appName",n,s,0))),p.b("</span>"),p.b("\n"+a),p.b('<span class="lf-question-wrapper">'),p.b("\n"+a),p.b('    <span class="fycon-question"></span>'),p.b("\n"+a),p.b("</span>"),p.b("\n"),p.fl()},partials:{},subs:{}},'<span class="lf-action-view-wrapper">\n    <span class="fycon-action-view"></span>\n</span>\n<span class="lf-text">{{ commentCount }}&nbsp;{{ strings.appName }}</span>\n<span class="lf-question-wrapper">\n    <span class="fycon-question"></span>\n</span>\n',Hogan)},{"hogan.js":93}],211:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,s){var t=this;return t.b(s=s||""),t.b('<div class="lf-title-text">'),t.b(t.v(t.d("strings.title",n,a,0))),t.b("</div>"),t.b("\n"+s),t.b("<br>"),t.b("\n"+s),t.b('<div class="lf-mock-text">'),t.b("\n"+s),t.b('    <span class="lf-gradient-right"></span>'),t.b("\n"+s),t.b("    "),t.b(t.v(t.d("strings.mockText",n,a,0))),t.b("\n"+s),t.b("    <span>"),t.b("\n"+s),t.b('        <a class="lf-thread-btn fycon-action-view lf-has-num lf-active">5</a>'),t.b("\n"+s),t.b("    </span>"),t.b("\n"+s),t.b('    <span class="lf-gradient-left"></span>'),t.b("\n"+s),t.b("</div>"),t.b("\n"+s),t.b("<br>"),t.b("\n"+s),t.b('<div class="lf-explanation-text">'),t.b(t.t(t.d("strings.explanation",n,a,0))),t.b("</div>"),t.b("\n"),t.fl()},partials:{},subs:{}
},'<div class="lf-title-text">{{ strings.title }}</div>\n<br>\n<div class="lf-mock-text">\n    <span class="lf-gradient-right"></span>\n    {{ strings.mockText }}\n    <span>\n        <a class="lf-thread-btn fycon-action-view lf-has-num lf-active">5</a>\n    </span>\n    <span class="lf-gradient-left"></span>\n</div>\n<br>\n<div class="lf-explanation-text">{{{ strings.explanation }}}</div>\n',Hogan)},{"hogan.js":93}],212:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,t,e){var o=this;return o.b(e=e||""),o.b('<a data-value="annotation" class="lf-add-annotation fycon-write" tabindex="0" role="button" aria-label="Write A Sidenote"></a>'),o.b("\n"+e),o.b('<a data-value="twitter" class="lf-share-twitter fycon-source-twitter" tabindex="0" role="button aria-label="Share to Twitter"></a>'),o.b("\n"+e),o.b('<a data-value="facebook" class="lf-share-facebook fycon-source-facebook" tabindex="0" role="button" aria-label="Share to Facebook"></a>'),o.b("\n"),o.fl()},partials:{},subs:{}},'<a data-value="annotation" class="lf-add-annotation fycon-write" tabindex="0" role="button" aria-label="Write A Sidenote"></a>\n<a data-value="twitter" class="lf-share-twitter fycon-source-twitter" tabindex="0" role="button aria-label="Share to Twitter"></a>\n<a data-value="facebook" class="lf-share-facebook fycon-source-facebook" tabindex="0" role="button" aria-label="Share to Facebook"></a>\n',Hogan)},{"hogan.js":93}],213:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(t,n,o){var i=this;return i.b(o=o||""),i.b('<style type="text/css">'),i.b("\n"+o),i.b("    .lf-thread-btn:before {"),i.b("\n"+o),i.b("        background-image: url('"),i.b(i.v(i.f("customIcon",t,n,0))),i.b("') !important;"),i.b("\n"+o),i.b("        background-size: "),i.b(i.v(i.d("customIconCfg.width",t,n,0))),i.b("px "),i.b(i.v(i.d("customIconCfg.height",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b('        content: " " !important;'),i.b("\n"+o),i.b("        height: "),i.b(i.v(i.d("customIconCfg.height",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b("        margin-left: "),i.b(i.v(i.d("customIconCfg.marginLeft",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b("        margin-right: "),i.b(i.v(i.d("customIconCfg.marginRight",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b("        margin-top: "),i.b(i.v(i.d("customIconCfg.marginTop",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b("        width: "),i.b(i.v(i.d("customIconCfg.width",t,n,0))),i.b("px !important;"),i.b("\n"+o),i.b("    }"),i.b("\n"+o),i.b("</style>"),i.b("\n"),i.fl()},partials:{},subs:{}},'<style type="text/css">\n    .lf-thread-btn:before {\n        background-image: url(\'{{ customIcon }}\') !important;\n        background-size: {{ customIconCfg.width }}px {{ customIconCfg.height }}px !important;\n        content: " " !important;\n        height: {{ customIconCfg.height }}px !important;\n        margin-left: {{ customIconCfg.marginLeft }}px !important;\n        margin-right: {{ customIconCfg.marginRight }}px !important;\n        margin-top: {{ customIconCfg.marginTop }}px !important;\n        width: {{ customIconCfg.width }}px !important;\n    }\n</style>\n',Hogan)},{"hogan.js":93}],214:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,e){var i=this;return i.b(e=e||""),i.s(i.f("count",a,n,1),a,n,0,10,99,"{{ }}")&&(i.rs(a,n,function(a,n,i){i.b('<a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote">'),i.b(i.v(i.f("count",a,n,0))),i.b("</a>"),i.b("\n"+e)}),a.pop()),i.s(i.f("count",a,n,1),a,n,1,0,0,"")||(i.b('<a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote">'),i.s(i.f("isMedia",a,n,1),a,n,0,205,237,"{{ }}")&&(i.rs(a,n,function(a,n,e){e.b(e.v(e.d("strings.emptyImageBlockTxt",a,n,0)))}),a.pop()),i.s(i.f("isMedia",a,n,1),a,n,1,0,0,"")||i.b(i.v(i.d("strings.emptyTextBlockTxt",a,n,0))),i.b("\n"+e),i.b("</a>"),i.b("\n"+e)),i.fl()},partials:{},subs:{}},'{{#count}}\n<a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote">{{ count }}</a>\n{{/count}}\n{{^count}}\n<a class="fycon-action-view" tabindex="0" aria-label="Write a Sidenote">{{#isMedia}}{{ strings.emptyImageBlockTxt }}{{/isMedia}}{{^isMedia}}{{ strings.emptyTextBlockTxt }}{{/isMedia}}\n</a>\n{{/count}}\n',Hogan)},{"hogan.js":93}],215:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,e){var t=this;return t.b(e=e||""),t.b('<div class="lf-thread-content"></div>'),t.b("\n"),t.fl()},partials:{},subs:{}},'<div class="lf-thread-content"></div>\n',Hogan)},{"hogan.js":93}],216:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,l){var s=this;return s.b(l=l||""),s.b('<div class="lf-votes" />'),s.b("\n"+l),s.b('<a class="fycon-action-reply lf-reply-btn" />'),s.b("\n"),s.fl()},partials:{},subs:{}},'<div class="lf-votes" />\n<a class="fycon-action-reply lf-reply-btn" />\n',Hogan)},{"hogan.js":93}],217:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,s){var e=this;return e.b(s=s||""),e.b('<div class="lf-comment-container">'),e.b("\n"+s),e.b('    <img class="lf-comment-author-avatar" src="'),e.b(e.v(e.d("author.avatar",n,a,0))),e.b('" />'),e.b("\n"+s),e.b('    <header class="lf-comment-header">'),e.b("\n"+s),e.b('        <div class="lf-comment-header-upper">'),e.b("\n"+s),e.b('            <span class="lf-comment-author-name">'),e.b(e.t(e.d("author.displayName",n,a,0))),e.b("</span>"),e.b("\n"+s),e.b(e.rp("<tags0",n,a,"            ")),e.b('            <div class="lf-escape-button fycon-x"></div>'),e.b("\n"+s),e.b("        </div>"),e.b("\n"+s),e.b('        <div class="lf-comment-header-lower">'),e.b("\n"+s),e.b('            <div class="lf-vote-count">'),e.b(e.v(e.f("voteCount",n,a,0))),e.b(" "),e.b(e.v(e.d("strings.voteCount",n,a,0))),e.b("</div>"),e.b("\n"+s),e.b("        </div>"),e.b("\n"+s),e.b("    </header>"),e.b("\n"+s),e.b('    <section class="lf-comment-body">'),e.b("\n"+s),e.b("        "),e.b(e.t(e.f("body",n,a,0))),e.b("\n"+s),e.b("    </section>"),e.b("\n"+s),e.b(e.rp("<footer1",n,a,"    ")),e.b("</div>"),e.b("\n"+s),e.s(e.f("hasReplies",n,a,1),n,a,0,643,763,"{{ }}")&&(e.rs(n,a,function(n,a,e){e.b("<footer class='lf-comment-container-footer'>"),e.b("\n"+s),e.b('    <span class="lf-reply-count">'),e.b(e.v(e.d("strings.replyLink",n,a,0))),e.b("</span>"),e.b("\n"+s),e.b("</footer>"),e.b("\n"+s)}),n.pop()),e.b('<div class="lf-reply-container"></div>'),e.b("\n"),e.fl()},partials:{"<tags0":{name:"tags",partials:{},subs:{}},"<footer1":{name:"footer",partials:{},subs:{}}},subs:{}},'<div class="lf-comment-container">\n    <img class="lf-comment-author-avatar" src="{{ author.avatar }}" />\n    <header class="lf-comment-header">\n        <div class="lf-comment-header-upper">\n            <span class="lf-comment-author-name">{{{ author.displayName }}}</span>\n            {{> tags}}\n            <div class="lf-escape-button fycon-x"></div>\n        </div>\n        <div class="lf-comment-header-lower">\n            <div class="lf-vote-count">{{ voteCount }} {{ strings.voteCount }}</div>\n        </div>\n    </header>\n    <section class="lf-comment-body">\n        {{{ body }}}\n    </section>\n    {{> footer }}\n</div>\n{{#hasReplies}}\n<footer class=\'lf-comment-container-footer\'>\n    <span class="lf-reply-count">{{ strings.replyLink }}</span>\n</footer>\n{{/hasReplies}}\n<div class="lf-reply-container"></div>\n',Hogan)},{"hogan.js":93}],218:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(e,a,r){var t=this;return t.b(r=r||""),t.b('<header class="lf-menu-head"></header>'),t.b("\n"+r),t.b("<textarea class='lf-editor-field'></textarea>"),t.b("\n"),t.fl()},partials:{},subs:{}},"<header class=\"lf-menu-head\"></header>\n<textarea class='lf-editor-field'></textarea>\n",Hogan)},{"hogan.js":93}],219:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,s){var e=this;return e.b(s=s||""),e.b('<span class="lf-menu-foot">'),e.b(e.t(e.d("strings.postedAt",a,n,0))),e.b("</span>"),e.b("\n"+s),e.b('<a class="lf-powered-by" href="http://livefyre.com" target="_blank">'),e.b("\n"+s),e.b("    <span>"),e.b(e.v(e.d("strings.appName",a,n,0))),e.b(" powered by</span>"),e.b("\n"+s),e.b("</a>"),e.b("\n"),e.fl()},partials:{},subs:{}},'<span class="lf-menu-foot">{{{ strings.postedAt }}}</span>\n<a class="lf-powered-by" href="http://livefyre.com" target="_blank">\n    <span>{{ strings.appName }} powered by</span>\n</a>\n',Hogan)},{"hogan.js":93}],220:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,e){var o=this;return o.b(e=e||""),o.b('<div class="lf-escape-button fycon-x"></div>'),o.b("\n"+e),o.b('<div class="lf-loader-container"></div>'),o.b("\n"),o.fl()},partials:{},subs:{}},'<div class="lf-escape-button fycon-x"></div>\n<div class="lf-loader-container"></div>\n',Hogan)},{"hogan.js":93}],221:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(t,n,b){var o=this;return o.b(b=b||""),o.b('<button type="button" class="lf-menu-back-btn lf-btn lf-btn-sm lf-btn-default" tabindex="0">'),o.b(o.t(o.d("strings.backBtn",t,n,0))),o.b("</button>"),o.b("\n"+b),o.b("<h3>"),o.b(o.t(o.d("strings.title",t,n,0))),o.b("</h3>"),o.b("\n"+b),o.s(o.f("actionButton",t,n,1),t,n,0,173,290,"{{ }}")&&(o.rs(t,n,function(t,n,o){o.b('    <button type="button" class="lf-menu-action-btn lf-btn lf-btn-sm" tabindex="0">'),o.b(o.v(o.d("strings.actionBtn",t,n,0))),o.b("</button>"),o.b("\n"+b)}),t.pop()),o.fl()},partials:{},subs:{}},'<button type="button" class="lf-menu-back-btn lf-btn lf-btn-sm lf-btn-default" tabindex="0">{{{ strings.backBtn }}}</button>\n<h3>{{{ strings.title }}}</h3>\n{{#actionButton}}\n    <button type="button" class="lf-menu-action-btn lf-btn lf-btn-sm" tabindex="0">{{ strings.actionBtn }}</button>\n{{/actionButton}}\n',Hogan)},{"hogan.js":93}],222:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,s,n){var e=this;return e.b(n=n||""),e.b('<span class="lf-read-more">'),e.b("\n"+n),e.b('    <span class="lf-read-more-gradient"></span>'),e.b("\n"+n),e.b('    <span class="lf-read-more-text">'),e.b(e.v(e.d("strings.readMore",a,s,0))),e.b("</span>"),e.b("\n"+n),e.b("</span>"),e.b("\n"),e.fl()},partials:{},subs:{}},'<span class="lf-read-more">\n    <span class="lf-read-more-gradient"></span>\n    <span class="lf-read-more-text">{{strings.readMore}}</span>\n</span>\n',Hogan)},{"hogan.js":93}],223:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,e){var l=this;return l.b(e=e||""),l.b('<header class="lf-menu-head"></header>'),l.b("\n"+e),l.b('<div class="lf-thread-wrapper">'),l.b("\n"+e),l.b('    <div class="lf-thread"></div>'),l.b("\n"+e),l.b('    <button type="button" class="lf-reply-btn lf-btn-lg lf-btn-default"><span class="fycon-action-reply"></span>'),l.b(l.v(l.d("strings.reply",n,a,0))),l.b("</button>"),l.b("\n"+e),l.b("</div>"),l.b("\n"),l.fl()},partials:{},subs:{}},'<header class="lf-menu-head"></header>\n<div class="lf-thread-wrapper">\n    <div class="lf-thread"></div>\n    <button type="button" class="lf-reply-btn lf-btn-lg lf-btn-default"><span class="fycon-action-reply"></span>{{strings.reply}}</button>\n</div>\n',Hogan)},{"hogan.js":93}],224:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,s){var t=this;return t.b(s=s||""),t.b('<div class="lf-comment-container">'),t.b("\n"+s),t.b('    <img class="lf-comment-author-avatar" src="'),t.b(t.v(t.d("author.avatar",a,n,0))),t.b('" />'),t.b("\n"+s),t.b('    <header class="lf-comment-header">'),t.b("\n"+s),t.b('        <span class="lf-comment-author-name">'),t.b(t.t(t.d("author.displayName",a,n,0))),t.b("</span>"),t.b("\n"+s),t.b(t.rp("<tags0",a,n,"        ")),t.b('        <a class="lf-etc-btn fycon-action-etc"></a>'),t.b("\n"+s),t.b("    </header>"),t.b("\n"+s),t.b('    <section class="lf-comment-body">'),t.b("\n"+s),t.b("        "),t.b(t.t(t.f("body",a,n,0))),t.b("\n"+s),t.b("    </section>"),t.b("\n"+s),t.b("</div>"),t.b("\n"),t.fl()},partials:{"<tags0":{name:"tags",partials:{},subs:{}}},subs:{}},'<div class="lf-comment-container">\n    <img class="lf-comment-author-avatar" src="{{ author.avatar }}" />\n    <header class="lf-comment-header">\n        <span class="lf-comment-author-name">{{{ author.displayName }}}</span>\n        {{> tags}}\n        <a class="lf-etc-btn fycon-action-etc"></a>\n    </header>\n    <section class="lf-comment-body">\n        {{{ body }}}\n    </section>\n</div>\n',Hogan)},{"hogan.js":93}],225:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,a,e){var i=this;return i.b(e=e||""),i.b('<div class="lf-slide"></div>'),i.b("\n"),i.fl()},partials:{},subs:{}},'<div class="lf-slide"></div>\n',Hogan)},{"hogan.js":93}],226:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(e,o,r){var s=this;return s.b(r=r||""),s.b('<div class="lf-swipe-wrapper"></div>'),s.b("\n"+r),s.b('<footer class="lf-stream-footer"></footer>'),s.b("\n"),s.fl()},partials:{},subs:{}},'<div class="lf-swipe-wrapper"></div>\n<footer class="lf-stream-footer"></footer>\n',Hogan)},{"hogan.js":93}],227:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,s,a){var i=this;return i.b(a=a||""),i.s(i.f("index",n,s,1),n,s,0,10,78,"{{ }}")&&(i.rs(n,s,function(n,s,i){i.b("    <span>"),i.b(i.v(i.f("index",n,s,0))),i.b(" "),i.b(i.v(i.d("strings.tally",n,s,0))),i.b(" "),i.b(i.v(i.f("streamCount",n,s,0))),i.b("</span>"),i.b("\n"+a)}),n.pop()),i.s(i.f("loading",n,s,1),n,s,0,101,141,"{{ }}")&&(i.rs(n,s,function(n,s,i){i.b("    <span>"),i.b(i.v(i.d("strings.loading",n,s,0))),i.b("</span>"),i.b("\n"+a)}),n.pop()),i.s(i.f("indexOne",n,s,1),n,s,0,167,374,"{{ }}")&&(i.rs(n,s,function(n,s,i){i.b('    <span class="lf-pull-left lf-swipe-write">'),i.b("\n"+a),i.b('        <span class="fycon-arrow-left"></span><span class="fycon-arrow-left"></span>'),i.b("\n"+a),i.b('        <span class="lf-invite-text">'),i.b(i.v(i.d("strings.write",n,s,0))),i.b("</span>"),i.b("\n"+a),i.b("    </span>"),i.b("\n"+a)}),n.pop()),i.s(i.f("inviteRead",n,s,1),n,s,0,403,597,"{{ }}")&&(i.rs(n,s,function(n,s,i){i.b('    <span class="lf-pull-right">'),i.b("\n"+a),i.b('        <span class="lf-invite-text">'),i.b(i.v(i.d("strings.read",n,s,0))),i.b("</span>"),i.b("\n"+a),i.b('        <span class="fycon-arrow-right"></span><span class="fycon-arrow-right"></span>'),i.b("\n"+a),i.b("    </span>"),i.b("\n"+a)}),n.pop()),i.s(i.f("inviteWrite",n,s,1),n,s,0,629,839,"{{ }}")&&(i.rs(n,s,function(n,s,i){i.b('    <span class="lf-pull-right lf-swipe-write">'),i.b("\n"+a),i.b('        <span class="lf-invite-text">'),i.b(i.v(i.d("strings.write",n,s,0))),i.b("</span>"),i.b("\n"+a),i.b('        <span class="fycon-arrow-right"></span><span class="fycon-arrow-right"></span>'),i.b("\n"+a),i.b("    </span>"),i.b("\n"+a)}),n.pop()),i.fl()},partials:{},subs:{}},'{{#index}}\n    <span>{{ index }} {{ strings.tally }} {{ streamCount }}</span>\n{{/index}}\n{{#loading}}\n    <span>{{ strings.loading }}</span>\n{{/loading}}\n{{#indexOne}}\n    <span class="lf-pull-left lf-swipe-write">\n        <span class="fycon-arrow-left"></span><span class="fycon-arrow-left"></span>\n        <span class="lf-invite-text">{{strings.write}}</span>\n    </span>\n{{/indexOne}}\n{{#inviteRead}}\n    <span class="lf-pull-right">\n        <span class="lf-invite-text">{{strings.read}}</span>\n        <span class="fycon-arrow-right"></span><span class="fycon-arrow-right"></span>\n    </span>\n{{/inviteRead}}\n{{#inviteWrite}}\n    <span class="lf-pull-right lf-swipe-write">\n        <span class="lf-invite-text">{{strings.write}}</span>\n        <span class="fycon-arrow-right"></span><span class="fycon-arrow-right"></span>\n    </span>\n{{/inviteWrite}}\n',Hogan)},{"hogan.js":93}],228:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,o,e){var a=this;return a.b(e=e||""),a.b('<div class="lf lf-popover-content"></div>'),a.b("\n"),a.fl()},partials:{},subs:{}},'<div class="lf lf-popover-content"></div>\n',Hogan)},{"hogan.js":93}],229:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,o){var e=this;return e.b(o=o||""),e.b('<a class="lf-upvote fycon-arrow-up" tabindex="0"></a>'),e.b("\n"+o),e.b('<a class="lf-downvote fycon-arrow-down" tabindex="0"></a>'),e.b("\n"),e.fl()},partials:{},subs:{}},'<a class="lf-upvote fycon-arrow-up" tabindex="0"></a>\n<a class="lf-downvote fycon-arrow-down" tabindex="0"></a>\n',Hogan)},{"hogan.js":93}],230:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,e,n){var t=this;return t.b(n=n||""),t.b('<header class="lf-write-header">'),t.b("\n"+n),t.b('    <span class="lf-write-title">'),t.b(t.v(t.d("strings.title",s,e,0))),t.b("</span>"),t.b("\n"+n),t.b('    <div class="lf-escape-button fycon-x"></div>'),t.b("\n"+n),t.s(t.f("userLoggedIn",s,e,1),s,e,0,161,250,"{{ }}")&&(t.rs(s,e,function(s,e,t){t.b('        <div class="lf-user-settings"><div class="fycon-settings-gear"></div></div>'),t.b("\n"+n)}),s.pop()),t.b("</header>"),t.b("\n"+n),t.b('<section class="lf-write-body">'),t.b("\n"+n),t.b('    <span class="lf-write-text">'),t.b(t.v(t.d("strings.text",s,e,0))),t.b("</span>"),t.b("\n"+n),t.b("</section>"),t.b("\n"),t.fl()},partials:{},subs:{}},'<header class="lf-write-header">\n    <span class="lf-write-title">{{strings.title}}</span>\n    <div class="lf-escape-button fycon-x"></div>\n    {{#userLoggedIn}}\n        <div class="lf-user-settings"><div class="fycon-settings-gear"></div></div>\n    {{/userLoggedIn}}\n</header>\n<section class="lf-write-body">\n    <span class="lf-write-text">{{strings.text}}</span>\n</section>\n',Hogan)},{"hogan.js":93}],231:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(o,a,e){var l=this;return l.b(e=e||""),l.b('<div class="lf-thread-content lf-popover-content" role="dialog" aria-label="Sidenote Dialog"></div>'),l.b("\n"+e),l.b('<div class="lf-popover-arrow"></div>'),l.b("\n"),l.fl()},partials:{},subs:{}},'<div class="lf-thread-content lf-popover-content" role="dialog" aria-label="Sidenote Dialog"></div>\n<div class="lf-popover-arrow"></div>\n',Hogan)},{"hogan.js":93}],232:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,a,n){var l=this;return l.b(n=n||""),l.b('<div class="lf-votes" />'),l.b("\n"+n),l.b('<span class="lf-separator">&middot;</span>'),l.b("\n"+n),l.b('<a class="lf-reply-btn"tabindex="0">'),l.b(l.v(l.d("strings.replyBtn",s,a,0))),l.b("</a>"),l.b("\n"),l.fl()},partials:{},subs:{}},'<div class="lf-votes" />\n<span class="lf-separator">&middot;</span>\n<a class="lf-reply-btn"tabindex="0">{{ strings.replyBtn }}</a>\n',Hogan)},{"hogan.js":93}],233:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,s,n){var t=this;return t.b(n=n||""),t.b('<img class="lf-comment-author-avatar" src="'),t.b(t.v(t.f("avatar",a,s,0))),t.b('" onerror="javascript:this.src=\''),t.b(t.v(t.f("defaultAvatar",a,s,0))),t.b("';\" />"),t.b("\n"+n),t.b('<header class="lf-comment-header">'),t.b("\n"+n),t.b('    <span class="lf-comment-author-name">'),t.b(t.t(t.d("author.displayName",a,s,0))),t.b("</span>"),t.b("\n"+n),t.b(t.rp("<tags0",a,s,"    ")),t.b("</header>"),t.b("\n"+n),t.b('<section class="lf-comment-body">'),t.b("\n"+n),t.b("    "),t.b(t.t(t.f("body",a,s,0))),t.b("\n"+n),t.b("</section>"),t.b("\n"),t.fl()},partials:{"<tags0":{name:"tags",partials:{},subs:{}}},subs:{}},'<img class="lf-comment-author-avatar" src="{{ avatar }}" onerror="javascript:this.src=\'{{ defaultAvatar }}\';" />\n<header class="lf-comment-header">\n    <span class="lf-comment-author-name">{{{ author.displayName }}}</span>\n    {{> tags}}\n</header>\n<section class="lf-comment-body">\n    {{{ body }}}\n</section>\n',Hogan)},{"hogan.js":93}],234:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,e){var s=this;return s.b(e=e||""),s.b('<div class="lf-comment-container">'),s.b("\n"+e),s.b(s.rp("<base0",a,n,"    ")),s.b("</div>"),s.b("\n"),s.fl()},partials:{"<base0":{name:"base",partials:{},subs:{}}},subs:{}},'<div class="lf-comment-container">\n    {{> base}}\n</div>\n',Hogan)},{"hogan.js":93}],235:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,t){var e=this;return e.b(t=t||""),e.b('<a class="lf-etc-btn fycon-action-etc" tabindex="0"></a>'),e.b("\n"),e.fl()},partials:{},subs:{}},'<a class="lf-etc-btn fycon-action-etc" tabindex="0"></a>\n',Hogan)},{"hogan.js":93}],236:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,o,e){var s=this;return s.b(e=e||""),s.b('<footer class="lf-comment-footer">'),s.b("\n"+e),s.b('    <span class="lf-comment-actions"></span>'),s.b("\n"+e),s.b(s.rp("<etc0",n,o,"    ")),s.b("</footer>"),s.b("\n"),s.fl()},partials:{"<etc0":{name:"etc",partials:{},subs:{}}},subs:{}},'<footer class="lf-comment-footer">\n    <span class="lf-comment-actions"></span>\n    {{> etc}}\n</footer>\n',Hogan)},{"hogan.js":93}],237:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,l){var e=this;return e.b(l=l||""),e.s(e.f("moderator",n,a,1),n,a,0,14,126,"{{ }}")&&(e.rs(n,a,function(n,a,e){e.b('    <span class="lf-comment-author-tag lf-tag lf-label lf-label-info">'),e.b(e.v(e.d("strings.commentModeratorTag",n,a,0))),e.b("</span>"),e.b("\n"+l)}),n.pop()),e.s(e.f("pending",n,a,1),n,a,0,153,264,"{{ }}")&&(e.rs(n,a,function(n,a,e){e.b('    <span class="lf-comment-pending-tag lf-tag lf-label lf-label-info">'),e.b(e.v(e.d("strings.commentPendingTag",n,a,0))),e.b("</span>"),e.b("\n"+l)}),n.pop()),e.fl()},partials:{},subs:{}},'{{#moderator}}\n    <span class="lf-comment-author-tag lf-tag lf-label lf-label-info">{{ strings.commentModeratorTag }}</span>\n{{/moderator}}\n{{#pending}}\n    <span class="lf-comment-pending-tag lf-tag lf-label lf-label-info">{{ strings.commentPendingTag }}</span>\n{{/pending}}\n',Hogan)},{"hogan.js":93}],238:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,e){var s=this;return s.b(e=e||""),s.b('<div class="lf-comment-container">'),s.b("\n"+e),s.b(s.rp("<base0",n,a,"    ")),s.b(s.rp("<footer1",n,a,"    ")),s.b("</div>"),s.b("\n"+e),s.b('<div class="lf-reply-container"></div>'),s.b("\n"+e),s.b('<div class="lf-editor-container"></div>'),s.b("\n"),s.fl()},partials:{"<base0":{name:"base",partials:{},subs:{}},"<footer1":{name:"footer",partials:{},subs:{}}},subs:{}},'<div class="lf-comment-container">\n    {{> base }}\n    {{> footer }}\n</div>\n<div class="lf-reply-container"></div>\n<div class="lf-editor-container"></div>\n',Hogan)},{"hogan.js":93}],239:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,o){var s=this;return s.b(o=o||""),s.b('<span class="lf-count">'),s.b(s.v(s.f("count",a,n,0))),s.b("</span>"),s.b("\n"+o),s.b('<a class="lf-upvote fycon-arrow-up" tabindex="0"></a>'),s.b("\n"+o),s.b('<a class="lf-downvote fycon-arrow-down" tabindex="0"></a>'),s.b("\n"),s.fl()},partials:{},subs:{}},'<span class="lf-count">{{ count }}</span>\n<a class="lf-upvote fycon-arrow-up" tabindex="0"></a>\n<a class="lf-downvote fycon-arrow-down" tabindex="0"></a>\n',Hogan)},{"hogan.js":93}],240:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(t,e,s){var a=this;return a.b(s=s||""),a.b('<div class="lf-editor-resize" />'),a.b("\n"+s),a.b("<textarea class='lf-editor-field'></textarea>"),a.b("\n"+s),a.b("<a class='lf-editor-post-btn'>"),a.b(a.v(a.d("strings.postBtn",t,e,0))),a.b("</a>"),a.b("\n"),a.fl()},partials:{},subs:{}},"<div class=\"lf-editor-resize\" />\n<textarea class='lf-editor-field'></textarea>\n<a class='lf-editor-post-btn'>{{ strings.postBtn }}</a>\n",Hogan)},{"hogan.js":93}],241:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,s,a){var o=this;return o.b(a=a||""),o.b('<div class="lf-editor-error">'),o.b("\n"+a),o.b('    <a class="lf-close fycon-x"></a>'),o.b("\n"+a),o.b("    <span>"),o.b(o.t(o.f("msg",n,s,0))),o.b("</span>"),o.b("\n"+a),o.b("</div>"),o.b("\n"),o.fl()},partials:{},subs:{}},'<div class="lf-editor-error">\n    <a class="lf-close fycon-x"></a>\n    <span>{{{ msg }}}</span>\n</div>\n',Hogan)},{"hogan.js":93}],242:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,e){var l=this;return l.b(e=e||""),l.b('<div class="lf-expandable-container"></div>'),l.b("\n"+e),l.b('<div class="lf-expandable-footer">'),l.b("\n"+e),l.b('    <a class="lf-expand-reply-btn" tabindex="0">'),l.b(l.v(l.d("strings.replyBtnText",n,a,0))),l.b("</a>"),l.b("\n"+e),l.b("</div>"),l.b("\n"),l.fl()},partials:{},subs:{}},'<div class="lf-expandable-container"></div>\n<div class="lf-expandable-footer">\n    <a class="lf-expand-reply-btn" tabindex="0">{{ strings.replyBtnText }}</a>\n</div>\n',Hogan)},{"hogan.js":93}],243:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,s){var e=this;return e.b(s=s||""),e.b('<div class="lf"></div>'),e.b("\n"),e.fl()},partials:{},subs:{}},'<div class="lf"></div>\n',Hogan)},{"hogan.js":93}],244:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,e){var o=this;return o.b(e=e||""),o.b('<div class="lf-loader-container"></div>'),o.b("\n"),o.fl()},partials:{},subs:{}},'<div class="lf-loader-container"></div>\n',Hogan)},{"hogan.js":93}],245:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,s,t){var i=this;return i.b(t=t||""),i.b('<div class="fycon-icon-sidenotes" />'),i.b("\n"+t),i.b('<span class="lf-signed-in">'),i.b(i.t(i.d("strings.signedInMsg",n,s,0))),i.b("</span>"),i.b("\n"+t),i.b('<button class="lf-signin-btn lf-btn lf-btn-default">'),i.b(i.t(i.d("strings.signInBtn",n,s,0))),i.b("</span>"),i.b("\n"),i.fl()},partials:{},subs:{}},'<div class="fycon-icon-sidenotes" />\n<span class="lf-signed-in">{{{ strings.signedInMsg }}}</span>\n<button class="lf-signin-btn lf-btn lf-btn-default">{{{ strings.signInBtn }}}</span>\n',Hogan)},{"hogan.js":93}],246:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,s,a){var e=this;return e.b(a=a||""),e.b('<li data-value="'),e.b(e.v(e.f("key",n,s,0))),e.b('" class="lf-'),e.b(e.v(e.f("key",n,s,0))),e.b(" "),e.b(e.v(e.f("cls",n,s,0))),e.b('">'),e.b("\n"+a),e.b("    <span>"),e.b(e.v(e.f("str",n,s,0))),e.b("</span>"),e.b("\n"+a),e.s(e.f("showTimeRemaining",n,s,1),n,s,0,112,253,"{{ }}")&&(e.rs(n,s,function(n,s,e){e.b('        <span class="lf-edit-timer">'),e.b("\n"+a),e.b('            <span class="fycon-clock lf-edit-countdown">'),e.b(e.v(e.f("timeRemaining",n,s,0))),e.b("</span>"),e.b("\n"+a),e.b("        </span>"),e.b("\n"+a)}),n.pop()),e.b("</li>"),e.b("\n"),e.fl()},partials:{},subs:{}},'<li data-value="{{ key }}" class="lf-{{ key }} {{ cls }}">\n    <span>{{ str }}</span>\n    {{#showTimeRemaining}}\n        <span class="lf-edit-timer">\n            <span class="fycon-clock lf-edit-countdown">{{ timeRemaining }}</span>\n        </span>\n    {{/showTimeRemaining}}\n</li>\n',Hogan)},{"hogan.js":93}],247:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,n,a){var t=this;return t.b(a=a||""),t.b('<span class="lf-menu-foot">'),t.b(t.t(t.d("strings.postedAt",s,n,0))),t.b("</span>"),t.b("\n"),t.fl()},partials:{},subs:{}},'<span class="lf-menu-foot">{{{ strings.postedAt }}}</span>\n',Hogan)},{"hogan.js":93}],248:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,n,e){var a=this;return a.b(e=e||""),a.b('<div class="fycon-icon-sidenotes" />'),a.b("\n"+e),a.b("<h3>"),a.b(a.v(a.d("strings.appName",s,n,0))),a.b("</h3>"),a.b("\n"+e),a.b('<span class="lf-powered-by">powered by</span>'),a.b("\n"+e),a.b('<span class="lf-version">'),a.b(a.v(a.d("strings.version",s,n,0))),a.b("</span>"),a.b("\n"+e),a.b('<a href="http://web.livefyre.com" target="_blank">'),a.b(a.v(a.d("strings.livefyreLink",s,n,0))),a.b("</a>"),a.b("\n"+e),a.b('<a href="https://livefyre.zendesk.com/hc/en-us" target="_blank" class="lf-help fycon-question">'),a.b(a.v(a.d("strings.helpLink",s,n,0))),a.b("</a>"),a.b("\n"+e),a.b('<label class="lf-copyright lf-menu-foot">'),a.b(a.t(a.d("strings.copyright",s,n,0))),a.b("</label>"),a.b("\n"),a.fl()},partials:{},subs:{}},'<div class="fycon-icon-sidenotes" />\n<h3>{{ strings.appName }}</h3>\n<span class="lf-powered-by">powered by</span>\n<span class="lf-version">{{ strings.version }}</span>\n<a href="http://web.livefyre.com" target="_blank">{{ strings.livefyreLink }}</a>\n<a href="https://livefyre.zendesk.com/hc/en-us" target="_blank" class="lf-help fycon-question">{{ strings.helpLink }}</a>\n<label class="lf-copyright lf-menu-foot">{{{ strings.copyright }}}</label>\n',Hogan)},{"hogan.js":93}],249:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,e,l){var b=this;return b.b(l=l||""),b.b('<li data-value="'),b.b(b.v(b.f("key",a,e,0))),b.b('" class="lf-'),b.b(b.v(b.f("key",a,e,0))),b.b(" "),b.b(b.v(b.f("cls",a,e,0))),b.b('" tabindex="0">'),b.b(b.v(b.f("str",a,e,0))),b.b("</li>"),b.b("\n"),b.fl()},partials:{},subs:{}},'<li data-value="{{ key }}" class="lf-{{ key }} {{ cls }}" tabindex="0">{{ str }}</li>\n',Hogan)},{"hogan.js":93}],250:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(e,a,o){var n=this;return n.b(o=o||""),n.b('<footer class="lf-menu-foot">'),n.b("\n"+o),n.b("    <textarea readonly>"),n.b(n.v(n.f("permalink",e,a,0))),n.b("</textarea>"),n.b("\n"+o),n.b("</footer>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<footer class="lf-menu-foot">\n    <textarea readonly>{{ permalink }}</textarea>\n</footer>\n',Hogan)},{"hogan.js":93}],251:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,s,l){var n=this;return n.b(l=l||""),n.b('<img src="'),n.b(n.v(n.f("avatar",a,s,0))),n.b('" class="lf-title-avatar" />'),n.b("\n"+l),n.b('<span class="lf-title-display-name">'),n.b(n.v(n.f("displayName",a,s,0))),n.b("</span>"),n.b("\n"),n.fl()},partials:{},subs:{}},'<img src="{{ avatar }}" class="lf-title-avatar" />\n<span class="lf-title-display-name">{{ displayName }}</span>\n',Hogan)},{"hogan.js":93}],252:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,e){var b=this;return b.b(e=e||""),b.s(b.f("topNavEnabled",a,n,1),a,n,0,18,88,"{{ }}")&&(b.rs(a,n,function(a,n,b){b.b('    <header class="lf-menu-head">'),b.b("\n"+e),b.b(b.rp("<navbar0",a,n,"        ")),b.b("    </header>"),b.b("\n"+e)}),a.pop()),b.b('<div class="lf-menu-body">'),b.b("\n"+e),b.b(b.rp("<body1",a,n,"    ")),b.b("</div>"),
b.b("\n"),b.fl()},partials:{"<navbar0":{name:"navbar",partials:{},subs:{}},"<body1":{name:"body",partials:{},subs:{}}},subs:{}},'{{#topNavEnabled}}\n    <header class="lf-menu-head">\n        {{> navbar}}\n    </header>\n{{/topNavEnabled}}\n<div class="lf-menu-body">\n    {{> body}}\n</div>\n',Hogan)},{"hogan.js":93}],253:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,e,n){var o=this;return o.b(n=n||""),o.fl()},partials:{},subs:{}},"",Hogan)},{"hogan.js":93}],254:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(i,n,t){var o=this;return o.b(t=t||""),o.b('<div class="lf-notification-icon" />'),o.b("\n"+t),o.b('<h4 class="lf-notification-title">'),o.b(o.v(o.d("strings.title",i,n,0))),o.b("</h4>"),o.b("\n"),o.fl()},partials:{},subs:{}},'<div class="lf-notification-icon" />\n<h4 class="lf-notification-title">{{ strings.title }}</h4>\n',Hogan)},{"hogan.js":93}],255:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(s,n,o){var a=this;return a.b(o=o||""),a.b('<div class="fycon-composer-sad" />'),a.b("\n"+o),a.b('<h4 class="lf-permalink-missing">'),a.b(a.v(a.f("doesNotExist",s,n,0))),a.b("</h4>"),a.b("\n"),a.fl()},partials:{},subs:{}},'<div class="fycon-composer-sad" />\n<h4 class="lf-permalink-missing">{{ doesNotExist }}</h4>\n',Hogan)},{"hogan.js":93}],256:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,a,s){var o=this;return o.b(s=s||""),o.b('<span class="lf-btn-text" />'),o.b("\n"+s),o.b('<span class="fycon-arrow-down" />'),o.b("\n"),o.fl()},partials:{},subs:{}},'<span class="lf-btn-text" />\n<span class="fycon-arrow-down" />\n',Hogan)},{"hogan.js":93}],257:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,n,s){var e=this;return e.b(s=s||""),e.b('<img src="'),e.b(e.v(e.f("assetServer",a,n,0))),e.b('/images/default-avatar.png" class="lf-anon-avatar" />'),e.b("\n"+s),e.b('<div class="lf-anon-editor" tabindex="0">'),e.b(e.t(e.d("strings.signInToPost",a,n,0))),e.b("</div>"),e.b("\n"),e.fl()},partials:{},subs:{}},'<img src="{{ assetServer }}/images/default-avatar.png" class="lf-anon-avatar" />\n<div class="lf-anon-editor" tabindex="0">{{{ strings.signInToPost }}}</div>\n',Hogan)},{"hogan.js":93}],258:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,r,s){var t=this;return t.b(s=s||""),t.b('<div class="lf-author-flip">'),t.b("\n"+s),t.b('    <div class="lf-author-flip-front">'),t.b("\n"+s),t.b('        <img src="'),t.b(t.v(t.f("avatar",a,r,0))),t.b('" class="lf-author-avatar" onerror="javascript:this.src=\''),t.b(t.v(t.f("defaultAvatar",a,r,0))),t.b("';\" />"),t.b("\n"+s),t.b("    </div>"),t.b("\n"+s),t.b('    <div class="lf-author-flip-back fycon-settings-gear"></div>'),t.b("\n"+s),t.b("</div>"),t.b("\n"),t.fl()},partials:{},subs:{}},'<div class="lf-author-flip">\n    <div class="lf-author-flip-front">\n        <img src="{{ avatar }}" class="lf-author-avatar" onerror="javascript:this.src=\'{{ defaultAvatar }}\';" />\n    </div>\n    <div class="lf-author-flip-back fycon-settings-gear"></div>\n</div>\n',Hogan)},{"hogan.js":93}],259:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,e,n){var r=this;return r.b(n=n||""),r.b('<div class="lf-thread-gradient" />'),r.b("\n"),r.fl()},partials:{},subs:{}},'<div class="lf-thread-gradient" />\n',Hogan)},{"hogan.js":93}],260:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(a,e,r){var n=this;return n.b(r=r||""),n.b(n.rp("<loader0",a,e,"")),n.b('<a class="lf-powered-by" href="http://livefyre.com" target="_blank">'),n.b("\n"+r),n.b("    <span>"),n.b(n.v(n.d("strings.appName",a,e,0))),n.b(" powered by</span>"),n.b("\n"+r),n.b("</a>"),n.b("\n"),n.fl()},partials:{"<loader0":{name:"loader",partials:{},subs:{}}},subs:{}},'{{> loader}}\n<a class="lf-powered-by" href="http://livefyre.com" target="_blank">\n    <span>{{ strings.appName }} powered by</span>\n</a>\n',Hogan)},{"hogan.js":93}],261:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(n,e,a){var o=this;return o.b(a=a||""),o.b('<section class="lf-thread-container"></section>'),o.b("\n"),o.fl()},partials:{},subs:{}},'<section class="lf-thread-container"></section>\n',Hogan)},{"hogan.js":93}],262:[function(_dereq_,module,exports){var Hogan=_dereq_("hogan.js");module.exports=new Hogan.Template({code:function(r,e,n){var t=this;return t.b(n=n||""),t.b("<script>"),t.b("\n"+n),t.b("  (function(i,s,o,g,r,a,m){i['LivefyreTrackerObject']=r;i[r]=i[r]||function(){"),t.b("\n"+n),t.b("  (i[r].q=i[r].q||[]).push(arguments);};a=s.createElement(o),m=s.getElementsByTagName(o)[0];"),t.b("\n"+n),t.b("  a.async=true;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script',"),t.b("\n"+n),t.b("  '"),t.b(t.v(t.f("cdn",r,e,0))),t.b("/libs/tracker-js/v0.1.0/tracker.js','lft');"),t.b("\n"+n),t.b("<\/script>"),t.b("\n"),t.fl()},partials:{},subs:{}},"<script>\n  (function(i,s,o,g,r,a,m){i['LivefyreTrackerObject']=r;i[r]=i[r]||function(){\n  (i[r].q=i[r].q||[]).push(arguments);};a=s.createElement(o),m=s.getElementsByTagName(o)[0];\n  a.async=true;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script',\n  '{{ cdn }}/libs/tracker-js/v0.1.0/tracker.js','lft');\n<\/script>\n",Hogan)},{"hogan.js":93}]},{},[136])(136)});